(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    690270,      16693]
NotebookOptionsPosition[    680998,      16557]
NotebookOutlinePosition[    681340,      16572]
CellTagsIndexPosition[    681297,      16569]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"NotebookDelete", "/@", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"Cells", "[", 
      RowBox[{"GeneratedCell", "\[Rule]", "False"}], "]"}], ",", 
     RowBox[{
      RowBox[{"StringMatchQ", "[", 
       RowBox[{
        RowBox[{"First", "@", 
         RowBox[{"FrontEndExecute", "[", 
          RowBox[{"FrontEnd`ExportPacket", "[", 
           RowBox[{
            RowBox[{"NotebookRead", "@", "#"}], ",", "\"\<InputText\>\""}], 
           "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
          "\"\< \>\"", "|", "\"\<\\t\>\"", "|", "\"\<\\r\>\"", "|", 
           "\"\<\\n\>\"", "|", "\"\<\[IndentingNewLine]\>\""}], ")"}], 
         "..."}]}], "]"}], "&"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.74119924801735*^9, 3.7411992498235636`*^9}, {
   3.741199286110298*^9, 3.741199295520392*^9}, {3.7419615740897446`*^9, 
   3.74196159483294*^9}, {3.7419616498064594`*^9, 3.741961680792351*^9}, {
   3.7419617142480264`*^9, 3.7419617200404263`*^9}, {3.7427572629552393`*^9, 
   3.7427572636803026`*^9}, {3.7427658315935073`*^9, 3.7427658342494097`*^9}, 
   3.742774777970193*^9, {3.744918632978471*^9, 
   3.7449186492099853`*^9}},ExpressionUUID->"9683201a-c063-4b23-a797-\
40f561c4b66a"],

Cell[CellGroupData[{

Cell["Bloch Oscillations: Starting from scratch", "Title",
 CellChangeTimes->{{3.74119924801735*^9, 3.7411992498235636`*^9}, {
   3.741199286110298*^9, 3.741199295520392*^9}, 3.7419615740897446`*^9, {
   3.742766764669775*^9, 3.7427667695956116`*^9}, {3.743802593978156*^9, 
   3.743802595557847*^9}, 
   3.74491850344703*^9},ExpressionUUID->"72126f28-df3c-41af-85d8-\
de8d4133e54c"],

Cell[CellGroupData[{

Cell["Intro", "Section",
 CellChangeTimes->{{3.74119924801735*^9, 3.7411992498235636`*^9}, {
   3.741199286110298*^9, 3.741199295520392*^9}, 3.7419615740897446`*^9, {
   3.742766764669775*^9, 3.7427667695956116`*^9}, {3.743802593978156*^9, 
   3.7438026088423347`*^9}},ExpressionUUID->"c743ae9a-090d-420d-a144-\
a92cae18c743"],

Cell[TextData[{
 "\tThis following Bloch oscillation work is based off of a number of \
sources. I started from basic AMO concepts outlined in \
\[OpenCurlyDoubleQuote]Bloch oscillations of cold atoms in optical lattices\
\[CloseCurlyDoubleQuote], a 2004 paper by Kolovsky and Korsch. From there, I \
matched these results up with Chenghui\[CloseCurlyQuote]s 2018 thesis, a \
paper \[OpenCurlyDoubleQuote]Theoretical analysis of a large momentum \
beamsplitter using Bloch oscillations\[CloseCurlyDoubleQuote] by Biraben\
\[CloseCurlyQuote]s group from 2010 (which was mostly correct, but I found \
one typo in their definition of ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["U", "0"], TraditionalForm]],ExpressionUUID->
  "71e89576-4612-4357-8e04-48c6956f3d92"],
 " which they later corrected in their \[Alpha] paper), Matt Jaffe\
\[CloseCurlyQuote]s code in Mathematica/Matlab and documentation in One Note, \
and Richard\[CloseCurlyQuote]s code in Matlab as well. After carefully \
following the derivations from all of these sources, I found:\n\n\t1) I think \
Matt\[CloseCurlyQuote]s factor of 4 difference from Biraben was Matt\
\[CloseCurlyQuote]s mistake, I agree with the Biraben analysis. \n\t2) \
Chenghui\[CloseCurlyQuote]s thesis is missing a factor of two in the phase \
factor from ramping the lattice. He appears to have thought that he was off \
by a factor of the the recoil frequency (which equals 1/2 in the \
dimensionless unit system we will use), but it really comes from needing to \
integrate the phase difference between lasers while ramping the frequency \
difference. See the paper \[OpenCurlyDoubleQuote]Bloch oscillations of atoms, \
adiabatic rapid passage, and monokinetic atomic beams\[CloseCurlyDoubleQuote] \
and the discussion below. \n\t3) Biraben quotes that they use a value ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["U", "0"], "~"}], "=", " ", 
    RowBox[{"8", 
     SubscriptBox["E", "r"]}]}], TraditionalForm]], "Item",ExpressionUUID->
  "8271410b-9620-40ff-8a4e-6afef0a4134f"],
 ", and I think the \[OpenCurlyDoubleQuote]approximately\
\[CloseCurlyDoubleQuote] comes from the fact that momentum space distribution \
of a free space plane wave does not exactly correspond to a single momentum \
state when loaded into the lattice. I don\[CloseCurlyQuote]t fully understand \
this point, it might be worth coming back to later, but for now we are \
interested in factors of two or four, not small corrections. Another thought: \
it could come from the fact the Hamiltonian generally assumes that the two \
Rabi frequencies are equal because the separation between states is so small, \
but because the Biraben group uses so many BO they might have run into \
problems from this assumption.\n\t4) Matt\[CloseCurlyQuote]s lattice frame \
code doesn\[CloseCurlyQuote]t account for photon kicks at the edge of the \
Bruillon zone. These momentum kicks are required by conservation of momentum \
and result from the fact that the quasimomentum is defined modulo the first \
Bruillon zone, yet the expression for the quasimomentum increases linearly in \
time. Richard\[CloseCurlyQuote]s code works in the lab frame, so there is no \
ramping of the quasimomentum and therefore no need for these extra momentum \
kicks. After adding in these momentum kicks, the lattice frame simulation \
agrees with the lab frame simulation exactly. \n\t\n\t\nIn everything below, \
I tried match up results between all of the references I was looking through. \
In particular, I made sure that the Hamiltonians in the lab frame and the \
atom rest frame gave the same simulation results. Below I walk through \
deriving the atom frame Hamiltonian and then the lab frame Hamiltonian. "
}], "Text",
 CellChangeTimes->{{3.7411992744871707`*^9, 3.741199277753787*^9}, {
   3.741199329629159*^9, 3.741199338064886*^9}, {3.741199368504813*^9, 
   3.7411993698257046`*^9}, {3.741199401597207*^9, 3.7411997625721455`*^9}, {
   3.741199846291649*^9, 3.741200382385866*^9}, {3.741200427533717*^9, 
   3.741200439928916*^9}, {3.741200484603733*^9, 3.7412005084681587`*^9}, {
   3.7412077338715487`*^9, 3.7412077495987873`*^9}, {3.7412077914572773`*^9, 
   3.7412079059812846`*^9}, {3.7412079816090827`*^9, 3.741208132189682*^9}, {
   3.741208202006751*^9, 3.741208296988839*^9}, {3.741208338199029*^9, 
   3.7412085416859837`*^9}, {3.7412086046986666`*^9, 3.741209460977104*^9}, {
   3.741209498600194*^9, 3.741209698206129*^9}, {3.7412097349028883`*^9, 
   3.741210043445814*^9}, {3.7412100836940546`*^9, 3.7412101384584217`*^9}, {
   3.7412101698055906`*^9, 3.741210448834248*^9}, {3.7412104801675873`*^9, 
   3.741210581747401*^9}, {3.741210618480197*^9, 3.741210651729346*^9}, {
   3.741210687364279*^9, 3.741210916786361*^9}, {3.741210994867734*^9, 
   3.741211213461388*^9}, {3.741211246824896*^9, 3.7412113588050137`*^9}, {
   3.74130691264672*^9, 3.741306915646143*^9}, {3.7413070675672693`*^9, 
   3.7413072831942434`*^9}, {3.741313614486566*^9, 3.7413137079159765`*^9}, 
   3.741314180068103*^9, {3.7413180248873234`*^9, 3.7413180456591454`*^9}, {
   3.7413181688336945`*^9, 3.7413181715776787`*^9}, {3.7421303227491975`*^9, 
   3.7421304390003257`*^9}, {3.7421304842925816`*^9, 3.742130491325249*^9}, {
   3.742130527196397*^9, 3.7421309086494265`*^9}, {3.74213095870535*^9, 
   3.7421310710856757`*^9}, {3.7421311129186974`*^9, 
   3.7421314043825893`*^9}, {3.7421314404908075`*^9, 
   3.7421314412680407`*^9}, {3.7421314715476165`*^9, 
   3.7421316145307465`*^9}, {3.7421330327952957`*^9, 
   3.7421331365014286`*^9}, {3.742133290332019*^9, 3.7421332916526966`*^9}, {
   3.742166456600613*^9, 3.742166472335432*^9}, {3.742166784375162*^9, 
   3.7421668123352747`*^9}, {3.742166846237751*^9, 3.742167233964834*^9}, {
   3.742167273592329*^9, 3.7421672747559323`*^9}, 3.7421679569338775`*^9, {
   3.74216809937573*^9, 3.7421681212975616`*^9}, {3.74216825084136*^9, 
   3.742168265665747*^9}, {3.7421682992953515`*^9, 3.7421683052713933`*^9}, {
   3.742168337030405*^9, 3.7421683858703747`*^9}, {3.7422215892216387`*^9, 
   3.7422216273128004`*^9}, {3.742224563041355*^9, 3.7422245630450773`*^9}, {
   3.742224719383098*^9, 3.7422247881596932`*^9}, {3.7422250744724936`*^9, 
   3.7422252939595013`*^9}, {3.7422253832688537`*^9, 3.742225551697933*^9}, {
   3.742225895660311*^9, 3.7422259931936893`*^9}, {3.7422260653175783`*^9, 
   3.7422262109344993`*^9}, {3.7422262444014173`*^9, 3.742226326885026*^9}, {
   3.742765867378873*^9, 3.742766092463871*^9}, {3.742766139341591*^9, 
   3.7427666511198874`*^9}, {3.7427667832212744`*^9, 3.742767013838937*^9}, {
   3.742767046795941*^9, 3.7427670850157166`*^9}, {3.7427673885716476`*^9, 
   3.7427676444548955`*^9}, {3.7427676996391673`*^9, 3.742767797723146*^9}, {
   3.742767828678318*^9, 3.7427678310559645`*^9}, {3.7427679193988695`*^9, 
   3.742767923646519*^9}, {3.742768434567094*^9, 3.7427684732078266`*^9}, {
   3.7427689856623135`*^9, 3.7427689874505343`*^9}, {3.742769214090642*^9, 
   3.742769458919345*^9}, {3.742769493164827*^9, 3.7427694982244167`*^9}, {
   3.742770501730461*^9, 3.7427706019265924`*^9}, {3.7427706526769643`*^9, 
   3.7427706683799973`*^9}, {3.7427712377103004`*^9, 
   3.7427716821426506`*^9}, {3.7433852951255536`*^9, 
   3.7433853054238677`*^9}, {3.7438023087103615`*^9, 3.743802326567545*^9}, {
   3.743802552218171*^9, 3.7438025629863415`*^9}, {3.743802612423258*^9, 
   3.7438028040973015`*^9}, {3.745618974852085*^9, 
   3.7456189828752565`*^9}},ExpressionUUID->"a2fc3284-537e-4ca5-88a3-\
fb7727496c0a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Bloch Oscillations in Lattice Frame", "Section",
 CellChangeTimes->{{3.7411992744871707`*^9, 3.741199277753787*^9}, {
   3.741199329629159*^9, 3.741199338064886*^9}, {3.741199368504813*^9, 
   3.7411993698257046`*^9}, {3.741199401597207*^9, 3.7411997625721455`*^9}, {
   3.741199846291649*^9, 3.741200382385866*^9}, {3.741200427533717*^9, 
   3.741200439928916*^9}, {3.741200484603733*^9, 3.7412005084681587`*^9}, {
   3.7412077338715487`*^9, 3.7412077495987873`*^9}, {3.7412077914572773`*^9, 
   3.7412079059812846`*^9}, {3.7412079816090827`*^9, 3.741208132189682*^9}, {
   3.741208202006751*^9, 3.741208296988839*^9}, {3.741208338199029*^9, 
   3.7412085416859837`*^9}, {3.7412086046986666`*^9, 3.741209460977104*^9}, {
   3.741209498600194*^9, 3.741209698206129*^9}, {3.7412097349028883`*^9, 
   3.741210043445814*^9}, {3.7412100836940546`*^9, 3.7412101384584217`*^9}, {
   3.7412101698055906`*^9, 3.741210448834248*^9}, {3.7412104801675873`*^9, 
   3.741210581747401*^9}, {3.741210618480197*^9, 3.741210651729346*^9}, {
   3.741210687364279*^9, 3.741210916786361*^9}, {3.741210994867734*^9, 
   3.741211213461388*^9}, {3.741211246824896*^9, 3.7412113588050137`*^9}, {
   3.74130691264672*^9, 3.741306915646143*^9}, {3.7413070675672693`*^9, 
   3.7413072831942434`*^9}, {3.741313614486566*^9, 3.7413137079159765`*^9}, 
   3.741314180068103*^9, {3.7413180248873234`*^9, 3.7413180456591454`*^9}, {
   3.7413181688336945`*^9, 3.7413181715776787`*^9}, {3.7421303227491975`*^9, 
   3.7421304390003257`*^9}, {3.7421304842925816`*^9, 3.742130491325249*^9}, {
   3.742130527196397*^9, 3.7421309086494265`*^9}, {3.74213095870535*^9, 
   3.7421310710856757`*^9}, {3.7421311129186974`*^9, 
   3.7421314043825893`*^9}, {3.7421314404908075`*^9, 
   3.7421314412680407`*^9}, {3.7421314715476165`*^9, 
   3.7421316145307465`*^9}, {3.7421330327952957`*^9, 
   3.7421331365014286`*^9}, {3.742133290332019*^9, 3.7421332916526966`*^9}, {
   3.742166456600613*^9, 3.742166472335432*^9}, {3.742166784375162*^9, 
   3.7421668123352747`*^9}, {3.742166846237751*^9, 3.742167233964834*^9}, {
   3.742167273592329*^9, 3.7421672747559323`*^9}, 3.7421679569338775`*^9, {
   3.74216809937573*^9, 3.7421681212975616`*^9}, {3.74216825084136*^9, 
   3.742168265665747*^9}, {3.7421682992953515`*^9, 3.7421683052713933`*^9}, {
   3.742168337030405*^9, 3.7421683858703747`*^9}, {3.7422215892216387`*^9, 
   3.7422216273128004`*^9}, {3.742224563041355*^9, 3.7422245630450773`*^9}, {
   3.742224719383098*^9, 3.7422247881596932`*^9}, {3.7422250744724936`*^9, 
   3.7422252939595013`*^9}, {3.7422253832688537`*^9, 3.742225551697933*^9}, {
   3.742225895660311*^9, 3.7422259931936893`*^9}, {3.7422260653175783`*^9, 
   3.7422262109344993`*^9}, {3.7422262444014173`*^9, 3.742226326885026*^9}, {
   3.742765867378873*^9, 3.742766092463871*^9}, {3.742766139341591*^9, 
   3.7427666511198874`*^9}, {3.7427667832212744`*^9, 3.742767013838937*^9}, {
   3.742767046795941*^9, 3.7427670850157166`*^9}, {3.7427673885716476`*^9, 
   3.7427676444548955`*^9}, {3.7427676996391673`*^9, 3.742767797723146*^9}, {
   3.742767828678318*^9, 3.7427678310559645`*^9}, {3.7427679193988695`*^9, 
   3.742767923646519*^9}, {3.742768434567094*^9, 3.7427684732078266`*^9}, {
   3.7427689856623135`*^9, 3.7427689874505343`*^9}, {3.742769214090642*^9, 
   3.742769458919345*^9}, {3.742769493164827*^9, 3.7427694982244167`*^9}, {
   3.742770501730461*^9, 3.7427706019265924`*^9}, {3.7427706526769643`*^9, 
   3.7427706683799973`*^9}, {3.7427712377103004`*^9, 
   3.7427716821426506`*^9}, {3.7433852951255536`*^9, 
   3.7433853054238677`*^9}, {3.7438023087103615`*^9, 3.743802326567545*^9}, {
   3.743802552218171*^9, 3.7438025894855595`*^9}, {3.7453326376003833`*^9, 
   3.745332655437461*^9}},ExpressionUUID->"5efdd70c-920e-4e13-9f16-\
d6fc8501a871"],

Cell[TextData[{
 "\n\tI\[CloseCurlyQuote]ll start from the basic Hamiltonian for an atom in a \
stationary lattice. This is where the Kolovsky and Kolsch paper begins:\n\t\n\
\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"Basic", " ", 
     RowBox[{"Hamiltonian", ":", "   ", 
      SubscriptBox["H", "basic"]}]}], " ", "=", " ", 
    RowBox[{
     RowBox[{
      FractionBox[
       SuperscriptBox[
        OverscriptBox["p", "^"], "2"], 
       RowBox[{"2", "M"}]], "+", 
      RowBox[{
       SubscriptBox["V", "0"], 
       SuperscriptBox[
        RowBox[{"cos", "(", "kx", ")"}], "2"]}]}], " ", "=", " ", 
     RowBox[{
      RowBox[{
       FractionBox[
        SuperscriptBox[
         OverscriptBox["p", "^"], "2"], 
        RowBox[{"2", "M"}]], "+", 
       RowBox[{
        FractionBox[
         SubscriptBox["V", "0"], "2"], 
        RowBox[{"cos", "(", 
         RowBox[{"2", "kx"}], ")"}]}], " ", "+", " ", 
       FractionBox[
        SubscriptBox["V", "0"], "2"]}], " ", "=", " ", 
      RowBox[{
       FractionBox[
        SuperscriptBox[
         OverscriptBox["p", "^"], "2"], 
        RowBox[{"2", "M"}]], "+", 
       RowBox[{
        SubscriptBox["\[HBar]\[CapitalOmega]", "eff"], 
        RowBox[{"cos", "(", 
         RowBox[{"2", "kx"}], ")"}]}], " ", "+", " ", 
       SubscriptBox["\[HBar]\[Omega]", "rabi"]}]}]}]}], TraditionalForm]],
  ExpressionUUID->"f242ca4c-d25b-4b35-b0e4-f3408eafcadf"],
 "\n\t\n\tWe see that ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["V", "0"], "/", "2"}], TraditionalForm]],ExpressionUUID->
  "8e0fa085-cc12-4102-a78d-dd783009fc73"],
 " is the AC Stark shift because it is the prefactor of the cosine term. From \
this we can also see the relation between Rabi frequency, AC Stark shift, and \
Lattice depth ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["V", "0"], TraditionalForm]],ExpressionUUID->
  "c439aaac-b118-4b6b-a36a-ce00bca0e8ff"],
 ":\n\t\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[HBar]\[CapitalOmega]", "eff"], "=", " ", 
    RowBox[{
     FractionBox[
      SuperscriptBox["\[HBar]\[CapitalOmega]", "2"], 
      RowBox[{"2", "\[CapitalDelta]"}]], "=", " ", 
     RowBox[{
      FractionBox[
       SubscriptBox["V", "0"], "2"], " ", "=", " ", 
      SubscriptBox["\[HBar]\[Omega]", "rabi"]}]}]}], TraditionalForm]],
  ExpressionUUID->"d9ae63ec-1914-40ca-9036-8aa84cf91800"],
 "\n\nThis is just a stationary lattice though: for Bloch oscillations we \
need to accelerate the lattice to transfer momentum. However, we first work \
in the accelerating frame with the lattice, so that in this frame the lattice \
is stationary. Out Hamiltonian this frame becomes:\n\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"Hamiltonian", " ", "in", " ", "the", " ", "lattice", " ", 
     RowBox[{"frame", ":", " ", 
      SubscriptBox["H", "lat"]}]}], " ", "=", " ", 
    RowBox[{
     FractionBox[
      SuperscriptBox[
       OverscriptBox["p", "^"], "2"], 
      RowBox[{"2", "M"}]], "+", 
     RowBox[{
      FractionBox[
       SubscriptBox["V", "0"], "2"], 
      RowBox[{"cos", "(", 
       RowBox[{"2", "kx"}], ")"}]}], " ", "+", " ", 
     FractionBox[
      SubscriptBox["V", "0"], "2"], "+", "Fx"}]}], TraditionalForm]],
  ExpressionUUID->"1c550e36-e8c3-46fc-9b4e-b115c9cb25ff"],
 "\n\t\nBasically, we have the same Hamiltonian in the accelerating frame but \
we add in a constant force . This is because in the lattice frame, the atoms \
are constantly accelerating backwards due to their inertia. This is an \
inertial/fictitious force, not a physical force, but the math doesn\
\[CloseCurlyQuote]t know the difference. \n\n\tExperimentally, this is \
accomplished by ramping the frequency difference between the \
counter-propagating laser beams. When two lasers have a frequency difference, \
the velocity of the moving lattice is related to the frequency difference, so \
ramping this difference accelerates the lattice. You can expand the ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{
      RowBox[{"cos", "(", 
       RowBox[{"kx", "-", "\[Omega]t"}], ")"}], " ", "+", " ", 
      RowBox[{"cos", "(", 
       RowBox[{
        RowBox[{
         RowBox[{"k", "'"}], "x"}], "+", 
        RowBox[{
         RowBox[{"\[Omega]", "'"}], "t"}]}], ")"}]}], ")"}], "2"], 
   TraditionalForm]],ExpressionUUID->"e1f8f64a-ef11-4811-8546-8ac2d546938b"],
 " term in the potential, and the relevant terms that remain are ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"cos", "(", 
     RowBox[{
      RowBox[{"2", 
       SubscriptBox["k", "eff"], "x"}], "-", "\[CapitalDelta]\[Omega]t"}], 
     ")"}], "   ", "and", "   ", 
    RowBox[{"cos", "(", 
     RowBox[{
      RowBox[{"2", 
       SubscriptBox["k", "eff"], "x"}], "+", "\[CapitalDelta]\[Omega]t"}], 
     ")"}]}], TraditionalForm]],ExpressionUUID->
  "3913c3ee-ccc7-40eb-893e-d2a687e92ae5"],
 ", ie. we get lattices moving at a velocity of v = ",
 Cell[BoxData[
  FormBox[
   FractionBox["\[CapitalDelta]\[Omega]", 
    RowBox[{"2", "k"}]], TraditionalForm]],ExpressionUUID->
  "1b98b775-a3f3-43c7-9c3e-3d7cda96c611"],
 ". This implies that if we ramp the frequency difference at a rate r, we get \
the following relationships:  ",
 Cell[BoxData[
  RowBox[{"r", "=", 
   RowBox[{
    FractionBox[
     RowBox[{"d", 
      RowBox[{"(", "\[CapitalDelta]\[Omega]", ")"}]}], "dt"], " ", "=", " ", 
    RowBox[{
     RowBox[{"2", "k", " ", 
      FractionBox["dv", "dt"]}], "=", " ", 
     RowBox[{
      RowBox[{"2", "ka"}], " ", "=", " ", 
      FractionBox[
       RowBox[{"2", "kF"}], 
       SubscriptBox["M", "cs"]]}]}]}]}]],ExpressionUUID->
  "671e6654-3e60-41d9-899c-13d282b16c44"],
 ",    or    F = ",
 Cell[BoxData[
  FormBox[
   FractionBox[
    RowBox[{"r", " ", 
     SubscriptBox["M", "Cs"]}], 
    RowBox[{"2", "k"}]], TraditionalForm]],ExpressionUUID->
  "dcba26d1-24b2-4f0e-b8a5-9d7aca8637c0"],
 ". The simulation below is written in terms of the ramp rate r because this \
is the experimentally relevant parameter.\n\t\n\tGoing back to the lattice \
frame Hamiltonian, the Houston functions are a good basis to use for this \
Hamiltonian and they can be written as:\n\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[CapitalPhi]", 
     RowBox[{"n", ",", 
      RowBox[{"\[Kappa]", "(", "t", ")"}]}]], "=", "   ", 
    RowBox[{
     SubscriptBox["\[Sum]", "n"], 
     RowBox[{
      RowBox[{
       SubscriptBox["c", "n"], "(", "t", ")"}], " ", 
      SuperscriptBox["e", 
       RowBox[{
        FractionBox[
         RowBox[{"-", "i"}], "\[HBar]"], 
        RowBox[{"\[Integral]", 
         RowBox[{"d\[Tau]", " ", 
          SubscriptBox["E", 
           RowBox[{"n", ",", " ", 
            RowBox[{
             SubscriptBox["\[Kappa]", "q"], "(", "\[Tau]", ")"}]}]], 
          " "}]}]}]], 
      SuperscriptBox["e", 
       RowBox[{"i", " ", 
        RowBox[{
         SubscriptBox["\[Kappa]", "q"], "(", "t", ")"}], " ", "x"}]], 
      RowBox[{
       SubscriptBox["u", 
        RowBox[{"n", ",", " ", 
         RowBox[{
          SubscriptBox["\[Kappa]", "q"], "(", "t", ")"}]}]], "(", "x", 
       ")"}]}]}]}], TraditionalForm]],ExpressionUUID->
  "f0096944-dedd-40ab-9f17-3f3d1ac0d52a"],
 "\n\t\nwhere n is the Bloch band,  and ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["u", 
    RowBox[{"n", ",", " ", 
     RowBox[{
      SubscriptBox["\[Kappa]", "q"], "(", "t", ")"}]}]], TraditionalForm]],
  ExpressionUUID->"53b1ed58-3a63-4330-8f5a-ec9dda54b76d"],
 "(x) is a periodic spatial function with the same periodicity of the lattice \
(periodicity of ",
 Cell[BoxData[
  FormBox[
   FractionBox["\[Lambda]", "2"], TraditionalForm]],ExpressionUUID->
  "04d5be41-790e-4367-8e41-9d905de9ce2e"],
 "). ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["\[Kappa]", "q"], "(", "t", ")"}], " "}], TraditionalForm]],
  ExpressionUUID->"40a4f144-d89b-4ed0-bba3-e428eac6c25f"],
 " is the quasimomentum of the state with respect to the lattice (defined \
modulo 2*pi), and it is assumed that the quasimomentum increases linearly in \
time when a constant force is applied: \[Kappa](t) = ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["\[Kappa]", "0"], "-", " ", 
     FractionBox["Ft", "\[HBar]"]}], " ", "=", " ", 
    RowBox[{
     SubscriptBox["\[Kappa]", "0"], " ", "-", " ", 
     FractionBox[
      RowBox[{"r", " ", 
       SubscriptBox["M", "Cs"], "t"}], 
      RowBox[{"2", "\[HBar]", " ", "k"}]]}]}], TraditionalForm]],
  ExpressionUUID->"05b7aa8e-06bb-4974-aef5-52814501b968"],
 ". If you plug this state into the Schrodinger equation, you'll see that \
everything cancels nicely.\n\tThe code below plots the Bloch band energy \
eigenvalues of the Bloch Hamiltonian versus the quasimomentum ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["k", "q"], ".", " "}], TraditionalForm]],ExpressionUUID->
  "3c786bb0-0e5c-49aa-91f2-0f2829e0c1ff"],
 "The lowest energy band is the 1st Bloch band. At the edge of the Brillion \
zone ",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    SubscriptBox["k", "q"]}], TraditionalForm]],ExpressionUUID->
  "4c8fe92b-c091-4914-b1fa-fba08eb79421"],
 " = +/-1), you can see the avoided level crossing between the first and \
second Bloch bands. Ideally for Bloch oscillations, atoms start and end in \
the first Bloch band (the quasimomentum just loops around the Brillion zone \
at the Bloch frequency. However, if you accelerate too quickly \
(non-adiabatically), atoms can tunnel to the second band or higher. The \
coupling between bands gets larger as you move to higher and higher bands \
(ie. atoms continue tunneling through and cease being accelerated by the \
lattice. in the accelerating frame, it looks like the atoms begin \
accelerating backwards). \n"
}], "Text",
 CellChangeTimes->{{3.7411992744871707`*^9, 3.741199277753787*^9}, {
   3.741199329629159*^9, 3.741199338064886*^9}, {3.741199368504813*^9, 
   3.7411993698257046`*^9}, {3.741199401597207*^9, 3.7411997625721455`*^9}, {
   3.741199846291649*^9, 3.741200382385866*^9}, {3.741200427533717*^9, 
   3.741200439928916*^9}, {3.741200484603733*^9, 3.7412005084681587`*^9}, {
   3.7412077338715487`*^9, 3.7412077495987873`*^9}, {3.7412077914572773`*^9, 
   3.7412079059812846`*^9}, {3.7412079816090827`*^9, 3.741208132189682*^9}, {
   3.741208202006751*^9, 3.741208296988839*^9}, {3.741208338199029*^9, 
   3.7412085416859837`*^9}, {3.7412086046986666`*^9, 3.741209460977104*^9}, {
   3.741209498600194*^9, 3.741209698206129*^9}, {3.7412097349028883`*^9, 
   3.741210043445814*^9}, {3.7412100836940546`*^9, 3.7412101384584217`*^9}, {
   3.7412101698055906`*^9, 3.741210448834248*^9}, {3.7412104801675873`*^9, 
   3.741210581747401*^9}, {3.741210618480197*^9, 3.741210651729346*^9}, {
   3.741210687364279*^9, 3.741210916786361*^9}, {3.741210994867734*^9, 
   3.741211213461388*^9}, {3.741211246824896*^9, 3.7412113588050137`*^9}, {
   3.74130691264672*^9, 3.741306915646143*^9}, {3.7413070675672693`*^9, 
   3.7413072831942434`*^9}, {3.741313614486566*^9, 3.7413137079159765`*^9}, 
   3.741314180068103*^9, {3.7413180248873234`*^9, 3.7413180456591454`*^9}, {
   3.7413181688336945`*^9, 3.7413181715776787`*^9}, {3.7421303227491975`*^9, 
   3.7421304390003257`*^9}, {3.7421304842925816`*^9, 3.742130491325249*^9}, {
   3.742130527196397*^9, 3.7421309086494265`*^9}, {3.74213095870535*^9, 
   3.7421310710856757`*^9}, {3.7421311129186974`*^9, 
   3.7421314043825893`*^9}, {3.7421314404908075`*^9, 
   3.7421314412680407`*^9}, {3.7421314715476165`*^9, 
   3.7421316145307465`*^9}, {3.7421330327952957`*^9, 
   3.7421331365014286`*^9}, {3.742133290332019*^9, 3.7421332916526966`*^9}, {
   3.742166456600613*^9, 3.742166472335432*^9}, {3.742166784375162*^9, 
   3.7421668123352747`*^9}, {3.742166846237751*^9, 3.742167233964834*^9}, {
   3.742167273592329*^9, 3.7421672747559323`*^9}, 3.7421679569338775`*^9, {
   3.74216809937573*^9, 3.7421681212975616`*^9}, {3.74216825084136*^9, 
   3.742168265665747*^9}, {3.7421682992953515`*^9, 3.7421683052713933`*^9}, {
   3.742168337030405*^9, 3.7421683858703747`*^9}, {3.7422215892216387`*^9, 
   3.7422216273128004`*^9}, {3.742224563041355*^9, 3.7422245630450773`*^9}, {
   3.742224719383098*^9, 3.7422247881596932`*^9}, {3.7422250744724936`*^9, 
   3.7422252939595013`*^9}, {3.7422253832688537`*^9, 3.742225551697933*^9}, {
   3.742225895660311*^9, 3.7422259931936893`*^9}, {3.7422260653175783`*^9, 
   3.7422262109344993`*^9}, {3.7422262444014173`*^9, 3.742226326885026*^9}, {
   3.742765867378873*^9, 3.742766092463871*^9}, {3.742766139341591*^9, 
   3.7427666511198874`*^9}, {3.7427667832212744`*^9, 3.742767013838937*^9}, {
   3.742767046795941*^9, 3.7427670850157166`*^9}, {3.7427673885716476`*^9, 
   3.7427676444548955`*^9}, {3.7427676996391673`*^9, 3.742767797723146*^9}, {
   3.742767828678318*^9, 3.7427678310559645`*^9}, {3.7427679193988695`*^9, 
   3.742767923646519*^9}, {3.742768434567094*^9, 3.7427684732078266`*^9}, {
   3.7427689856623135`*^9, 3.7427689874505343`*^9}, {3.742769214090642*^9, 
   3.742769458919345*^9}, {3.742769493164827*^9, 3.7427694982244167`*^9}, {
   3.742770501730461*^9, 3.7427706019265924`*^9}, {3.7427706526769643`*^9, 
   3.7427706683799973`*^9}, {3.7427712377103004`*^9, 
   3.7427716821426506`*^9}, {3.7433852951255536`*^9, 
   3.7433853054238677`*^9}, {3.7438023087103615`*^9, 3.743802326567545*^9}, 
   3.743802552218171*^9, {3.7438028339124575`*^9, 3.7438028878854218`*^9}, {
   3.7438029361786613`*^9, 3.743802952333578*^9}, {3.743803003176577*^9, 
   3.7438032064276886`*^9}, {3.7438032559512215`*^9, 
   3.743803320112915*^9}},ExpressionUUID->"1394e92c-7b7e-480a-85f9-\
8aa05541efc5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lmax", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dim", " ", "=", " ", 
   RowBox[{
    RowBox[{"2", " ", "lmax"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ham0", "[", 
    RowBox[{"k_", ",", " ", "dep_"}], "]"}], " ", "=", " ", 
   RowBox[{"Normal", "[", 
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"k", "+", 
             RowBox[{"2", 
              RowBox[{"(", 
               RowBox[{"l", " ", "-", " ", 
                RowBox[{"(", 
                 RowBox[{"lmax", "+", "1"}], ")"}]}], ")"}]}]}], ")"}], "2"], 
          " ", "+", "2"}]}], " ", ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          FractionBox["dep", "8"], "/;", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"i", "-", "j"}], "]"}], "\[Equal]", "1"}]}]}]}], "}"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BlochBands", "[", 
    RowBox[{"kk_", ",", "dep_"}], "]"}], " ", ":=", 
   RowBox[{
    RowBox[{"Eigensystem", "[", 
     RowBox[{"Ham0", "[", 
      RowBox[{"kk", ",", "dep"}], "]"}], "]"}], "\[LeftDoubleBracket]", "1", 
    "\[RightDoubleBracket]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"J", " ", "=", " ", 
  RowBox[{"Plot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"BlochBands", "[", 
       RowBox[{"k", ",", " ", "0"}], "]"}], ",", " ", 
      RowBox[{"BlochBands", "[", 
       RowBox[{"k", ",", " ", "4"}], "]"}], ",", " ", 
      RowBox[{"BlochBands", "[", 
       RowBox[{"k", ",", " ", "10"}], "]"}]}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"k", ",", " ", 
      RowBox[{"-", "2"}], ",", " ", "2"}], "}"}], ",", " ", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"Red", ",", " ", "Blue", ",", " ", "Green"}], "}"}]}], ",", " ", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"0", ",", " ", "15"}], "}"}]}], ",", " ", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Quasimomentum", " ", 
        SubscriptBox["k", "q"]}], ",", 
       RowBox[{"Energy", "  ", "[", 
        SubscriptBox["E", "r"], "]"}]}], "}"}]}], " ", ",", " ", 
    RowBox[{"PlotLegends", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "\"\<U = 0 Er\>\"", ",", " ", "\"\<U = 4 Er\>\"", ",", " ", 
       "\"\<U = 10 Er\>\""}], "}"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<Band Structure Various Lattice Depths.png\>\"", ",", " ", "J"}], 
   "]"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"K", " ", "=", " ", 
  RowBox[{"Plot", "[", 
   RowBox[{
    RowBox[{"BlochBands", "[", 
     RowBox[{"k", ",", " ", "4"}], "]"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"k", ",", " ", 
      RowBox[{"-", "2"}], ",", " ", "2"}], "}"}], ",", " ", 
    RowBox[{"PlotStyle", "\[Rule]", "Blue"}], ",", " ", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"0", ",", " ", "15"}], "}"}]}], ",", " ", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Quasimomentum", " ", 
        SubscriptBox["k", "q"]}], ",", 
       RowBox[{"Energy", "  ", "[", 
        SubscriptBox["E", "r"], "]"}]}], "}"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{"\"\<Band Structure Single Lattice Depth.png\>\"", ",", " ", "K"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.7411992744871707`*^9, 3.741199277753787*^9}, {
   3.741199329629159*^9, 3.741199338064886*^9}, {3.741199368504813*^9, 
   3.7411993698257046`*^9}, {3.741199401597207*^9, 3.7411997625721455`*^9}, {
   3.741199846291649*^9, 3.741200382385866*^9}, {3.741200427533717*^9, 
   3.741200439928916*^9}, {3.741200484603733*^9, 3.7412005084681587`*^9}, {
   3.7412077338715487`*^9, 3.7412077495987873`*^9}, {3.7412077914572773`*^9, 
   3.7412079059812846`*^9}, {3.7412079816090827`*^9, 3.741208132189682*^9}, {
   3.741208202006751*^9, 3.741208296988839*^9}, {3.741208338199029*^9, 
   3.7412085416859837`*^9}, {3.7412086046986666`*^9, 3.741209460977104*^9}, {
   3.741209498600194*^9, 3.741209698206129*^9}, {3.7412097349028883`*^9, 
   3.741210043445814*^9}, {3.7412100836940546`*^9, 3.7412101384584217`*^9}, {
   3.7412101698055906`*^9, 3.741210448834248*^9}, {3.7412104801675873`*^9, 
   3.741210581747401*^9}, {3.741210618480197*^9, 3.741210651729346*^9}, {
   3.741210687364279*^9, 3.741210916786361*^9}, {3.741210994867734*^9, 
   3.741211213461388*^9}, {3.741211246824896*^9, 3.7412113588050137`*^9}, {
   3.74130691264672*^9, 3.741306915646143*^9}, {3.7413070675672693`*^9, 
   3.7413072831942434`*^9}, {3.741313614486566*^9, 3.7413137079159765`*^9}, 
   3.741314180068103*^9, {3.7413180248873234`*^9, 3.7413180456591454`*^9}, {
   3.7413181688336945`*^9, 3.7413181715776787`*^9}, {3.7421303227491975`*^9, 
   3.7421304390003257`*^9}, {3.7421304842925816`*^9, 3.742130491325249*^9}, {
   3.742130527196397*^9, 3.7421309086494265`*^9}, {3.74213095870535*^9, 
   3.7421310710856757`*^9}, {3.7421311129186974`*^9, 
   3.7421314043825893`*^9}, {3.7421314404908075`*^9, 
   3.7421314412680407`*^9}, {3.7421314715476165`*^9, 
   3.7421316145307465`*^9}, {3.7421330327952957`*^9, 
   3.7421331365014286`*^9}, {3.742133290332019*^9, 3.7421332916526966`*^9}, {
   3.742166456600613*^9, 3.742166472335432*^9}, {3.742166784375162*^9, 
   3.7421668123352747`*^9}, {3.742166846237751*^9, 3.742167233964834*^9}, {
   3.742167273592329*^9, 3.7421672747559323`*^9}, 3.7421679569338775`*^9, {
   3.74216809937573*^9, 3.7421681212975616`*^9}, {3.74216825084136*^9, 
   3.742168265665747*^9}, {3.7421682992953515`*^9, 3.7421683052713933`*^9}, {
   3.742168337030405*^9, 3.7421683858703747`*^9}, {3.7422215892216387`*^9, 
   3.7422216273128004`*^9}, {3.742224563041355*^9, 3.7422245630450773`*^9}, {
   3.742224719383098*^9, 3.7422247881596932`*^9}, {3.7422250744724936`*^9, 
   3.7422252939595013`*^9}, {3.7422253832688537`*^9, 3.742225551697933*^9}, {
   3.742225895660311*^9, 3.7422259931936893`*^9}, {3.7422260653175783`*^9, 
   3.7422262109344993`*^9}, {3.7422262444014173`*^9, 3.742226326885026*^9}, {
   3.742765867378873*^9, 3.742766092463871*^9}, {3.742766139341591*^9, 
   3.7427666511198874`*^9}, {3.7427667832212744`*^9, 3.742767013838937*^9}, {
   3.742767046795941*^9, 3.7427670850157166`*^9}, {3.7427673885716476`*^9, 
   3.7427676444548955`*^9}, {3.7427676996391673`*^9, 3.742767797723146*^9}, {
   3.742767828678318*^9, 3.7427678310559645`*^9}, {3.7427679193988695`*^9, 
   3.742767950095832*^9}, {3.7427680052853384`*^9, 3.742768221411747*^9}, {
   3.742768263523204*^9, 3.742768289248616*^9}, {3.7427683256092863`*^9, 
   3.742768413569211*^9}, {3.7427685744281073`*^9, 3.74276869227875*^9}, {
   3.742768762310154*^9, 3.7427688434025555`*^9}, {3.7427689370801797`*^9, 
   3.7427689730171065`*^9}, {3.7427690298789434`*^9, 3.742769201395771*^9}, {
   3.743385511526578*^9, 3.7433855414497147`*^9}, {3.743803243622957*^9, 
   3.7438032464577074`*^9}, {3.7477638397064576`*^9, 3.747763841375122*^9}, {
   3.752941586679224*^9, 3.7529416143922157`*^9}, {3.752941678448318*^9, 
   3.7529418404326677`*^9}, {3.752941875269645*^9, 3.752941942624509*^9}, {
   3.7529436616991873`*^9, 3.7529436912639637`*^9}, {3.7529437426943264`*^9, 
   3.7529437519125257`*^9}, {3.7529670706290703`*^9, 
   3.752967071067979*^9}},ExpressionUUID->"c98c5c60-5783-4461-bd22-\
f159f7448a7c"],

Cell[TextData[{
 "\n\tBecause the Houston wave functions mostly have the same periodicity as \
the lattice, for numerical simulation it is easiest to expand the spatially \
periodic part into Fourier components. This is because cos(2kx) = ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    FractionBox["1", "2"], " ", 
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox["e", "\[ImaginaryI]2kx"], "+", 
      SuperscriptBox["e", 
       RowBox[{"-", "\[ImaginaryI]2kx"}]]}], ")"}]}], TraditionalForm]],
  ExpressionUUID->"438b5abf-2774-44de-ba02-ffa5b2d26cbf"],
 ",    and these exponential factors relate the Fourier components to their \
nearest neighbors.\n\t\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[CapitalPhi]", 
     RowBox[{"m", ",", 
      RowBox[{"\[Kappa]", "(", "t", ")"}]}]], "=", " ", 
    RowBox[{
     SuperscriptBox["e", 
      RowBox[{"i", " ", 
       RowBox[{"\[Kappa]", "(", "t", ")"}], " ", "x"}]], "  ", 
     RowBox[{
      SubscriptBox["\[Sum]", "m"], 
      RowBox[{
       RowBox[{
        SubscriptBox["c", "m"], "(", "t", ")"}], " ", 
       SuperscriptBox["e", 
        RowBox[{"i", " ", "2", "m", " ", "k", " ", "x"}]]}]}]}]}], 
   TraditionalForm]],ExpressionUUID->"6caf36ae-5b14-48aa-ab04-cde42d62dfa3"],
 "\n\t\nwhere here m is the fourier component ranging from -\[Infinity] to +\
\[Infinity]. For numerical simulation, it is easier to work in the Fourier \
expansion because the Hamiltonian you get is just a simple tridiagonal \
matrix. If you were to work in the Bloch eigenbasis, you would have coupling \
between all levels. Now, we can plug this ansatz into the Schrodinger \
equation to get EOM's for  the ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["c", "m"], "(", "t", ")"}], TraditionalForm]],ExpressionUUID->
  "52f07adf-be63-4b92-a8ed-2b1e94ae1657"],
 " coefficients. Doing this, you get (after some manipulation and canceling):\
\n\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"i", " ", "\[HBar]", " ", 
     SubscriptBox[
      OverscriptBox["c", "."], "m"]}], " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         FractionBox[
          SuperscriptBox[
           RowBox[{
            SuperscriptBox["\[HBar]", "2"], "(", 
            RowBox[{
             RowBox[{"\[Kappa]", "(", "t", ")"}], "+", 
             RowBox[{"2", "m", " ", "k"}]}], ")"}], "2"], 
          RowBox[{"2", "M"}]], " ", "+", " ", 
         FractionBox[
          SubscriptBox["V", "0"], "2"]}], ")"}], 
       SubscriptBox["c", "m"]}], "+", " ", 
      RowBox[{
       FractionBox[
        SubscriptBox["V", "0"], "4"], 
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["e", 
          RowBox[{
           RowBox[{"-", "2"}], "i", " ", "k"}]], "+", 
         SuperscriptBox["e", 
          RowBox[{
           RowBox[{"+", "2"}], " ", "i", " ", "k"}]]}], ")"}], 
       SubscriptBox["c", "m"]}]}], "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         FractionBox[
          SuperscriptBox[
           RowBox[{
            SuperscriptBox["\[HBar]", "2"], "(", 
            RowBox[{
             RowBox[{"\[Kappa]", "(", "t", ")"}], "+", 
             RowBox[{"2", "m", " ", "k"}]}], ")"}], "2"], 
          RowBox[{"2", "M"}]], " ", "+", " ", 
         FractionBox[
          SubscriptBox["V", "0"], "2"]}], ")"}], 
       SubscriptBox["c", "m"]}], "+", " ", 
      RowBox[{
       FractionBox[
        SubscriptBox["V", "0"], "4"], 
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["c", 
          RowBox[{"m", "-", "1"}]], "+", 
         SubscriptBox["c", 
          RowBox[{"m", "+", "1"}]]}], ")"}], " ", " "}]}]}]}], 
   TraditionalForm]],ExpressionUUID->"d9cd3841-3f4a-4606-890c-19dc5fdaf045"],
 "\n\t\nNote that m is the fourier mode index, and M is ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["M", "Cs"], TraditionalForm]],ExpressionUUID->
  "6c0a500d-e54a-42a5-ae04-cb5285b8a4ec"],
 ". Recall \[Kappa](t) = ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Kappa]", "0"], "-", " ", 
    FractionBox["Ft", "\[HBar]"]}], TraditionalForm]],ExpressionUUID->
  "d477b17c-59fe-4015-9448-27f89fd9f43d"],
 " is the quasi-momentum as a function of time (which for us varies linearly \
in time due to the constant force). Also note that the Fx term dropped out of \
the equations: this is because the time derivative on the LHS also picks up a \
term that includes ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{"-", "\[HBar]"}], 
     RowBox[{
      OverscriptBox["\[Kappa]", "."], "(", "t", ")"}], "x"}], "=", 
    RowBox[{"-", "Fx"}]}], TraditionalForm]],ExpressionUUID->
  "d513d0af-d27c-4220-a00a-846c7decf4b4"],
 " which cancels out the Fx term on the RHS. This is why Houston proposed the \
wave functions as solutions, so that you get this cancellation. Lastly, note \
that we pick up an extra factor of 1/2 on the ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["V", "0"], " ", "coupling", " ", "term", " "}], 
   TraditionalForm]],ExpressionUUID->"349611d0-30a6-4564-b54c-7db6b83b452d"],
 "because you need to convert the cosine term in ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["H", "lat"], TraditionalForm]],ExpressionUUID->
  "d13aae59-d754-48ef-b524-5208ac53878c"],
 " to the exponential form for cosine to relate it to the neighboring states. \
\n\nNow, we want to turn this into a dimensionless equation where ",
 StyleBox["\[HBar] = k = M = 1. ",
  FontWeight->"Bold"],
 "This can be a subtle exercise because in this unit system, the recoil \
frequency and recoil energy are equal to 1/2, meaning there are lots of \
factors of 1/2 floating around. It was more difficult to make the equations \
dimensionless for the lab frame equation. Here, we introduce a number of \
relations in this unit system. The primed variables (and \[Tau]) are \
dimensionless:\n\n\tThis Bloch period is given by:   ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["T", "b"], " ", "=", " ", 
     RowBox[{
      FractionBox[
       RowBox[{"4", "\[Pi]", " ", "\[HBar]"}], 
       RowBox[{"F", " ", "d"}]], "=", 
      RowBox[{"4", 
       FractionBox[
        SuperscriptBox["\[HBar]k", "2"], 
        RowBox[{"r", " ", "M"}]]}]}]}], ",", "           ", 
    RowBox[{"or", " ", "in", " ", "dimensionless", " ", "form"}], ",", 
    "           ", 
    RowBox[{
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[Omega]", "r"], 
       RowBox[{"-", "1"}]], " ", 
      SubscriptBox["\[Tau]", "bloch"]}], " ", "=", " ", 
     RowBox[{
      RowBox[{
       FractionBox["4", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[Omega]", "r"], "2"], 
         RowBox[{"r", "'"}]}]], "      ", "\[Rule]", "   ", 
       SubscriptBox["\[Tau]", "bloch"]}], " ", "=", " ", 
      FractionBox["8", 
       RowBox[{"r", "'"}]], "  "}]}]}], TraditionalForm]],ExpressionUUID->
  "27ca0319-d759-4c78-891b-97799369201c"],
 ",    \n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Time", "/", " ", "frequency"}], " ", 
      RowBox[{"ramp", ":", "     ", "t"}]}], " ", "\[Rule]", " ", 
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[Omega]", "r"], 
       RowBox[{"-", "1"}]], "\[Tau]"}]}], ",", "         ", 
    RowBox[{"r", "\[Rule]", " ", 
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[Omega]", "r"], "2"], 
      RowBox[{"r", "'"}], " "}]}]}], TraditionalForm]],ExpressionUUID->
  "f85d413f-db0d-4914-8430-d914b1164763"],
 "\n\t\n\tEnergy relationships:  ",
 Cell[BoxData[
  FormBox[
   RowBox[{"             ", 
    RowBox[{
     SubscriptBox["\[CapitalOmega]", "eff"], "=", " ", 
     RowBox[{
      FractionBox[
       SuperscriptBox["\[CapitalOmega]", "2"], 
       RowBox[{"2", "\[Delta]"}]], "=", " ", 
      RowBox[{
       RowBox[{
        FractionBox[
         SuperscriptBox["\[CapitalGamma]", "2"], 
         RowBox[{"4", "\[Delta]"}]], " ", 
        FractionBox["I", 
         SubscriptBox["I", "sat"]]}], " ", "=", 
       FractionBox[
        SubscriptBox["V", "0"], 
        RowBox[{"2", "\[HBar]"}]], " "}]}]}]}], TraditionalForm]],
  ExpressionUUID->"b8bc14b5-1af1-42ac-b7a1-54bfba2b9b65"],
 ",           ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["V", "0"], "=", 
    RowBox[{
     SubscriptBox["NE", "r"], " ", "=", " ", 
     FractionBox["N", "2"]}]}], TraditionalForm]],ExpressionUUID->
  "0d3f530a-c1a9-4936-96e3-b16442d7ac3e"],
 "    \n\t\n\t\t\t\t\t",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    RowBox[{
     RowBox[{"note", " ", "that", "   ", 
      SubscriptBox["E", "r"]}], " ", "=", " ", 
     RowBox[{
      SubscriptBox["\[Omega]", "r"], "=", 
      RowBox[{
       RowBox[{
        FractionBox["1", "2"], "  ", "in", " ", "this", " ", "unit", " ", 
        "system", " ", "because", " ", "we", " ", "have", " ", 
        SubscriptBox["E", "r"]}], " ", "=", " ", 
       RowBox[{
        SubscriptBox["\[HBar]\[Omega]", "r"], " ", "=", " ", 
        RowBox[{
         FractionBox[
          RowBox[{
           SuperscriptBox["\[HBar]", "2"], 
           SuperscriptBox["k", "2"]}], 
          RowBox[{"2", " ", 
           SubscriptBox["M", "Cs"]}]], " ", "=", " ", 
         FractionBox["1", "2"]}]}]}]}]}], ")"}], TraditionalForm]],
  ExpressionUUID->"0f8e0ddd-d631-48d0-bf0e-cae8dc6ce1ff"],
 "\n\t\t\t\t\t\n\tDistance: ",
 Cell[BoxData[
  FormBox[
   RowBox[{"       ", 
    RowBox[{
     RowBox[{"\[Lambda]", " ", "=", " ", 
      RowBox[{
       FractionBox[
        RowBox[{"2", "\[Pi]"}], "k"], " ", "=", " ", 
       RowBox[{"2", "\[Pi]"}]}]}], ","}]}], TraditionalForm]],ExpressionUUID->
  "f7c86cc5-0a79-4825-9563-7ac2b591311a"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"\t", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
       "Quasimomentum", " ", "as", " ", "function", " ", "of", " ", 
        "dimensionless", " ", "time", " ", "and", " ", "ramp", " ", 
        RowBox[{"rate", ":", "   ", 
         RowBox[{"\[Kappa]", "(", "t", ")"}]}]}], "\[Rule]", " ", 
       RowBox[{"k", "(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[Kappa]", "0"], "'"}], " ", "-", " ", 
         FractionBox[
          RowBox[{"r", " ", "t"}], "2"]}], ")"}]}], "   ", "=", "   ", 
      RowBox[{"k", "(", 
       RowBox[{
        RowBox[{
         SubscriptBox["\[Kappa]", "0"], "'"}], " ", "-", " ", 
        FractionBox[
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[Omega]", "r"], "2"], 
            RowBox[{"r", "'"}]}], ")"}], 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[Omega]", "r"], 
             RowBox[{"-", "1"}]], "\[Tau]"}], ")"}]}], "2"]}], "  ", ")"}]}], 
     "    ", "\[IndentingNewLine]", "\t\t", 
     RowBox[{
      RowBox[{
      "which", " ", "implies", " ", "that", " ", "the", " ", "dimensionless", 
       " ", "quasimomentum", " ", "ramps", " ", "as", "     ", 
       RowBox[{"\[Kappa]", "'"}], 
       RowBox[{"(", "\[Tau]", ")"}]}], "\[Rule]", " ", 
      RowBox[{
       RowBox[{
        SubscriptBox["\[Kappa]", "0"], "'"}], " ", "-", " ", 
       FractionBox[
        RowBox[{
         RowBox[{"r", "'"}], " ", "\[Tau]"}], "4"], " "}]}]}]}], 
   TraditionalForm]],ExpressionUUID->"7b48dade-5608-4d74-8bcd-511462c9a998"],
 "\n\nFrom these, we can derive the dimensionless equations of motion for \
simulation:\n\n\tEOM Lattice frame:       ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     FractionBox["i", "2"], " ", 
     RowBox[{
      SubscriptBox[
       OverscriptBox["c", "."], "m"], "(", "\[Tau]", ")"}]}], " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          FractionBox[
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"\[Kappa]", "(", "t", ")"}], "+", 
              RowBox[{"2", "m"}]}], ")"}], "2"], "2"], " ", "+", " ", 
          FractionBox["N", "4"]}], ")"}], 
        SubscriptBox["c", "m"]}], "+", " ", 
       RowBox[{
        FractionBox["N", "8"], 
        RowBox[{"(", 
         RowBox[{
          SubscriptBox["c", 
           RowBox[{"m", "-", "1"}]], "+", 
          SubscriptBox["c", 
           RowBox[{"m", "+", "1"}]]}], ")"}]}]}], "                     ", 
      "\[Rule]", "                  ", 
      RowBox[{"i", " ", 
       StyleBox[
        RowBox[{
         SubscriptBox[
          OverscriptBox["c", "."], "m"], "(", "\[Tau]", ")"}],
        FontWeight->"Bold"]}]}], 
     StyleBox[" ",
      FontWeight->"Bold"], 
     StyleBox["=",
      FontWeight->"Bold"], 
     StyleBox[" ",
      FontWeight->"Bold"], 
     RowBox[{
      StyleBox[
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Kappa]", 
               StyleBox["'",
                FontWeight->"Bold"]}], 
              RowBox[{"(", "t", ")"}]}], "+", 
             RowBox[{"2", "m"}]}], ")"}], "2"], " ", "+", " ", 
          FractionBox["N", "2"]}], ")"}], 
        SubscriptBox["c", "m"]}],
       FontWeight->"Bold"], 
      StyleBox["+",
       FontWeight->"Bold"], 
      StyleBox[" ",
       FontWeight->"Bold"], 
      StyleBox[
       RowBox[{
        FractionBox["N", "4"], 
        RowBox[{"(", 
         RowBox[{
          SubscriptBox["c", 
           RowBox[{"m", "-", "1"}]], "+", 
          SubscriptBox["c", 
           RowBox[{"m", "+", "1"}]]}], ")"}], " "}],
       FontWeight->"Bold"], "  "}]}]}], TraditionalForm]],ExpressionUUID->
  "fe01b6c8-1fb0-45e6-aaf9-24444d5cc448"],
 "\n\t\n\t\nThe bold equation is the equations of motion I will be using for \
the lattice frame simulation. For the Hamiltonian\[CloseCurlyQuote]s matrix \
form, we define the off-diagonal couplings as \[Kappa], where ",
 Cell[BoxData[
  FormBox[
   RowBox[{" ", 
    RowBox[{"\[Kappa]", " ", "=", " ", 
     RowBox[{
      FractionBox[
       SubscriptBox["\[HBar]\[CapitalOmega]", "eff"], "2"], " ", "=", " ", 
      RowBox[{
       FractionBox[
        SubscriptBox["V", "0"], "4"], "=", " ", 
       FractionBox["N", "8"]}]}]}]}], TraditionalForm]],ExpressionUUID->
  "ac6a9661-64d0-4819-8e43-741b16a292b6"],
 " . See that Biraben EPJD paper for more on this. Run the below few lines to \
see the dimensionless Hamiltonian matrix in the lattice frame:\n"
}], "Text",
 CellChangeTimes->{{3.7411992744871707`*^9, 3.741199277753787*^9}, {
   3.741199329629159*^9, 3.741199338064886*^9}, {3.741199368504813*^9, 
   3.7411993698257046`*^9}, {3.741199401597207*^9, 3.7411997625721455`*^9}, {
   3.741199846291649*^9, 3.741200382385866*^9}, {3.741200427533717*^9, 
   3.741200439928916*^9}, {3.741200484603733*^9, 3.7412005084681587`*^9}, {
   3.7412077338715487`*^9, 3.7412077495987873`*^9}, {3.7412077914572773`*^9, 
   3.7412079059812846`*^9}, {3.7412079816090827`*^9, 3.741208132189682*^9}, {
   3.741208202006751*^9, 3.741208296988839*^9}, {3.741208338199029*^9, 
   3.7412085416859837`*^9}, {3.7412086046986666`*^9, 3.741209460977104*^9}, {
   3.741209498600194*^9, 3.741209698206129*^9}, {3.7412097349028883`*^9, 
   3.741210043445814*^9}, {3.7412100836940546`*^9, 3.7412101384584217`*^9}, {
   3.7412101698055906`*^9, 3.741210448834248*^9}, {3.7412104801675873`*^9, 
   3.741210581747401*^9}, {3.741210618480197*^9, 3.741210651729346*^9}, {
   3.741210687364279*^9, 3.741210916786361*^9}, {3.741210994867734*^9, 
   3.741211213461388*^9}, {3.741211246824896*^9, 3.7412113588050137`*^9}, {
   3.74130691264672*^9, 3.741306915646143*^9}, {3.7413070675672693`*^9, 
   3.7413072831942434`*^9}, {3.741313614486566*^9, 3.7413137079159765`*^9}, 
   3.741314180068103*^9, {3.7413180248873234`*^9, 3.7413180456591454`*^9}, {
   3.7413181688336945`*^9, 3.7413181715776787`*^9}, {3.7421303227491975`*^9, 
   3.7421304390003257`*^9}, {3.7421304842925816`*^9, 3.742130491325249*^9}, {
   3.742130527196397*^9, 3.7421309086494265`*^9}, {3.74213095870535*^9, 
   3.7421310710856757`*^9}, {3.7421311129186974`*^9, 
   3.7421314043825893`*^9}, {3.7421314404908075`*^9, 
   3.7421314412680407`*^9}, {3.7421314715476165`*^9, 
   3.7421316145307465`*^9}, {3.7421330327952957`*^9, 
   3.7421331365014286`*^9}, {3.742133290332019*^9, 3.7421332916526966`*^9}, {
   3.742166456600613*^9, 3.742166472335432*^9}, {3.742166784375162*^9, 
   3.7421668123352747`*^9}, {3.742166846237751*^9, 3.742167233964834*^9}, {
   3.742167273592329*^9, 3.7421672747559323`*^9}, 3.7421679569338775`*^9, {
   3.74216809937573*^9, 3.7421681212975616`*^9}, {3.74216825084136*^9, 
   3.742168265665747*^9}, {3.7421682992953515`*^9, 3.7421683052713933`*^9}, {
   3.742168337030405*^9, 3.7421683858703747`*^9}, {3.7422215892216387`*^9, 
   3.7422216273128004`*^9}, {3.742224563041355*^9, 3.7422245630450773`*^9}, {
   3.742224719383098*^9, 3.7422247881596932`*^9}, {3.7422250744724936`*^9, 
   3.7422252939595013`*^9}, {3.7422253832688537`*^9, 3.742225551697933*^9}, {
   3.742225895660311*^9, 3.7422259931936893`*^9}, {3.7422260653175783`*^9, 
   3.7422262109344993`*^9}, {3.7422262444014173`*^9, 3.742226326885026*^9}, {
   3.742765867378873*^9, 3.742766092463871*^9}, {3.742766139341591*^9, 
   3.7427666511198874`*^9}, {3.7427667832212744`*^9, 3.742767013838937*^9}, {
   3.742767046795941*^9, 3.7427670850157166`*^9}, {3.7427673885716476`*^9, 
   3.7427676444548955`*^9}, {3.7427676996391673`*^9, 3.742767797723146*^9}, {
   3.742767828678318*^9, 3.7427678310559645`*^9}, {3.7427679193988695`*^9, 
   3.7427679289802604`*^9}, {3.742769464461536*^9, 3.7427694704714746`*^9}, {
   3.7427695386642294`*^9, 3.742769561272809*^9}, {3.7427695932334223`*^9, 
   3.7427696411843023`*^9}, {3.7427696820969114`*^9, 
   3.7427697228350687`*^9}, {3.742769773654228*^9, 3.7427700260068254`*^9}, {
   3.742770062655877*^9, 3.742770191812708*^9}, {3.7427702487116785`*^9, 
   3.74277040961464*^9}, {3.74277044315107*^9, 3.742770460307165*^9}, {
   3.742771712277117*^9, 3.742772022294603*^9}, {3.7427720612425756`*^9, 
   3.7427720736771183`*^9}, {3.7427722162560825`*^9, 3.742772284988395*^9}, {
   3.7427723268435397`*^9, 3.742772591015768*^9}, {3.742864673967396*^9, 
   3.7428646870087395`*^9}, {3.743803337585702*^9, 
   3.743803583557861*^9}},ExpressionUUID->"34590aa0-c1f5-406f-9d28-\
3fc4ad0276d6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kl", "[", "l_", "]"}], ":=", 
   RowBox[{"k", "+", 
    RowBox[{"2", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lmax", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dim", " ", "=", " ", 
   RowBox[{
    RowBox[{"2", " ", "lmax"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Ham0", " ", "=", " ", 
   RowBox[{"Normal", "[", 
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"kl", "[", 
            RowBox[{"l", " ", "-", " ", 
             RowBox[{"(", 
              RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"], " ", "+", " ", 
          RowBox[{"2", "\[Kappa]"}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{"\[Kappa]", "/;", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"i", "-", "j"}], "]"}], "\[Equal]", "1"}]}]}]}], "}"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Ham1", "=", 
  RowBox[{"MatrixForm", "[", 
   RowBox[{"Ham0", "/.", 
    RowBox[{"{", 
     RowBox[{"k", "\[Rule]", 
      RowBox[{"k0", "-", 
       FractionBox[
        RowBox[{"r", " ", "\[Tau]"}], "4"]}]}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7411992744871707`*^9, 3.741199277753787*^9}, {
   3.741199329629159*^9, 3.741199338064886*^9}, {3.741199368504813*^9, 
   3.7411993698257046`*^9}, {3.741199401597207*^9, 3.7411997625721455`*^9}, {
   3.741199846291649*^9, 3.741200382385866*^9}, {3.741200427533717*^9, 
   3.741200439928916*^9}, {3.741200484603733*^9, 3.7412005084681587`*^9}, {
   3.7412077338715487`*^9, 3.7412077495987873`*^9}, {3.7412077914572773`*^9, 
   3.7412079059812846`*^9}, {3.7412079816090827`*^9, 3.741208132189682*^9}, {
   3.741208202006751*^9, 3.741208296988839*^9}, {3.741208338199029*^9, 
   3.7412085416859837`*^9}, {3.7412086046986666`*^9, 3.741209460977104*^9}, {
   3.741209498600194*^9, 3.741209698206129*^9}, {3.7412097349028883`*^9, 
   3.741210043445814*^9}, {3.7412100836940546`*^9, 3.7412101384584217`*^9}, {
   3.7412101698055906`*^9, 3.741210448834248*^9}, {3.7412104801675873`*^9, 
   3.741210581747401*^9}, {3.741210618480197*^9, 3.741210651729346*^9}, {
   3.741210687364279*^9, 3.741210916786361*^9}, {3.741210994867734*^9, 
   3.741211213461388*^9}, {3.741211246824896*^9, 3.7412113588050137`*^9}, {
   3.74130691264672*^9, 3.741306915646143*^9}, {3.7413070675672693`*^9, 
   3.7413072831942434`*^9}, {3.741313614486566*^9, 3.7413137079159765`*^9}, 
   3.741314180068103*^9, {3.7413180248873234`*^9, 3.7413180456591454`*^9}, {
   3.7413181688336945`*^9, 3.7413181715776787`*^9}, {3.7421303227491975`*^9, 
   3.7421304390003257`*^9}, {3.7421304842925816`*^9, 3.742130491325249*^9}, {
   3.742130527196397*^9, 3.7421309086494265`*^9}, {3.74213095870535*^9, 
   3.7421310710856757`*^9}, {3.7421311129186974`*^9, 
   3.7421314043825893`*^9}, {3.7421314404908075`*^9, 
   3.7421314412680407`*^9}, {3.7421314715476165`*^9, 
   3.7421316145307465`*^9}, {3.7421330327952957`*^9, 
   3.7421331365014286`*^9}, {3.742133290332019*^9, 3.7421332916526966`*^9}, {
   3.742166456600613*^9, 3.742166472335432*^9}, {3.742166784375162*^9, 
   3.7421668123352747`*^9}, {3.742166846237751*^9, 3.742167233964834*^9}, {
   3.742167273592329*^9, 3.7421672747559323`*^9}, {3.7421679794160748`*^9, 
   3.7421680862560024`*^9}, {3.742168187038921*^9, 3.742168233139583*^9}, {
   3.7422241894357796`*^9, 3.7422241899603834`*^9}, {3.7422242279922357`*^9, 
   3.74222425872709*^9}, {3.742224309299966*^9, 3.742224339935624*^9}, {
   3.7427362287198353`*^9, 3.742736229116515*^9}, {3.7427720790956373`*^9, 
   3.7427721024392567`*^9}, {3.7478710139652314`*^9, 
   3.747871026898478*^9}},ExpressionUUID->"d9bef651-16da-400c-80bc-\
20606eb9e0be"],

Cell["\<\


\tThe last hairy detail to address is that you need to manually impose a \
momentum kick on the wave function when the quasimomentum loops around the \
Brillion zone. As the quasimomentum loops from +k to -k, say, the wave \
function undergoes a two-photon coherent transition to conserve momentum. \
That is, the quasimomentum decreases by 2k -> the real space momentum must \
increase by 2k. We only need to think of this process when working in the \
lattice frame: in the lab frame, there is no force on the atoms so the \
quasimomentum remains constant. Matt\[CloseCurlyQuote]s Mathematica code \
doesn\[CloseCurlyQuote]t implement this momentum kick or modulo of the \
quasimomentum. As a result, the lattice frame simulation shows amplitude \
going from the m=0 state to m=1, m=2, m=3, etc, instead of staying in m=0 at \
the end of N Bloch periods.

\tIn the below code, I implement this by defining the quasimomentum as modulo \
2 in the Hamiltonian. Then, when the atoms cross the first Brillion zone, I \
shift all of the wave function amplitudes up by one (subtracting 2k from each \
basis state). Therefore as the Hamiltonian diagonal changes because of the \
modulo, the state amplitude follows along and everything continues to work \
normally. 

\tFirst, I run a simulation without including these momentum kicks, then I \
run one including the momentum kicks.
\t\t\
\>", "Text",
 CellChangeTimes->{{3.7421681479123898`*^9, 3.7421681774942904`*^9}, {
   3.742168408622323*^9, 3.7421684284063225`*^9}, {3.7423411423876176`*^9, 
   3.7423411831574664`*^9}, {3.742770182574396*^9, 3.7427701833413844`*^9}, 
   3.7427704324875116`*^9, {3.7427721196781816`*^9, 3.7427721994509945`*^9}, {
   3.7427726625149546`*^9, 3.742772787569863*^9}, {3.742773022729596*^9, 
   3.742773077255874*^9}, {3.7427731438129416`*^9, 3.7427736257891784`*^9}, {
   3.742773682183115*^9, 3.742773893048503*^9}, {3.7427739293435073`*^9, 
   3.7427745988488855`*^9}, {3.742774664901363*^9, 3.742774669996745*^9}, {
   3.7438036107635393`*^9, 3.743803627507845*^9}, {3.745332851734909*^9, 
   3.7453328824854665`*^9}},ExpressionUUID->"438c889f-41a3-41a1-9d69-\
e6a8e7ea0f6e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Numerical Simulation: Lattice Frame, not including momentum kicks\
\>", "Section",
 CellChangeTimes->{{3.7453328058138437`*^9, 3.7453328371225905`*^9}, 
   3.7453328874604044`*^9},ExpressionUUID->"46845895-8a47-46c5-a608-\
ee752aa0b69d"],

Cell["\<\
This replicates the results of Matt\[CloseCurlyQuote]s Mathematica code but \
uses the dimensionless equations derived above.
\
\>", "Text",
 CellChangeTimes->{{3.7453328058138437`*^9, 3.7453328371225905`*^9}, {
  3.745332891352557*^9, 
  3.7453329696067953`*^9}},ExpressionUUID->"b9941298-489a-4a4d-808e-\
7f1abc56eda9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rGrav", " ", "=", " ", "0.8576"}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
     "This", " ", "is", " ", "the", " ", "dimensionless", " ", "value", " ", 
      "for", " ", "r"}], " ", "=", " ", 
     RowBox[{"23", " ", 
      RowBox[{"kHz", "/", "ms"}], " ", "converted", " ", "with", " ", "a", 
      " ", "factor", " ", "of", " ", "2", " ", "\[Pi]", " ", "x", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"2.066", " ", "kHz"}], ")"}], "^", "2."}], " ", "We", " ", 
      "need", " ", "to", " ", "convert", " ", "both", " ", 
      RowBox[{"1", "/", "s"}], " ", "units"}]}], ",", " ", 
    RowBox[{
    "but", " ", "the", " ", "23", " ", "KHz", " ", "number", " ", "is", " ", 
     "in", " ", "Hz"}], ",", " ", 
    RowBox[{"not", " ", 
     RowBox[{"radians", "/", "s"}]}], ",", " ", 
    RowBox[{
    "so", " ", "we", " ", "only", " ", "need", " ", "one", " ", "factor", " ",
      "of", " ", 
     RowBox[{"pi", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "NLatDep", " ", "is", " ", "the", " ", "lattice", " ", "depth", " ", "in",
      " ", "units", " ", "of", " ", 
     SubscriptBox["E", "r"]}], ",", " ", 
    RowBox[{"as", " ", "defined", " ", 
     RowBox[{"above", ".", " ", "NRamp"}], " ", "is", " ", "the", " ", "ramp",
      " ", "rate", " ", "in", " ", "units", " ", "of", " ", "gravity", " ", 
     "ramp", " ", "rate"}], ",", " ", 
    RowBox[{
    "NBloch", " ", "is", " ", "the", " ", "number", " ", "of", " ", "Bloch", 
     " ", "oscillations", " ", "to", " ", "do"}], ",", " ", 
    RowBox[{
    "and", " ", "therefore", " ", "gives", " ", "the", " ", "duration", " ", 
     "of", " ", "the", " ", "ramp"}], ",", " ", 
    RowBox[{
    "k0", " ", "is", " ", "the", " ", "initial", " ", "quasimomentum", " ", 
     "when", " ", "atoms", " ", "are", " ", "loaded", " ", "into", " ", "the",
      " ", "lattice"}], ",", " ", 
    RowBox[{
    "and", " ", "tLoad", " ", "is", " ", "the", " ", "time", " ", "taken", 
     " ", "to", " ", "load", " ", "atoms", " ", "into", " ", "the", " ", 
     "lattice", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"assumed", " ", "linear", " ", "intensity", " ", "ramp"}], 
       ")"}], "."}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NLatDep", " ", "=", " ", "6"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NBloch", " ", "=", " ", "6"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NRamp", " ", "=", " ", ".5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"v0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tLoad", " ", "=", " ", "2"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Variables", " ", "for", " ", "simulation"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"k0", " ", "=", " ", 
    RowBox[{
     RowBox[{"Mod", "[", 
      RowBox[{
       RowBox[{"v0", "+", "1"}], ",", "2"}], "]"}], "-", "1"}]}], ";"}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n0", " ", "=", " ", 
   FractionBox[
    RowBox[{"v0", " ", "-", " ", "k0"}], "2"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalDelta]\[Omega]", " ", "=", " ", 
   RowBox[{"8", " ", "n0"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Kappa]", " ", "=", " ", 
   FractionBox["NLatDep", "8"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"r", " ", "=", " ", 
   RowBox[{"NRamp", "*", "rGrav"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlochPeriod", " ", "=", " ", 
   FractionBox["8", "r"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TBloch", " ", "=", " ", 
    RowBox[{"BlochPeriod", " ", "*", " ", "NBloch"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lmax", " ", "=", " ", 
    RowBox[{"Max", "[", 
     RowBox[{"10", ",", 
      RowBox[{"Round", "[", 
       RowBox[{"5.", "*", 
        SuperscriptBox["NLatDep", 
         RowBox[{"1", "/", "4"}]]}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dim", " ", "=", " ", 
    RowBox[{
     RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "This", " ", "loadLattice", " ", "module", " ", "creates", " ", "the", 
     " ", "initial", " ", "state", " ", "and", " ", "loads", " ", "it", " ", 
     "into", " ", "the", " ", 
     RowBox[{"lattice", ".", " ", "It"}], " ", "takes", " ", "in", " ", "an", 
     " ", "initial", " ", "free", " ", "space", " ", "momentum", " ", "state",
      " ", "n0", " ", "for", " ", "a", " ", "wavefunction"}], ",", " ", 
    RowBox[{
    "size", " ", "of", " ", "the", " ", "hamiltonian", " ", "being", " ", 
     "simulated"}], ",", " ", 
    RowBox[{"time", " ", "to", " ", "load", " ", "lattice"}], ",", " ", 
    RowBox[{
    "and", " ", "a", " ", "load", " ", "hamiltonian", " ", "which", " ", "is",
      " ", "a", " ", "function", " ", "of", " ", 
     RowBox[{"time", ".", " ", "It"}], " ", "solves", " ", "the", " ", 
     "Schrodinger", " ", "equation", " ", "for", " ", "\[IndentingNewLine]", 
     "the", " ", "wave", " ", "function", " ", "while", " ", "loading", " ", 
     "the", " ", "atom", " ", "into", " ", "the", " ", "lattice", "  ", "and",
      " ", "returns", " ", "this", " ", "wave", " ", 
     RowBox[{"function", "."}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"loadLattice", "[", 
    RowBox[{
    "lMax_", ",", " ", "nn0_", ",", " ", "tLoad_", ",", " ", "loadHam_"}], 
    "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
       RowBox[{"n0", " ", "=", " ", "nn0"}], ",", " ", 
       RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
       RowBox[{"HamLoad", " ", "=", " ", "loadHam"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{
       "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
        ",", " ", "cs"}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"dimState", " ", "=", " ", 
       RowBox[{
        RowBox[{"2", "*", "maxL"}], " ", "+", " ", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Psi]i", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", "dimState"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
        RowBox[{"n0", " ", "+", " ", "maxL", "+", "1"}], 
        "\[RightDoubleBracket]"}], " ", "=", " ", "1"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"equation", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{"HamLoad", "[", "tt", "]"}], ".", 
          RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
         RowBox[{"{", 
          RowBox[{"tt", ",", "0", ",", "loadTime"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]cii", "[", "tt_", "]"}], "=", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
        RowBox[{
        "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[Psi]cii"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "unloadLattice", " ", "is", " ", "a", " ", "module", " ", "that", " ", 
     "takes", " ", "in", " ", "the", " ", "size", " ", "of", " ", "the", " ", 
     "hamiltonian", " ", "being", " ", "simulated"}], ",", " ", 
    RowBox[{
    "the", " ", "time", " ", "taken", " ", "to", " ", "unload", " ", "the", 
     " ", "atoms", " ", 
     RowBox[{"(", 
      RowBox[{
      "assumed", " ", "to", " ", "be", " ", "the", " ", "same", " ", "as", 
       " ", "the", " ", "load", " ", "time"}], ")"}]}], ",", " ", 
    RowBox[{
    "the", " ", "unload", " ", "hamiltonian", " ", "as", " ", "a", " ", 
     "function", " ", "of", " ", "time"}], ",", " ", 
    RowBox[{"and", " ", "the", " ", "state", " ", "to", " ", "be", " ", 
     RowBox[{"unloaded", ".", " ", "It"}], " ", "returns", " ", "the", " ", 
     "state", " ", "evolution", " ", "during", " ", "unload"}], ",", " ", 
    RowBox[{"so", " ", 
     RowBox[{"\[Psi]ci", "[", "tLoad", "]"}], " ", "is", " ", "the", " ", 
     "final", " ", "free", " ", "space", " ", 
     RowBox[{"wavefunction", "."}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"unLoadLattice", "[", 
    RowBox[{
    "lMax_", ",", " ", "tLoad_", ",", " ", "unLoadHam_", ",", " ", 
     "\[Psi]ci_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
       RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
       RowBox[{"HamUnLoad", " ", "=", " ", "unLoadHam"}], ",", " ", 
       RowBox[{"\[Psi]i", "=", " ", "\[Psi]ci"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"equation", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{"HamUnLoad", "[", "tt", "]"}], ".", 
          RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
         RowBox[{"{", 
          RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]cff", "[", "tt_", "]"}], "=", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
        RowBox[{
        "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[Psi]cff"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Define", " ", 
     RowBox[{"Hamiltonian", ".", " ", "The"}], " ", "base", " ", 
     "hamiltonian", " ", "is", " ", 
     RowBox[{"Ham0", ".", " ", "I"}], " ", "then", " ", "specialize", " ", 
     "this", " ", "to", " ", "the", " ", "load", " ", "and", " ", "unload", 
     " ", "hamiltonians"}], ",", " ", 
    RowBox[{
    "and", " ", "the", " ", "main", " ", "hamiltonian", " ", "for", " ", "BO",
      " ", "is", " ", 
     RowBox[{"Ham1", "."}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"kl", "[", 
     RowBox[{"l_", ",", "v_"}], "]"}], ":=", 
    RowBox[{"v", "+", 
     RowBox[{"2", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"+", "4"}], " ", "\[Kappa]\[Kappa]"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ham0", " ", "[", "k_", "]"}], "=", " ", 
   RowBox[{"Normal", "[", 
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"kl", "[", 
            RowBox[{
             RowBox[{"l", " ", "-", " ", 
              RowBox[{"(", 
               RowBox[{"lmax", " ", "+", " ", "1"}], ")"}]}], ",", "k"}], 
            "]"}], "2"], "  ", "+", 
          RowBox[{"4", " ", "\[Kappa]\[Kappa]"}], " ", "-", 
          RowBox[{"\[CapitalDelta]w", 
           RowBox[{"(", 
            RowBox[{"l", "-", "lmax", "-", "1"}], ")"}]}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", "\[Kappa]\[Kappa]"}], "/;", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"i", "-", "j"}], "]"}], "\[Equal]", "1"}]}]}]}], "}"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HamLoad", "[", "t_", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"Ham0", "[", "k0", "]"}], "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
       RowBox[{"\[Kappa]", " ", 
        FractionBox["t", "tLoad"]}]}], ",", " ", 
      RowBox[{
      "\[CapitalDelta]w", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}]}], 
     "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HamUnLoad", "[", "tt_", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"Ham0", "[", 
     RowBox[{"k0", "-", 
      FractionBox[
       RowBox[{"r", " ", "TBloch"}], "4"]}], "]"}], "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
       RowBox[{"\[Kappa]", " ", 
        RowBox[{"(", 
         FractionBox[
          RowBox[{"tLoad", " ", "-", " ", "tt"}], "tLoad"], ")"}]}]}], ",", 
      "  ", 
      RowBox[{
      "\[CapitalDelta]w", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}]}], 
     "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Ham1", "[", "tt_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Ham0", "[", 
      RowBox[{"k0", "-", 
       FractionBox[
        RowBox[{"r", " ", "tt"}], "4"]}], "]"}], "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", "  ", 
       RowBox[{
       "\[CapitalDelta]w", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}]}], 
      "}"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Returns", " ", "the", " ", "main", " ", "Hamiltonian", " ", "in", " ", 
    "matrix", " ", "form"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MatrixForm", "[", 
   RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"load", " ", "lattice"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
    RowBox[{"loadLattice", "[", 
     RowBox[{"lmax", ",", " ", "n0", ",", " ", "tLoad", ",", " ", "HamLoad"}],
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Return", " ", "the", " ", "amplitude", " ", "squared", " ", "after", " ", 
    "loading"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  SuperscriptBox[
   RowBox[{"Abs", "[", 
    RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], "]"}], "2"], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Now", ",", " ", 
    RowBox[{
    "set", " ", "up", " ", "NDSolve", " ", "to", " ", "solve", " ", "the", 
     " ", "Schrodinger", " ", "equation", " ", "for", " ", "Bloch", " ", 
     "oscillations"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cs", " ", "=", " ", 
    RowBox[{"Table", "[", " ", 
     RowBox[{
      RowBox[{"ci", "[", "nn", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"nn", ",", 
        RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "See", " ", "projection", " ", "of", " ", "loaded", " ", "wave", " ", 
    "function", " ", "onto", " ", "the", " ", "first", " ", "three", " ", 
    "Bloch", " ", "bands"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"i1", " ", "=", "  ", 
  SuperscriptBox[
   RowBox[{"Norm", "[", 
    RowBox[{
     RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], ".", 
     RowBox[{
      RowBox[{
       RowBox[{"Eigensystem", "[", 
        RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
       "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ", 
      "\[RightDoubleBracket]"}]}], "]"}], "2"]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"i2", " ", "=", "  ", 
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], ".", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
        "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
    "2"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i3", " ", "=", "  ", 
    SuperscriptBox[
     RowBox[{"Norm", "[", 
      RowBox[{
       RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], ".", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", "2",
          "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
        RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
     "2"]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Solve", " ", "the", " ", "main", " ", "Schrodinger", " ", "equation", " ",
     "for", " ", "BOs"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ics", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
      RowBox[{
       RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"nn", "+", 
        RowBox[{"(", 
         RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"equation", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
    RowBox[{
     RowBox[{"-", "\[ImaginaryI]"}], " ", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt", "]"}], ".", 
      RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sol", " ", "=", " ", 
   RowBox[{"NDSolve", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
     RowBox[{"{", 
      RowBox[{"tt", ",", "0", ",", "TBloch"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
    RowBox[{
     RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
     RowBox[{
     "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], ";"}],
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Return", " ", "the", " ", "amplitude", " ", "squared", " ", "after", " ", 
    "bloch", " ", "oscillations"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  SuperscriptBox[
   RowBox[{"Abs", "[", 
    RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], "]"}], "2"], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Look", " ", "at", " ", "projection", " ", "onto", " ", "different", " ", 
    "bloch", " ", "bands", " ", "after", " ", "BOs", " ", "are", " ", 
    "done"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"p1", " ", "=", "  ", 
  SuperscriptBox[
   RowBox[{"Norm", "[", 
    RowBox[{
     RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
     RowBox[{
      RowBox[{
       RowBox[{"Eigensystem", "[", 
        RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], "\[LeftDoubleBracket]", 
       "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ", 
      "\[RightDoubleBracket]"}]}], "]"}], "2"]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"p2", " ", "=", "  ", 
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], "\[LeftDoubleBracket]", 
        "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
    "2"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"p3", " ", "=", "  ", 
    SuperscriptBox[
     RowBox[{"Norm", "[", 
      RowBox[{
       RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], "\[LeftDoubleBracket]",
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
        RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
     "2"]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Unload", " ", "lattice"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]fBloch", " ", "=", " ", 
    RowBox[{"unLoadLattice", "[", 
     RowBox[{"lmax", ",", " ", "tLoad", ",", " ", "HamUnLoad", ",", " ", 
      RowBox[{"\[Psi]ci", "[", "TBloch", "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Return", " ", "magnitude", " ", "squared", " ", "of", " ", "final", " ", 
    "free", " ", "space", " ", "wave", " ", "function"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  SuperscriptBox[
   RowBox[{"Abs", "[", 
    RowBox[{"\[Psi]fBloch", "[", "tLoad", "]"}], "]"}], "2"], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Plot", " ", "time", " ", "domain", " ", "BO", " ", "solution", " ", 
    "during", " ", "main", " ", "Hamiltonian"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"load", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]iBloch", "[", "t", "]"}], "]"}], "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "tLoad"}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"ColorData", "[", "\"\<Rainbow\>\"", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BO", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]ci", "[", 
        RowBox[{"t", "-", "tLoad"}], "]"}], "]"}], "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "tLoad", ",", 
       RowBox[{"tLoad", " ", "+", " ", "TBloch"}]}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"ColorData", "[", "\"\<Rainbow\>\"", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"unload", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]fBloch", "[", 
        RowBox[{"t", "-", "tLoad", " ", "-", " ", "TBloch"}], "]"}], "]"}], 
      "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{"tLoad", " ", "+", " ", "TBloch"}], ",", 
       RowBox[{
        RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}], ",", 
     " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"ColorData", "[", "\"\<Rainbow\>\"", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Show", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"load", ",", " ", "BO", ",", " ", "unload"}], "}"}], ",", " ", 
    RowBox[{"AxesLabel", "\[Rule]", " ", 
     RowBox[{"{", 
      RowBox[{
      "\"\<Time (dimensionless)\>\"", ",", " ", 
       "\"\<Probability Amplitude\>\""}], "}"}]}], ",", " ", 
    RowBox[{"ImageSize", "\[Rule]", " ", 
     RowBox[{"{", 
      RowBox[{"700", ",", "400"}], "}"}]}]}], "]"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"kList", " ", "=", " ", 
  RowBox[{"Table", "[", 
   RowBox[{"i", ",", " ", 
    RowBox[{"{", 
     RowBox[{"i", ",", " ", 
      RowBox[{"-", "lmax"}], ",", " ", "lmax", ",", " ", "1"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"evect1", "[", "t_", "]"}], " ", ":=", " ", 
   RowBox[{"Normalize", "[", 
    RowBox[{"N", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Eigensystem", "[", 
        RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
       "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", 
      "\[RightDoubleBracket]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"evect2", "[", "t_", "]"}], " ", ":=", " ", 
   RowBox[{"Normalize", "[", 
    RowBox[{"N", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Eigensystem", "[", 
        RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
       "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
      RowBox[{"dim", "-", "1"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"evect3", "[", "t_", "]"}], " ", ":=", " ", 
   RowBox[{"Normalize", "[", 
    RowBox[{"N", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Eigensystem", "[", 
        RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
       "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
      RowBox[{"dim", "-", "2"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"evect4", "[", "t_", "]"}], " ", ":=", " ", 
   RowBox[{"Normalize", "[", 
    RowBox[{"N", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Eigensystem", "[", 
        RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
       "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
      RowBox[{"dim", "-", "3"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"evect5", "[", "t_", "]"}], " ", ":=", " ", 
   RowBox[{"Normalize", "[", 
    RowBox[{"N", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Eigensystem", "[", 
        RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
       "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
      RowBox[{"dim", "-", "4"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"e1", "[", "t_", "]"}], " ", ":=", " ", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{
      RowBox[{"evect1", "[", "t", "]"}], ".", 
      RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"e2", "[", "t_", "]"}], " ", ":=", " ", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{
      RowBox[{"evect2", "[", "t", "]"}], ".", 
      RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"e3", "[", "t_", "]"}], " ", ":=", " ", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{
      RowBox[{"evect3", "[", "t", "]"}], ".", 
      RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"e4", "[", "t_", "]"}], " ", ":=", " ", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{
      RowBox[{"evect4", "[", "t", "]"}], ".", 
      RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"e5", "[", "t_", "]"}], " ", ":=", " ", 
    SuperscriptBox[
     RowBox[{"Abs", "[", 
      RowBox[{
       RowBox[{"evect5", "[", "t", "]"}], ".", 
       RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ttt", " ", "=", " ", 
   RowBox[{
    FractionBox["8", "8"], "TBloch"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kkkk", " ", "=", " ", 
    RowBox[{"r", " ", 
     FractionBox["ttt", "4"]}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Re", "[", 
     RowBox[{"N", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "ttt", "]"}], "]"}], "\[LeftDoubleBracket]", 
        "1", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", 
       "\[RightDoubleBracket]"}], "]"}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"ListPlot", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"kList", ",", " ", 
         RowBox[{"Re", "[", 
          RowBox[{"evect1", "[", "ttt", "]"}], "]"}]}], "}"}], "]"}], ",", 
      " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
      RowBox[{"PlotStyle", "\[Rule]", "Red"}]}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"Re", "[", 
     RowBox[{"N", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "ttt", "]"}], "]"}], "\[LeftDoubleBracket]", 
        "1", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "1"}], "\[RightDoubleBracket]"}], "]"}], "]"}], 
    "\[IndentingNewLine]", 
    RowBox[{"ListPlot", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"kList", ",", " ", 
         RowBox[{"Re", "[", 
          RowBox[{"evect2", "[", "ttt", "]"}], "]"}]}], "}"}], "]"}], ",", 
      " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
      RowBox[{"PlotStyle", "\[Rule]", "Orange"}]}], "]"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Re", "[", 
     RowBox[{"N", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "ttt", "]"}], "]"}], "\[LeftDoubleBracket]", 
        "1", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "2"}], "\[RightDoubleBracket]"}], "]"}], "]"}], 
    "\[IndentingNewLine]", 
    RowBox[{"ListPlot", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"kList", ",", " ", 
         RowBox[{"Re", "[", 
          RowBox[{"evect3", "[", "ttt", "]"}], "]"}]}], "}"}], "]"}], ",", 
      " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
      RowBox[{"PlotStyle", "\[Rule]", "Purple"}]}], "]"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Re", "[", 
     RowBox[{"N", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "ttt", "]"}], "]"}], "\[LeftDoubleBracket]", 
        "1", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "3"}], "\[RightDoubleBracket]"}], "]"}], "]"}], 
    "\[IndentingNewLine]", 
    RowBox[{"ListPlot", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"kList", ",", " ", 
         RowBox[{"Re", "[", 
          RowBox[{"evect4", "[", "ttt", "]"}], "]"}]}], "}"}], "]"}], ",", 
      " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
      RowBox[{"PlotStyle", "\[Rule]", "Green"}]}], "]"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Re", "[", 
     RowBox[{"N", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "ttt", "]"}], "]"}], "\[LeftDoubleBracket]", 
        "1", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "4"}], "\[RightDoubleBracket]"}], "]"}], "]"}], 
    "\[IndentingNewLine]", 
    RowBox[{"ListPlot", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"kList", ",", " ", 
         RowBox[{"Re", "[", 
          RowBox[{"evect5", "[", "ttt", "]"}], "]"}]}], "}"}], "]"}], ",", 
      " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
      RowBox[{"PlotStyle", "\[Rule]", "Blue"}]}], "]"}]}], 
   "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"e1", "[", "t", "]"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"e2", "[", "t", "]"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"e3", "[", "t", "]"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"e4", "[", "t", "]"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"e5", "[", "t", "]"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"BlochBands", "[", "k", "]"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"k", ",", " ", 
       RowBox[{"-", "2"}], ",", " ", "2"}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "4"}], ",", " ", "15"}], "}"}]}], ",", " ", 
     RowBox[{"AxesLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Quasimomentum", " ", 
         SubscriptBox["k", "q"]}], ",", 
        RowBox[{"Energy", "  ", "[", 
         SubscriptBox["E", "r"], "]"}]}], "}"}]}]}], " ", "]"}], 
   "\[IndentingNewLine]", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7453328058138437`*^9, 3.7453328371225905`*^9}, {
   3.745332891352557*^9, 3.7453329161758194`*^9}, {3.7453329844473476`*^9, 
   3.745333001017542*^9}, {3.745333190965929*^9, 3.7453332830183845`*^9}, {
   3.745333318544135*^9, 3.745333389092039*^9}, {3.745333424049735*^9, 
   3.745333494923379*^9}, {3.7453335269981656`*^9, 3.7453335307243657`*^9}, {
   3.745333568597969*^9, 3.7453336202881427`*^9}, {3.7453337229859467`*^9, 
   3.7453338095696735`*^9}, {3.7453338624906235`*^9, 
   3.7453339494861207`*^9}, {3.7453340269201555`*^9, 
   3.7453341151155496`*^9}, {3.745334163535421*^9, 3.745334164164155*^9}, {
   3.74533422267395*^9, 3.7453342231253967`*^9}, {3.745334281330929*^9, 
   3.7453342838918447`*^9}, {3.745351377628761*^9, 3.745351407234662*^9}, {
   3.7453515171151648`*^9, 3.7453515896144676`*^9}, {3.745351625617283*^9, 
   3.7453516392847643`*^9}, {3.745351678302518*^9, 3.745351686076748*^9}, {
   3.745351727871088*^9, 3.745351746736683*^9}, {3.745351889404517*^9, 
   3.7453518954922495`*^9}, {3.7453519331257043`*^9, 
   3.7453519690287824`*^9}, {3.745352012247316*^9, 3.7453520381650705`*^9}, {
   3.7453520962528753`*^9, 3.7453521363078604`*^9}, {3.7453521834848194`*^9, 
   3.745352228168437*^9}, {3.745352373561985*^9, 3.745352404766616*^9}, {
   3.745352538569132*^9, 3.7453525729253416`*^9}, {3.745352627220285*^9, 
   3.7453526289656234`*^9}, {3.745352761125528*^9, 3.7453527794036903`*^9}, {
   3.745352927113062*^9, 3.745352928852417*^9}, 3.7453530325593433`*^9, {
   3.7453530810458*^9, 3.7453530961135435`*^9}, {3.7453611784692316`*^9, 
   3.745361220167821*^9}, {3.745361253646377*^9, 3.7453612650998173`*^9}, {
   3.7453613428354*^9, 3.7453613509547057`*^9}, {3.7453615452369385`*^9, 
   3.745361545478324*^9}, {3.745361811547407*^9, 3.7453618580561266`*^9}, 
   3.7453619079049683`*^9, 3.745361944930036*^9, {3.7453620138029685`*^9, 
   3.745362072178852*^9}, {3.745362126727109*^9, 3.745362131863619*^9}, {
   3.7453621827206426`*^9, 3.7453621946697636`*^9}, {3.7453622512814846`*^9, 
   3.7453622514470224`*^9}, 3.7453622889228992`*^9, {3.7453623326218443`*^9, 
   3.7453623356956806`*^9}, {3.745362460122819*^9, 3.745362461014421*^9}, {
   3.7453625003601294`*^9, 3.745362527631322*^9}, 3.7453626104292545`*^9, 
   3.7453626583559246`*^9, {3.7453629440371256`*^9, 3.745362978462152*^9}, {
   3.7453632518716536`*^9, 3.7453633802620645`*^9}, 3.7453634217731447`*^9, {
   3.7453634915217834`*^9, 3.745363572816498*^9}, 3.7453636485052814`*^9, {
   3.7454639640042143`*^9, 3.745463988680537*^9}, {3.7454640828519845`*^9, 
   3.7454641383247223`*^9}, {3.745464173320018*^9, 3.7454641800115047`*^9}, {
   3.7459874272875457`*^9, 3.745987428468482*^9}, {3.748005682234687*^9, 
   3.7480057150187397`*^9}, {3.748005779428485*^9, 3.7480059041543283`*^9}, {
   3.748006120073569*^9, 3.74800614973678*^9}, {3.748006359960551*^9, 
   3.7480064859761853`*^9}, {3.748006521672021*^9, 3.748006521857703*^9}, {
   3.748006575396757*^9, 3.7480065848146486`*^9}, {3.748006623025341*^9, 
   3.748006644987525*^9}, {3.7480067213938656`*^9, 3.748006751427104*^9}, {
   3.7480339802479753`*^9, 3.7480339808840866`*^9}, {3.7480343103663497`*^9, 
   3.748034311285471*^9}, {3.74805966279069*^9, 3.7480597296957808`*^9}, {
   3.748059849573371*^9, 3.7480599118004107`*^9}, {3.7480616066810584`*^9, 
   3.748061609487047*^9}, {3.7480617048920426`*^9, 
   3.7480617124372835`*^9}},ExpressionUUID->"45dcede9-ed50-43b8-89b3-\
a7bdd7ec6920"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Lattice frame simulation including momentum kicks", "Section",
 CellChangeTimes->{
  3.7453539955116353`*^9, {3.7453613881119385`*^9, 
   3.745361422354452*^9}},ExpressionUUID->"932035d5-e66c-4a0a-8c25-\
dde2f622f089"],

Cell["\<\
Next, implement the same Hamiltonian but define the quasimomentum modulo the \
first Brillion zone, and give atoms momentum kick at the edge of the Brillion \
zone. Note that this only works when k0 = 0, I didn\[CloseCurlyQuote]t want \
to deal with implementing this more generally... This gives almost identical \
results to the previos simulation (~.005% population difference from what I \
saw) except the atoms end up in the correct momentum state. \
\>", "Text",
 CellChangeTimes->{
  3.7453539955116353`*^9, {3.7453613881119385`*^9, 
   3.7453614566089354`*^9}},ExpressionUUID->"21695f31-11f8-4806-8ddf-\
3a873d227879"],

Cell[BoxData[
 RowBox[{"\n", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Kappa]\[Kappa]", ",", "pl", ",", "Ham0", ",", "Ham1", ",", "q", ",", 
      "k", ",", "m", ",", " ", "r", ",", " ", "\[Psi]iBloch", ",", " ", "rr", 
      ",", " ", "tt", ",", " ", "HamLoad", ",", " ", "HamUnLoad", ",", " ", 
      "\[Psi]cf", ",", " ", "\[CapitalDelta]\[Omega]", ",", " ", "kl", ",", 
      " ", "v0", ",", " ", "n0", ",", "k0", ",", " ", "\[Psi]f", ",", " ", 
      "\[Kappa]"}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rGrav", " ", "=", " ", "0.8576"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Set", " ", "parameters", " ", "for", " ", "simulation"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NLatDep", " ", "=", " ", "8"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NBloch", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NRamp", " ", "=", " ", "5"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"v0", " ", "=", " ", "2"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tLoad", " ", "=", " ", "2"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Variables", " ", "for", " ", "simulation"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k0", " ", "=", " ", 
     RowBox[{
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v0", "+", "1"}], ",", "2"}], "]"}], "-", "1"}]}], ";"}], " ",
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"n0", " ", "=", " ", 
     FractionBox[
      RowBox[{"v0", " ", "-", " ", "k0"}], "2"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CapitalDelta]\[Omega]", " ", "=", " ", 
     RowBox[{"8", " ", "n0"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Kappa]", " ", "=", " ", 
     FractionBox["NLatDep", "8"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"r", " ", "=", " ", 
     RowBox[{"NRamp", "*", "rGrav"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BlochPeriod", " ", "=", " ", 
     FractionBox["8", "r"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TBloch", " ", "=", " ", 
     RowBox[{"BlochPeriod", " ", "*", " ", "NBloch"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lmax", " ", "=", " ", 
     RowBox[{"Max", "[", 
      RowBox[{"10", ",", 
       RowBox[{"Round", "[", 
        RowBox[{"5.", "*", 
         SuperscriptBox["NLatDep", 
          RowBox[{"1", "/", "4"}]]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dim", " ", "=", " ", 
     RowBox[{
      RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"kl", "[", "l_", "]"}], "=", 
     RowBox[{"k", "+", 
      RowBox[{"2", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Define", " ", "Hamiltonians"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Ham0", " ", "=", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"kl", "[", 
              RowBox[{"l", " ", "-", " ", 
               RowBox[{"(", 
                RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"], "+", 
            RowBox[{"4", " ", "\[Kappa]\[Kappa]"}], " ", "-", " ", 
            RowBox[{"\[CapitalDelta]w", 
             RowBox[{"(", 
              RowBox[{"l", "-", "lmax", "-", "1"}], ")"}]}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i_", ",", "j_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", " ", "\[Kappa]\[Kappa]"}], "/;", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{"i", "-", "j"}], "]"}], "\[Equal]", "1"}]}]}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{"Ham0", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"k", "\[Rule]", "k0"}], ",", " ", 
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox["tt", "tLoad"]}]}], ",", "  ", 
        RowBox[{
        "\[CapitalDelta]w", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}]}], 
       "}"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamUnLoad", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{"Ham0", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"k", "\[Rule]", "k0"}], " ", ",", " ", 
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox[
           RowBox[{"tLoad", " ", "-", " ", "tt"}], "tLoad"]}]}], ",", "  ", 
        RowBox[{
        "\[CapitalDelta]w", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}]}], 
       "}"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
     RowBox[{"Ham0", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"k", "\[Rule]", 
         RowBox[{
          RowBox[{"Mod", "[", 
           RowBox[{
            RowBox[{"1", "+", "k0", "-", 
             FractionBox[
              RowBox[{"r", " ", "tt"}], "4"]}], ",", "2"}], "]"}], "-", 
          "1"}]}], ",", " ", 
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", "  ", 
        RowBox[{
        "\[CapitalDelta]w", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}]}], 
       "}"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Load", " ", "lattice"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Psi]", ",", " ", "cs", ",", " ", "\[Psi]iBloch", ",", " ", "ics", ",",
       " ", "sol", ",", " ", "equation", ",", " ", "t", ",", " ", "tt"}], 
     "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
     RowBox[{"loadLattice", "[", 
      RowBox[{
      "lmax", ",", " ", "n0", ",", " ", "tLoad", ",", " ", "HamLoad"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Solve", " ", "main", " ", "SE", " ", "until", " ", "atoms", " ", 
      "reach", " ", "edge", " ", "of", " ", "Brillion", " ", "zone"}], ",", 
     " ", 
     RowBox[{
      RowBox[{
       RowBox[{"ie", ".", " ", "1"}], "/", "2"}], " ", "of", " ", "a", " ", 
      "Bloch", " ", "period"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cs", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ics", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
        RowBox[{
         RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"nn", "+", 
          RowBox[{"(", 
           RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"equation", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", 
       RowBox[{
        RowBox[{"Ham1", "[", "tt", "]"}], ".", 
        RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sol", " ", "=", " ", 
     RowBox[{"NDSolve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
       RowBox[{"{", 
        RowBox[{"tt", ",", "0", ",", 
         FractionBox["BlochPeriod", "2"]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]fBloch", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
      RowBox[{
      "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Plot", " ", "the", " ", "first", " ", 
     RowBox[{"1", "/", "2"}], " ", "Bloch", " ", "period", " ", "solution"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"start", " ", "=", " ", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"Abs", "[", 
        RowBox[{"\[Psi]f", "[", "t", "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "0", ",", 
         FractionBox["BlochPeriod", "2"]}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]start", " ", "=", " ", "\[Psi]iBloch"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "\[Psi]iBloch", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]iBloch", " ", "=", " ", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", "dim"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]iBloch", "[", 
      RowBox[{"[", "dim", "]"}], "]"}], " ", "=", " ", "0"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Give", " ", "the", " ", "states", " ", "a", " ", "momentum", " ", "kick",
      " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
       "loop", " ", "them", " ", "all", " ", "one", " ", "place", " ", 
        "backwards", " ", "in", " ", "the", " ", "state", " ", "vector"}], 
       ")"}], "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"i", "=", "1"}], ",", 
     RowBox[{"i", "<", "dim"}], ",", 
     RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Psi]iBloch", "[", 
        RowBox[{"[", "i", "]"}], "]"}], " ", "=", " ", 
       RowBox[{
        RowBox[{"\[Psi]fBloch", "[", 
         FractionBox["BlochPeriod", "2"], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Now", ",", " ", 
     RowBox[{
     "solve", " ", "system", " ", "one", " ", "Bloch", " ", "period", " ", 
      "at", " ", "a", " ", "time"}], ",", " ", 
     RowBox[{
     "given", " ", "atoms", " ", "a", " ", "momentum", " ", "kick", " ", "at",
       " ", "the", " ", "end", " ", "of", " ", "each", " ", "Bloch", " ", 
      "period"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"j", "=", "1"}], ",", 
     RowBox[{"j", "<", "NBloch"}], ",", 
     RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Solve", " ", "SE"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{
       "\[Psi]", ",", " ", "\[Psi]f", ",", " ", "cs", ",", " ", "ics", ",", 
        " ", "sol", ",", " ", "t", ",", " ", "tt"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
       RowBox[{"ParallelTable", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"ParallelTable", "[", " ", 
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"ParallelTable", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"equation", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{"Ham1", "[", 
           RowBox[{"tt", "+", 
            FractionBox["BlochPeriod", "2"]}], "]"}], ".", 
          RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
         RowBox[{"{", 
          RowBox[{"tt", ",", "0", ",", "BlochPeriod"}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]f", "[", "tt_", "]"}], "=", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
        RowBox[{
        "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Define", " ", "newly", " ", "kicked", " ", "vector"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Clear", "[", "\[Psi]iBloch", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Psi]iBloch", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", "dim"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]iBloch", "[", 
        RowBox[{"[", "dim", "]"}], "]"}], " ", "=", " ", "0"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "<", "dim"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]iBloch", "[", 
           RowBox[{"[", "i", "]"}], "]"}], " ", "=", " ", 
          RowBox[{
           RowBox[{"\[Psi]f", "[", "BlochPeriod", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Last", ",", " ", 
     RowBox[{"solve", " ", "for", " ", "the", " ", "last", " ", 
      RowBox[{"1", "/", "2"}], " ", "Bloch", " ", "period", " ", "to", " ", 
      "complete", " ", "the", " ", "N", " ", "Bloch", " ", "periods"}]}], " ",
     "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Psi]", ",", " ", "\[Psi]f", ",", " ", "cs", ",", " ", "ics", ",", " ",
       "sol", ",", " ", "equation", ",", " ", "t", ",", " ", "tt"}], "]"}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cs", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ics", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
        RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
         RowBox[{"nn", "+", 
          RowBox[{"(", 
           RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"equation", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", 
       RowBox[{
        RowBox[{"Ham1", "[", 
         RowBox[{"tt", "+", 
          FractionBox["BlochPeriod", "2"]}], "]"}], ".", 
        RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sol", " ", "=", " ", 
     RowBox[{"NDSolve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
       RowBox[{"{", 
        RowBox[{"tt", ",", "0", ",", 
         FractionBox["BlochPeriod", "2"]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]f", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
      RowBox[{
      "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]final", " ", "=", " ", 
     RowBox[{"unLoadLattice", "[", 
      RowBox[{"lmax", ",", " ", "tLoad", ",", " ", "HamUnLoad", ",", " ", 
       RowBox[{"\[Psi]f", "[", 
        FractionBox["BlochPeriod", "2"], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Return", " ", "the", " ", "final", " ", "fgree", " ", "space", " ", 
     "wavefunction", " ", "amplitude", " ", "squared"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{"\[Psi]f", "[", 
      FractionBox["BlochPeriod", "2"], "]"}], "]"}], "2"], 
   "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", "\[Psi]final", "]"}], "2"], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Plot", " ", "the", " ", "final", " ", 
     RowBox[{"1", "/", "2"}], " ", "Bloch", " ", "period", " ", "evolution", 
     " ", "of", " ", "the", " ", "wavefunction"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"Abs", "[", 
      RowBox[{"\[Psi]f", "[", "tt", "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"tt", ",", "0", ",", 
       FractionBox["BlochPeriod", "2"]}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{
  3.7453539955116353`*^9, {3.7453613881119385`*^9, 3.745361539166849*^9}, {
   3.7453636187298436`*^9, 3.745363625967493*^9}, {3.7453636612532196`*^9, 
   3.745363691099478*^9}, {3.745363722052782*^9, 3.7453637731712074`*^9}, {
   3.745363806554018*^9, 3.7453638568825674`*^9}, {3.7459874817046685`*^9, 
   3.7459875054063077`*^9}, {3.7459876577771397`*^9, 
   3.745987658567486*^9}},ExpressionUUID->"0884d85a-59f1-4efa-91f2-\
e68604750c6e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Bloch Oscillations in Lab Frame", "Section",
 CellChangeTimes->{{3.7421681479123898`*^9, 3.7421681774942904`*^9}, {
   3.742168408622323*^9, 3.7421684284063225`*^9}, {3.7423411423876176`*^9, 
   3.7423411831574664`*^9}, {3.742770182574396*^9, 3.7427701833413844`*^9}, 
   3.7427704324875116`*^9, {3.7427721196781816`*^9, 3.7427721994509945`*^9}, {
   3.7427726625149546`*^9, 3.742772787569863*^9}, {3.742773022729596*^9, 
   3.742773077255874*^9}, {3.7427731438129416`*^9, 3.7427736257891784`*^9}, {
   3.742773682183115*^9, 3.742773893048503*^9}, {3.7427739293435073`*^9, 
   3.7427745988488855`*^9}, {3.742774664901363*^9, 3.742774669996745*^9}, {
   3.7438036107635393`*^9, 
   3.7438036469533224`*^9}},ExpressionUUID->"1bef48a0-4b57-41b1-9c57-\
5a7b066a2aac"],

Cell[TextData[{
 "\n\tWhat about the Hamiltonian in the lab frame? For this, we need to go \
back to the original Hamiltonian and add in the frequency dependence. See the \
appendix of the paper \"",
 ButtonBox["Bloch oscillations of atoms, adiabatic rapid passage, and \
monokinetic atomic beams",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://journals.aps.org/pra/abstract/10.1103/PhysRevA.55.2989"], 
    None},
  ButtonNote->
   "https://journals.aps.org/pra/abstract/10.1103/PhysRevA.55.2989"],
 "\" for a unitary relation between the two Hamiltonians and an explanation \
of how the factor of ",
 Cell[BoxData[
  FormBox[
   FractionBox["1", "2"], TraditionalForm]],ExpressionUUID->
  "50f6f1a8-f938-4678-b74d-837252ccc2e3"],
 " appears in the ramping frequency term in the off-diagonal exponent (I \
spent a ",
 StyleBox["lot",
  FontWeight->"Bold"],
 " of time looking for this factor of two...). When you work in the lab \
frame, there is no longer a force term in the Hamiltonian because we work in \
an inertial frame. However there is now a frequency difference between the \
two counter-propagating beams. For a general frequency ramp, you need to \
account for the phase difference between the beams by integrating the \
frequency difference at a function of time, and you need to keep track of \
this phase when integrating the Schrodinger equation so that there aren\
\[CloseCurlyQuote]t any discontinuities in this phase factor (for example, \
between loading the lattice and Bloch oscillations). \n\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
    "General", " ", "Hamiltonian", " ", "in", " ", "the", " ", "lab", " ", 
     RowBox[{"frame", ":", " ", 
      SubscriptBox["H", 
       RowBox[{"lab", ",", " ", "gen"}]]}]}], " ", "=", " ", 
    RowBox[{
     RowBox[{
      FractionBox[
       SuperscriptBox[
        OverscriptBox["p", "^"], "2"], 
       RowBox[{"2", "M"}]], "+", 
      RowBox[{
       SubscriptBox["V", "0"], 
       RowBox[{
        SuperscriptBox["cos", "2"], "(", 
        RowBox[{"kx", " ", "-", " ", 
         RowBox[{
          FractionBox["1", "2"], 
          RowBox[{"\[CapitalDelta]\[Phi]", "(", "t", ")"}]}]}], ")"}], "               ",
        "where", "                  ", 
       RowBox[{"\[CapitalDelta]\[Phi]", "(", "t", ")"}]}]}], " ", "=", " ", 
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[Integral]", "0"], "t"], 
      RowBox[{"d\[Tau]", " ", 
       RowBox[{"\[CapitalDelta]\[Omega]", "(", "\[Tau]", ")"}]}]}]}]}], 
   TraditionalForm]],ExpressionUUID->"a51ec0d6-8d34-4404-abe0-207ab54cdb9f"],
 "\n\t\nFor a constant frequency ramp, this gives:\n\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[CapitalDelta]\[Phi]", "(", "t", ")"}], " ", "=", " ", 
    RowBox[{
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[Integral]", "0"], "t"], 
      RowBox[{"d\[Tau]", " ", 
       RowBox[{"\[CapitalDelta]\[Omega]", "(", "\[Tau]", ")"}]}]}], "  ", "=",
      " ", 
     RowBox[{
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[Integral]", "0"], "t"], 
       RowBox[{"d\[Tau]", " ", 
        RowBox[{"(", 
         RowBox[{
          SubscriptBox["\[Omega]", "0"], " ", "+", " ", 
          RowBox[{"r", " ", "t"}]}], ")"}]}]}], " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         SubscriptBox["\[CapitalDelta]\[Omega]", "0"], " ", "t"}], " ", "+", 
        " ", 
        FractionBox[
         RowBox[{"r", " ", 
          SuperscriptBox["t", "2"]}], "2"]}], " ", "=", " ", 
       RowBox[{
        RowBox[{"2", " ", "k", " ", 
         SubscriptBox["v", "0"], " ", "t"}], " ", "+", " ", 
        FractionBox[
         RowBox[{"r", " ", 
          SuperscriptBox["t", "2"]}], "2"]}]}]}]}]}], TraditionalForm]],
  ExpressionUUID->"95cce62e-6189-47ae-aab7-7edb54407f23"],
 "\n\t\nFor references about this integral, see the appendix of \
\[OpenCurlyDoubleQuote]Bloch oscillations of atoms, adiabatic rapid passage, \
and monokinetic atomic beams\[CloseCurlyDoubleQuote] as well as Tim Kovachy\
\[CloseCurlyQuote]s paper \[OpenCurlyDoubleQuote]Optical Lattices as \
Waveguides and Beam Splitters for Atom Interferometry: An Analytical \
Treatment and Proposal of Applications\[CloseCurlyDoubleQuote].\n\nIf we then \
expand the ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["cos", "2"], TraditionalForm]],ExpressionUUID->
  "1f90ece7-f04b-4042-9dc7-4eeaaa45700e"],
 " term we get, for a linear frequency ramp:\n\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"\t", 
    RowBox[{
     SubscriptBox["H", "lab"], " ", "=", " ", 
     RowBox[{
      FractionBox[
       SuperscriptBox[
        OverscriptBox["p", "^"], "2"], 
       RowBox[{"2", "M"}]], "+", 
      RowBox[{
       FractionBox[
        SubscriptBox["V", "0"], "4"], 
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["e", 
          RowBox[{
           RowBox[{"2", " ", "i", " ", "k", " ", "x"}], " ", "+", " ", 
           RowBox[{"i", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               SubscriptBox["\[CapitalDelta]\[Omega]", "0"], " ", "t"}], " ", 
              "+", " ", 
              FractionBox[
               RowBox[{"r", " ", 
                SuperscriptBox["t", "2"]}], "2"]}], ")"}]}]}]], " ", "+", " ", 
         SuperscriptBox["e", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", "i", " ", "k", " ", "x"}], " ", "-", " ", 
           RowBox[{"i", "(", 
            RowBox[{
             RowBox[{
              SubscriptBox["\[CapitalDelta]\[Omega]", "0"], " ", "t"}], " ", 
             "+", " ", 
             FractionBox[
              RowBox[{"r", " ", 
               SuperscriptBox["t", "2"]}], "2"]}], ")"}]}]], " ", "+", " ", 
         "2"}], ")"}]}]}]}]}], TraditionalForm]],ExpressionUUID->
  "3601834b-bd90-4743-acc7-0b2550da7718"],
 "\n\nWe now make the same ansatz as before where we expand the state as a \
series of Fourier components, but we don\[CloseCurlyQuote]t need to ramp the \
quasimomentum because there is no force term in our Hamiltonian. So our \
ansatz is just a Fourier series:\n\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[CapitalPhi]", "m"], "=", "  ", 
    RowBox[{
     SubscriptBox["\[Sum]", "m"], 
     RowBox[{
      RowBox[{
       SubscriptBox["c", "m"], "(", "t", ")"}], " ", 
      SuperscriptBox["e", 
       RowBox[{"i", " ", "2", "m", " ", "k", " ", "x"}]]}]}]}], 
   TraditionalForm]],ExpressionUUID->"bdf7b4ba-4280-4417-902b-b633440ebf8e"],
 "\n\n We plug this in to get the dimensionless EOMs:\n\n\tEOM Lab frame:    \
\n\t   ",
 Cell[BoxData[{
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{
      FractionBox["i", "2"], " ", 
      RowBox[{
       SubscriptBox[
        OverscriptBox["c", "."], "m"], "(", "\[Tau]", ")"}]}], "  ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         FractionBox[
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             SubscriptBox["\[Kappa]", "0"], "+", 
             RowBox[{"2", "m"}]}], ")"}], "2"], "2"], " ", "+", " ", 
         FractionBox["N", "4"]}], ")"}], 
       SubscriptBox["c", "m"]}], "+", " ", 
      RowBox[{
       FractionBox["N", "8"], 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{
          SuperscriptBox["e", 
           RowBox[{"i", "(", 
            RowBox[{
             RowBox[{
              SubscriptBox["\[CapitalDelta]\[Omega]", "0"], " ", "t"}], "+", 
             " ", 
             FractionBox[
              RowBox[{"r", " ", 
               SuperscriptBox["t", "2"]}], "2"]}], ")"}]], 
          SubscriptBox["c", 
           RowBox[{"m", "-", "1"}]]}], "+", " ", 
         RowBox[{
          SuperscriptBox["e", 
           RowBox[{"-", 
            RowBox[{"i", "(", 
             RowBox[{
              RowBox[{
               SubscriptBox["\[CapitalDelta]\[Omega]", "0"], " ", "t"}], "+", 
              " ", 
              FractionBox[
               RowBox[{"r", " ", 
                SuperscriptBox["t", "2"]}], "2"]}], ")"}]}]], 
          SubscriptBox["c", 
           RowBox[{"m", "+", "1"}]]}]}], ")"}]}]}]}], "       "}], 
   TraditionalForm], "\[IndentingNewLine]", 
  FormBox[
   RowBox[{"                     ", 
    RowBox[{
     RowBox[{"\[Rule]", "                          ", 
      RowBox[{"i", " ", 
       StyleBox[
        RowBox[{
         SubscriptBox[
          OverscriptBox["c", "."], "m"], "(", "\[Tau]", ")"}],
        FontWeight->"Bold"]}]}], 
     StyleBox[" ",
      FontWeight->"Bold"], 
     StyleBox["=",
      FontWeight->"Bold"], 
     StyleBox[" ",
      FontWeight->"Bold"], 
     RowBox[{
      StyleBox[
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Kappa]", 
               StyleBox["'",
                FontWeight->"Bold"]}], 
              RowBox[{"(", "t", ")"}]}], "+", 
             RowBox[{"2", "m"}]}], ")"}], "2"], " ", "+", " ", 
          FractionBox["N", "2"]}], ")"}], 
        SubscriptBox["c", "m"]}],
       FontWeight->"Bold"], 
      StyleBox["+",
       FontWeight->"Bold"], 
      StyleBox[" ",
       FontWeight->"Bold"], 
      RowBox[{
       StyleBox[
        FractionBox["N", "4"],
        FontWeight->"Bold"], 
       StyleBox[
        RowBox[{"(", " ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["e", 
            RowBox[{"i", "(", 
             RowBox[{
              SubscriptBox["\[CapitalDelta]\[Omega]", "0"], " ", "+", " ", 
              FractionBox[
               RowBox[{"r", " ", 
                SuperscriptBox["t", "2"]}], "2"]}], ")"}]], 
           SubscriptBox["c", 
            RowBox[{"m", "-", "1"}]]}], "+", " ", 
          RowBox[{
           SuperscriptBox["e", 
            RowBox[{"-", 
             RowBox[{"i", "(", 
              RowBox[{
               SubscriptBox["\[CapitalDelta]\[Omega]", "0"], " ", "+", " ", 
               FractionBox[
                RowBox[{"r", " ", 
                 SuperscriptBox["t", "2"]}], "2"]}], ")"}]}]], 
           SubscriptBox["c", 
            RowBox[{"m", "+", "1"}]]}]}], ")"}],
        FontWeight->"Bold"], 
       StyleBox[" ",
        FontWeight->"Bold"], "  "}]}]}]}], TraditionalForm]}],ExpressionUUID->
  "ed2cab72-424c-403f-bd29-b541745f5259"],
 "\n\t   \nBelow is a simulation of \n\t    \n\t\n\n"
}], "Text",
 CellChangeTimes->{{3.7421681479123898`*^9, 3.7421681774942904`*^9}, {
   3.742168408622323*^9, 3.7421684284063225`*^9}, {3.7423411423876176`*^9, 
   3.7423411831574664`*^9}, {3.742770182574396*^9, 3.7427701833413844`*^9}, 
   3.7427704324875116`*^9, {3.7427721196781816`*^9, 3.7427721994509945`*^9}, {
   3.7427726625149546`*^9, 3.742772787569863*^9}, {3.742773022729596*^9, 
   3.742773077255874*^9}, {3.7427731438129416`*^9, 3.7427736257891784`*^9}, {
   3.742773682183115*^9, 3.742773893048503*^9}, {3.7427739293435073`*^9, 
   3.7427745988488855`*^9}, {3.742774664901363*^9, 3.742774669996745*^9}, {
   3.7438036107635393`*^9, 3.7438036506958466`*^9}, {3.7438037193476653`*^9, 
   3.743803862167987*^9}, {3.74535317150412*^9, 3.7453531751653385`*^9}, {
   3.7453532382368298`*^9, 3.745353321147315*^9}, {3.7453534513255167`*^9, 
   3.7453534602546597`*^9}, {3.745353495696968*^9, 3.7453536534046183`*^9}, {
   3.745353814079341*^9, 3.7453538571343107`*^9}, {3.745353943656149*^9, 
   3.7453539774329104`*^9}, {3.7455371430816917`*^9, 3.745537143311078*^9}, {
   3.746564544075817*^9, 
   3.7465645440778885`*^9}},ExpressionUUID->"da525ee8-8bd4-4ec1-ac15-\
526ab0e60a55"]
}, Open  ]],

Cell[CellGroupData[{

Cell["", "Section",
 CellChangeTimes->{{3.741200513869094*^9, 3.741200558337879*^9}, {
   3.741211362616437*^9, 3.741211376322707*^9}, {3.7427746349015355`*^9, 
   3.7427746495094967`*^9}, {3.74380386597108*^9, 3.743803885139639*^9}, 
   3.7453540244522867`*^9},ExpressionUUID->"b19c1240-713f-4bc9-8667-\
5799149691e2"],

Cell["", "Text",
 CellChangeTimes->{{3.7411993815768375`*^9, 3.741199385617083*^9}, {
   3.74121138478876*^9, 3.7412114236676283`*^9}, {3.741211912622472*^9, 
   3.7412119147631693`*^9}, {3.7412123940964785`*^9, 3.741212417010724*^9}, {
   3.7422256242025537`*^9, 3.7422256312519364`*^9}, {3.742774656419035*^9, 
   3.742774658699936*^9}, {3.7427746921106515`*^9, 3.7427747147820573`*^9}, 
   3.745354023236533*^9},ExpressionUUID->"8d2c47fc-adb8-48b0-a475-\
02685e7fc021"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.741211735234652*^9, 3.741211763021079*^9}, {
   3.741211805163951*^9, 3.741211811749238*^9}, {3.7412119405964575`*^9, 
   3.741211958945638*^9}, {3.7412122851510572`*^9, 3.7412123631311913`*^9}, {
   3.7412124648809185`*^9, 3.7412126078154783`*^9}, 3.7412126393425846`*^9, {
   3.741212673128311*^9, 3.741212704817706*^9}, {3.7412128249361515`*^9, 
   3.741212832603329*^9}, {3.7413074795692797`*^9, 3.741307482059593*^9}, {
   3.741307528784458*^9, 3.7413075310908213`*^9}, {3.74130759581266*^9, 
   3.741307597968816*^9}, {3.7413082895312047`*^9, 3.741308451385281*^9}, {
   3.7413085046816554`*^9, 3.7413085860472145`*^9}, {3.741308638666904*^9, 
   3.7413087451688023`*^9}, {3.7413090633184605`*^9, 
   3.7413090659021006`*^9}, {3.741309110597767*^9, 3.7413091340233884`*^9}, {
   3.7413091872738748`*^9, 3.7413092912641716`*^9}, {3.7413093307837887`*^9, 
   3.741309375362914*^9}, {3.741309633406517*^9, 3.741309636318183*^9}, {
   3.741309718830452*^9, 3.741309845516855*^9}, {3.7413098962333508`*^9, 
   3.7413099925518565`*^9}, {3.7413100365797367`*^9, 
   3.7413100664646916`*^9}, {3.741310124473631*^9, 3.741310350608971*^9}, 
   3.74131044700043*^9, {3.7413105218711247`*^9, 3.7413105537047*^9}, {
   3.7413106170933356`*^9, 3.7413106387441177`*^9}, {3.741311014576647*^9, 
   3.741311018918105*^9}, {3.741313545700123*^9, 3.7413135661513243`*^9}, {
   3.741314190478891*^9, 3.7413143603828497`*^9}, {3.7413143961862926`*^9, 
   3.7413144698161497`*^9}, 3.7413173752971373`*^9, {3.741317471621793*^9, 
   3.7413175892910595`*^9}, {3.7413180712099185`*^9, 
   3.7413180817206497`*^9}, {3.7413181312851973`*^9, 3.741318153591115*^9}, {
   3.7413182963653235`*^9, 3.7413183394176826`*^9}, {3.7413377327504544`*^9, 
   3.7413377510006356`*^9}, {3.7413377826151752`*^9, 3.741337782736441*^9}, {
   3.7413378746484556`*^9, 3.741337906439661*^9}, {3.741337972083366*^9, 
   3.741337999893508*^9}, 3.741338039035328*^9, {3.7413380897733955`*^9, 
   3.7413380932646933`*^9}, {3.7413895981251264`*^9, 3.7413896171380787`*^9}, 
   3.7413896722400255`*^9, 3.7413899500797105`*^9, {3.7413983025938053`*^9, 
   3.7413983029810762`*^9}, {3.7413983334307632`*^9, 3.741398340872614*^9}, {
   3.74139845356531*^9, 3.741398457061966*^9}, {3.741398533850153*^9, 
   3.7413985660084534`*^9}, {3.7413986414168425`*^9, 3.741398754964644*^9}, {
   3.741398898144227*^9, 3.7413989627196245`*^9}, {3.741398992950243*^9, 
   3.7413990746664147`*^9}, {3.7413991276863956`*^9, 3.741399299108982*^9}, {
   3.7413993557723937`*^9, 3.7413994336212826`*^9}, 3.7413994806609745`*^9, {
   3.741399779239669*^9, 3.7413997889896874`*^9}, 3.7413998458900323`*^9, {
   3.741399893298066*^9, 3.7413998942723365`*^9}, 3.7413999313143167`*^9, {
   3.741402850532468*^9, 3.7414028617612824`*^9}, {3.7414844801109667`*^9, 
   3.741484481093342*^9}, {3.7414845508269*^9, 3.74148460441463*^9}, {
   3.7415752976203375`*^9, 3.7415753112703886`*^9}, {3.7416054127507815`*^9, 
   3.741605413248988*^9}, {3.741667663600215*^9, 3.7416676716981277`*^9}, {
   3.7416677462353125`*^9, 3.741667851789542*^9}, {3.7416679172549114`*^9, 
   3.741667987555418*^9}, 3.741668159144102*^9, {3.741754123561977*^9, 
   3.7417541445403795`*^9}, {3.7417541846484194`*^9, 3.741754203215796*^9}, {
   3.741754304914278*^9, 3.7417544847281237`*^9}, 3.741754533374176*^9, {
   3.7417545817988586`*^9, 3.741754622858463*^9}, {3.7417920038156834`*^9, 
   3.741792004034495*^9}, {3.7417920540949697`*^9, 3.7417920561645627`*^9}, {
   3.741792105180784*^9, 3.7417922347451363`*^9}, {3.7417923340080433`*^9, 
   3.7417923441683273`*^9}, {3.741792377525735*^9, 3.7417923788567715`*^9}, 
   3.7417924160622644`*^9, {3.741792480457719*^9, 3.74179250921708*^9}, {
   3.7418630699523196`*^9, 3.741863076510955*^9}, {3.741950629943957*^9, 
   3.7419506332260776`*^9}, 3.7419506635208874`*^9, {3.7419543646069126`*^9, 
   3.7419544177816625`*^9}, {3.7419552998372855`*^9, 
   3.7419553007218456`*^9}, {3.7419761404022613`*^9, 3.7419761598594065`*^9}, 
   3.7419777192322187`*^9, 3.74198699288422*^9, {3.74198702715335*^9, 
   3.7419871717270217`*^9}, {3.7419873643089004`*^9, 3.741987398293508*^9}, {
   3.7419874461926827`*^9, 3.741987449429823*^9}, {3.7419875047589645`*^9, 
   3.7419875084925227`*^9}, {3.7419875898190737`*^9, 3.741987590683988*^9}, {
   3.741987687273533*^9, 3.7419876882535954`*^9}, {3.7419878522139454`*^9, 
   3.7419878571887913`*^9}, {3.7419878907437515`*^9, 3.741987903041321*^9}, {
   3.741987992978654*^9, 3.7419879939661274`*^9}, {3.7419881235227666`*^9, 
   3.7419881243036947`*^9}, {3.742091624278222*^9, 3.7420916434356403`*^9}, {
   3.7420917329640017`*^9, 3.742091741816007*^9}, {3.7421672880979266`*^9, 
   3.742167300431549*^9}, {3.7421677726685495`*^9, 3.742167800473238*^9}, {
   3.742171010836005*^9, 3.74217101300204*^9}, {3.7422255702240543`*^9, 
   3.7422256136313915`*^9}, {3.7422256573774867`*^9, 3.742225687415143*^9}, {
   3.742226869604114*^9, 3.7422268783520617`*^9}, {3.7422269846442337`*^9, 
   3.7422270244317794`*^9}, {3.742227108462003*^9, 3.7422271142575183`*^9}, {
   3.7422306045616198`*^9, 3.742230630914815*^9}, {3.742230670749219*^9, 
   3.7422306750763316`*^9}, {3.742230713598544*^9, 3.742230786972419*^9}, {
   3.7422308212764626`*^9, 3.742230821729437*^9}, {3.742230856783724*^9, 
   3.7422308636414843`*^9}, {3.742341473325287*^9, 3.7423414737540903`*^9}, {
   3.7423415703477683`*^9, 3.742341571594389*^9}, {3.742648991375132*^9, 
   3.7426490562286186`*^9}, {3.7426492528030443`*^9, 
   3.7426492535216007`*^9}, {3.742649366385516*^9, 3.7426493666979046`*^9}, {
   3.742756526809432*^9, 3.7427565352638416`*^9}, 3.7427566710260253`*^9, {
   3.742760657560102*^9, 3.7427606786507454`*^9}, {3.7427607258241935`*^9, 
   3.7427607277131615`*^9}, {3.7427746785847945`*^9, 
   3.7427746791394033`*^9}, {3.7427747483035145`*^9, 3.74277561233605*^9}, {
   3.7427823076472483`*^9, 3.742782321874505*^9}, {3.7440669162449446`*^9, 
   3.7440670373581424`*^9}, {3.7440670932002926`*^9, 3.744067112290662*^9}, {
   3.744067173935236*^9, 3.7440671764591827`*^9}, {3.7440672248301983`*^9, 
   3.744067288029094*^9}, {3.7440673919499636`*^9, 3.7440674182333136`*^9}, {
   3.7440675497307425`*^9, 3.7440675527455535`*^9}, {3.744067604557844*^9, 
   3.744067677786863*^9}, {3.744067726864053*^9, 3.7440677641810246`*^9}, {
   3.7440678146168547`*^9, 3.7440678163899703`*^9}, {3.744067893392524*^9, 
   3.7440678940692887`*^9}, {3.744067930089985*^9, 3.7440679550890684`*^9}, {
   3.7440680220575914`*^9, 3.7440680343508387`*^9}, {3.7440682220749283`*^9, 
   3.744068262925783*^9}, {3.7440731924539394`*^9, 3.7440731949413195`*^9}, 
   3.7440732286960063`*^9, {3.744073268912952*^9, 3.7440732743450565`*^9}, {
   3.7440737326474175`*^9, 3.744073734186817*^9}, {3.7440738248844385`*^9, 
   3.7440738377535987`*^9}, {3.7440738850935054`*^9, 
   3.7440738879122715`*^9}, {3.7440740682996044`*^9, 
   3.7440740783127937`*^9}, {3.7440742192911253`*^9, 3.74407423458458*^9}, {
   3.7440742735722203`*^9, 3.7440743942790413`*^9}, {3.74407442602785*^9, 
   3.7440744445688*^9}, {3.74407447497801*^9, 3.744074529953133*^9}, {
   3.74415625318128*^9, 3.744156271911242*^9}, {3.7441563119504986`*^9, 
   3.7441563123232203`*^9}, {3.744156361894782*^9, 3.74415636207382*^9}, {
   3.7441563950305414`*^9, 3.7441563970997972`*^9}, 
   3.7453540325436697`*^9},ExpressionUUID->"7afd8b0f-e4f5-444d-aedd-\
b5b6e6aa067c"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7453540415645657`*^9, 
  3.7453540416613073`*^9}},ExpressionUUID->"687e0dc3-d1dd-4dd6-954b-\
9f909d62572d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["", "Section",
 CellChangeTimes->{{3.741793318487226*^9, 3.741793326720529*^9}, 
   3.742775716754939*^9, {3.7438038988375053`*^9, 3.743803911564601*^9}, {
   3.744074119737486*^9, 3.744074125890489*^9}, {3.744074162099538*^9, 
   3.7440741645103106`*^9}, 
   3.7453614036783524`*^9},ExpressionUUID->"7f81da71-d436-40cf-ab3d-\
2be4d96db746"],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{{3.741211735234652*^9, 3.741211763021079*^9}, {
   3.741211805163951*^9, 3.741211811749238*^9}, {3.7412119405964575`*^9, 
   3.741211958945638*^9}, {3.7412122851510572`*^9, 3.7412123631311913`*^9}, {
   3.7412124648809185`*^9, 3.7412126078154783`*^9}, 3.7412126393425846`*^9, {
   3.741212673128311*^9, 3.741212704817706*^9}, {3.7412128249361515`*^9, 
   3.741212832603329*^9}, {3.7413074795692797`*^9, 3.741307482059593*^9}, {
   3.741307528784458*^9, 3.7413075310908213`*^9}, {3.74130759581266*^9, 
   3.741307597968816*^9}, {3.7413082895312047`*^9, 3.741308451385281*^9}, {
   3.7413085046816554`*^9, 3.7413085860472145`*^9}, {3.741308638666904*^9, 
   3.7413087451688023`*^9}, {3.7413090633184605`*^9, 
   3.7413090659021006`*^9}, {3.741309110597767*^9, 3.7413091340233884`*^9}, {
   3.7413091872738748`*^9, 3.7413092912641716`*^9}, {3.7413093307837887`*^9, 
   3.741309375362914*^9}, {3.741309633406517*^9, 3.741309636318183*^9}, {
   3.741309718830452*^9, 3.741309845516855*^9}, {3.7413098962333508`*^9, 
   3.7413099925518565`*^9}, {3.7413100365797367`*^9, 
   3.7413100664646916`*^9}, {3.741310124473631*^9, 3.741310350608971*^9}, 
   3.74131044700043*^9, {3.7413105218711247`*^9, 3.7413105537047*^9}, {
   3.7413106170933356`*^9, 3.7413106387441177`*^9}, {3.741311014576647*^9, 
   3.741311018918105*^9}, {3.741313545700123*^9, 3.7413135661513243`*^9}, {
   3.741314190478891*^9, 3.7413143603828497`*^9}, {3.7413143961862926`*^9, 
   3.7413144698161497`*^9}, 3.7413173752971373`*^9, {3.741317471621793*^9, 
   3.7413175892910595`*^9}, {3.7413180712099185`*^9, 
   3.7413180817206497`*^9}, {3.7413181312851973`*^9, 3.741318153591115*^9}, {
   3.7413182963653235`*^9, 3.7413183394176826`*^9}, {3.7413377327504544`*^9, 
   3.7413377510006356`*^9}, {3.7413377826151752`*^9, 3.741337782736441*^9}, {
   3.7413378746484556`*^9, 3.741337906439661*^9}, {3.741337972083366*^9, 
   3.741337999893508*^9}, 3.741338039035328*^9, {3.7413380897733955`*^9, 
   3.7413380932646933`*^9}, {3.7413895981251264`*^9, 3.7413896171380787`*^9}, 
   3.7413896722400255`*^9, 3.7413899500797105`*^9, {3.7413983025938053`*^9, 
   3.7413983029810762`*^9}, {3.7413983334307632`*^9, 3.741398340872614*^9}, {
   3.74139845356531*^9, 3.741398457061966*^9}, {3.741398533850153*^9, 
   3.7413985660084534`*^9}, {3.7413986414168425`*^9, 3.741398754964644*^9}, {
   3.741398898144227*^9, 3.7413989627196245`*^9}, {3.741398992950243*^9, 
   3.7413990746664147`*^9}, {3.7413991276863956`*^9, 3.741399299108982*^9}, {
   3.7413993557723937`*^9, 3.7413994336212826`*^9}, 3.7413994806609745`*^9, {
   3.741399779239669*^9, 3.7413997889896874`*^9}, {3.7413999842912827`*^9, 
   3.7414000171056175`*^9}, {3.741400058792286*^9, 3.7414000791635685`*^9}, {
   3.741400139044436*^9, 3.741400176954072*^9}, {3.7414002136497517`*^9, 
   3.741400269255838*^9}, {3.7414003125452576`*^9, 3.7414003162239313`*^9}, {
   3.7414004339706717`*^9, 3.7414004963187017`*^9}, {3.741400607266597*^9, 
   3.74140061067262*^9}, {3.741400674323283*^9, 3.741400747479274*^9}, {
   3.7414007877105665`*^9, 3.7414008202964015`*^9}, {3.7414009961207066`*^9, 
   3.741401002032657*^9}, {3.7414010612403307`*^9, 3.7414010918911896`*^9}, {
   3.741401251324448*^9, 3.741401270541774*^9}, {3.741401333165574*^9, 
   3.741401344807023*^9}, {3.7414015094159126`*^9, 3.7414015171289725`*^9}, {
   3.7414018932204556`*^9, 3.7414019095479193`*^9}, {3.74158939097619*^9, 
   3.741589391065027*^9}, {3.7416053299127812`*^9, 3.74160533076156*^9}, {
   3.74166764730363*^9, 3.7416676504021063`*^9}, {3.741956758802434*^9, 
   3.741956759226127*^9}, 3.74197624245269*^9, 3.7419763044214277`*^9, {
   3.7419763421913657`*^9, 3.741976342338209*^9}, {3.7419763732621064`*^9, 
   3.741976435363903*^9}, {3.741976610097859*^9, 3.7419766812292824`*^9}, {
   3.7419768003679647`*^9, 3.7419768037529783`*^9}, {3.7419769128020773`*^9, 
   3.7419769466116204`*^9}, {3.7419770642803597`*^9, 3.741977067133012*^9}, 
   3.741977152462181*^9, 3.741977191581053*^9, {3.7419772341541677`*^9, 
   3.741977243789467*^9}, {3.741977300347297*^9, 3.7419773085691905`*^9}, {
   3.741977342357255*^9, 3.741977345556782*^9}, {3.7419773972047205`*^9, 
   3.7419774484821706`*^9}, {3.741977489375533*^9, 3.741977609731287*^9}, 
   3.7419776460916953`*^9, {3.7419880288706036`*^9, 3.741988093418233*^9}, {
   3.7419881589677176`*^9, 3.7419882288814173`*^9}, {3.74198854734299*^9, 
   3.7419885502328715`*^9}, {3.7421673674216566`*^9, 
   3.7421673773397818`*^9}, {3.7422309720535526`*^9, 
   3.7422310216669817`*^9}, {3.7422311026010637`*^9, 3.742231115895153*^9}, {
   3.742319032848361*^9, 3.7423190358087797`*^9}, {3.7423191522353415`*^9, 
   3.7423191527007976`*^9}, {3.7426494808391438`*^9, 3.742649497030653*^9}, {
   3.742775745049723*^9, 3.7427761419843683`*^9}, {3.7427761945518827`*^9, 
   3.7427761961206903`*^9}, {3.742780538622178*^9, 3.742780539015173*^9}, {
   3.7427813340777493`*^9, 3.7427813921713066`*^9}, {3.7427814864969935`*^9, 
   3.74278151809479*^9}, {3.742782373447763*^9, 3.7427824098158197`*^9}, {
   3.7449187936945715`*^9, 3.744918855334853*^9}, {3.7449189544817815`*^9, 
   3.744918955654982*^9}, 3.7453614160203757`*^9, 
   3.74536147088979*^9},ExpressionUUID->"2172d681-5467-479e-8a91-\
76f5508d5177"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Lab frame simulation
\
\>", "Section",
 CellChangeTimes->{{3.7413982583366756`*^9, 3.7413982769541345`*^9}, {
   3.741860437775786*^9, 3.741860452929072*^9}, {3.742781640622509*^9, 
   3.7427816762437725`*^9}, {3.7438039288117123`*^9, 3.743803946781226*^9}, {
   3.744074171287549*^9, 3.744074182112127*^9}, 
   3.744918755619217*^9},ExpressionUUID->"39360da8-6692-4df3-8c26-\
6e6fb5e9761e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Next", ",", " ", 
    RowBox[{
     RowBox[{"I", "'"}], "ll", " ", "implement", " ", "Bloch", " ", 
     "oscillations", " ", "in", " ", "the", " ", "lab", " ", 
     RowBox[{"frame", ".", " ", "Note"}], " ", "that", " ", "you", " ", 
     RowBox[{"don", "'"}], "t", " ", "need", " ", "to", " ", "include", " ", 
     "momentum", " ", "kicks", " ", "in", " ", "the", " ", "lab", " ", 
     "frame", " ", "basis", " ", "states", " ", "because", " ", "the", " ", 
     "quasimomentum", " ", "is", " ", "not", " ", "a", " ", "function", " ", 
     "of", " ", 
     RowBox[{"time", ".", " ", "From"}], " ", "what", " ", "I", " ", "saw"}], 
    ",", " ", 
    RowBox[{
    "this", " ", "seems", " ", "to", " ", "agree", " ", "with", " ", "the", 
     " ", "lattice", " ", "frame", " ", "results", " ", "to", " ", "around", 
     " ", ".2", "%", " ", "in", " ", "final", " ", "probability", " ", 
     "amplitude", " ", "in", " ", "the", " ", "correct", " ", 
     RowBox[{"state", ".", " ", "You"}], " ", "can", " ", "also", " ", 
     "input", " ", "different", " ", "starting", " ", 
     RowBox[{"velocities", ":", " ", 
      RowBox[{
      "If", " ", "you", " ", "want", " ", "to", " ", "start", " ", "in", " ", 
       "the", " ", 
       SuperscriptBox["m", "th"], " ", "Fourier", " ", "component", " ", 
       "state"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{
     "this", " ", "corresponds", " ", "to", " ", "an", " ", "initial", " ", 
      "velocity", " ", "of"}], " ", "-", 
     RowBox[{"2", "*", "m", " ", "in", " ", "the", " ", "lab", " ", 
      RowBox[{"frame", ".", " ", "The"}], " ", "2", " ", "comes", " ", "from",
       " ", "the", " ", "fact", " ", "that", " ", "Fourier", " ", "states", 
      " ", "are", " ", "separated", " ", "by", " ", "two", " ", "photon", " ",
       "transitions"}]}], ",", " ", 
    RowBox[{
     RowBox[{"corresponding", " ", "to", " ", "2", "*", 
      SubscriptBox["v", "recoil"], " ", 
      RowBox[{"velocity", ".", " ", "And"}], " ", 
      SubscriptBox["v", "recoil"]}], " ", "=", " ", 
     RowBox[{"1", " ", "in", " ", "this", " ", "unit", " ", 
      RowBox[{"system", ".", " ", "The"}], " ", "minus", " ", "sign", " ", 
      "comes", " ", "from", " ", "a", " ", "convention", " ", "of", " ", 
      "how", " ", "\[CapitalDelta]\[Omega]", " ", "is", " ", "defined", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"I", "'"}], "m", " ", "pretty", " ", "sure"}], ")"}], 
       "."}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "pl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", 
      "NBloch", ",", "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", 
      "Ham0", ",", "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", 
      " ", "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",",
       " ", "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", 
      " ", "\[Psi]cf"}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NBloch", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NLatDep", " ", "=", " ", "12"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NRamp", " ", "=", " ", "11"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"v0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k0", " ", "=", " ", 
     RowBox[{
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v0", "+", "1"}], ",", "2"}], "]"}], "-", "1"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tLoad", " ", "=", " ", 
     RowBox[{"2", " ", "Pi", " ", "6"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CapitalDelta]\[Omega]", " ", "=", 
     RowBox[{
      RowBox[{"-", "4"}], "*", 
      RowBox[{"(", 
       RowBox[{"v0", "-", "k0"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Kappa]", " ", "=", " ", 
     FractionBox["NLatDep", "8"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"r", " ", "=", " ", 
     RowBox[{"NRamp", "*", "rGrav"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BlochPeriod", " ", "=", 
     RowBox[{"Abs", "[", 
      FractionBox["8", "r"], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TBloch", " ", "=", " ", 
     RowBox[{"BlochPeriod", " ", "*", " ", "NBloch"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lmax", " ", "=", " ", 
     RowBox[{"Max", "[", 
      RowBox[{"10", ",", 
       RowBox[{"Round", "[", 
        RowBox[{"5.", "*", 
         SuperscriptBox["NLatDep", 
          RowBox[{"1", "/", "4"}]]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dim", " ", "=", " ", 
     RowBox[{
      RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"loadLattice", "[", 
     RowBox[{
     "lMax_", ",", " ", "vv0_", ",", " ", "tLoad_", ",", " ", "loadHam_"}], 
     "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
        RowBox[{"v0", " ", "=", " ", "vv0"}], ",", " ", 
        RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
        RowBox[{"HamLoad", " ", "=", " ", "loadHam"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{
        "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
         ",", " ", "cs"}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"dimState", " ", "=", " ", 
        RowBox[{
         RowBox[{"2", "*", "maxL"}], " ", "+", " ", "1"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Psi]i", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "dimState"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"rem", " ", "=", " ", 
        RowBox[{"Mod", "[", 
         RowBox[{"v0", ",", " ", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"state", " ", "=", " ", 
        RowBox[{"Floor", "[", 
         FractionBox[
          RowBox[{"v0", "+", "1"}], "2"], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"m0", " ", "=", " ", 
        RowBox[{
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"v0", "+", "1"}], ",", " ", "2"}], "]"}], " ", "-", " ", 
         "1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]i", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"-", "state"}], " ", "+", "maxL", "+", "1"}], "]"}], "]"}],
         " ", "=", " ", "1"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "maxL"}], ",", "maxL", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"cs", " ", "=", " ", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "maxL"}], ",", "maxL", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ics", " ", "=", " ", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
           RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
            RowBox[{"nn", "+", 
             RowBox[{"(", 
              RowBox[{"maxL", "+", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "maxL"}], ",", "maxL", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"equation", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{
           RowBox[{"HamLoad", "[", "tt", "]"}], ".", 
           RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sol", " ", "=", " ", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
          RowBox[{"{", 
           RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
         RowBox[{
         "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[Psi]ci"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"unLoadLattice", "[", 
     RowBox[{
     "lMax_", ",", " ", "tLoad_", ",", " ", "unLoadHam_", ",", " ", 
      "\[Psi]ci_", ",", "vv0_"}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
        RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
        RowBox[{"HamUnLoad", " ", "=", " ", "unLoadHam"}], ",", " ", 
        RowBox[{"\[Psi]i", "=", " ", "\[Psi]ci"}], ",", 
        RowBox[{"v0", "=", "vv0"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"cs", " ", "=", " ", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ics", " ", "=", " ", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
           RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
            RowBox[{"nn", "+", 
             RowBox[{"(", 
              RowBox[{"lmax", "+", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"equation", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{
           RowBox[{"HamUnLoad", "[", "tt", "]"}], ".", 
           RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sol", " ", "=", " ", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
          RowBox[{"{", 
           RowBox[{"tt", ",", "0", ",", "loadTime"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]cff", "[", "tt_", "]"}], "=", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
         RowBox[{
         "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[Psi]cff"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Psi]", ",", " ", "ics", ",", " ", "cs", ",", " ", "\[CapitalDelta]"}],
      "]"}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"kl", "[", 
      RowBox[{"l_", ",", "v_"}], "]"}], ":=", 
     RowBox[{"v", "+", 
      RowBox[{"2", " ", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham0", "[", 
      RowBox[{"tt_", ",", "v_"}], "]"}], " ", "=", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"kl", "[", 
              RowBox[{
               RowBox[{"l", " ", "-", " ", 
                RowBox[{"(", 
                 RowBox[{"lmax", "+", "1"}], ")"}]}], ",", "v"}], "]"}], "2"],
             " ", "+", 
            RowBox[{"4", " ", "\[Kappa]\[Kappa]"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", 
             RowBox[{"(", 
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"-", "\[ImaginaryI]"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"tt", " ", 
                   RowBox[{"(", " ", 
                    RowBox[{"\[CapitalDelta]", "+", 
                    FractionBox[
                    RowBox[{"rr", " ", "tt"}], "2"]}], ")"}]}], " ", "+", " ",
                   "\[Phi]"}], ")"}]}], "]"}], ")"}]}], " ", "/;", " ", 
            RowBox[{
             RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"(", 
              RowBox[{"Exp", "[", 
               RowBox[{"\[ImaginaryI]", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"tt", " ", 
                   RowBox[{"(", " ", 
                    RowBox[{"\[CapitalDelta]", "+", 
                    FractionBox[
                    RowBox[{"rr", " ", "tt"}], "2"]}], ")"}]}], " ", "+", " ",
                   "\[Phi]"}], ")"}]}], "]"}], ")"}]}], "/;", 
            RowBox[{
             RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"Ham0", "[", 
       RowBox[{"tt", ",", "k0"}], "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox["tt", "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamUnLoad0", "[", 
      RowBox[{"tt_", ",", "v_"}], "]"}], " ", "=", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"kl", "[", 
              RowBox[{
               RowBox[{"l", " ", "-", " ", 
                RowBox[{"(", 
                 RowBox[{"lmax", "+", "1"}], ")"}]}], ",", "v"}], "]"}], "2"],
             " ", "+", 
            RowBox[{"4", " ", "\[Kappa]\[Kappa]"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"(", 
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"-", "\[ImaginaryI]"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"tt", " ", 
                   RowBox[{"(", " ", 
                    RowBox[{"\[CapitalDelta]", " ", "+", 
                    FractionBox["rr", "2"]}], ")"}]}], " ", "+", " ", 
                  "\[Phi]"}], ")"}]}], "]"}], ")"}]}], " ", "/;", " ", 
            RowBox[{
             RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"(", 
              RowBox[{"Exp", "[", 
               RowBox[{"\[ImaginaryI]", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"tt", " ", 
                   RowBox[{"(", " ", 
                    RowBox[{"\[CapitalDelta]", " ", "+", 
                    FractionBox["rr", "2"]}], ")"}]}], " ", "+", " ", 
                  "\[Phi]"}], ")"}]}], "]"}], ")"}]}], "/;", 
            RowBox[{
             RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"HamUnLoad0", "[", 
       RowBox[{"tt", ",", "k0"}], "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox[
           RowBox[{"(", 
            RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
        RowBox[{"\[CapitalDelta]", " ", "\[Rule]", " ", 
         RowBox[{"\[CapitalDelta]\[Omega]", " ", "+", 
          RowBox[{"r", " ", "TBloch"}]}]}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", 
         RowBox[{
          FractionBox[
           RowBox[{"r", " ", 
            SuperscriptBox["TBloch", "2"]}], "2"], " ", "+", " ", 
          RowBox[{"\[CapitalDelta]\[Omega]", " ", 
           RowBox[{"(", 
            RowBox[{"TBloch", " ", "+", " ", "tLoad"}], ")"}]}]}]}]}], 
       "}"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", 
       RowBox[{"tt", ",", "k0"}], "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
        RowBox[{"rr", "\[Rule]", "r"}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", " ", 
         RowBox[{"\[CapitalDelta]\[Omega]", " ", "tLoad"}]}]}], "}"}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"MatrixForm", "[", 
    RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamTrans", "[", "t_", "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"Ham1", "[", 
       RowBox[{"t", ",", "k0"}], "]"}], ".", 
      RowBox[{"Normal", "[", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
           SuperscriptBox["E", 
            RowBox[{
             RowBox[{"-", "\[ImaginaryI]"}], " ", "t", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"kl", "[", 
                 RowBox[{"l", " ", "-", " ", 
                  RowBox[{"(", 
                   RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"], " ", "+", 
               RowBox[{"4", " ", "\[Kappa]\[Kappa]"}]}], ")"}]}]]}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MatrixForm", "[", 
     RowBox[{"HamTrans", "[", "t", "]"}], "]"}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cs", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
    RowBox[{"loadLattice", "[", 
     RowBox[{"lmax", ",", " ", "v0", ",", " ", "tLoad", ",", " ", "HamLoad"}],
      "]"}]}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], "]"}], "2"], 
   "\[IndentingNewLine]", 
   RowBox[{"i1", " ", "=", "  ", 
    SuperscriptBox[
     RowBox[{"Norm", "[", 
      RowBox[{
       RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], ".", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", "2",
          "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ", 
        "\[RightDoubleBracket]"}]}], "]"}], "2"]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"i2", " ", "=", "  ", 
     SuperscriptBox[
      RowBox[{"Norm", "[", 
       RowBox[{
        RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], ".", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
         RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
      "2"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"i3", " ", "=", "  ", 
     SuperscriptBox[
      RowBox[{"Norm", "[", 
       RowBox[{
        RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], ".", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
         RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
      "2"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ics", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
        RowBox[{
         RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"nn", "+", 
          RowBox[{"(", 
           RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"equation", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", 
       RowBox[{
        RowBox[{"Ham1", "[", "tt", "]"}], ".", 
        RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sol", " ", "=", " ", 
     RowBox[{"NDSolve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
       RowBox[{"{", 
        RowBox[{"tt", ",", "0", ",", "TBloch"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
      RowBox[{
      "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ";"}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], "]"}], "2"], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]cf", " ", "=", " ", 
     RowBox[{"unLoadLattice", "[", 
      RowBox[{"lmax", ",", " ", "tLoad", ",", " ", "HamUnLoad", ",", 
       RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ",", "v0"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"p1", " ", "=", "  ", 
     SuperscriptBox[
      RowBox[{"Norm", "[", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], 
          "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
         "\[LeftDoubleBracket]", "dim", " ", "\[RightDoubleBracket]"}]}], 
       "]"}], "2"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"p2", " ", "=", "  ", 
     SuperscriptBox[
      RowBox[{"Norm", "[", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], 
          "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
      "2"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"p3", " ", "=", "  ", 
     SuperscriptBox[
      RowBox[{"Norm", "[", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], 
          "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
      "2"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"p1", "+", "p2", "+", "p3"}], ";"}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{"\[Psi]cf", "[", "tLoad", "]"}], "]"}], "2"], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"load", " ", "=", " ", 
     RowBox[{"Plot", "[", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"Abs", "[", 
         RowBox[{"\[Psi]iBloch", "[", "t", "]"}], "]"}], "2"], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", "0", ",", "tLoad"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BO", " ", "=", " ", 
     RowBox[{"Plot", "[", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"Abs", "[", 
         RowBox[{"\[Psi]ci", "[", 
          RowBox[{"t", "-", "tLoad"}], "]"}], "]"}], "2"], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", "tLoad", ",", 
         RowBox[{"tLoad", " ", "+", " ", "TBloch"}]}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"unload", " ", "=", " ", 
     RowBox[{"Plot", "[", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"Abs", "[", 
         RowBox[{"\[Psi]cf", "[", 
          RowBox[{"t", "-", "tLoad", " ", "-", " ", "TBloch"}], "]"}], "]"}], 
        "2"], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", 
         RowBox[{"tLoad", " ", "+", " ", "TBloch"}], ",", 
         RowBox[{
          RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}], 
       ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"load", ",", " ", "BO", ",", " ", "unload"}], "}"}], ",", " ", 
     RowBox[{"AxesLabel", "\[Rule]", " ", 
      RowBox[{"{", 
       RowBox[{
       "\"\<Time (dimensionless)\>\"", ",", " ", 
        "\"\<Probability Amplitude\>\""}], "}"}]}], ",", " ", 
     RowBox[{"ImageSize", "\[Rule]", " ", 
      RowBox[{"{", 
       RowBox[{"700", ",", "400"}], "}"}]}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.741860669882031*^9, 3.741860874199934*^9}, {
   3.741860910450859*^9, 3.741860974550316*^9}, {3.7418610723851643`*^9, 
   3.741861123858411*^9}, {3.7418613215877*^9, 3.741861338010107*^9}, {
   3.741861449477813*^9, 3.741861479565584*^9}, {3.7418619577592354`*^9, 
   3.7418619851852484`*^9}, {3.7418620273979836`*^9, 3.741862108202337*^9}, {
   3.7418622711398935`*^9, 3.741862272952489*^9}, {3.741862541538198*^9, 
   3.741862547369665*^9}, {3.7418626616794167`*^9, 3.7418626642770634`*^9}, {
   3.741862815906218*^9, 3.7418628252804537`*^9}, {3.741863235717679*^9, 
   3.741863239166461*^9}, {3.7418633178527746`*^9, 3.7418633391324472`*^9}, {
   3.7418635211749635`*^9, 3.741863524831752*^9}, 3.7418636340629025`*^9, {
   3.741863669799762*^9, 3.74186375985443*^9}, {3.7418638181651845`*^9, 
   3.741863827159851*^9}, {3.741863968350774*^9, 3.741863974101836*^9}, {
   3.741864102153517*^9, 3.7418641438641777`*^9}, {3.741865790365019*^9, 
   3.7418658877162447`*^9}, {3.7418659271996856`*^9, 3.741866036546028*^9}, {
   3.741866074056638*^9, 3.7418661077297*^9}, {3.741866197998753*^9, 
   3.741866212504515*^9}, {3.7418662664077187`*^9, 3.7418662702963734`*^9}, {
   3.74186630452822*^9, 3.741866369494582*^9}, {3.7418665105535083`*^9, 
   3.741866519699362*^9}, {3.7418665574864354`*^9, 3.741866593402815*^9}, {
   3.7418666301976366`*^9, 3.7418666314409666`*^9}, {3.7418666943145294`*^9, 
   3.7418666959588065`*^9}, {3.741866785802388*^9, 3.7418667974346647`*^9}, {
   3.7418668462515755`*^9, 3.741866851774766*^9}, {3.741866929033579*^9, 
   3.7418669889029226`*^9}, {3.7418670416880646`*^9, 3.741867057172574*^9}, {
   3.741867102425441*^9, 3.741867108349246*^9}, 3.7418671746860027`*^9, {
   3.741867318275659*^9, 3.7418673472522945`*^9}, {3.741867401704465*^9, 
   3.741867402865607*^9}, {3.7418674438284645`*^9, 3.741867452550108*^9}, {
   3.7418676700384245`*^9, 3.741867702436269*^9}, {3.7418677692524977`*^9, 
   3.7418678392627707`*^9}, {3.7418679418360724`*^9, 
   3.7418679535678368`*^9}, {3.7418680252426505`*^9, 3.7418680334829073`*^9}, 
   3.741868065725882*^9, {3.7418681447225204`*^9, 3.741868149441669*^9}, {
   3.741868246940384*^9, 3.741868248902231*^9}, {3.7418727703343287`*^9, 
   3.7418727864527855`*^9}, {3.7418728503806047`*^9, 
   3.7418728902951603`*^9}, {3.741872920822674*^9, 3.7418729218326235`*^9}, {
   3.7418729622012033`*^9, 3.741873039325132*^9}, {3.741873070027249*^9, 
   3.7418731058173137`*^9}, {3.741873230203494*^9, 3.741873238572608*^9}, {
   3.7418732739472275`*^9, 3.741873294494777*^9}, 3.7418733549570723`*^9, {
   3.7418734897101107`*^9, 3.7418735187462444`*^9}, 3.741873563430319*^9, {
   3.741873628125656*^9, 3.7418736829691057`*^9}, {3.741881381087506*^9, 
   3.7418813888021793`*^9}, {3.7419761608986235`*^9, 
   3.7419761609068136`*^9}, {3.741988689490301*^9, 3.7419887798824883`*^9}, 
   3.7419888230646467`*^9, {3.741988907571807*^9, 3.741988918132991*^9}, {
   3.7419890693854017`*^9, 3.741989086345129*^9}, {3.7419891878430643`*^9, 
   3.7419891888382206`*^9}, {3.7419893318399067`*^9, 3.7419893513119307`*^9}, 
   3.741989672620695*^9, {3.7419900763159275`*^9, 3.7419900818018775`*^9}, 
   3.741990394265979*^9, {3.7419907287893195`*^9, 3.741990732693043*^9}, {
   3.7419910109192986`*^9, 3.741991040555854*^9}, {3.7420915743889284`*^9, 
   3.7420916071723185`*^9}, {3.7420917613055344`*^9, 3.742091782463378*^9}, {
   3.7421674195955925`*^9, 3.742167480666748*^9}, {3.74223114174813*^9, 
   3.742231149183943*^9}, {3.742231179786186*^9, 3.7422312566743493`*^9}, {
   3.742231343701086*^9, 3.742231374584154*^9}, {3.7422315440588036`*^9, 
   3.742231579331767*^9}, {3.742231619962889*^9, 3.7422316265238004`*^9}, {
   3.742231658344451*^9, 3.742231663811923*^9}, {3.7422641913779664`*^9, 
   3.742264208401393*^9}, {3.7422642894158354`*^9, 3.7422643051450787`*^9}, {
   3.7422643410709925`*^9, 3.742264361894171*^9}, {3.742264714601554*^9, 
   3.7422647253800592`*^9}, {3.742264758682906*^9, 3.7422647708076277`*^9}, {
   3.7423126776004558`*^9, 3.7423126814201994`*^9}, {3.7423127178286304`*^9, 
   3.742312772195527*^9}, {3.742312874081865*^9, 3.742312980762902*^9}, {
   3.7423130157471886`*^9, 3.7423130251080265`*^9}, {3.742313094222059*^9, 
   3.7423131161663904`*^9}, {3.7423169471288767`*^9, 3.742316981114571*^9}, {
   3.7423170159511456`*^9, 3.742317029170951*^9}, {3.7423170632174797`*^9, 
   3.7423171603886967`*^9}, {3.7423172932310076`*^9, 
   3.7423173128423185`*^9}, {3.7423173495739326`*^9, 
   3.7423173506524515`*^9}, {3.7423174330810757`*^9, 
   3.7423174336084657`*^9}, {3.742317528461347*^9, 3.7423175414593787`*^9}, {
   3.742318422198106*^9, 3.742318523826437*^9}, {3.742318559550652*^9, 
   3.742318562682888*^9}, {3.742318619805689*^9, 3.7423186199093285`*^9}, {
   3.742318758032279*^9, 3.7423187614706736`*^9}, {3.742318812373005*^9, 
   3.742318903722255*^9}, {3.7423191861177535`*^9, 3.7423192042987127`*^9}, {
   3.7423192565598774`*^9, 3.742319260901048*^9}, {3.742319292304363*^9, 
   3.7423192937717466`*^9}, {3.7423193449194317`*^9, 3.742319398964735*^9}, {
   3.742319485924732*^9, 3.742319497252585*^9}, {3.742319530166074*^9, 
   3.742319530482894*^9}, {3.7423196018311243`*^9, 3.7423196097807226`*^9}, {
   3.7423197262795377`*^9, 3.742319727826803*^9}, {3.74231978576202*^9, 
   3.742319813139223*^9}, {3.742341240633272*^9, 3.7423412409914656`*^9}, {
   3.742341355521696*^9, 3.7423413559198294`*^9}, {3.74234139917237*^9, 
   3.7423413996892147`*^9}, {3.742341431317034*^9, 3.742341435526911*^9}, {
   3.742393315737317*^9, 3.7423933354457664`*^9}, {3.742649604326782*^9, 
   3.7426496087217135`*^9}, 3.7426498494889984`*^9, {3.742649920376139*^9, 
   3.742649920626082*^9}, 3.7426499593411093`*^9, {3.7426500060609837`*^9, 
   3.7426500094144597`*^9}, {3.7426500539273815`*^9, 3.7426500700391245`*^9}, 
   3.742650140665313*^9, {3.7426502285770397`*^9, 3.742650254453419*^9}, {
   3.742650313670294*^9, 3.7426503170473795`*^9}, 3.7426504505898137`*^9, {
   3.7426507433865547`*^9, 3.742650765821205*^9}, {3.742650841886865*^9, 
   3.742650854635337*^9}, {3.7426509109205713`*^9, 3.7426509112954826`*^9}, {
   3.7426509706920276`*^9, 3.742650972597831*^9}, {3.742651059377462*^9, 
   3.742651064409172*^9}, {3.7426511129087706`*^9, 3.742651116614567*^9}, {
   3.7426511488325777`*^9, 3.742651170208703*^9}, {3.742651207989891*^9, 
   3.742651239061108*^9}, {3.7426513218544545`*^9, 3.7426513432608447`*^9}, {
   3.7426513865382395`*^9, 3.7426513949066024`*^9}, {3.742651426532206*^9, 
   3.7426514266259365`*^9}, {3.7426904002680397`*^9, 
   3.7426904047098203`*^9}, {3.7426904387677155`*^9, 3.742690438891977*^9}, {
   3.7427565579571886`*^9, 3.74275659124024*^9}, 3.7427566852988753`*^9, {
   3.7427816102553215`*^9, 3.742781627280463*^9}, {3.7427816694937296`*^9, 
   3.7427816826796618`*^9}, {3.7427817331711197`*^9, 3.742781823193639*^9}, {
   3.742781877195053*^9, 3.7427819586545563`*^9}, {3.742782001037891*^9, 
   3.742782011676104*^9}, {3.742782052614385*^9, 3.7427821311092873`*^9}, {
   3.742782191491016*^9, 3.7427822052292185`*^9}, {3.74278252819234*^9, 
   3.7427825445571575`*^9}, {3.7434415908413906`*^9, 3.743441623136615*^9}, {
   3.7434416694631433`*^9, 3.7434416743135443`*^9}, {3.7434417084360065`*^9, 
   3.7434418234957895`*^9}, {3.743441860865471*^9, 3.7434418652930045`*^9}, 
   3.7434419100800576`*^9, {3.743443285012768*^9, 3.743443285204627*^9}, {
   3.7438039498826194`*^9, 3.7438039727435045`*^9}, {3.7440682751937575`*^9, 
   3.744068311609928*^9}, {3.744068347998927*^9, 3.744068384334203*^9}, {
   3.74406844385111*^9, 3.744068533099961*^9}, {3.7440686144660416`*^9, 
   3.744068727610094*^9}, {3.7440687739160247`*^9, 3.7440687883383255`*^9}, {
   3.744068822486323*^9, 3.7440688230834723`*^9}, {3.7440690491037683`*^9, 
   3.744069056115788*^9}, {3.7440691139531355`*^9, 3.7440691727398944`*^9}, {
   3.744069225704549*^9, 3.7440693455553493`*^9}, {3.744069390465627*^9, 
   3.7440693907716713`*^9}, {3.7440705834698677`*^9, 3.744070586240918*^9}, 
   3.7440706502033367`*^9, {3.74407073607006*^9, 3.7440707366947484`*^9}, {
   3.744070778076757*^9, 3.744070778446319*^9}, {3.7440708252854166`*^9, 
   3.7440709299106693`*^9}, {3.744071332325164*^9, 3.744071359326189*^9}, {
   3.7440714802117414`*^9, 3.7440715178803325`*^9}, {3.744071621532355*^9, 
   3.7440716416798677`*^9}, {3.744071875444444*^9, 3.7440718768352118`*^9}, {
   3.744071935076955*^9, 3.744071956235919*^9}, {3.7440720711162977`*^9, 
   3.7440720862760844`*^9}, {3.744072220932765*^9, 3.744072248224099*^9}, 
   3.7440723049520063`*^9, 3.744072375663868*^9, {3.744072413015526*^9, 
   3.744072472739649*^9}, {3.7440728829749165`*^9, 3.7440729119282584`*^9}, {
   3.744073082866171*^9, 3.744073132271512*^9}, {3.7440732966419554`*^9, 
   3.744073320877113*^9}, {3.7440745801182594`*^9, 3.744074605461934*^9}, 
   3.744074673900998*^9, {3.744074800482289*^9, 3.744074802404579*^9}, 
   3.7440748905863166`*^9, {3.7440749236467776`*^9, 3.74407497544083*^9}, {
   3.744075355899743*^9, 3.744075369306188*^9}, {3.744075399788889*^9, 
   3.7440754053076468`*^9}, {3.7440754950508337`*^9, 3.744075500966539*^9}, {
   3.744075597860298*^9, 3.7440755983784113`*^9}, {3.744075749794846*^9, 
   3.7440757958644633`*^9}, {3.7440758599516764`*^9, 3.744075878897304*^9}, {
   3.744075929349784*^9, 3.744075992362273*^9}, {3.7440760266324606`*^9, 
   3.744076029444788*^9}, {3.744076363976404*^9, 3.74407636807014*^9}, {
   3.7440766208538847`*^9, 3.7440766250963044`*^9}, {3.7440767978186836`*^9, 
   3.7440768495815067`*^9}, {3.744077117957825*^9, 3.744077118679907*^9}, {
   3.744077186089465*^9, 3.7440772112329082`*^9}, {3.7440772748853817`*^9, 
   3.744077276301049*^9}, {3.7440773751118107`*^9, 3.7440774350504804`*^9}, {
   3.7440776920666203`*^9, 3.744077705585121*^9}, {3.7440780844714117`*^9, 
   3.7440780854903107`*^9}, {3.744078482378851*^9, 3.7440785561552052`*^9}, {
   3.744078688346594*^9, 3.7440787123363*^9}, {3.7440787751081924`*^9, 
   3.744078786903239*^9}, {3.74408138677916*^9, 3.7440813899973865`*^9}, {
   3.7440818074802437`*^9, 3.7440818095887136`*^9}, {3.7449189622893395`*^9, 
   3.7449189635141926`*^9}, 3.744919173063037*^9, 3.7449192654500303`*^9, 
   3.7449193058196535`*^9, {3.7449194128119793`*^9, 3.7449197123580265`*^9}, {
   3.744919762025116*^9, 3.7449198026452937`*^9}, {3.745987508593805*^9, 
   3.745987539716568*^9}, {3.7459889240586414`*^9, 3.745988950164448*^9}, {
   3.74598910366122*^9, 3.7459891313873863`*^9}, {3.7459891919160995`*^9, 
   3.745989195567445*^9}, {3.745989232523693*^9, 3.7459893825935144`*^9}, {
   3.745989444999426*^9, 3.7459894467436247`*^9}, {3.7459896119289455`*^9, 
   3.74598961865449*^9}},ExpressionUUID->"6f9e9a3e-c9c3-49b4-8b4c-\
3157797561d6"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Adding in Bragg Diffraction", "Section",
 CellChangeTimes->{{3.74491991143268*^9, 
  3.7449199406820297`*^9}},ExpressionUUID->"059bb7e4-f7cb-4c59-9dc8-\
170d58fe24f9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Bragg", " ", "diffraction", " ", "has", " ", "the", " ", "same", " ", 
     "Hamiltonian", " ", "as", " ", "Bloch", " ", "oscillations"}], ",", " ", 
    RowBox[{
    "except", " ", "the", " ", "frequency", " ", "is", " ", "not", " ", 
     RowBox[{"ramped", ".", " ", "Instead"}], " ", "of", " ", "starting", " ",
      "with", " ", "a", " ", "lattice", " ", "comoving", " ", "with", " ", 
     "the", " ", "atoms"}], ",", " ", 
    RowBox[{
     RowBox[{"you", " ", "start", " ", "with", " ", "an", " ", "off"}], "-", 
     RowBox[{
     "resonant", " ", "lattice", " ", "that", " ", "the", " ", "atoms", " ", 
      "diffract", " ", "off", " ", 
      RowBox[{"of", ".", " ", "My"}], " ", "goal", " ", "here", " ", "is", 
      " ", "to", " ", "try", " ", "to", " ", "compare", " ", "my", " ", 
      "results", " ", "with", " ", "the", " ", "output", " ", "of", " ", 
      RowBox[{"Richard", "'"}], "s", " ", "Matlab", " ", "code", " ", "so", 
      " ", "that", " ", "we", " ", "can", " ", "verify", " ", "we", " ", 
      "are", " ", "simulating", " ", "Bloch", " ", "oscillations", " ", 
      RowBox[{"correctly", ".", " ", "So"}]}]}], ",", " ", 
    RowBox[{
    "I", " ", "will", " ", "use", " ", "the", " ", "same", " ", "Bragg", " ", 
     "pulse", " ", 
     RowBox[{"shape", "/", "intensity"}], " ", "that", " ", "is", " ", "used",
      " ", "in", " ", "the", " ", "Matlab", " ", 
     RowBox[{"code", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"n", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"v0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tau", " ", "=", " ", ".2596"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"int", " ", "=", " ", "3.0871"}], ";"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"int", " ", "=", " ", 
     RowBox[{"4", "*", "3.0871"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blochInt", " ", "=", " ", ".1544"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rampRate", " ", "=", " ", 
     RowBox[{"1.55", " ", "*", " ", 
      SuperscriptBox["10", "6"]}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Hz", "/", "s"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"recoilFreq", " ", "=", " ", "2066"}], ";"}], " ", 
   RowBox[{"(*", " ", "Hz", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dimRampRate", " ", "=", " ", 
     FractionBox["rampRate", 
      RowBox[{
       SuperscriptBox["recoilFreq", "2"], "*", " ", "2", " ", "Pi"}]]}], 
    ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"2", " ", "Pi", " ", "int"}], " ", ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"BraggPulse", "[", "t_", "]"}], " ", "=", "  ", 
     RowBox[{"2", " ", "Pi", " ", "int", " ", 
      RowBox[{"Exp", "[", 
       RowBox[{
        FractionBox[
         RowBox[{"-", "1"}], "2"], 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["t", "tau"], ")"}], "2"]}], "]"}]}]}], " ", ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fBragg", " ", "=", " ", 
     RowBox[{"4", "*", "2", "*", 
      RowBox[{"(", 
       RowBox[{"v0", " ", "+", " ", 
        FractionBox["n", "2"]}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "pl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", 
      "NBloch", ",", "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", 
      "Ham0", ",", "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", 
      " ", "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",",
       " ", "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", 
      " ", "\[Psi]cf"}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lmax", " ", "=", " ", "10"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dim", " ", "=", " ", 
     RowBox[{
      RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Psi]", ",", " ", "ics", ",", " ", "cs", ",", " ", "\[CapitalDelta]"}],
      "]"}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"kl", "[", 
      RowBox[{"l_", ",", "v_"}], "]"}], ":=", 
     RowBox[{"v", "+", 
      RowBox[{"2", " ", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham0", "[", 
      RowBox[{"tt_", ",", "v_"}], "]"}], " ", "=", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
           SuperscriptBox[
            RowBox[{"kl", "[", 
             RowBox[{
              RowBox[{"l", " ", "-", " ", 
               RowBox[{"(", 
                RowBox[{"lmax", "+", "1"}], ")"}]}], ",", "v"}], "]"}], 
            "2"]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", 
             RowBox[{"(", 
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"-", "\[ImaginaryI]"}], " ", "tt", " ", 
                "\[CapitalDelta]"}], "]"}], ")"}]}], " ", "/;", " ", 
            RowBox[{
             RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"(", 
              RowBox[{"Exp", "[", 
               RowBox[{"\[ImaginaryI]", " ", "tt", " ", "\[CapitalDelta]"}], 
               "]"}], ")"}]}], "/;", 
            RowBox[{
             RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", 
       RowBox[{"tt", ",", "v0"}], "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"BraggPulse", "[", "tt", "]"}]}], ",", " ", 
        RowBox[{"\[CapitalDelta]", " ", "\[Rule]", " ", "fBragg"}]}], 
       "}"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"MatrixForm", "[", 
    RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "   ", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Including", " ", "AC", " ", "stark", " ", "shift", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"Ham0", "[", 
        RowBox[{"tt_", ",", "v_"}], "]"}]}], " ", "=", " ", 
      RowBox[{"Normal", "[", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"kl", "[", 
               RowBox[{
                RowBox[{"l", " ", "-", " ", 
                 RowBox[{"(", 
                  RowBox[{"lmax", "+", "1"}], ")"}]}], ",", "v"}], "]"}], 
              "2"], " ", "+", 
             RowBox[{"2", "\[Kappa]\[Kappa]"}]}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"2", " ", "\[Kappa]\[Kappa]", 
              RowBox[{"(", 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", "\[ImaginaryI]"}], " ", "tt", " ", 
                 "\[CapitalDelta]"}], "]"}], ")"}]}], " ", "/;", " ", 
             RowBox[{
              RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
              RowBox[{"(", 
               RowBox[{"Exp", "[", 
                RowBox[{"\[ImaginaryI]", " ", "tt", " ", "\[CapitalDelta]"}], 
                "]"}], ")"}]}], "/;", 
             RowBox[{
              RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", 
        RowBox[{"tt", ",", "v0"}], "]"}], "/.", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{
           FractionBox["1", "4"], 
           RowBox[{"BraggPulse", "[", "tt", "]"}]}]}], ",", " ", 
         RowBox[{"\[CapitalDelta]", " ", "\[Rule]", " ", "fBragg"}]}], 
        "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"Ham1", "[", "t", "]"}], "]"}]}], "\[IndentingNewLine]", "*)"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cs", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", "dim"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
      RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
     "1"}], ";"}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", "\[Psi]iBloch", "]"}], "2"], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ics", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], "[", 
         RowBox[{
          RowBox[{"-", "5"}], " ", "tau"}], "]"}], "\[Equal]", 
        RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
         RowBox[{"nn", "+", 
          RowBox[{"(", 
           RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"equation", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", 
       RowBox[{
        RowBox[{"Ham1", "[", "tt", "]"}], ".", 
        RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sol", " ", "=", " ", 
     RowBox[{"NDSolve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
       RowBox[{"{", 
        RowBox[{"tt", ",", 
         RowBox[{
          RowBox[{"-", "5"}], "*", "tau"}], ",", 
         RowBox[{"5", "*", "tau"}]}], "}"}], ",", 
       RowBox[{"AccuracyGoal", "\[Rule]", "6"}], ",", 
       RowBox[{"PrecisionGoal", "\[Rule]", "6"}], ",", 
       RowBox[{"WorkingPrecision", "\[Rule]", "8"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
      RowBox[{
      "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"\[Psi]ci", "[", 
    RowBox[{"5", " ", "tau"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ArcTan", "[", 
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", 
         RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
       "]"}], ",", 
      RowBox[{"Im", "[", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", 
         RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
       "]"}]}], "]"}], "-", 
    RowBox[{"ArcTan", "[", 
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", 
         RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
      RowBox[{"Im", "[", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", 
         RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}]}], 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Mod", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"ArcTan", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Psi]ci", "[", 
             RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
            RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
           " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"\[ImaginaryI]", " ", "4", " ", 
             SuperscriptBox["n", "2"], " ", "t"}], "]"}]}], "]"}], ",", 
         RowBox[{"Im", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Psi]ci", "[", 
             RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
            RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
           " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"\[ImaginaryI]", " ", "4", " ", 
             SuperscriptBox["n", "2"], " ", "t"}], "]"}]}], "]"}]}], "]"}], 
       "-", 
       RowBox[{"ArcTan", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{
           RowBox[{"\[Psi]ci", "[", 
            RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
         RowBox[{"Im", "[", 
          RowBox[{
           RowBox[{"\[Psi]ci", "[", 
            RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], " ", 
          "]"}]}], "]"}]}], ",", 
      RowBox[{"2", " ", "Pi"}]}], "]"}], "/.", 
    RowBox[{"t", "\[Rule]", " ", 
     RowBox[{"5", " ", "tau"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"phin", "[", "t_", "]"}], " ", "=", " ", 
     RowBox[{"ArcTan", "[", 
      RowBox[{
       RowBox[{"Re", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
         " ", 
         RowBox[{"Exp", "[", 
          RowBox[{"\[ImaginaryI]", " ", "4", " ", 
           SuperscriptBox["n", "2"], " ", "t"}], "]"}]}], "]"}], ",", 
       RowBox[{"Im", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
         " ", 
         RowBox[{"Exp", "[", 
          RowBox[{"\[ImaginaryI]", " ", "4", " ", 
           SuperscriptBox["n", "2"], " ", "t"}], "]"}]}], "]"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"phi0", "[", "t_", "]"}], " ", "=", " ", 
     RowBox[{"ArcTan", "[", 
      RowBox[{
       RowBox[{"Re", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
       RowBox[{"Im", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"phin", "[", "t", "]"}], ",", " ", 
       RowBox[{"phi0", "[", "t", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{
        RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
       RowBox[{"5", " ", "tau"}]}], "}"}]}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{"\[Psi]ci", "[", 
      RowBox[{"5", " ", "tau"}], "]"}], "]"}], "2"], "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]ci", "[", "t", "]"}], "]"}], "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{
        RowBox[{"-", "5"}], "*", "tau"}], ",", 
       RowBox[{"5", "*", "tau"}]}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "kl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", 
      "NBloch", ",", "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", 
      "Ham0", ",", "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", 
      " ", "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",",
       " ", "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", 
      " ", "\[Psi]cf"}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Psi]", ",", " ", "ics", ",", " ", "cs", ",", " ", "\[CapitalDelta]"}],
      "]"}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"kl", "[", 
      RowBox[{"l_", ",", "v_"}], "]"}], ":=", 
     RowBox[{"v", "+", 
      RowBox[{"2", " ", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham0", "[", 
      RowBox[{"tt_", ",", "v_"}], "]"}], " ", "=", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", 
             RowBox[{"(", 
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"-", "\[ImaginaryI]"}], " ", "tt", 
                RowBox[{"(", " ", 
                 RowBox[{"\[CapitalDelta]", " ", "-", " ", 
                  RowBox[{"4", 
                   RowBox[{"(", 
                    RowBox[{"0", "+", 
                    RowBox[{"2", " ", 
                    RowBox[{"(", 
                    RowBox[{"a", " ", "-", " ", "lmax", "-", "1"}], ")"}]}], 
                    " ", "-", "1"}], ")"}]}]}], ")"}]}], "]"}], ")"}]}], " ", 
            "/;", " ", 
            RowBox[{
             RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"(", 
              RowBox[{"Exp", "[", 
               RowBox[{"\[ImaginaryI]", " ", "tt", 
                RowBox[{"(", " ", 
                 RowBox[{"\[CapitalDelta]", " ", "-", " ", 
                  RowBox[{"4", 
                   RowBox[{"(", 
                    RowBox[{"0", "+", 
                    RowBox[{"2", " ", 
                    RowBox[{"(", 
                    RowBox[{"m", "-", "lmax", "-", "1"}], ")"}]}], " ", "+", 
                    "1"}], ")"}]}]}], ")"}]}], "]"}], ")"}]}], "/;", 
            RowBox[{
             RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", 
       RowBox[{"tt", ",", "v0"}], "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{
          FractionBox["1", "4"], 
          RowBox[{"BraggPulse", "[", "tt", "]"}]}]}], ",", " ", 
        RowBox[{"\[CapitalDelta]", " ", "\[Rule]", " ", "fBragg"}]}], 
       "}"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"MatrixForm", "[", 
    RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cs", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", "dim"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
      RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
     "1"}], ";"}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", "\[Psi]iBloch", "]"}], "2"], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ics", " ", "=", " ", 
     RowBox[{"ParallelTable", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], "[", 
         RowBox[{
          RowBox[{"-", "5"}], " ", "tau"}], "]"}], "\[Equal]", 
        RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
         RowBox[{"nn", "+", 
          RowBox[{"(", 
           RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"equation", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", 
       RowBox[{
        RowBox[{"Ham1", "[", "tt", "]"}], ".", 
        RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sol", " ", "=", " ", 
     RowBox[{"NDSolve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
       RowBox[{"{", 
        RowBox[{"tt", ",", 
         RowBox[{
          RowBox[{"-", "5"}], "*", "tau"}], ",", 
         RowBox[{"5", "*", "tau"}]}], "}"}], ",", 
       RowBox[{"AccuracyGoal", "\[Rule]", "6"}], ",", 
       RowBox[{"PrecisionGoal", "\[Rule]", "6"}], ",", 
       RowBox[{"WorkingPrecision", "\[Rule]", "8"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
      RowBox[{
      "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]ci", "[", 
     RowBox[{"5", " ", "tau"}], "]"}], ";"}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{"\[Psi]ci", "[", 
      RowBox[{"5", " ", "tau"}], "]"}], "]"}], "2"], "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]ci", "[", "t", "]"}], "]"}], "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{
        RowBox[{"-", "5"}], "*", "tau"}], ",", 
       RowBox[{"5", "*", "tau"}]}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"Mod", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ArcTan", "[", 
       RowBox[{
        RowBox[{"Re", "[", 
         RowBox[{
          RowBox[{"\[Psi]ci", "[", 
           RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
         "]"}], ",", 
        RowBox[{"Im", "[", 
         RowBox[{
          RowBox[{"\[Psi]ci", "[", 
           RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
         "]"}]}], "]"}], "-", 
      RowBox[{"ArcTan", "[", 
       RowBox[{
        RowBox[{"Re", "[", 
         RowBox[{
          RowBox[{"\[Psi]ci", "[", 
           RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
        RowBox[{"Im", "[", 
         RowBox[{
          RowBox[{"\[Psi]ci", "[", 
           RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}]}], 
       "]"}]}], ",", 
     RowBox[{"2", " ", "Pi"}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"phin", "[", "t_", "]"}], " ", "=", " ", 
     RowBox[{"ArcTan", "[", 
      RowBox[{
       RowBox[{"Re", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], " ",
         "]"}], ",", 
       RowBox[{"Im", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
        "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"phi0", "[", "t_", "]"}], " ", "=", " ", 
     RowBox[{"ArcTan", "[", 
      RowBox[{
       RowBox[{"Re", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
       RowBox[{"Im", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"phin", "[", "t", "]"}], ",", " ", 
       RowBox[{"phi0", "[", "t", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{
        RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
       RowBox[{"5", " ", "tau"}]}], "}"}]}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.74491991143268*^9, 3.7449199641104302`*^9}, {
   3.7449200245733385`*^9, 3.7449201785827055`*^9}, {3.744920217542529*^9, 
   3.7449202563433475`*^9}, {3.7449475897772894`*^9, 3.744947596731127*^9}, {
   3.7449476454991007`*^9, 3.7449477684535074`*^9}, {3.74494790708576*^9, 
   3.7449480342987814`*^9}, {3.744948073751777*^9, 3.7449480739219117`*^9}, {
   3.744948179115616*^9, 3.74494823039714*^9}, 3.7449483223439693`*^9, {
   3.744948354614434*^9, 3.7449483907846317`*^9}, {3.7449484213158665`*^9, 
   3.744948427515899*^9}, {3.7449485624309025`*^9, 3.744948583319004*^9}, {
   3.7449486245563316`*^9, 3.744948642652888*^9}, {3.744948679270796*^9, 
   3.7449487647562523`*^9}, {3.744948800478438*^9, 3.7449488886805325`*^9}, {
   3.7449489584455786`*^9, 3.7449490684561005`*^9}, {3.7449492575084352`*^9, 
   3.7449493322451324`*^9}, {3.744949375435626*^9, 3.744949398797327*^9}, {
   3.7449494844409723`*^9, 3.7449495110527043`*^9}, {3.7449495484633923`*^9, 
   3.7449495512414637`*^9}, {3.7449498481607723`*^9, 
   3.7449498713296814`*^9}, {3.744950581841468*^9, 3.7449505834454675`*^9}, 
   3.744982285341117*^9, {3.7449861106380606`*^9, 3.7449861113126106`*^9}, {
   3.7450169594756346`*^9, 3.7450169628087273`*^9}, {3.745019885183429*^9, 
   3.7450198859274397`*^9}, {3.7450200005221677`*^9, 
   3.7450200012402506`*^9}, {3.7450205851002407`*^9, 
   3.7450205853206525`*^9}, {3.7450211895674095`*^9, 
   3.7450212071015635`*^9}, {3.7450213274609985`*^9, 3.745021327716316*^9}, {
   3.745021391309412*^9, 3.74502141899644*^9}, {3.745021505592029*^9, 
   3.745021529204943*^9}, {3.745021951484272*^9, 3.7450219552841196`*^9}, {
   3.745021988644988*^9, 3.7450219958666935`*^9}, {3.7450223171587777`*^9, 
   3.7450223241241713`*^9}, {3.7450296629501667`*^9, 
   3.7450297270514345`*^9}, {3.7450297601534357`*^9, 
   3.7450297727971425`*^9}, {3.745029896066967*^9, 3.745029935352663*^9}, {
   3.745030844857926*^9, 3.7450308456348515`*^9}, {3.7450309310795927`*^9, 
   3.745030960262601*^9}, {3.74503102869277*^9, 3.7450310319111977`*^9}, {
   3.745031353803007*^9, 3.7450313657204285`*^9}, {3.745031428233509*^9, 
   3.7450314301207075`*^9}, {3.7450314834705877`*^9, 
   3.7450314848041143`*^9}, {3.7450319901218767`*^9, 3.745031993632615*^9}, {
   3.7450320768170505`*^9, 3.745032098122879*^9}, {3.7450321759430933`*^9, 
   3.745032181191164*^9}, 3.745032682233738*^9, {3.745032887282989*^9, 
   3.745032888576844*^9}, {3.745033315100774*^9, 3.745033317898796*^9}, {
   3.7450333543715982`*^9, 3.745033355045186*^9}, {3.7450334179884925`*^9, 
   3.745033444788308*^9}, {3.745033543295641*^9, 3.7450335444216595`*^9}, 
   3.745033829324684*^9, {3.745034321520564*^9, 3.745034335844856*^9}, {
   3.7450956079880085`*^9, 3.745095608561435*^9}, {3.7450956494328957`*^9, 
   3.7450956541057987`*^9}, {3.7450956898052177`*^9, 
   3.7450956904761934`*^9}, {3.7450957251495275`*^9, 3.745095729555915*^9}, {
   3.7450961242324843`*^9, 3.745096134910026*^9}, {3.745096377631358*^9, 
   3.7450963869492273`*^9}, {3.7450964222781515`*^9, 
   3.7450964267320337`*^9}, {3.7450964639488487`*^9, 
   3.7450964730989428`*^9}, {3.745100093509102*^9, 3.745100097695543*^9}, {
   3.7451001845388126`*^9, 3.7451002764771338`*^9}, {3.7451003105514565`*^9, 
   3.745100341612999*^9}, {3.745100534596027*^9, 3.7451005433528767`*^9}, {
   3.7451006313914924`*^9, 3.745100740432217*^9}, {3.7451018535089445`*^9, 
   3.74510185371572*^9}, {3.7451024686384163`*^9, 3.745102468954176*^9}, {
   3.7451025000790462`*^9, 3.745102535336439*^9}, {3.74510366491881*^9, 
   3.745103729398969*^9}, {3.74510378241523*^9, 3.745103854233379*^9}, {
   3.7451038985116563`*^9, 3.7451039196542077`*^9}, {3.7451039690978827`*^9, 
   3.745104041086171*^9}, {3.745104141722783*^9, 3.7451041575799675`*^9}, {
   3.745104248864962*^9, 3.7451042766653223`*^9}, {3.745104411962658*^9, 
   3.745104446208234*^9}, {3.7451046087108717`*^9, 3.745104612735139*^9}, {
   3.7451053004477696`*^9, 3.7451053040023003`*^9}, {3.7451054127762437`*^9, 
   3.745105427421506*^9}, {3.745106756698353*^9, 3.745106760891348*^9}, {
   3.745107390893255*^9, 3.745107435227029*^9}, {3.7451076899508905`*^9, 
   3.745107696693647*^9}, {3.745107877818176*^9, 3.7451079030903015`*^9}, {
   3.745108080904247*^9, 3.7451081074613247`*^9}, {3.7451112859086504`*^9, 
   3.7451112904701595`*^9}, 3.745111823420431*^9, {3.745111872848998*^9, 
   3.745111873327625*^9}, {3.7457097316916313`*^9, 3.7457097353448706`*^9}, {
   3.7459875428939543`*^9, 3.7459875656899877`*^9}, {3.7516340818364115`*^9, 
   3.751634082262813*^9}, {3.7516341488487606`*^9, 3.7516341621496563`*^9}, {
   3.751634202644074*^9, 3.751634204167512*^9}, {3.7516345008739595`*^9, 
   3.7516345010443134`*^9}},ExpressionUUID->"eb24d7ce-b747-4be9-850e-\
ce05a408fad2"],

Cell[BoxData["/"], "Input",
 CellChangeTimes->{
  3.751634535616191*^9},ExpressionUUID->"6f6f4103-a770-41b0-9b7a-\
d06e0581e29e"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7516342911802816`*^9, 
  3.7516342912316494`*^9}},ExpressionUUID->"0ca48f2f-7f5f-4475-968e-\
6ef9dc995c62"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.751634295241288*^9, 
  3.7516342952613993`*^9}},ExpressionUUID->"bea0fdac-30c5-4c83-a307-\
28e6f2a8a03d"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7516342631393538`*^9, 
  3.751634263155184*^9}},ExpressionUUID->"5251a683-0efc-43f6-abca-\
477bac8cbc87"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.751634259080391*^9, 
  3.7516342591143036`*^9}},ExpressionUUID->"168397dc-6ec9-4a7d-b73f-\
7ee2bf3c3c64"],

Cell[CellGroupData[{

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7516342761491413`*^9, 
  3.7516342761543884`*^9}},ExpressionUUID->"a0735ba1-f040-4706-9508-\
bbae90fe453c"],

Cell[BoxData[
 TemplateBox[{
  "General","stop",
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"Infinity\\\", \
\\\"::\\\", \\\"indet\\\"}], \\\"MessageName\\\"]\\) will be suppressed \
during this calculation.\"",2,226,76,16586085820115175459,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.7449498736572456`*^9, 3.7449505863816867`*^9, 3.744982289145464*^9, 
   3.7449861139880404`*^9, 3.7450169710556946`*^9, 3.7450198892735014`*^9, 
   3.745020010179366*^9, 3.745020587797035*^9, 3.7450212129369726`*^9, 
   3.74502133012488*^9, {3.74502139589516*^9, 3.7450214213521457`*^9}, 
   3.7450220186109276`*^9, 3.7450299779613323`*^9, 3.7450308485410843`*^9, 
   3.7450309660361705`*^9, 3.745031034957034*^9, 3.745031432911165*^9, 
   3.745031487478578*^9, 3.745031997054288*^9, 3.745032101382576*^9, 
   3.7450326855912957`*^9, 3.745032891428252*^9, 3.7450333206062965`*^9, 
   3.7450333581235223`*^9, 3.74503354686485*^9, 3.745033833008179*^9, 
   3.745034338740059*^9, 3.745095613325138*^9, 3.745095656705576*^9, 
   3.74509569303957*^9, 3.7450957322885675`*^9, 3.745096140892042*^9, 
   3.7450963900502357`*^9, 3.745096429702468*^9, 3.7450964757973523`*^9, 
   3.745100283097327*^9, 3.745100344671198*^9, 3.74510054595362*^9, 
   3.7451007503232884`*^9, 3.7451018656096277`*^9, 3.745102472039792*^9, 
   3.7451025039279475`*^9, 3.7451038572628264`*^9, 3.7451039253231897`*^9, 
   3.745104044873597*^9, 3.7451041638140373`*^9, {3.7451042517295294`*^9, 
   3.745104279666918*^9}, 3.7451052249561305`*^9, 3.7451055044396567`*^9, 
   3.7451067636651416`*^9, 3.74510743836838*^9, 3.745107700766321*^9, 
   3.7451079061698313`*^9, 3.7451081137646008`*^9, 3.7451112945805817`*^9, 
   3.7451118270510263`*^9, 3.745111876767867*^9, 3.7457096970901036`*^9, 
   3.745709736715207*^9, 3.751633999860473*^9, 3.7516340832815733`*^9, 
   3.751634163186924*^9, {3.751634232879589*^9, 
   3.751634255298814*^9}},ExpressionUUID->"9e9d0383-74ee-44f7-a459-\
8b860cfef59c"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7516342515795393`*^9, 
  3.7516342516348553`*^9}},ExpressionUUID->"443cdfdc-7369-40e5-8630-\
1e9d5a764e44"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Dual Bloch Lattice Acceleration", "Section",
 CellChangeTimes->{{3.745111407193483*^9, 
  3.745111432719699*^9}},ExpressionUUID->"0c4874c1-72a4-4a82-83e9-\
c1fbcb9b2011"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "pl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", "NBloch",
      ",", "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", "Ham0", ",", 
     "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", " ", 
     "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",", " ", 
     "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", " ", 
     "\[Psi]cf"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NBloch", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NLatDep", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NRamp", " ", "=", " ", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"k0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tLoad", " ", "=", " ", 
   RowBox[{"2", " ", "Pi"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n1", " ", "=", " ", 
   RowBox[{"-", "1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n2", " ", "=", " ", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalDelta]\[Omega]", " ", "=", " ", 
   RowBox[{"4", "*", "2", "*", 
    FractionBox[
     RowBox[{"(", 
      RowBox[{"n2", "+", "n1"}], ")"}], "2"]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Omega]Mod", " ", "=", " ", 
    RowBox[{"4", " ", "*", " ", "2", " ", "*", " ", 
     FractionBox[
      RowBox[{"(", 
       RowBox[{"n2", "-", "n1"}], ")"}], "2"]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Kappa]", " ", "=", " ", 
   FractionBox["NLatDep", "8"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"r", " ", "=", " ", 
   RowBox[{"NRamp", "*", "rGrav"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlochPeriod", " ", "=", " ", 
   FractionBox["8", "r"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"TBloch", " ", "=", " ", 
   RowBox[{"BlochPeriod", " ", "*", " ", "NBloch"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lmax", " ", "=", " ", 
   RowBox[{"Max", "[", 
    RowBox[{
     RowBox[{"5", "+", "NBloch", " ", "+", " ", 
      RowBox[{"Max", "[", 
       RowBox[{"n1", ",", "n2"}], "]"}]}], ",", 
     RowBox[{"NBloch", " ", "+", " ", 
      RowBox[{"Max", "[", 
       RowBox[{"n1", ",", "n2"}], "]"}], "+", " ", 
      RowBox[{"Round", "[", 
       RowBox[{"5.", "*", 
        SuperscriptBox["NLatDep", 
         RowBox[{"1", "/", "4"}]]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dim", " ", "=", " ", 
    RowBox[{
     RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"loadLattice", "[", 
    RowBox[{
    "lMax_", ",", " ", "nn1_", ",", "nn2_", ",", " ", "tLoad_", ",", " ", 
     "loadHam_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
       RowBox[{"n1", " ", "=", " ", "nn1"}], ",", " ", 
       RowBox[{"n2", " ", "=", " ", "nn2"}], ",", " ", 
       RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
       RowBox[{"HamLoad", " ", "=", " ", "loadHam"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{
       "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
        ",", " ", "cs"}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"dimState", " ", "=", " ", 
       RowBox[{
        RowBox[{"2", "*", "maxL"}], " ", "+", " ", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Psi]i", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", "dimState"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"rem", " ", "=", " ", 
       RowBox[{"Mod", "[", 
        RowBox[{"k0", ",", " ", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]i", "[", 
        RowBox[{"[", 
         RowBox[{"n1", " ", "+", " ", 
          RowBox[{"(", 
           RowBox[{"lmax", " ", "+", "1"}], ")"}]}], "]"}], "]"}], " ", "=", 
       " ", 
       FractionBox["1", 
        RowBox[{"Sqrt", "[", "2", "]"}]]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]i", "[", 
        RowBox[{"[", 
         RowBox[{"n2", " ", "+", " ", 
          RowBox[{"(", 
           RowBox[{"lmax", " ", "+", "1"}], ")"}]}], "]"}], "]"}], " ", "=", 
       " ", 
       FractionBox["1", 
        RowBox[{"Sqrt", "[", "2", "]"}]]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"equation", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{"HamLoad", "[", "tt", "]"}], ".", 
          RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
         RowBox[{"{", 
          RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]ci", "[", "tt_", "]"}], ":=", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
        RowBox[{
        "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"\[Psi]ci", "[", "tLoad", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"unLoadLattice", "[", 
    RowBox[{
    "lMax_", ",", " ", "tLoad_", ",", " ", "unLoadHam_", ",", " ", 
     "\[Psi]ci_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
       RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
       RowBox[{"HamUnLoad", " ", "=", " ", "unLoadHam"}], ",", " ", 
       RowBox[{"\[Psi]i", "=", " ", "\[Psi]ci"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"equation", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{"HamUnLoad", "[", "tt", "]"}], ".", 
          RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
         RowBox[{"{", 
          RowBox[{"tt", ",", "0", ",", "loadTime"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]cff", "[", "tt_", "]"}], ":=", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
        RowBox[{
        "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"\[Psi]cff", "[", "loadTime", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kl", "[", "l_", "]"}], ":=", 
   RowBox[{"k0", "+", 
    RowBox[{"2", " ", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
   RowBox[{"Normal", "[", 
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"kl", "[", 
            RowBox[{"l", " ", "-", " ", 
             RowBox[{"(", 
              RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"], " ", "+", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"4", " ", "\[Kappa]\[Kappa]"}], " ", "+", " ", 
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"Cos", "[", 
              RowBox[{
               RowBox[{"wMod", " ", "tt"}], " ", "+", 
               FractionBox[
                RowBox[{"rr", " ", 
                 SuperscriptBox["tt", "2"]}], "2"], "+", "\[Phi]2"}], 
              "]"}]}]}], ")"}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", " ", 
           RowBox[{"Sqrt", "[", "2", "]"}], "  ", "\[Kappa]\[Kappa]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", " ", "\[ImaginaryI]"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[CapitalDelta]w", " ", "tt"}], "+", "\[Phi]1"}], 
                ")"}]}], "]"}], " ", 
             RowBox[{"Cos", "[", 
              RowBox[{
               RowBox[{"wMod", " ", "tt"}], " ", "+", " ", 
               FractionBox[
                RowBox[{"rr", " ", 
                 SuperscriptBox["tt", "2"]}], "2"], "+", "\[Phi]2"}], "]"}]}],
             ")"}]}], " ", "/;", " ", 
          RowBox[{
           RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", " ", 
           RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"\[ImaginaryI]", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[CapitalDelta]w", " ", "tt"}], "+", "\[Phi]1"}], 
                ")"}]}], "]"}], " ", 
             RowBox[{"Cos", "[", 
              RowBox[{
               RowBox[{"wMod", " ", "tt"}], " ", "+", " ", 
               FractionBox[
                RowBox[{"rr", " ", 
                 SuperscriptBox["tt", "2"]}], "2"], "+", "\[Phi]2"}], "]"}]}],
             ")"}]}], "/;", 
          RowBox[{
           RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
       RowBox[{"\[Kappa]", " ", 
        FractionBox["tt", "tLoad"]}]}], ",", " ", 
      RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
      RowBox[{
      "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
      ",", " ", 
      RowBox[{"wMod", "\[Rule]", " ", "\[Omega]Mod"}], ",", " ", 
      RowBox[{"\[Phi]1", "\[Rule]", " ", "0"}], ",", 
      RowBox[{"\[Phi]2", "\[Rule]", " ", "0"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
   RowBox[{
    RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
       RowBox[{"\[Kappa]", " ", 
        FractionBox[
         RowBox[{"(", 
          RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
      RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
      RowBox[{
      "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
      ",", " ", 
      RowBox[{"\[Phi]1", "\[Rule]", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"tLoad", "+", "TBloch"}], ")"}], " ", 
        "\[CapitalDelta]\[Omega]"}]}], ",", " ", 
      RowBox[{"\[Phi]2", "\[Rule]", " ", 
       RowBox[{
        RowBox[{"tLoad", " ", "\[CapitalDelta]\[Omega]"}], "+", 
        FractionBox[
         RowBox[{"r", " ", 
          SuperscriptBox["TBloch", "2"]}], "2"]}]}], ",", "  ", 
      RowBox[{"wMod", "\[Rule]", " ", "\[Omega]Mod"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MatrixForm", "[", 
   RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
   RowBox[{
    RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
      RowBox[{"rr", "\[Rule]", "r"}], ",", " ", 
      RowBox[{
      "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
      ",", "  ", 
      RowBox[{"wMod", "\[Rule]", " ", "\[Omega]Mod"}], ",", " ", 
      RowBox[{"\[Phi]1", "\[Rule]", " ", 
       RowBox[{"tLoad", " ", "\[CapitalDelta]\[Omega]"}]}], ",", " ", 
      RowBox[{"\[Phi]2", "\[Rule]", " ", 
       RowBox[{"tLoad", " ", "\[Omega]Mod"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MatrixForm", "[", 
   RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cs", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{"ci", "[", "nn", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
   RowBox[{"loadLattice", "[", 
    RowBox[{
    "lmax", ",", " ", "n1", ",", " ", "n2", ",", " ", "tLoad", ",", " ", 
     "HamLoad"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 SuperscriptBox[
  RowBox[{"Abs", "[", "\[Psi]iBloch", "]"}], "2"], "\[IndentingNewLine]", 
 RowBox[{"i1", " ", "=", "  ", 
  SuperscriptBox[
   RowBox[{"Norm", "[", 
    RowBox[{"\[Psi]iBloch", ".", 
     RowBox[{
      RowBox[{
       RowBox[{"Eigensystem", "[", 
        RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
       "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ", 
      "\[RightDoubleBracket]"}]}], "]"}], "2"]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"i2", " ", "=", "  ", 
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{"\[Psi]iBloch", ".", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
        "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
    "2"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"i3", " ", "=", "  ", 
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{"\[Psi]iBloch", ".", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
        "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
    "2"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ics", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
      RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
       RowBox[{"nn", "+", 
        RowBox[{"(", 
         RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"equation", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
    RowBox[{
     RowBox[{"-", "\[ImaginaryI]"}], " ", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt", "]"}], ".", 
      RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sol", " ", "=", " ", 
   RowBox[{"NDSolve", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
     RowBox[{"{", 
      RowBox[{"tt", ",", "0", ",", "TBloch"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
   RowBox[{
    RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
    RowBox[{"sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ";"}], "\[IndentingNewLine]", 
 SuperscriptBox[
  RowBox[{"Abs", "[", 
   RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], "]"}], 
  "2"], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]cf", " ", "=", " ", 
   RowBox[{"unLoadLattice", "[", 
    RowBox[{"lmax", ",", " ", "tLoad", ",", " ", "HamUnLoad", ",", 
     RowBox[{"\[Psi]ci", "[", "TBloch", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"p1", " ", "=", "  ", 
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], "\[LeftDoubleBracket]", 
        "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ", 
       "\[RightDoubleBracket]"}]}], "]"}], "2"]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"p2", " ", "=", "  ", 
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], "\[LeftDoubleBracket]", 
        "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
    "2"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"p3", " ", "=", "  ", 
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], "\[LeftDoubleBracket]", 
        "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
    "2"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"p1", "+", "p2", "+", "p3"}], ";"}], "\[IndentingNewLine]", 
 SuperscriptBox[
  RowBox[{"Abs", "[", "\[Psi]cf", "]"}], "2"], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{"\[Psi]ci", "[", "t", "]"}], "]"}], "2"], ",", " ", 
   RowBox[{"{", 
    RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.745111407193483*^9, 3.74511143926927*^9}, 
   3.745111691418311*^9, {3.745111971628496*^9, 3.745112031518957*^9}, {
   3.7451121226607227`*^9, 3.745112162239562*^9}, {3.74511235407763*^9, 
   3.745112424093357*^9}, {3.7451125847946644`*^9, 3.7451125901938977`*^9}, {
   3.7451128056895094`*^9, 3.7451128218921356`*^9}, {3.745112977574361*^9, 
   3.7451130562386336`*^9}, {3.745113089619318*^9, 3.7451130908415556`*^9}, {
   3.745158620694614*^9, 3.745158625312478*^9}, {3.74515865632561*^9, 
   3.7451587161294107`*^9}, {3.745158874950424*^9, 3.745159029935588*^9}, 
   3.7451590694904537`*^9, {3.745159111223796*^9, 3.7451591834296603`*^9}, {
   3.7451592159778934`*^9, 3.7451593255053215`*^9}, 3.745159418413692*^9, {
   3.7451656815230036`*^9, 3.7451656845131087`*^9}, 
   3.7451657447858095`*^9},ExpressionUUID->"9b93bacd-1aa2-4b07-9c43-\
c106d6c61d40"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Putting it all together! Bragg pulse then dual bloch acceleration, one of \
each arm\
\>", "Section",
 CellChangeTimes->{{3.7451656467580137`*^9, 3.745165650219885*^9}, {
  3.745166075250907*^9, 
  3.7451661085151386`*^9}},ExpressionUUID->"ab790ed3-42c3-4e35-a1e5-\
9005bc2c55b6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "pl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", "NBloch",
      ",", "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", "Ham0", ",", 
     "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", " ", 
     "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",", " ", 
     "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", " ", 
     "\[Psi]cf"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n", " ", "=", " ", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NBloch", " ", "=", " ", "20"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"v0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"k0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tLoad", " ", "=", " ", 
    RowBox[{"100", "*", 
     SuperscriptBox["10", 
      RowBox[{"-", "6"}]], "*", "2066", "*", "2", "*", "Pi"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tLoad", " ", "=", " ", 
     RowBox[{"2", " ", "Pi"}]}], ";"}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tau", " ", "=", " ", "0.259621216892661"}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"for", " ", "n"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"4", "\[IndentingNewLine]", "int"}], " ", "=", " ", 
      "3.0871"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"blochInt", " ", "=", " ", 
     RowBox[{"5", "*", "2", "*", ".1544"}]}], ";"}], "\[IndentingNewLine]", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"for", " ", "n"}], "=", 
     RowBox[{
      RowBox[{"8", "\[IndentingNewLine]", "int"}], " ", "=", " ", 
      "11.8533"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"blochInt", " ", "=", " ", 
     RowBox[{"5", "*", "2", "*", 
      FractionBox["int", "20"]}]}], ";"}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"n", " ", "=", " ", "5"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"int", " ", "=", " ", "4.725368657396999"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"blochInt", " ", "=", " ", 
    RowBox[{
     FractionBox[
      RowBox[{"2", " ", "Pi"}], "4"], " ", 
     FractionBox["int", "20"], " ", 
     FractionBox["20", "6"]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rampRate", " ", "=", " ", "155000000"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Hz", "/", "s"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"recoilFreq", " ", "=", " ", "2066"}], ";"}], " ", 
  RowBox[{"(*", " ", "Hz", " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dimRampRate", " ", "=", " ", 
   FractionBox["rampRate", 
    RowBox[{
     SuperscriptBox["recoilFreq", "2"], "*", " ", "2", " ", "Pi"}]]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BraggPulse", "[", "t_", "]"}], " ", "=", "  ", 
    RowBox[{"2", " ", "Pi", " ", "int", " ", 
     RowBox[{"Exp", "[", 
      RowBox[{
       FractionBox[
        RowBox[{"-", "1"}], "2"], 
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox["t", "tau"], ")"}], "2"]}], "]"}]}]}], " ", ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalDelta]\[Omega]", " ", "=", " ", 
   RowBox[{"4", "*", "2", "*", 
    FractionBox["n", "2"]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Omega]Mod", " ", "=", " ", 
   RowBox[{"4", " ", "*", " ", "2", " ", "*", " ", 
    FractionBox["n", "2"]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlochPeriod", " ", "=", " ", 
   FractionBox["8", "dimRampRate"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"TBloch", " ", "=", " ", 
   RowBox[{"BlochPeriod", " ", "*", " ", "NBloch"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lmax", " ", "=", " ", 
   RowBox[{"Max", "[", 
    RowBox[{
     RowBox[{"5", "+", "NBloch", " ", "+", " ", "n"}], ",", 
     RowBox[{"NBloch", " ", "+", " ", "n", " ", "+", " ", 
      RowBox[{"Round", "[", 
       RowBox[{"5.", "*", 
        SuperscriptBox["NLatDep", 
         RowBox[{"1", "/", "4"}]]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dim", " ", "=", " ", 
    RowBox[{
     RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "pl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", "NBloch",
      ",", "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", "Ham0", ",", 
     "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", " ", 
     "\[Psi]iBloch", ",", " ", "\[Psi]Bragg", ",", "rr", ",", " ", "tt", ",", 
     " ", "t", ",", " ", "HamLoad", ",", " ", "HamUnLoad", ",", " ", 
     "HamUnLoad0", ",", " ", "\[Psi]cf"}], "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "\[Psi]", ",", " ", "ics", ",", " ", "cs", ",", " ", "\[CapitalDelta]"}], 
    "]"}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"kl", "[", 
     RowBox[{"l_", ",", "v_"}], "]"}], ":=", 
    RowBox[{"v", "+", 
     RowBox[{"2", " ", "l"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Ham0", "[", 
     RowBox[{"tt_", ",", "v_"}], "]"}], " ", "=", " ", 
    RowBox[{"Normal", "[", 
     RowBox[{"SparseArray", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
          SuperscriptBox[
           RowBox[{"kl", "[", 
            RowBox[{
             RowBox[{"l", " ", "-", " ", 
              RowBox[{"(", 
               RowBox[{"lmax", "+", "1"}], ")"}]}], ",", "v"}], "]"}], "2"]}],
          ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"2", " ", "\[Kappa]\[Kappa]", 
            RowBox[{"(", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", "\[ImaginaryI]"}], " ", "tt", " ", 
               "\[CapitalDelta]"}], "]"}], ")"}]}], " ", "/;", " ", 
           RowBox[{
            RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
            RowBox[{"(", 
             RowBox[{"Exp", "[", 
              RowBox[{"\[ImaginaryI]", " ", "tt", " ", "\[CapitalDelta]"}], 
              "]"}], ")"}]}], "/;", 
           RowBox[{
            RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
   RowBox[{
    RowBox[{"Ham0", "[", 
     RowBox[{"tt", ",", "v0"}], "]"}], "/.", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
       RowBox[{
        FractionBox["1", "4"], 
        RowBox[{"BraggPulse", "[", "tt", "]"}]}]}], ",", " ", 
      RowBox[{
      "\[CapitalDelta]", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}]}], 
     "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MatrixForm", "[", 
    RowBox[{"Ham1", "[", "t", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "   ", 
   RowBox[{
    RowBox[{
     RowBox[{
     "Bragg", " ", "Hamiltonian", " ", "including", " ", "AC", " ", "stark", 
      " ", "shift", " ", "\[IndentingNewLine]", 
      RowBox[{"Ham0", "[", 
       RowBox[{"tt_", ",", "v_"}], "]"}]}], " ", "=", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"kl", "[", 
              RowBox[{
               RowBox[{"l", " ", "-", " ", 
                RowBox[{"(", 
                 RowBox[{"lmax", "+", "1"}], ")"}]}], ",", "v"}], "]"}], "2"],
             " ", "+", 
            RowBox[{"2", "\[Kappa]\[Kappa]"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", 
             RowBox[{"(", 
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"-", "\[ImaginaryI]"}], " ", "tt", " ", 
                "\[CapitalDelta]"}], "]"}], ")"}]}], " ", "/;", " ", 
            RowBox[{
             RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"(", 
              RowBox[{"Exp", "[", 
               RowBox[{"\[ImaginaryI]", " ", "tt", " ", "\[CapitalDelta]"}], 
               "]"}], ")"}]}], "/;", 
            RowBox[{
             RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", 
       RowBox[{"tt", ",", "v0"}], "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{
          FractionBox["1", "4"], 
          RowBox[{"BraggPulse", "[", "tt", "]"}]}]}], ",", " ", 
        RowBox[{"\[CapitalDelta]", " ", "\[Rule]", " ", "fBragg"}]}], 
       "}"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"MatrixForm", "[", 
     RowBox[{"Ham1", "[", "t", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
   "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cs", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{"ci", "[", "nn", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", "dim"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
    RowBox[{"v0", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], " ", 
   "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  SuperscriptBox[
   RowBox[{"Abs", "[", "\[Psi]iBloch", "]"}], "2"], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ics", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], "[", 
       RowBox[{
        RowBox[{"-", "5"}], " ", "tau"}], "]"}], "\[Equal]", 
      RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
       RowBox[{"nn", "+", 
        RowBox[{"(", 
         RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"equation", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
    RowBox[{
     RowBox[{"-", "\[ImaginaryI]"}], " ", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt", "]"}], ".", 
      RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sol", " ", "=", " ", 
   RowBox[{"NDSolve", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
     RowBox[{"{", 
      RowBox[{"tt", ",", 
       RowBox[{
        RowBox[{"-", "5"}], "*", "tau"}], ",", 
       RowBox[{"5", "*", "tau"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]Bragg", "[", "tt_", "]"}], "=", 
   RowBox[{
    RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
    RowBox[{"sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]Bragg", "[", 
    RowBox[{"5", " ", "tau"}], "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ArcTan", "[", 
       RowBox[{
        RowBox[{"Re", "[", 
         RowBox[{
          RowBox[{"\[Psi]ci", "[", 
           RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
         "]"}], ",", 
        RowBox[{"Im", "[", 
         RowBox[{
          RowBox[{"\[Psi]ci", "[", 
           RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
         "]"}]}], "]"}], "-", 
      RowBox[{
       RowBox[{"ArcTan", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{
           RowBox[{"\[Psi]ci", "[", 
            RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
         RowBox[{"Im", "[", 
          RowBox[{
           RowBox[{"\[Psi]ci", "[", 
            RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}]}], 
        "]"}], "\[IndentingNewLine]", 
       RowBox[{"Mod", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ArcTan", "[", 
           RowBox[{
            RowBox[{"Re", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"\[Psi]ci", "[", 
                RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
               RowBox[{"n", "+", "lmax", "+", "1"}], 
               "\[RightDoubleBracket]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"\[ImaginaryI]", " ", "4", " ", 
                SuperscriptBox["n", "2"], " ", "t"}], "]"}]}], "]"}], ",", 
            RowBox[{"Im", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"\[Psi]ci", "[", 
                RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
               RowBox[{"n", "+", "lmax", "+", "1"}], 
               "\[RightDoubleBracket]"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"\[ImaginaryI]", " ", "4", " ", 
                SuperscriptBox["n", "2"], " ", "t"}], "]"}]}], "]"}]}], "]"}],
           "-", 
          RowBox[{"ArcTan", "[", 
           RowBox[{
            RowBox[{"Re", "[", 
             RowBox[{
              RowBox[{"\[Psi]ci", "[", 
               RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], 
            ",", 
            RowBox[{"Im", "[", 
             RowBox[{
              RowBox[{"\[Psi]ci", "[", 
               RowBox[{"5", " ", "tau"}], "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], " ", 
             "]"}]}], "]"}]}], ",", 
         RowBox[{"2", " ", "Pi"}]}], "]"}]}]}], "/.", 
     RowBox[{"t", "\[Rule]", " ", 
      RowBox[{"5", " ", "tau", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"phin", "[", "t_", "]"}], " ", "=", " ", 
        RowBox[{"ArcTan", "[", 
         RowBox[{
          RowBox[{"Re", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
             RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
            " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"\[ImaginaryI]", " ", "4", " ", 
              SuperscriptBox["n", "2"], " ", "t"}], "]"}]}], "]"}], ",", 
          RowBox[{"Im", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
             RowBox[{"n", "+", "lmax", "+", "1"}], "\[RightDoubleBracket]"}], 
            " ", 
            RowBox[{"Exp", "[", 
             RowBox[{"\[ImaginaryI]", " ", "4", " ", 
              SuperscriptBox["n", "2"], " ", "t"}], "]"}]}], "]"}]}], 
         "]"}]}]}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"phi0", "[", "t_", "]"}], " ", "=", " ", 
     RowBox[{"ArcTan", "[", 
      RowBox[{
       RowBox[{"Re", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
       RowBox[{"Im", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}]}], 
      "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"phin", "[", "t", "]"}], ",", " ", 
         RowBox[{"phi0", "[", "t", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", 
         RowBox[{
          RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
         RowBox[{"5", " ", "tau"}]}], "}"}]}], "]"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]ci", "[", 
        RowBox[{"5", " ", "tau"}], "]"}], "]"}], "2"], "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"Abs", "[", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}], "]"}], "2"], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", 
         RowBox[{
          RowBox[{"-", "5"}], "*", "tau"}], ",", 
         RowBox[{"5", "*", "tau"}]}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  SuperscriptBox[
   RowBox[{"Abs", "[", 
    RowBox[{"\[Psi]Bragg", "[", 
     RowBox[{"5", " ", "tau"}], "]"}], "]"}], "2"], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Move", " ", "on", " ", "to", " ", "Bloch", " ", "oscillation"}], 
   "*)"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "\[Kappa]\[Kappa]", ",", "kl", ",", "Ham0", ",", "Ham1", ",", 
     "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",", " ", 
     "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", " ", 
     "\[Psi]cf", ",", " ", "\[Psi]iBloch"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "\[Psi]", ",", " ", "ics", ",", " ", "cs", ",", " ", "\[CapitalDelta]"}], 
    "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"loadLatticeBraggBloch", "[", 
    RowBox[{
    "lMax_", ",", " ", "\[Psi]\[Psi]i_", ",", " ", "tLoad_", ",", " ", 
     "loadHam_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
       RowBox[{"\[Psi]i", " ", "=", " ", "\[Psi]\[Psi]i"}], ",", " ", 
       RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
       RowBox[{"HamLoad", " ", "=", " ", "loadHam"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{
       "\[Psi]", ",", " ", "\[Psi]ci", ",", " ", "ics", ",", " ", "cs"}], 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "maxL"}], ",", "maxL", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "maxL"}], ",", "maxL", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"maxL", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "maxL"}], ",", "maxL", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"equation", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{"HamLoad", "[", "tt", "]"}], ".", 
          RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
         RowBox[{"{", 
          RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
        RowBox[{
        "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[Psi]ci"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"unLoadLattice", "[", 
    RowBox[{
    "lMax_", ",", " ", "tLoad_", ",", " ", "unLoadHam_", ",", " ", 
     "\[Psi]ci_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
       RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
       RowBox[{"HamUnLoad", " ", "=", " ", "unLoadHam"}], ",", " ", 
       RowBox[{"\[Psi]i", "=", " ", "\[Psi]ci"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"equation", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{"HamUnLoad", "[", "tt", "]"}], ".", 
          RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
         RowBox[{"{", 
          RowBox[{"tt", ",", "0", ",", "loadTime"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]cff", "[", "tt_", "]"}], "=", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
        RowBox[{
        "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[Psi]cff"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"+", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"3", " ", "\[Kappa]\[Kappa]"}], " ", "+", " ", 
      RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
       RowBox[{"Cos", "[", 
        RowBox[{
         RowBox[{"wMod", " ", "tt"}], " ", "+", 
         FractionBox[
          RowBox[{"rr", " ", 
           SuperscriptBox["tt", "2"]}], "2"], "+", "\[Phi]2"}], "]"}]}]}], 
     ")"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kl", "[", "l_", "]"}], ":=", 
   RowBox[{"k0", "+", 
    RowBox[{"2", " ", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
   RowBox[{"Normal", "[", 
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
         SuperscriptBox[
          RowBox[{"kl", "[", 
           RowBox[{"l", " ", "-", " ", 
            RowBox[{"(", 
             RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"]}], " ", ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"4", "  ", "\[Kappa]\[Kappa]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", " ", "\[ImaginaryI]"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[CapitalDelta]w", " ", "tt"}], "+", "\[Phi]1"}], 
                ")"}]}], "]"}], " ", 
             RowBox[{"Cos", "[", 
              RowBox[{
               RowBox[{"wMod", " ", "tt"}], " ", "+", " ", 
               FractionBox[
                RowBox[{"rr", " ", 
                 SuperscriptBox["tt", "2"]}], "2"], "+", "\[Phi]2"}], "]"}]}],
             ")"}]}], " ", "/;", " ", 
          RowBox[{
           RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"4", " ", "\[Kappa]\[Kappa]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"\[ImaginaryI]", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[CapitalDelta]w", " ", "tt"}], "+", "\[Phi]1"}], 
                ")"}]}], "]"}], " ", 
             RowBox[{"Cos", "[", 
              RowBox[{
               RowBox[{"wMod", " ", "tt"}], " ", "+", " ", 
               FractionBox[
                RowBox[{"rr", " ", 
                 SuperscriptBox["tt", "2"]}], "2"], "+", "\[Phi]2"}], "]"}]}],
             ")"}]}], "/;", 
          RowBox[{
           RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{"tLoad", " ", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", "0"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", "0"}], ";"}], 
   "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"blochInt", " ", 
          FractionBox["tt", "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"wMod", "\[Rule]", " ", "\[Omega]Mod"}], ",", " ", 
        RowBox[{"\[Phi]1", "\[Rule]", " ", 
         RowBox[{"\[CapitalDelta]\[Omega]", " ", "5", " ", "tau"}]}], ",", 
        RowBox[{"\[Phi]2", "\[Rule]", " ", "0"}]}], "}"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"blochInt", " ", 
          FractionBox[
           RowBox[{"(", 
            RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[Phi]1", "\[Rule]", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"tLoad", "+", "TBloch", " ", "+", " ", 
            RowBox[{"5", " ", "tau"}]}], ")"}], " ", 
          "\[CapitalDelta]\[Omega]"}]}], ",", " ", 
        RowBox[{"\[Phi]2", "\[Rule]", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"tLoad", "+", "TBloch"}], ")"}], " ", 
           "\[CapitalDelta]\[Omega]"}], "+", 
          FractionBox[
           RowBox[{"dimRampRate", " ", 
            SuperscriptBox["TBloch", "2"]}], "2"]}]}], ",", "  ", 
        RowBox[{"wMod", "\[Rule]", " ", 
         RowBox[{"(", 
          RowBox[{"\[Omega]Mod", "+", 
           RowBox[{"dimRampRate", " ", "TBloch"}]}], ")"}]}]}], "}"}]}]}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"MatrixForm", "[", 
     RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";"}]}], 
  "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
   RowBox[{
    RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "blochInt"}], ",", " ", 
      RowBox[{"rr", "\[Rule]", "dimRampRate"}], ",", " ", 
      RowBox[{
      "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
      ",", "  ", 
      RowBox[{"wMod", "\[Rule]", " ", "\[Omega]Mod"}], ",", " ", 
      RowBox[{"\[Phi]1", "\[Rule]", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"tLoad", "+", 
          RowBox[{"5", " ", "tau"}]}], ")"}], " ", 
        "\[CapitalDelta]\[Omega]"}]}], ",", " ", 
      RowBox[{"\[Phi]2", "\[Rule]", " ", 
       RowBox[{"tLoad", " ", "\[Omega]Mod"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MatrixForm", "[", 
    RowBox[{"Ham1", "[", "t", "]"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cs", " ", "=", " ", 
    RowBox[{"Table", "[", " ", 
     RowBox[{
      RowBox[{"ci", "[", "nn", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"nn", ",", 
        RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"tLoad", " ", "\[Equal]", " ", "0"}], ",", " ", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Psi]iBloch", " ", "=", 
       RowBox[{"\[Psi]Bragg", "[", 
        RowBox[{"5", " ", "tau"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
       RowBox[{"loadLatticeBraggBloch", "[", 
        RowBox[{"lmax", ",", " ", 
         RowBox[{"\[Psi]Bragg", "[", 
          RowBox[{"5", " ", "tau"}], "]"}], ",", " ", "tLoad", ",", " ", 
         "HamLoad"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{
           RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], 
           "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], 
        "]"}]}]}]}], "\[IndentingNewLine]", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"tLoad", " ", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
    SuperscriptBox[
     RowBox[{"Abs", "[", "\[Psi]iBloch", "]"}], "2"], ",", 
    "\[IndentingNewLine]", 
    SuperscriptBox[
     RowBox[{"Abs", "[", 
      RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], "]"}], "2"]}], "]"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"equation", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
    RowBox[{
     RowBox[{"-", "\[ImaginaryI]"}], " ", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt", "]"}], ".", 
      RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sol", " ", "=", " ", 
   RowBox[{"NDSolve", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
     RowBox[{"{", 
      RowBox[{"tt", ",", "0", ",", "TBloch"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]Bloch", "[", "tt_", "]"}], "=", 
   RowBox[{
    RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
    RowBox[{"sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]Bloch", "[", "TBloch", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  SuperscriptBox[
   RowBox[{"Abs", "[", 
    RowBox[{"\[Psi]Bloch", "[", "TBloch", "]"}], "]"}], "2"], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"tLoad", " ", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Psi]fBloch", " ", "=", " ", 
       RowBox[{"\[Psi]Bloch", "[", "TBloch", "]"}]}], ";"}], 
     "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Psi]fBloch", " ", "=", " ", 
       RowBox[{"unLoadLattice", "[", 
        RowBox[{"lmax", ",", " ", "tLoad", ",", " ", "HamUnLoad", ",", 
         RowBox[{"\[Psi]Bloch", "[", "TBloch", "]"}]}], "]"}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"tLoad", " ", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
    SuperscriptBox[
     RowBox[{"Abs", "[", "\[Psi]fBloch", "]"}], "2"], ",", 
    "\[IndentingNewLine]", 
    SuperscriptBox[
     RowBox[{"Abs", "[", 
      RowBox[{"\[Psi]fBloch", "[", "tLoad", "]"}], "]"}], "2"]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "braggPlot", ",", "blochPlot", ",", " ", "blochLoadPlot", ",", " ", 
     "blochUnLoadPlot"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"tLoad", " ", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"braggPlot", " ", "=", " ", 
      RowBox[{"Plot", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"Abs", "[", 
          RowBox[{"\[Psi]Bragg", "[", "t", "]"}], "]"}], "2"], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{
           RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
          RowBox[{"5", " ", "tau"}]}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
             RowBox[{
              RowBox[{"5", " ", "tau"}], "+", 
              RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}],
            ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blochPlot", " ", "=", " ", 
      RowBox[{"Plot", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"Abs", "[", 
          RowBox[{"\[Psi]Bloch", "[", 
           RowBox[{"t", "-", " ", 
            RowBox[{"5", " ", "tau"}]}], "]"}], "]"}], "2"], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"5", " ", "tau"}], ",", " ", 
          RowBox[{
           RowBox[{"5", " ", "tau"}], " ", "+", " ", "TBloch"}]}], "}"}], ",",
         " ", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
             RowBox[{
              RowBox[{"5", " ", "tau"}], "+", 
              RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}],
            ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"braggPlot", ",", " ", "blochPlot"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
            RowBox[{
             RowBox[{"5", " ", "tau"}], "+", 
             RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}], 
          ",", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", " ", 
       RowBox[{"ImageSize", "\[Rule]", " ", 
        RowBox[{"{", 
         RowBox[{"1000", ",", "600"}], "}"}]}]}], "]"}]}], 
    "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"braggPlot", " ", "=", " ", 
      RowBox[{"Plot", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"Abs", "[", 
          RowBox[{"\[Psi]Bragg", "[", "t", "]"}], "]"}], "2"], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{
           RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
          RowBox[{"5", " ", "tau"}]}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
             RowBox[{
              RowBox[{"5", " ", "tau"}], "+", 
              RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}],
            ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blochLoadPlot", " ", "=", " ", 
      RowBox[{"Plot", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"Abs", "[", 
          RowBox[{"\[Psi]iBloch", "[", 
           RowBox[{"t", "-", " ", 
            RowBox[{"5", " ", "tau"}]}], "]"}], "]"}], "2"], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"5", " ", "tau"}], ",", " ", 
          RowBox[{
           RowBox[{"5", " ", "tau"}], " ", "+", " ", "tLoad"}]}], "}"}], ",", 
        " ", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
             RowBox[{
              RowBox[{"5", " ", "tau"}], "+", 
              RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}],
            ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blochPlot", " ", "=", " ", 
      RowBox[{"Plot", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"Abs", "[", 
          RowBox[{"\[Psi]Bloch", "[", 
           RowBox[{"t", "-", " ", 
            RowBox[{"5", " ", "tau"}], " ", "-", " ", "tLoad"}], "]"}], "]"}],
          "2"], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{
           RowBox[{"5", " ", "tau"}], " ", "+", " ", "tLoad"}], ",", " ", 
          RowBox[{
           RowBox[{"5", " ", "tau"}], " ", "+", " ", "tLoad", " ", "+", " ", 
           "TBloch"}]}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
             RowBox[{
              RowBox[{"5", " ", "tau"}], "+", 
              RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}],
            ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blochUnLoadPlot", " ", "=", " ", 
      RowBox[{"Plot", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"Abs", "[", 
          RowBox[{"\[Psi]fBloch", "[", 
           RowBox[{"t", "-", " ", 
            RowBox[{"5", " ", "tau"}], " ", "-", " ", "tLoad", " ", "-", " ", 
            "TBloch"}], "]"}], "]"}], "2"], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{
           RowBox[{"5", " ", "tau"}], " ", "+", " ", "tLoad", " ", "+", " ", 
           "TBloch"}], ",", " ", 
          RowBox[{
           RowBox[{"5", " ", "tau"}], " ", "+", " ", 
           RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}], 
        ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
             RowBox[{
              RowBox[{"5", " ", "tau"}], "+", 
              RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}],
            ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "braggPlot", ",", " ", "blochLoadPlot", ",", " ", "blochPlot", ",", 
         " ", "blochUnLoadPlot"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "5"}], " ", "tau"}], ",", " ", 
            RowBox[{
             RowBox[{"5", " ", "tau"}], "+", 
             RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}], 
          ",", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", " ", 
       RowBox[{"ImageSize", "\[Rule]", " ", 
        RowBox[{"{", 
         RowBox[{"1000", ",", "600"}], "}"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"{", 
    RowBox[{
    "braggPlot", ",", " ", "blochLoadPlot", ",", " ", "blochPlot", ",", " ", 
     "blochUnLoadPlot"}], "}"}], "*)"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7451656467580137`*^9, 3.745165650219885*^9}, {
   3.745166075250907*^9, 3.7451661116218023`*^9}, 3.745166172433714*^9, {
   3.745166217544456*^9, 3.74516629697678*^9}, {3.7451663316543465`*^9, 
   3.7451663329295597`*^9}, {3.7451663715063934`*^9, 
   3.7451664218253365`*^9}, {3.7451917461772757`*^9, 
   3.7451917610473585`*^9}, {3.745192095602643*^9, 3.7451921117391176`*^9}, {
   3.7451921671766577`*^9, 3.745192191131328*^9}, {3.745193023677926*^9, 
   3.7451930636187224`*^9}, {3.7451932952744207`*^9, 
   3.7451934882534647`*^9}, {3.745193521303834*^9, 3.745193842287123*^9}, {
   3.7451940078309546`*^9, 3.745194035244789*^9}, {3.745194110695057*^9, 
   3.7451941318116317`*^9}, {3.7451942318722076`*^9, 
   3.7451942773155193`*^9}, {3.745194327806876*^9, 3.7451943345438194`*^9}, {
   3.7451943691767654`*^9, 3.7451944059557056`*^9}, {3.7451945777672553`*^9, 
   3.7451945824870996`*^9}, {3.7451946238587313`*^9, 3.745194632128233*^9}, {
   3.745194673548981*^9, 3.745194699305958*^9}, {3.7451947739634495`*^9, 
   3.7451952053249807`*^9}, {3.745195263511645*^9, 3.7451952936227217`*^9}, {
   3.7451954801788096`*^9, 3.7451955569527082`*^9}, {3.745195754777089*^9, 
   3.7451957678168373`*^9}, 3.745195853046383*^9, {3.7451959424480495`*^9, 
   3.7451960062150345`*^9}, {3.7451961663961625`*^9, 
   3.7451962325445557`*^9}, {3.7451962859891577`*^9, 
   3.7451962987508016`*^9}, {3.745196332799116*^9, 3.7451963901292963`*^9}, {
   3.745196491959484*^9, 3.7451965050462465`*^9}, {3.7451965451072063`*^9, 
   3.745196570313294*^9}, {3.745196701231725*^9, 3.745196736160841*^9}, {
   3.745196774645723*^9, 3.7451967928521795`*^9}, {3.745196833265888*^9, 
   3.745196833624276*^9}, {3.7451970348800097`*^9, 3.7451970472199774`*^9}, 
   3.745197092403905*^9, {3.7451972969090967`*^9, 3.7451973319984107`*^9}, {
   3.7452002601730905`*^9, 3.74520026095999*^9}, {3.745200476581382*^9, 
   3.745200490167082*^9}, {3.7452006366938486`*^9, 3.745200637943509*^9}, 
   3.7452007502215347`*^9, {3.7452011592956076`*^9, 3.7452011600625916`*^9}, {
   3.7452012126470656`*^9, 3.745201244404219*^9}, {3.7452013539276342`*^9, 
   3.7452013695837755`*^9}, {3.7452014882736807`*^9, 
   3.7452014910831757`*^9}, {3.74520159696429*^9, 3.745201600929697*^9}, {
   3.7452017702134175`*^9, 3.7452017881574764`*^9}, {3.7452020675962152`*^9, 
   3.745202114901827*^9}, {3.74520228099868*^9, 3.745202405834153*^9}, {
   3.745202439316701*^9, 3.745202450445964*^9}, {3.745202574521468*^9, 
   3.7452025876055136`*^9}, {3.745203060169958*^9, 3.745203061761702*^9}, {
   3.745203108786066*^9, 3.7452031658815217`*^9}, {3.7452076271557913`*^9, 
   3.7452076710125313`*^9}, {3.7452078510372505`*^9, 
   3.7452078714242477`*^9}, {3.745207941725227*^9, 3.7452079442042923`*^9}, {
   3.74520800128633*^9, 3.745208040797657*^9}, {3.7452080913396573`*^9, 
   3.745208100793558*^9}, {3.7452420107031584`*^9, 3.745242019311683*^9}, {
   3.7452420930330772`*^9, 3.7452420976913223`*^9}, {3.7452424707347484`*^9, 
   3.7452424727053022`*^9}, {3.7452430088212457`*^9, 3.745243018122245*^9}, {
   3.745243230250269*^9, 3.74524323074741*^9}, {3.7452432832123165`*^9, 
   3.74524328394763*^9}, {3.7452434840815177`*^9, 3.7452435194837008`*^9}, {
   3.745243663138236*^9, 3.7452437100874863`*^9}, {3.745243850267765*^9, 
   3.7452438720481153`*^9}, {3.74524404166041*^9, 3.745244065698558*^9}, {
   3.745251441570465*^9, 3.745251442618914*^9}, 3.7452515836080933`*^9, {
   3.7452517198397665`*^9, 3.7452517212401686`*^9}, {3.745251781557927*^9, 
   3.7452518044459853`*^9}, 3.7452522012348757`*^9, {3.745252297465434*^9, 
   3.74525230928001*^9}, {3.7452526551445627`*^9, 3.7452526619061694`*^9}, {
   3.7452528985899887`*^9, 3.7452528989278097`*^9}, {3.7452529723097305`*^9, 
   3.745252973554039*^9}, {3.7452531029480453`*^9, 3.7452531344658337`*^9}, {
   3.7452533973561683`*^9, 3.7452533986485767`*^9}, {3.745253664691902*^9, 
   3.7452536832917266`*^9}, 3.745257045617175*^9, {3.745257200321848*^9, 
   3.7452572060206213`*^9}, {3.74525728142616*^9, 3.745257283489647*^9}, {
   3.7452839342212296`*^9, 3.7452839398044033`*^9}, {3.7452841575163713`*^9, 
   3.7452841587356825`*^9}, {3.745291831110156*^9, 3.7452918319728518`*^9}, {
   3.7452919811421585`*^9, 3.745291984202981*^9}, {3.745293180606777*^9, 
   3.7452932033679657`*^9}, {3.745293237698248*^9, 3.745293238366461*^9}, {
   3.745293358176505*^9, 3.7452933583500166`*^9}, {3.7452937293443213`*^9, 
   3.745293730744542*^9}, {3.745293893708814*^9, 3.745293895090103*^9}, {
   3.7452945769662075`*^9, 3.7452945792580853`*^9}, {3.7452946095402093`*^9, 
   3.745294612412509*^9}, 3.7453302548151255`*^9, {3.745330401380669*^9, 
   3.7453304016299343`*^9}},ExpressionUUID->"fe4bf2f2-79ab-4602-91f4-\
fe4eb2a8c4b6"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    SuperscriptBox["recoilFreq", "2"], "*", " ", "2", " ", "Pi", "*", 
    "0.2889756170671305`"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.745252265435033*^9, 
  3.7452522757408447`*^9}},ExpressionUUID->"0f1abc11-73b4-4b89-8d28-\
238cc505f6b4"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Bloch Beamsplitter simulation", "Section",
 CellChangeTimes->{{3.7419897660731316`*^9, 3.7419897674741673`*^9}, {
  3.7422643105293274`*^9, 3.7422643249277544`*^9}, {3.7438041790498238`*^9, 
  3.7438041907403245`*^9}},ExpressionUUID->"db509298-9d5b-4b7a-97d1-\
ffc43a9b66f8"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ClearAll", "[", "\"\<Global'*\>\"", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "pl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", 
      "NBloch", ",", "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", 
      "Ham0", ",", "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", 
      " ", "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",",
       " ", "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", 
      " ", "\[Psi]cf"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rGrav", " ", "=", " ", "0.8576"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NBloch", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NLatDep", " ", "=", 
     RowBox[{"3.5", "*", ".5"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NRamp", " ", "=", ".1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tLoad", " ", "=", " ", "Pi"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CapitalDelta]\[Omega]", " ", "=", " ", 
     RowBox[{"0", "*", ".05"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Kappa]", " ", "=", " ", 
     FractionBox["NLatDep", "8"]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"r", " ", "=", " ", 
     RowBox[{"NRamp", "*", "rGrav"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BlochPeriod", " ", "=", " ", 
     FractionBox["8", "r"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TBloch", " ", "=", " ", 
     RowBox[{"BlochPeriod", " ", "*", " ", "NBloch"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"time", " ", "=", " ", 
     RowBox[{
      FractionBox["10000", "125"], "*", "2", " ", 
      FractionBox[
       RowBox[{"NBloch", " ", "*", " ", "11"}], "NRamp"]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lmax", " ", "=", " ", 
     RowBox[{"Max", "[", 
      RowBox[{"13", ",", 
       RowBox[{"Round", "[", 
        RowBox[{"5.", "*", 
         SuperscriptBox["NLatDep", 
          RowBox[{"1", "/", "4"}]]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dim", " ", "=", " ", 
     RowBox[{
      RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"loadLattice", "[", 
     RowBox[{
     "lMax_", ",", " ", "kk0_", ",", " ", "tLoad_", ",", " ", "loadHam_"}], 
     "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
        RowBox[{"k0", " ", "=", " ", "kk0"}], ",", " ", 
        RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
        RowBox[{"HamLoad", " ", "=", " ", "loadHam"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{
        "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
         ",", " ", "cs"}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"dimState", " ", "=", " ", 
        RowBox[{
         RowBox[{"2", "*", "maxL"}], " ", "+", " ", "1"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Psi]i", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "dimState"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"rem", " ", "=", " ", 
        RowBox[{"Mod", "[", 
         RowBox[{"k0", ",", " ", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"low", " ", "=", " ", 
           RowBox[{"Floor", "[", 
            FractionBox["k0", "2"], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"high", " ", "=", " ", 
           RowBox[{"Ceiling", "[", 
            FractionBox["k0", "2"], "]"}]}], " ", ";"}], "="}], 
        "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]i", "[", 
         RowBox[{"[", 
          RowBox[{"0", "+", " ", 
           RowBox[{"(", 
            RowBox[{"lmax", " ", "+", "1"}], ")"}]}], "]"}], "]"}], " ", "=", 
        " ", "1"}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"cs", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ics", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
           RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
            RowBox[{"nn", "+", 
             RowBox[{"(", 
              RowBox[{"lmax", "+", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"equation", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{
           RowBox[{"HamLoad", "[", "tt", "]"}], ".", 
           RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sol", " ", "=", " ", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
          RowBox[{"{", 
           RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", "tt_", "]"}], ":=", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
         RowBox[{
         "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[Psi]ci", "[", "tLoad", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"unLoadLattice", "[", 
     RowBox[{
     "lMax_", ",", " ", "tLoad_", ",", " ", "unLoadHam_", ",", " ", 
      "\[Psi]ci_"}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
        RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
        RowBox[{"HamUnLoad", " ", "=", " ", "unLoadHam"}], ",", " ", 
        RowBox[{"\[Psi]i", "=", " ", "\[Psi]ci"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"cs", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ics", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
           RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
            RowBox[{"nn", "+", 
             RowBox[{"(", 
              RowBox[{"lmax", "+", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"equation", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{
           RowBox[{"HamUnLoad", "[", "tt", "]"}], ".", 
           RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sol", " ", "=", " ", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
          RowBox[{"{", 
           RowBox[{"tt", ",", "0", ",", "loadTime"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]cff", "[", "tt_", "]"}], ":=", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
         RowBox[{
         "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[Psi]cff", "[", "loadTime", "]"}]}]}], "\[IndentingNewLine]",
      "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Clear", "[", "k", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kl", "[", "l_", "]"}], ":=", 
      RowBox[{"k0", "+", 
       RowBox[{"2", " ", "l"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
      RowBox[{"Normal", "[", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
            SuperscriptBox[
             RowBox[{"kl", "[", 
              RowBox[{"l", " ", "-", " ", 
               RowBox[{"(", 
                RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", " ", 
            RowBox[{
             RowBox[{"2", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", " ", "\[ImaginaryI]"}], " ", 
                  "\[CapitalDelta]w", " ", 
                  RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
                RowBox[{"Cos", "[", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"rr", " "}], "2"], "+", 
                  RowBox[{"\[CapitalDelta]wm", " ", 
                   RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                 "]"}]}], ")"}]}], " ", "/;", " ", 
             RowBox[{
              RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", " ", 
            RowBox[{
             RowBox[{"2", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{"\[ImaginaryI]", " ", "\[CapitalDelta]w", " ", 
                  RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
                RowBox[{"Cos", "[", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"rr", " "}], "2"], "+", 
                  RowBox[{"\[CapitalDelta]wm", " ", 
                   RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                 "]"}]}], ")"}]}], "/;", 
             RowBox[{
              RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox["tt", "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "  ", "0"}]}], " ", "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox[
            RowBox[{"(", 
             RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
          RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", " ", 
          RowBox[{"r", " ", 
           FractionBox[
            SuperscriptBox["TBloch", "2"], "2"]}]}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", 
          RowBox[{"r", 
           SuperscriptBox[
            RowBox[{"(", "tt", ")"}], "2"]}]}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamTest", "[", 
       RowBox[{"kk_", ",", "tt_"}], "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", 
          RowBox[{"r", " ", 
           SuperscriptBox["tt", "2"]}]}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"Ham1", "[", "t", "]"}], "]"}]}], "\[IndentingNewLine]", "*)"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Clear", "[", "k", "]"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Ham0", "[", 
        RowBox[{"k_", ",", "tt_"}], "]"}], " ", "=", " ", 
       RowBox[{"Normal", "[", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"k", "+", 
                RowBox[{"2", 
                 RowBox[{"(", 
                  RowBox[{"l", " ", "-", " ", 
                   RowBox[{"(", 
                    RowBox[{"lmax", "+", "1"}], ")"}]}], ")"}]}]}], ")"}], 
              "2"]}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", " ", 
             RowBox[{
              RowBox[{"2", " ", 
               RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", 
               RowBox[{"(", " ", 
                RowBox[{"1", " ", "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"\[ImaginaryI]", " ", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{"rr", " ", 
                    SuperscriptBox["tt", "2"]}], "+", 
                    RowBox[{"2", " ", "\[CapitalDelta]wm", " ", "tt"}], "+", 
                    " ", 
                    RowBox[{"2", " ", "\[Phi]"}]}], ")"}]}], "]"}]}], ")"}]}],
               " ", "/;", " ", 
              RowBox[{
               RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", " ", 
             RowBox[{
              RowBox[{"2", " ", 
               RowBox[{"Sqrt", "[", "2", "]"}], "\[Kappa]\[Kappa]", " ", 
               RowBox[{"(", " ", 
                RowBox[{"1", "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "\[ImaginaryI]"}], " ", 
                   RowBox[{"(", "  ", 
                    RowBox[{
                    RowBox[{"rr", " ", 
                    SuperscriptBox["tt", "2"]}], "+", 
                    RowBox[{"2", "\[CapitalDelta]wm", " ", "tt"}], "+", " ", 
                    RowBox[{"2", " ", "\[Phi]"}]}], ")"}]}], "]"}]}], ")"}]}],
               "/;", 
              RowBox[{
               RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"Ham0", "[", 
        RowBox[{"0", ",", "tt"}], "]"}], "/.", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox["tt", "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", " ", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", " ", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "r"}], " ", 
          FractionBox["TBloch", "4"]}], ",", "tt"}], "]"}], "/.", 
       RowBox[{"{", "  ", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox[
            RowBox[{"(", 
             RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
          RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", 
          FractionBox[
           RowBox[{"r", " ", 
            SuperscriptBox["TBloch", "2"]}], "2"]}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "r"}], " ", 
          FractionBox["tt", "4"]}], ",", "tt"}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", "r"}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamTest", "[", 
       RowBox[{"k_", ",", "tt_"}], "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", 
        RowBox[{"k", ",", "tt"}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", "r"}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"Ham1", "[", "t", "]"}], "]"}]}], "\[IndentingNewLine]", "*)"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "USE", " ", "THIS", " ", "HAMILTONIAN", " ", "FOR", " ", "ACTUAL", " ", 
     "BBS", " ", "SIMULATION"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "k", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"kl", "[", "l_", "]"}], ":=", 
     RowBox[{"k0", "+", 
      RowBox[{"2", " ", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
           SuperscriptBox[
            RowBox[{"kl", "[", 
             RowBox[{"l", " ", "-", " ", 
              RowBox[{"(", 
               RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", " ", 
           RowBox[{
            RowBox[{"2", " ", 
             RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", " ", "\[ImaginaryI]"}], " ", "\[CapitalDelta]w",
                  " ", 
                 RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
               RowBox[{"Cos", "[", 
                RowBox[{
                 FractionBox[
                  RowBox[{"rr", " "}], "2"], "+", 
                 RowBox[{"\[CapitalDelta]wm", " ", 
                  RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                "]"}]}], ")"}]}], " ", "/;", " ", 
            RowBox[{
             RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", " ", 
           RowBox[{
            RowBox[{"2", " ", 
             RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{"\[ImaginaryI]", " ", "\[CapitalDelta]w", " ", 
                 RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
               RowBox[{"Cos", "[", 
                RowBox[{
                 FractionBox[
                  RowBox[{"rr", " "}], "2"], "+", 
                 RowBox[{"\[CapitalDelta]wm", " ", 
                  RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                "]"}]}], ")"}]}], "/;", 
            RowBox[{
             RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox["tt", "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", "  ", "0"}]}], " ", "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox[
           RowBox[{"(", 
            RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
         RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", " ", 
         RowBox[{"r", " ", 
          FractionBox[
           SuperscriptBox["TBloch", "2"], "2"]}]}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MatrixForm", "[", 
     RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
        RowBox[{"rr", "\[Rule]", 
         RowBox[{"r", 
          SuperscriptBox[
           RowBox[{"(", "tt", ")"}], "2"]}]}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamTest", "[", 
      RowBox[{"kk_", ",", "tt_"}], "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
        RowBox[{"rr", "\[Rule]", 
         RowBox[{"r", " ", 
          SuperscriptBox["tt", "2"]}]}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"MatrixForm", "[", 
    RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "THIS", " ", "HAMILTONIAN", " ", "ALLOWS", " ", "FOR", " ", "DIFFERENT", 
     " ", "LATTICE", " ", "DEPTHS", " ", "FOR", " ", "THE", " ", "TWO", " ", 
     "LATTICES"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fraction", " ", "=", ".8"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "k", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kl", "[", "l_", "]"}], ":=", 
      RowBox[{"k0", "+", 
       RowBox[{"2", " ", "l"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
      RowBox[{"Normal", "[", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
            SuperscriptBox[
             RowBox[{"kl", "[", 
              RowBox[{"l", " ", "-", " ", 
               RowBox[{"(", 
                RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", " ", 
            RowBox[{
             RowBox[{"2", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Exp", "[", " ", 
                 RowBox[{"\[ImaginaryI]", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    FractionBox[
                    RowBox[{"rr", " "}], "2"], "+", 
                    RowBox[{"\[CapitalDelta]wm", " ", 
                    RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], " ", 
                   ")"}]}], " ", "]"}], "  ", "+", " ", 
                RowBox[{"fraction", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", " ", "\[ImaginaryI]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"rr", " "}], "2"], "+", 
                    RowBox[{"\[CapitalDelta]wm", " ", 
                    RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], " ", 
                    ")"}]}], " ", "]"}]}]}], ")"}]}], " ", "/;", " ", 
             RowBox[{
              RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", " ", 
            RowBox[{
             RowBox[{"2", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Exp", "[", " ", 
                 RowBox[{
                  RowBox[{"-", "\[ImaginaryI]"}], " ", 
                  RowBox[{"(", 
                   RowBox[{
                    FractionBox[
                    RowBox[{"rr", " "}], "2"], "+", 
                    RowBox[{"\[CapitalDelta]wm", " ", 
                    RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], " ", 
                   ")"}]}], " ", "]"}], "  ", "+", " ", 
                RowBox[{"fraction", " ", 
                 RowBox[{"Exp", "[", " ", 
                  RowBox[{"\[ImaginaryI]", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"rr", " "}], "2"], "+", 
                    RowBox[{"\[CapitalDelta]wm", " ", 
                    RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], " ", 
                    ")"}]}], " ", "]"}]}]}], ")"}]}], "/;", 
             RowBox[{
              RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox["tt", "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "  ", "0"}]}], " ", "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox[
            RowBox[{"(", 
             RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
          RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", " ", 
          RowBox[{"r", " ", 
           FractionBox[
            SuperscriptBox["TBloch", "2"], "2"]}]}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", 
          RowBox[{"r", 
           SuperscriptBox[
            RowBox[{"(", "tt", ")"}], "2"]}]}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamTest", "[", 
       RowBox[{"kk_", ",", "tt_"}], "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", 
          RowBox[{"r", " ", 
           SuperscriptBox["tt", "2"]}]}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"Ham1", "[", "t", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
      ",", " ", "cs", ",", " ", "\[Psi]cf", ",", "tt"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
     RowBox[{"Table", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cs", " ", "=", " ", 
     RowBox[{"Table", "[", " ", 
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
    RowBox[{"loadLattice", "[", 
     RowBox[{"lmax", ",", " ", "k0", ",", " ", "tLoad", ",", " ", "HamLoad"}],
      "]"}]}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", "\[Psi]iBloch", "]"}], "2"], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"i1", " ", "=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{"\[Psi]iBloch", ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ",
           "\[RightDoubleBracket]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"i2", " ", "=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{"\[Psi]iBloch", ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"i3", " ", "=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{"\[Psi]iBloch", ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ics", " ", "=", " ", 
     RowBox[{"Table", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
        RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
         RowBox[{"nn", "+", 
          RowBox[{"(", 
           RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"equation", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", 
       RowBox[{
        RowBox[{"Ham1", "[", "tt", "]"}], ".", 
        RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sol", " ", "=", " ", 
     RowBox[{"NDSolve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
       RowBox[{"{", 
        RowBox[{"tt", ",", "0", ",", "TBloch"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
      RowBox[{
      "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ";"}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{"\[Psi]ci", "[", " ", "TBloch", "]"}], "]"}], "2"], 
   "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "t", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]cf", " ", "=", " ", 
     RowBox[{"unLoadLattice", "[", 
      RowBox[{"lmax", ",", " ", "tLoad", ",", " ", "HamUnLoad", ",", 
       RowBox[{"\[Psi]ci", "[", "TBloch", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], "\[LeftDoubleBracket]", 
        "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", " ", "-", "4"}], "\[RightDoubleBracket]"}]}], "]"}], 
    "2"], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"p1", "[", "t_", "]"}], " ", ":=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ",
           "\[RightDoubleBracket]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p2", "[", "t_", "]"}], " ", ":=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p3", "[", "t_", "]"}], " ", ":=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{"p1", "[", "t", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{"p2", "[", "t", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{"p3", "[", "t", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", "p1"}], "+", "p2", "+", "p3"}], ";"}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", "\[Psi]cf", "]"}], "2"], "\[IndentingNewLine]", 
   RowBox[{"Mod", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ArcTan", "[", 
       RowBox[{
        RowBox[{"Re", "[", 
         RowBox[{"\[Psi]cf", "\[LeftDoubleBracket]", 
          RowBox[{"lmax", "+", "1", "+", "NBloch"}], 
          "\[RightDoubleBracket]"}], "]"}], ",", " ", 
        RowBox[{"Im", "[", 
         RowBox[{"\[Psi]cf", "\[LeftDoubleBracket]", 
          RowBox[{"lmax", "+", "1", "+", "NBloch"}], 
          "\[RightDoubleBracket]"}], "]"}]}], "]"}], "-", 
      RowBox[{"ArcTan", "[", 
       RowBox[{
        RowBox[{"Re", "[", 
         RowBox[{"\[Psi]cf", "\[LeftDoubleBracket]", 
          RowBox[{"lmax", "+", "1", "-", "NBloch"}], 
          "\[RightDoubleBracket]"}], "]"}], ",", " ", 
        RowBox[{"Im", "[", 
         RowBox[{"\[Psi]cf", "\[LeftDoubleBracket]", 
          RowBox[{"lmax", "+", "1", "-", "NBloch"}], 
          "\[RightDoubleBracket]"}], "]"}]}], "]"}]}], " ", ",", " ", 
     RowBox[{"2", " ", "Pi"}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    SuperscriptBox[
     RowBox[{"Abs", "[", 
      RowBox[{"\[Psi]cf", "\[LeftDoubleBracket]", 
       RowBox[{"lmax", "+", "1", "+", "NBloch"}], "\[RightDoubleBracket]"}], 
      "]"}], "2"], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]ci", "[", "t", "]"}], "]"}], "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"a", "=", 
    RowBox[{"ListPlot", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{"i", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"-", "lmax"}], ",", " ", "lmax", ",", " ", "1"}], 
            "}"}]}], "]"}], ",", 
         SuperscriptBox[
          RowBox[{"Abs", "[", "\[Psi]cf", "]"}], "2"]}], "}"}], "]"}], ",", 
      " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{",", " ", 
     RowBox[{"Frame", "->", "True"}], ",", " ", 
     RowBox[{"FrameTicksStyle", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Directive", "[", 
           RowBox[{
            RowBox[{"FontOpacity", "\[Rule]", "0"}], ",", 
            RowBox[{"FontSize", "\[Rule]", "0"}]}], "]"}], ",", "Automatic"}],
          "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Automatic", ",", "Automatic"}], "}"}]}], "}"}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
    "\"\<MomentumStatesWithLosses_LatDep70_Ramp2_N12.png\>\"", ",", "a"}], 
    "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"lmax", " ", "+", " ", "1"}], "\[RightDoubleBracket]"}], 
         "]"}], "2"], ",", 
       SuperscriptBox[
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"lmax", " ", "+", " ", "2"}], "\[RightDoubleBracket]"}], 
         "]"}], "2"], ",", 
       SuperscriptBox[
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"lmax", " ", "+", " ", "3"}], "\[RightDoubleBracket]"}], 
         "]"}], "2"]}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
     RowBox[{"PlotLegends", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<0\>\"", ",", "\"\<1\>\"", ",", "\"\<2\>\""}], "}"}]}]}], 
    "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{"klist", ",", "tlist", ",", "table"}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"klist", "[", "t_", "]"}]}], " ", ":=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{"i", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"-", "lmax"}], ",", " ", "lmax", ",", "1"}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tlist", "[", "t_", "]"}], " ", ":=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{"t", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"-", "lmax"}], ",", "lmax", ",", " ", "1"}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"table", "[", "t_", "]"}], " ", ":=", " ", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"klist", "[", "t", "]"}], ",", " ", 
         RowBox[{"tlist", "[", "t", "]"}], ",", " ", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ParametricPlot3D", "[", 
      RowBox[{
       RowBox[{"table", "[", "t", "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Plot", "[", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"Abs", "[", 
           RowBox[{
            RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
            RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], 
          "2"], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"Abs", "[", 
           RowBox[{
            RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
            RowBox[{"lmax", "+", "2"}], "\[RightDoubleBracket]"}], "]"}], 
          "2"], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "try", " ", "plotting", " ", "projetion", " ", "onto", " ", 
         "eigenstates", " ", 
         RowBox[{"vs", ".", " ", "time"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"evect1", "[", 
        RowBox[{"k_", ",", "t_"}], "]"}]}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"HamTest", "[", 
            RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", 
         "\[RightDoubleBracket]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evect2", "[", 
       RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"HamTest", "[", 
            RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
         RowBox[{"dim", "-", "1"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evect3", "[", 
       RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"HamTest", "[", 
            RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
         RowBox[{"dim", "-", "2"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evect4", "[", 
       RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"HamTest", "[", 
            RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
         RowBox[{"dim", "-", "3"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e1p", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect1", "[", 
           RowBox[{
            RowBox[{"r", " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e1m", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect1", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "r"}], " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e2p", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect2", "[", 
           RowBox[{
            RowBox[{"r", " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e2m", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect2", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "r"}], " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e3p", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect3", "[", 
           RowBox[{
            RowBox[{"r", " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e3m", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect3", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "r"}], " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e4p", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect4", "[", 
           RowBox[{
            RowBox[{"r", " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e4m", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect4", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "r"}], " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"NIntegrate", "[", 
       RowBox[{
        RowBox[{"test", "[", "t", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          FractionBox["BlochPeriod", "2"], ",", "TBloch"}], "}"}]}], "]"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"test", "[", "t_", "]"}], " ", ":=", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect1", "[", 
           RowBox[{
            RowBox[{"r", " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"N", "[", 
          RowBox[{"evect1", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "r"}], " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}]}], "]"}], 
       "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"test", "[", "t", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
    "\[IndentingNewLine]", 
    RowBox[{"(*", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"e1p", "[", "t", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"e1m", "[", "t", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"e2p", "[", "t", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"e2m", "[", "t", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"e3p", "[", "t", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"e3m", "[", "t", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"e4p", "[", "t", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"e4m", "[", "t", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
     "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{
  3.742651487641162*^9, {3.7427818887189217`*^9, 3.742781889512308*^9}, {
   3.7427859548038397`*^9, 3.742786064303526*^9}, {3.742786213438733*^9, 
   3.742786299814277*^9}, {3.7427863618494473`*^9, 3.7427863651269026`*^9}, {
   3.742787157860143*^9, 3.742787223459919*^9}, {3.7427872754023247`*^9, 
   3.742787323373995*^9}, {3.742787354891426*^9, 3.742787429359742*^9}, {
   3.7428161904328766`*^9, 3.742816197418194*^9}, {3.742816229444022*^9, 
   3.7428162309395895`*^9}, {3.7428163145242805`*^9, 
   3.7428163235466175`*^9}, {3.7428163714574394`*^9, 
   3.7428163865172224`*^9}, {3.742816420442396*^9, 3.7428164436663985`*^9}, {
   3.7428199208903503`*^9, 3.742819921447382*^9}, {3.7428200181242666`*^9, 
   3.742820060437401*^9}, {3.743468188941511*^9, 3.7434682266885614`*^9}, {
   3.743468295876808*^9, 3.7434683381821218`*^9}, {3.743468411922779*^9, 
   3.743468520099881*^9}, 3.7434685667504854`*^9, {3.743468604099724*^9, 
   3.7434686541246557`*^9}, {3.7434687735035734`*^9, 3.743468781224735*^9}, {
   3.743468978161416*^9, 3.7434690496344585`*^9}, {3.7434712883951206`*^9, 
   3.743471312795918*^9}, {3.743471348644082*^9, 3.743471349453788*^9}, {
   3.743471385794652*^9, 3.7434714158529973`*^9}, {3.7434718278394217`*^9, 
   3.743471868759737*^9}, {3.7434719070207796`*^9, 3.7434721115756435`*^9}, {
   3.7434728025833273`*^9, 3.743472845195954*^9}, {3.743473065777603*^9, 
   3.743473084348714*^9}, {3.7434732296636457`*^9, 3.743473230788076*^9}, {
   3.7434733125265317`*^9, 3.7434733145775204`*^9}, {3.7434737159005384`*^9, 
   3.743473716963723*^9}, {3.7434738461799383`*^9, 3.7434738801524878`*^9}, {
   3.743473914936407*^9, 3.743473915088481*^9}, {3.743474059221354*^9, 
   3.743474059905284*^9}, {3.7434741808853145`*^9, 3.7434742449933653`*^9}, {
   3.7434774629079695`*^9, 3.7434775058364506`*^9}, {3.7434775782205276`*^9, 
   3.74347768127614*^9}, {3.7434777342331123`*^9, 3.743477735481698*^9}, {
   3.743477805363488*^9, 3.743477881189825*^9}, {3.743478022597022*^9, 
   3.743478038742275*^9}, {3.743804203378504*^9, 3.7438042075810614`*^9}, {
   3.7438045921759415`*^9, 3.7438046338148947`*^9}, {3.7460370185583363`*^9, 
   3.7460370594788637`*^9}, {3.7460371798225517`*^9, 3.74603718085428*^9}, {
   3.746037245009845*^9, 3.7460372470936494`*^9}, 3.746037489684019*^9, {
   3.7461135497520666`*^9, 3.7461135500259857`*^9}, {3.746113591526598*^9, 
   3.7461135917562003`*^9}, {3.7469398258416805`*^9, 
   3.7469400070048995`*^9}, {3.7469400475666666`*^9, 3.746940070566573*^9}, {
   3.7469401008724666`*^9, 3.7469401098362465`*^9}, {3.7469401631004705`*^9, 
   3.7469402610852804`*^9}, {3.747860347939765*^9, 3.7478603487835913`*^9}, {
   3.7478603861904716`*^9, 3.7478604557596855`*^9}, {3.747860503419691*^9, 
   3.747860508048565*^9}, {3.747860539256374*^9, 3.747860613838385*^9}, {
   3.747860682354624*^9, 3.747860698825569*^9}, {3.7478608001024694`*^9, 
   3.747860822711776*^9}, {3.747860857709268*^9, 3.7478608610007195`*^9}, {
   3.7478609858877153`*^9, 3.747861127249587*^9}, {3.747869830769309*^9, 
   3.747869909016781*^9}, {3.747870070098647*^9, 3.7478701069986944`*^9}, {
   3.7478701527236614`*^9, 3.7478701606567893`*^9}, {3.747870198214446*^9, 
   3.747870243077113*^9}, {3.747870281863593*^9, 3.7478702830527973`*^9}, {
   3.747870330588724*^9, 3.747870341044487*^9}, {3.747870390510836*^9, 
   3.7478704261569223`*^9}, {3.7478704996031275`*^9, 
   3.7478705016237326`*^9}, {3.747870667150803*^9, 3.747870670868335*^9}, {
   3.7478707204283543`*^9, 3.7478707248580112`*^9}, {3.747870810362075*^9, 
   3.747870810838143*^9}, {3.7478715255420055`*^9, 3.7478716031767206`*^9}, {
   3.747871794368431*^9, 3.7478718238167315`*^9}, {3.74787196528677*^9, 
   3.7478719889895506`*^9}, {3.7478720951766005`*^9, 
   3.7478721112235518`*^9}, {3.747872201047073*^9, 3.747872223456788*^9}, {
   3.747872293278644*^9, 3.747872293807103*^9}, 3.7478723724007974`*^9, {
   3.7478724338573084`*^9, 3.7478724369915576`*^9}, {3.7478724858968563`*^9, 
   3.747872486333856*^9}, {3.747872549395321*^9, 3.7478726254833603`*^9}, {
   3.7478726557281895`*^9, 3.747872664409423*^9}, {3.747872767259311*^9, 
   3.747872784325889*^9}, {3.747872862487899*^9, 3.7478728733717995`*^9}, {
   3.7478729707211795`*^9, 3.7478729735156183`*^9}, {3.7478730947548757`*^9, 
   3.7478730972882533`*^9}, {3.7478732922126265`*^9, 3.747873304535415*^9}, {
   3.7478733753410254`*^9, 3.747873375445676*^9}, {3.747873454985376*^9, 
   3.7478734551006184`*^9}, {3.747873515809382*^9, 3.747873519284917*^9}, {
   3.74787355400467*^9, 3.7478735572089896`*^9}, {3.7478740168691397`*^9, 
   3.747874066699284*^9}, {3.7478741028671985`*^9, 3.747874157953047*^9}, {
   3.7478742443549175`*^9, 3.7478742475784407`*^9}, {3.7478743129749146`*^9, 
   3.7478743617845783`*^9}, {3.747874432285843*^9, 3.74787447634694*^9}, {
   3.7478745248559256`*^9, 3.747874597573082*^9}, {3.7478746464338803`*^9, 
   3.74787464986794*^9}, {3.747874745858919*^9, 3.747874796243683*^9}, {
   3.747874914845219*^9, 3.747874993713037*^9}, {3.7478756715584784`*^9, 
   3.7478756916619453`*^9}, {3.7478763032694626`*^9, 3.747876336168659*^9}, {
   3.7478763863400884`*^9, 3.747876407230285*^9}, {3.747876560958743*^9, 
   3.7478765923380613`*^9}, {3.7478766599581456`*^9, 
   3.7478766601037407`*^9}, {3.747876763252739*^9, 3.747876763381183*^9}, {
   3.7478768597742195`*^9, 3.747876920959236*^9}, {3.7478769799309616`*^9, 
   3.7478769832026963`*^9}, {3.7478770151303825`*^9, 3.747877046312991*^9}, {
   3.747877091411244*^9, 3.7478770932077026`*^9}, {3.7478771239692206`*^9, 
   3.7478771290922117`*^9}, 3.747877167893011*^9, {3.7478772081555367`*^9, 
   3.747877208811926*^9}, {3.7478777270398836`*^9, 3.7478777285167656`*^9}, 
   3.747877855208603*^9, {3.747878143884141*^9, 3.74787814611305*^9}, {
   3.7478781874188013`*^9, 3.7478781892113204`*^9}, {3.747878277419737*^9, 
   3.7478782968167095`*^9}, {3.7478783789596195`*^9, 
   3.7478783864910326`*^9}, {3.747878439864543*^9, 3.747878443863202*^9}, {
   3.747878498236489*^9, 3.747878533409647*^9}, {3.7478785758451924`*^9, 
   3.747878609494491*^9}, {3.7478786786187906`*^9, 3.7478786844360285`*^9}, {
   3.7478789298446116`*^9, 3.747878930659882*^9}, {3.747879011490947*^9, 
   3.74787901225032*^9}, {3.7478790589068823`*^9, 3.747879062222402*^9}, {
   3.747879272077074*^9, 3.747879275714942*^9}, {3.7478793138961864`*^9, 
   3.747879314583845*^9}, {3.7478793966991253`*^9, 3.7478794013749533`*^9}, {
   3.7478794492959113`*^9, 3.74787944982438*^9}, {3.747879525565037*^9, 
   3.747879525961599*^9}, {3.7478795672013674`*^9, 3.74787957008578*^9}, {
   3.7478796164718943`*^9, 3.747879617716838*^9}, {3.747879716634113*^9, 
   3.747879723559559*^9}, {3.747879760215726*^9, 3.747879764836173*^9}, {
   3.7478798754868603`*^9, 3.74787988126661*^9}, 3.747879927318472*^9, {
   3.7478799728331842`*^9, 3.7478799813077483`*^9}, {3.74788007334999*^9, 
   3.7478800867176123`*^9}, 3.747880139939083*^9, {3.7478805441731253`*^9, 
   3.747880548286168*^9}, {3.747880588181969*^9, 3.747880588356281*^9}, {
   3.74788062322694*^9, 3.747880623487598*^9}, 3.7478807247849255`*^9, 
   3.747880824534953*^9, {3.7478808802679358`*^9, 3.7478809175994935`*^9}, {
   3.747881004099003*^9, 3.7478810044274607`*^9}, {3.7478810813136024`*^9, 
   3.7478810826211214`*^9}, {3.747881585860922*^9, 3.747881589336632*^9}, {
   3.747881860401907*^9, 3.747881863495636*^9}, {3.747886202578162*^9, 
   3.7478862042420435`*^9}, {3.7478863248878007`*^9, 3.747886329993596*^9}, {
   3.7478863691678376`*^9, 3.747886383214099*^9}, {3.7478879968271866`*^9, 
   3.7478880878656487`*^9}, {3.747888126779563*^9, 3.747888129326373*^9}, {
   3.747888177722045*^9, 3.747888178244749*^9}, {3.7478882376739683`*^9, 
   3.7478882413043833`*^9}, {3.747888272474656*^9, 3.7478883177210326`*^9}, {
   3.747888354624194*^9, 3.7478883594687614`*^9}, {3.747888406171449*^9, 
   3.7478884663416457`*^9}, 3.74788854802426*^9, {3.747888592018262*^9, 
   3.7478886010592737`*^9}, {3.7478886513352804`*^9, 3.747888682604332*^9}, {
   3.7478887656725707`*^9, 3.7478887689363937`*^9}, {3.747888830328314*^9, 
   3.74788883046113*^9}, {3.7478888969813714`*^9, 3.7478889039463797`*^9}, {
   3.7478889717614794`*^9, 3.747888975541852*^9}, {3.7478891652914543`*^9, 
   3.747889165692315*^9}, 3.7478894601313753`*^9, {3.7478895599715967`*^9, 
   3.7478895660269165`*^9}, 3.7478896838421736`*^9, {3.7478897138712206`*^9, 
   3.74788972180808*^9}, {3.747889812604985*^9, 3.747889821765259*^9}, {
   3.7478900433945775`*^9, 3.7478900512481613`*^9}, 3.7478901310667906`*^9, {
   3.747890229168092*^9, 3.74789026148685*^9}, {3.7478902945819006`*^9, 
   3.747890305558259*^9}, {3.7478903388689747`*^9, 3.7478903394631844`*^9}, 
   3.747890373379568*^9, {3.7478904073407035`*^9, 3.7478904079921494`*^9}, {
   3.7478904383123937`*^9, 3.747890439930646*^9}, {3.7478904938362465`*^9, 
   3.747890521436054*^9}, 3.7478905621294355`*^9, {3.7478906467581334`*^9, 
   3.747890690173044*^9}, 3.7478911041388645`*^9, {3.7478922209228106`*^9, 
   3.7478922236987157`*^9}, 3.7478923270133743`*^9, {3.7478923632913523`*^9, 
   3.747892364254552*^9}, {3.7479711671251793`*^9, 3.7479712245410004`*^9}, {
   3.7479714935300508`*^9, 3.747971547519462*^9}, {3.7479716020832863`*^9, 
   3.747971630167588*^9}, {3.7479716614619694`*^9, 3.747971662007844*^9}, 
   3.747971854529826*^9, {3.747971911845327*^9, 3.747971935249486*^9}, {
   3.7479719829531937`*^9, 3.747971985648652*^9}, {3.747972024026872*^9, 
   3.747972026872669*^9}, {3.747972063150317*^9, 3.7479720633623905`*^9}, {
   3.7479721091289*^9, 3.7479722580518913`*^9}, {3.747972322081354*^9, 
   3.747972514507098*^9}, {3.7479726388373156`*^9, 3.7479726843410873`*^9}, {
   3.7479727260298915`*^9, 3.7479727864288435`*^9}, {3.747972855129181*^9, 
   3.747972927458417*^9}, {3.747972999871667*^9, 3.747973002556872*^9}, {
   3.74797306862763*^9, 3.747973068770059*^9}, {3.747973245499544*^9, 
   3.7479732485718236`*^9}, {3.747973294253846*^9, 3.747973294456682*^9}, {
   3.747973452857783*^9, 3.7479734671821976`*^9}, {3.748034953625616*^9, 
   3.748034954337402*^9}, {3.748035055606254*^9, 3.748035056197654*^9}, {
   3.7480353198916135`*^9, 3.748035378630293*^9}, {3.7480355949621754`*^9, 
   3.748035599852849*^9}, {3.748035682401575*^9, 3.7480356987763987`*^9}, {
   3.7480380746789713`*^9, 3.748038075022639*^9}, 3.748038731693616*^9, 
   3.7480388189905863`*^9, {3.7480389109648595`*^9, 3.74803891464703*^9}, {
   3.748038962943553*^9, 3.7480389634926987`*^9}, {3.7480390114125147`*^9, 
   3.7480390138809137`*^9}, {3.748039073334253*^9, 3.748039076365264*^9}, {
   3.748039192756333*^9, 3.748039196927876*^9}, {3.748039237304778*^9, 
   3.748039245012109*^9}, {3.7480392992406964`*^9, 3.748039302153781*^9}, {
   3.7480395881625657`*^9, 3.748039592538847*^9}, {3.7480396678810673`*^9, 
   3.748039670929267*^9}, {3.748040395365748*^9, 3.7480403964127784`*^9}, {
   3.7480405408337307`*^9, 3.7480405468044252`*^9}, {3.7480405880213337`*^9, 
   3.7480405891154175`*^9}, {3.74804072774059*^9, 3.748040728553088*^9}, {
   3.7480407934393744`*^9, 3.7480408082249966`*^9}, {3.748040872537257*^9, 
   3.7480408738368263`*^9}, {3.748040962787088*^9, 3.748041058266026*^9}, 
   3.7480411050838428`*^9, {3.7480422154902425`*^9, 3.748042223786622*^9}, {
   3.7480422573044252`*^9, 3.7480423831709137`*^9}, {3.7480428818928804`*^9, 
   3.748042935805745*^9}, {3.7480431073809795`*^9, 3.748043109991457*^9}, {
   3.74804319904947*^9, 3.7480432094911723`*^9}, {3.74804326324025*^9, 
   3.7480432890073385`*^9}, {3.748048867238369*^9, 3.7480488711620317`*^9}, {
   3.748049091732269*^9, 3.74804912249329*^9}, {3.7480491613309917`*^9, 
   3.748049187140744*^9}, {3.7480494768487377`*^9, 3.7480494983422303`*^9}, {
   3.7480497390047193`*^9, 3.7480497601341763`*^9}, {3.7480499215546093`*^9, 
   3.7480499220947084`*^9}, {3.748050566839304*^9, 3.7480505736961823`*^9}, {
   3.748050704594051*^9, 3.748050707356554*^9}, {3.7480509300015087`*^9, 
   3.748050930595424*^9}, {3.7480509924222727`*^9, 3.748050993601025*^9}, 
   3.748051303210295*^9, {3.748051625269971*^9, 3.748051627069759*^9}, {
   3.7480516860944376`*^9, 3.748051687080983*^9}, {3.7480517304959636`*^9, 
   3.748051730607983*^9}, {3.748051817828189*^9, 3.748051822399049*^9}, {
   3.7480518790618567`*^9, 3.7480518804848843`*^9}, {3.7481016617573276`*^9, 
   3.748101669716401*^9}, {3.748101735255192*^9, 3.7481017360099945`*^9}, {
   3.748101773650543*^9, 3.748101773789483*^9}, {3.748101823298442*^9, 
   3.748101833524497*^9}, {3.7481018791081905`*^9, 3.7481019352610054`*^9}, {
   3.7481019825171604`*^9, 3.748101983512635*^9}, {3.748190016521226*^9, 
   3.74819002011175*^9}, {3.7481900506142335`*^9, 3.748190051946985*^9}, {
   3.7481903799546027`*^9, 3.7481903871254*^9}, {3.7481904392528667`*^9, 
   3.748190442982711*^9}, {3.748190587500509*^9, 3.7481906228386655`*^9}, {
   3.7481907220751233`*^9, 3.7481907224897327`*^9}, {3.7481908535796223`*^9, 
   3.7481909301842437`*^9}, {3.748191022495266*^9, 3.748191025332595*^9}, {
   3.748191441580491*^9, 3.7481914461271086`*^9}, {3.7481918072191324`*^9, 
   3.7481918074902105`*^9}, {3.748192153638137*^9, 3.74819215439225*^9}, {
   3.74819271369093*^9, 3.7481927163267303`*^9}, {3.748192811308379*^9, 
   3.748192811738056*^9}, {3.748203697063826*^9, 3.7482036973176546`*^9}, {
   3.7482046614306583`*^9, 3.7482046629484262`*^9}, {3.7482298038713307`*^9, 
   3.7482300080048285`*^9}, {3.748230072715685*^9, 3.748230116242358*^9}, 
   3.748230176173807*^9, {3.74823021833488*^9, 3.7482302290382113`*^9}, {
   3.748269766440333*^9, 3.7482697666790524`*^9}, {3.748269814959479*^9, 
   3.748269815456345*^9}, {3.748275699768573*^9, 3.748275700526863*^9}, {
   3.748275988532777*^9, 3.7482759890199614`*^9}, {3.7482760230552716`*^9, 
   3.748276049276471*^9}, {3.748276100596918*^9, 3.7482761010336733`*^9}, 
   3.748276178659658*^9, {3.7485641689949784`*^9, 3.748564171063447*^9}, {
   3.748564229633875*^9, 3.748564231112929*^9}, {3.7485642718021965`*^9, 
   3.7485643009552174`*^9}, {3.748564408724127*^9, 3.7485644281900887`*^9}, {
   3.7485644627307644`*^9, 3.7485644632274647`*^9}, {3.7485644993089757`*^9, 
   3.7485645358603063`*^9}, {3.7485645673939657`*^9, 3.7485646198447523`*^9}, 
   3.7485646620190477`*^9, {3.7485647006547284`*^9, 3.7485647185977626`*^9}, {
   3.7485648092065563`*^9, 3.748564828880952*^9}, {3.7486081050078735`*^9, 
   3.748608126400648*^9}, {3.7487488423435464`*^9, 3.74874885167817*^9}, {
   3.7487488900333033`*^9, 3.7487488910327005`*^9}, {3.7487489286337233`*^9, 
   3.748748936013573*^9}, {3.7487489671897435`*^9, 3.7487489691260366`*^9}, {
   3.7487490137795744`*^9, 3.748749022156251*^9}, {3.748749213121705*^9, 
   3.748749213336541*^9}, {3.748749310647993*^9, 3.748749310869522*^9}, {
   3.7487493432096367`*^9, 3.7487493437196817`*^9}, {3.748749820882799*^9, 
   3.748749856507553*^9}, {3.7487499037750225`*^9, 3.748749904506542*^9}, {
   3.7507956107634296`*^9, 3.7507956149615493`*^9}, {3.750795657644828*^9, 
   3.750795658127681*^9}, {3.7507957102682066`*^9, 3.7507957560180197`*^9}, {
   3.7507957912822037`*^9, 3.7507959154563847`*^9}, {3.7507959549600444`*^9, 
   3.750796006862849*^9}, {3.7507960467273045`*^9, 3.750796093704235*^9}, {
   3.7507961330857863`*^9, 3.750796160713715*^9}, {3.750799359625386*^9, 
   3.7507993857175407`*^9}, {3.7507994319167337`*^9, 3.750799432185652*^9}, 
   3.7510763842119303`*^9, {3.7510764387247725`*^9, 3.751076446029709*^9}, {
   3.751076537957972*^9, 3.751076538390883*^9}, {3.7510766304292293`*^9, 
   3.7510766310151863`*^9}, {3.751145575345435*^9, 3.751145584549842*^9}, {
   3.7511456161832895`*^9, 3.751145662183359*^9}, {3.7511457458417816`*^9, 
   3.751145791822898*^9}, {3.75114588610194*^9, 3.7511459174484487`*^9}, {
   3.7511459631572924`*^9, 3.751145990471299*^9}, {3.7511460594310083`*^9, 
   3.7511460787603464`*^9}, {3.7511461597259727`*^9, 
   3.7511461600800247`*^9}, {3.7511461954325633`*^9, 3.751146195560202*^9}, {
   3.751146235284047*^9, 3.751146240490128*^9}, {3.751146287707944*^9, 
   3.7511463163065577`*^9}, {3.7511464051500835`*^9, 3.751146408597906*^9}, {
   3.7511464570294333`*^9, 3.7511464685187287`*^9}, {3.7511465038124104`*^9, 
   3.75114650604748*^9}, {3.7511465732458534`*^9, 3.7511466019740753`*^9}, {
   3.7511466353279424`*^9, 3.75114663649881*^9}, {3.751146674072398*^9, 
   3.7511466752991204`*^9}, {3.7511467726150417`*^9, 
   3.7511467932389235`*^9}, {3.7511468240219326`*^9, 
   3.7511468241565685`*^9}, {3.751146886344375*^9, 3.7511468869547434`*^9}, {
   3.751147277475091*^9, 3.751147277541911*^9}, {3.751147464646387*^9, 
   3.751147473906638*^9}, {3.751147504071026*^9, 3.7511475045467544`*^9}, {
   3.751147549733992*^9, 3.7511475502685986`*^9}, {3.7511476109952736`*^9, 
   3.751147612160163*^9}, {3.75114766487528*^9, 3.7511476653709583`*^9}, {
   3.7511477065259695`*^9, 3.751147707111408*^9}, {3.7511479562525883`*^9, 
   3.751147957558094*^9}, {3.7511479941143985`*^9, 3.751148037900382*^9}, {
   3.751148322064065*^9, 3.7511483245075345`*^9}, {3.7511483890756593`*^9, 
   3.75114842374301*^9}, {3.751148487349024*^9, 3.751148554908473*^9}, {
   3.7511485849312987`*^9, 3.751148585168604*^9}, {3.751148646144647*^9, 
   3.7511486502087855`*^9}, {3.7511487182353015`*^9, 3.751148718611294*^9}, {
   3.7511487717742176`*^9, 3.751148777314413*^9}, {3.751149290872942*^9, 
   3.7511492921495776`*^9}, {3.7511494735343857`*^9, 
   3.7511494749017267`*^9}, {3.751150493453289*^9, 3.751150497355194*^9}, {
   3.7511505695847173`*^9, 3.751150570392721*^9}, {3.7511506374406815`*^9, 
   3.7511506385982294`*^9}, {3.751150713026862*^9, 3.7511507142319317`*^9}, {
   3.7511508100329895`*^9, 3.75115081115981*^9}, {3.7511509204731393`*^9, 
   3.7511509865127935`*^9}, {3.75115104436744*^9, 3.7511510506531057`*^9}, {
   3.75115124093486*^9, 3.7511512526555376`*^9}, {3.7511513857186756`*^9, 
   3.7511513865005827`*^9}, {3.7511516170629835`*^9, 
   3.7511516201367683`*^9}, {3.751151886500083*^9, 3.751151955779069*^9}, {
   3.751152236321004*^9, 3.7511522501261115`*^9}, {3.75115228717111*^9, 
   3.7511522878253593`*^9}, {3.7511523187417383`*^9, 3.751152319276311*^9}, {
   3.7511523499812517`*^9, 3.751152350306382*^9}, {3.751152383287241*^9, 
   3.7511524115985813`*^9}, {3.751152454436098*^9, 3.7511524552489257`*^9}, {
   3.7511525095657654`*^9, 3.7511525115913534`*^9}, {3.7511525506389985`*^9, 
   3.7511525532739573`*^9}, {3.7511525962690573`*^9, 
   3.7511525966041574`*^9}, {3.751152631629557*^9, 3.751152632154151*^9}, {
   3.75115266803925*^9, 3.7511527131566744`*^9}, {3.7511527963146276`*^9, 
   3.7511528042893486`*^9}, {3.751153023048678*^9, 3.7511530254731956`*^9}, {
   3.751153184600933*^9, 3.751153191073634*^9}, {3.7511542858099957`*^9, 
   3.751154299961094*^9}, {3.7511544900677958`*^9, 3.7511544935824013`*^9}, {
   3.7516528846969795`*^9, 3.7516528909144926`*^9}, {3.751652960509201*^9, 
   3.7516529614598436`*^9}, {3.751652994743167*^9, 3.7516529967376747`*^9}, {
   3.7516530495809255`*^9, 3.751653050621091*^9}, {3.75165326183834*^9, 
   3.7516532629146905`*^9}, {3.751653329131836*^9, 3.751653329262769*^9}, 
   3.7516535751211815`*^9, {3.7522029405426064`*^9, 3.7522031714992533`*^9}, {
   3.7522032142453356`*^9, 3.7522032417191186`*^9}, 3.752203285827386*^9, {
   3.7522033281664777`*^9, 3.752203328900377*^9}, {3.75220340510645*^9, 
   3.7522034058605976`*^9}, {3.752203646731629*^9, 3.752203647347251*^9}, {
   3.752203689674806*^9, 3.752203691112166*^9}, {3.752203729668148*^9, 
   3.752203731137553*^9}, {3.7522037616534767`*^9, 3.7522038793255186`*^9}, {
   3.7522039715530005`*^9, 3.752203976444245*^9}, {3.7522040741974144`*^9, 
   3.7522040747670283`*^9}, {3.752204240749623*^9, 3.752204250691905*^9}, {
   3.7522043099241934`*^9, 3.7522043105267277`*^9}, {3.7522046377275424`*^9, 
   3.752204638122506*^9}, 3.752204739898386*^9, {3.752204805723409*^9, 
   3.752204806772026*^9}, {3.752204848296836*^9, 3.752204848505245*^9}, {
   3.752204879889639*^9, 3.752204880312815*^9}, {3.7522049335418844`*^9, 
   3.752204961641912*^9}, {3.752205204209818*^9, 3.752205204513014*^9}, 
   3.7522406291474648`*^9, 3.752240690773116*^9, 3.7522407323663898`*^9, {
   3.7522407724686403`*^9, 3.7522407728525257`*^9}, {3.752240823580648*^9, 
   3.7522408238845797`*^9}, {3.7522408909753094`*^9, 
   3.7522409248874865`*^9}, {3.752240962416329*^9, 3.752240962568923*^9}, {
   3.7541672402030373`*^9, 
   3.754167251235548*^9}},ExpressionUUID->"914f5001-5385-481e-ab04-\
ca96dd50c059"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7522407612812443`*^9, 
  3.7522407613021154`*^9}},ExpressionUUID->"d89c1af4-6e5c-440d-9ddc-\
0e928aec0161"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.752240749910124*^9, 
  3.752240749917925*^9}},ExpressionUUID->"f69c087e-56c7-48c3-88cf-\
acdc5eb221af"],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{{3.7522085321846066`*^9, 3.752208532326332*^9}, {
  3.752240704142023*^9, 
  3.752240704158366*^9}},ExpressionUUID->"62b82f68-00b7-4834-8ded-\
5dced9a5a254"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.752240757959942*^9, 
  3.7522407579661446`*^9}},ExpressionUUID->"9b028130-dae9-4c4a-8a84-\
85b4ce2f7358"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.752240706869853*^9, 3.752240709873087*^9}, 
   3.752240753172958*^9},ExpressionUUID->"511631ba-d020-4e44-bc48-\
c021c48ea897"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7485647287665815`*^9, 
  3.748564729842703*^9}},ExpressionUUID->"669322ba-1fbf-4fd7-8f96-\
61ccfb6ef55c"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.748564708874754*^9, 
  3.7485647107327876`*^9}},ExpressionUUID->"738544a3-1518-4e03-b137-\
833a05dde45d"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.748043819881168*^9, 3.748043823616372*^9}, {
   3.748048811308262*^9, 3.7480488122231855`*^9}, 
   3.748050548292853*^9},ExpressionUUID->"4ecae579-fc28-4289-8f47-\
8c0abba9f138"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7480505453399143`*^9, 
  3.7480505453913307`*^9}},ExpressionUUID->"15cf8d18-b159-4bbc-a260-\
00e55e73249e"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7480505437975035`*^9, 
  3.7480505438080287`*^9}},ExpressionUUID->"8256aa35-a3ba-479d-8eb9-\
166a7f0a7b89"],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{
  3.748192388834234*^9},ExpressionUUID->"a07eeed0-a5ec-4e97-a6bf-\
4febdc96d66d"],

Cell[BoxData[{
 RowBox[{"N", "=", 
  "8"}], "\[IndentingNewLine]", ".073", "\[IndentingNewLine]", ".4", "\
\[IndentingNewLine]", 
 RowBox[{"frac", ":", " ", "5.749"}], "\[IndentingNewLine]", 
 RowBox[{"N", "=", 
  "9"}], "\[IndentingNewLine]", ".097", "\[IndentingNewLine]", ".39", "\
\[IndentingNewLine]", 
 RowBox[{"frac", ":", " ", "4.02"}], "\[IndentingNewLine]", 
 RowBox[{"N", "=", 
  "9.4"}], "\[IndentingNewLine]", ".128", "\[IndentingNewLine]", ".367", "\
\[IndentingNewLine]", 
 RowBox[{"frac", ":", " ", "2.87"}], "\[IndentingNewLine]", 
 RowBox[{"N", " ", "=", " ", 
  "10"}], "\[IndentingNewLine]", ".14", "\[IndentingNewLine]", ".325", "\
\[IndentingNewLine]", 
 RowBox[{"frac", ":", " ", "2.32"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"N", "=", "12"}], 
  " "}], "\[IndentingNewLine]", ".15", "\[IndentingNewLine]", ".25", "\
\[IndentingNewLine]", 
 RowBox[{"frac", ":", "1.66"}], "\[IndentingNewLine]", 
 RowBox[{"expt", ":", "\[IndentingNewLine]", 
  ".46"}], "\[IndentingNewLine]", ".12", "\[IndentingNewLine]", 
 RowBox[{"frac", ":", " ", "3.5"}]}], "Input",
 CellChangeTimes->{{3.74805054143534*^9, 3.7480505415030537`*^9}, {
  3.7481918161469603`*^9, 3.748191843447806*^9}, {3.7481923914517174`*^9, 
  3.7481925138200445`*^9}, {3.748192605665888*^9, 3.7481926810955324`*^9}, {
  3.748203623044376*^9, 3.748203689439335*^9}, {3.7482041333835964`*^9, 
  3.748204134698018*^9}, {3.7482042090795918`*^9, 3.748204212691544*^9}, {
  3.7482045787893476`*^9, 
  3.7482046115695925`*^9}},ExpressionUUID->"2d2bbb78-4853-447e-9ae5-\
2c229f2a6e58"],

Cell[BoxData["."], "Input",
 CellChangeTimes->{
  3.748204198317839*^9},ExpressionUUID->"037ef508-7124-4dbe-b4fd-\
c412c98af8b7"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.748050539407248*^9, 
  3.7480505394699783`*^9}},ExpressionUUID->"6317b6cb-2b87-4023-9864-\
d54bd89e460f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[" Bloch Beamsplitter, 2 ports in, 2 ports out", "Section",
 CellChangeTimes->{
  3.74789198402812*^9, {3.747971297627748*^9, 
   3.747971314427878*^9}},ExpressionUUID->"fe425fa6-55e9-4275-a5e7-\
3f6e797171e5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Two", " ", "sets", " ", "of", " ", "Hamiltonians"}], ",", " ", 
    RowBox[{"one", " ", "in", " ", "lab", " ", "frame"}], ",", " ", 
    RowBox[{"one", " ", "in", " ", "lattice", " ", "frame"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ClearAll", "[", "\"\<Global'*\>\"", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "pl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", 
      "NBloch", ",", "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", 
      "Ham0", ",", "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", 
      " ", "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",",
       " ", "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", 
      " ", "\[Psi]cf"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rGrav", " ", "=", " ", "0.8576"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NBloch", " ", "=", " ", "6"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NLatDep", " ", "=", " ", "10"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NRamp", " ", "=", " ", "2"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tLoad", " ", "=", " ", 
     RowBox[{"2", " ", "Pi"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CapitalDelta]\[Omega]", " ", "=", " ", "0"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Kappa]", " ", "=", " ", 
     FractionBox["NLatDep", "8"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"r", " ", "=", " ", 
     RowBox[{"NRamp", "*", "rGrav"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BlochPeriod", " ", "=", " ", 
     FractionBox["8", "r"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TBloch", " ", "=", " ", 
     RowBox[{"BlochPeriod", " ", "*", " ", "NBloch"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"time", " ", "=", " ", 
    RowBox[{
     FractionBox["10000", "125"], "*", "2", " ", 
     FractionBox[
      RowBox[{"NBloch", " ", "*", " ", "11"}], "NRamp"]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lmax", " ", "=", " ", 
     RowBox[{"Max", "[", 
      RowBox[{"10", ",", 
       RowBox[{"Round", "[", 
        RowBox[{"5.", "*", 
         SuperscriptBox["NLatDep", 
          RowBox[{"1", "/", "4"}]]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dim", " ", "=", " ", 
     RowBox[{
      RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"loadLattice", "[", 
     RowBox[{
     "lMax_", ",", " ", "kk0_", ",", " ", "tLoad_", ",", " ", "loadHam_"}], 
     "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
        RowBox[{"k0", " ", "=", " ", "kk0"}], ",", " ", 
        RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
        RowBox[{"HamLoad", " ", "=", " ", "loadHam"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{
        "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
         ",", " ", "cs"}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"dimState", " ", "=", " ", 
        RowBox[{
         RowBox[{"2", "*", "maxL"}], " ", "+", " ", "1"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Psi]i", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "dimState"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"rem", " ", "=", " ", 
        RowBox[{"Mod", "[", 
         RowBox[{"k0", ",", " ", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"low", " ", "=", " ", 
           RowBox[{"Floor", "[", 
            FractionBox["k0", "2"], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"high", " ", "=", " ", 
           RowBox[{"Ceiling", "[", 
            FractionBox["k0", "2"], "]"}]}], " ", ";"}], "="}], 
        "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"low", " ", "=", " ", 
        RowBox[{"-", "NBloch"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"high", " ", "=", " ", "NBloch"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]i", "[", 
         RowBox[{"[", 
          RowBox[{"low", " ", "+", " ", 
           RowBox[{"(", 
            RowBox[{"lmax", " ", "+", "1"}], ")"}]}], "]"}], "]"}], " ", "=", 
        " ", "1"}], " ", ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]i", "[", 
         RowBox[{"[", 
          RowBox[{"high", " ", "+", " ", 
           RowBox[{"(", 
            RowBox[{"lmax", " ", "+", "1"}], ")"}]}], "]"}], "]"}], " ", "=", 
        FractionBox[
         RowBox[{"0", "*", "1", "  ", "\[ImaginaryI]"}], 
         RowBox[{"Sqrt", "[", "2", "]"}]]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"cs", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ics", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
           RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
            RowBox[{"nn", "+", 
             RowBox[{"(", 
              RowBox[{"lmax", "+", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"equation", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{
           RowBox[{"HamLoad", "[", "tt", "]"}], ".", 
           RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sol", " ", "=", " ", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
          RowBox[{"{", 
           RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", "tt_", "]"}], ":=", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
         RowBox[{
         "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[Psi]ci", "[", "tLoad", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"unLoadLattice", "[", 
     RowBox[{
     "lMax_", ",", " ", "tLoad_", ",", " ", "unLoadHam_", ",", " ", 
      "\[Psi]ci_"}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
        RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
        RowBox[{"HamUnLoad", " ", "=", " ", "unLoadHam"}], ",", " ", 
        RowBox[{"\[Psi]i", "=", " ", "\[Psi]ci"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"cs", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ics", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
           RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
            RowBox[{"nn", "+", 
             RowBox[{"(", 
              RowBox[{"lmax", "+", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"equation", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{
           RowBox[{"HamUnLoad", "[", "tt", "]"}], ".", 
           RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sol", " ", "=", " ", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
          RowBox[{"{", 
           RowBox[{"tt", ",", "0", ",", "loadTime"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]cff", "[", "tt_", "]"}], ":=", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
         RowBox[{
         "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[Psi]cff", "[", "loadTime", "]"}]}]}], "\[IndentingNewLine]",
      "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"kl", "[", "l_", "]"}], ":=", 
     RowBox[{"k0", "+", 
      RowBox[{"2", " ", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
           SuperscriptBox[
            RowBox[{"kl", "[", 
             RowBox[{"l", " ", "-", " ", 
              RowBox[{"(", 
               RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", "   ", "\[Kappa]\[Kappa]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", " ", "\[ImaginaryI]"}], " ", "\[CapitalDelta]w",
                  " ", 
                 RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
               RowBox[{"Cos", "[", 
                RowBox[{
                 FractionBox[
                  RowBox[{"rr", " "}], "2"], "+", 
                 RowBox[{"\[CapitalDelta]wm", " ", 
                  RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]", " ", "+", 
                 FractionBox[
                  RowBox[{"1", " ", "Pi"}], "8"], "+", " ", 
                 RowBox[{"r", " ", 
                  FractionBox[
                   SuperscriptBox["TBloch", "2"], "2"]}]}], " ", "]"}]}], 
              ")"}]}], " ", "/;", " ", 
            RowBox[{
             RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"2", "  ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{"\[ImaginaryI]", " ", "\[CapitalDelta]w", " ", 
                 RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
               RowBox[{"Cos", "[", 
                RowBox[{
                 FractionBox[
                  RowBox[{"rr", " "}], "2"], "+", 
                 RowBox[{"\[CapitalDelta]wm", " ", 
                  RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]", " ", "+", 
                 FractionBox[
                  RowBox[{"1", " ", "Pi"}], "8"], "+", " ", 
                 RowBox[{"r", " ", 
                  FractionBox[
                   SuperscriptBox["TBloch", "2"], "2"]}]}], " ", "]"}]}], 
              ")"}]}], "/;", 
            RowBox[{
             RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox["tt", "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
         RowBox[{
          RowBox[{"-", "r"}], " ", "TBloch"}]}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", "  ", 
         RowBox[{"r", " ", "TBloch", " ", "tLoad"}]}]}], " ", "}"}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox[
           RowBox[{"(", 
            RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
         RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MatrixForm", "[", 
     RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
        RowBox[{"rr", "\[Rule]", 
         RowBox[{"r", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"tt", " ", "-", " ", "TBloch"}], ")"}], "2"]}]}], ",", 
        " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", 
         RowBox[{
          RowBox[{"-", " ", "r"}], " ", 
          FractionBox[
           SuperscriptBox["TBloch", "2"], "2"]}]}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"MatrixForm", "[", 
    RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamPlot", "[", 
      RowBox[{"x_", ",", "t_", ",", "phi_"}], "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"Cos", "[", 
       RowBox[{
        FractionBox[
         RowBox[{"r", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"t", " ", "-", " ", "TBloch"}], ")"}], "2"]}], "2"], " ", 
        "+", " ", "phi"}], "]"}], 
      RowBox[{"Cos", "[", 
       RowBox[{"2", " ", "x"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamReg", "[", 
      RowBox[{"x_", ",", "t_", ",", "rr_"}], "]"}], " ", "=", " ", 
     RowBox[{"Cos", "[", 
      RowBox[{
       RowBox[{"2", " ", "x"}], " ", "+", " ", 
       FractionBox[
        RowBox[{"rr", " ", 
         SuperscriptBox["t", "2"]}], "2"]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"a", " ", "=", " ", 
    RowBox[{"DensityPlot", "[", 
     RowBox[{
      RowBox[{"HamPlot", "[", 
       RowBox[{"x", ",", "t", ",", "0"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", 
        RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"t", ",", 
        RowBox[{"TBloch", " ", "-", " ", "BlochPeriod"}], ",", " ", 
        RowBox[{"TBloch", " ", "+", " ", "BlochPeriod"}]}], "}"}], ",", " ", 
      RowBox[{"PlotPoints", "\[Rule]", "200"}], ",", " ", 
      RowBox[{"PlotLegends", "\[Rule]", "Automatic"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"b", " ", "=", " ", 
    RowBox[{"DensityPlot", "[", 
     RowBox[{
      RowBox[{"HamPlot", "[", 
       RowBox[{"x", ",", "t", ",", 
        FractionBox["Pi", "2"]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", 
        RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"t", ",", 
        RowBox[{"TBloch", " ", "-", " ", "BlochPeriod"}], ",", " ", 
        RowBox[{"TBloch", " ", "+", " ", "BlochPeriod"}]}], "}"}], ",", " ", 
      RowBox[{"PlotPoints", "\[Rule]", "200"}], ",", " ", 
      RowBox[{"PlotLegends", "\[Rule]", "Automatic"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"c", " ", "=", " ", 
    RowBox[{"DensityPlot", "[", 
     RowBox[{
      RowBox[{"HamReg", "[", 
       RowBox[{"x", ",", "t", ",", "r"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", 
        RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", " ", "BlochPeriod"}], "}"}], ",", " ", 
      RowBox[{"PlotPoints", "\[Rule]", "200"}], ",", " ", 
      RowBox[{"PlotLegends", "\[Rule]", "Automatic"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"d", " ", "=", " ", 
    RowBox[{"DensityPlot", "[", 
     RowBox[{
      RowBox[{"HamReg", "[", 
       RowBox[{"x", ",", "t", ",", 
        RowBox[{"-", "r"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", 
        RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", " ", "BlochPeriod"}], "}"}], ",", " ", 
      RowBox[{"PlotPoints", "\[Rule]", "200"}], ",", " ", 
      RowBox[{"PlotLegends", "\[Rule]", "Automatic"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"e", " ", "=", " ", 
    RowBox[{"DensityPlot", "[", 
     RowBox[{
      RowBox[{"HamPlot", "[", 
       RowBox[{"x", ",", "t", ",", "0"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", 
        RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"t", ",", "TBloch", ",", " ", 
        RowBox[{"TBloch", " ", "+", " ", "BlochPeriod"}]}], "}"}], ",", " ", 
      RowBox[{"PlotPoints", "\[Rule]", "200"}], ",", " ", 
      RowBox[{"PlotLegends", "\[Rule]", "Automatic"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{"\"\<BBS Zero crossing phi=0.png\>\"", ",", "a"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{"\"\<BBS Zero crossing phi=piOver2.png\>\"", ",", "b"}], "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{"\"\<Accelerate Left.png\>\"", ",", "c"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{"\"\<Accelerate Right.png\>\"", ",", "d"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{"\"\<Accelerate Left and Right.png\>\"", ",", "e"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Clear", "[", "k", "]"}], "\[IndentingNewLine]", 
        RowBox[{"kl", "[", 
         RowBox[{"l_", ",", "k_"}], "]"}]}], " ", "=", " ", 
       RowBox[{"k", " ", "+", " ", 
        RowBox[{"2", " ", "l"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
       RowBox[{"Normal", "[", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
             SuperscriptBox[
              RowBox[{"kl", "[", 
               RowBox[{
                RowBox[{"l", " ", "-", " ", 
                 RowBox[{"(", 
                  RowBox[{"lmax", "+", "1"}], ")"}]}], ",", " ", "k"}], "]"}],
               "2"]}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", "  ", 
             RowBox[{
              RowBox[{"\[Kappa]\[Kappa]", 
               RowBox[{"(", " ", 
                RowBox[{"1", " ", "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"\[ImaginaryI]", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"rr", " ", 
                    SuperscriptBox["tt", "2"]}], "+", 
                    RowBox[{"2", " ", "\[CapitalDelta]wm", " ", "tt"}], "+", 
                    " ", 
                    RowBox[{"2", " ", "\[Phi]"}]}], ")"}]}], "]"}]}], ")"}]}],
               " ", "/;", " ", 
              RowBox[{
               RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", " ", 
             RowBox[{
              RowBox[{"\[Kappa]\[Kappa]", " ", 
               RowBox[{"(", " ", 
                RowBox[{"1", "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "\[ImaginaryI]"}], " ", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{"rr", " ", 
                    SuperscriptBox["tt", "2"]}], "+", 
                    RowBox[{"2", "\[CapitalDelta]wm", " ", "tt"}], "+", " ", 
                    RowBox[{"2", " ", "\[Phi]"}]}], ")"}]}], "]"}]}], ")"}]}],
               "/;", 
              RowBox[{
               RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
       RowBox[{
        RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"k", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"-", "r"}], " ", 
            FractionBox["TBloch", "4"]}]}], ",", 
          RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
           RowBox[{"\[Kappa]", " ", 
            FractionBox["tt", "tLoad"]}]}], ",", " ", 
          RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
          RowBox[{
          "\[CapitalDelta]w", " ", "\[Rule]", " ", 
           "\[CapitalDelta]\[Omega]"}], ",", " ", 
          RowBox[{"\[CapitalDelta]wm", "\[Rule]", " ", "0"}], ",", " ", 
          RowBox[{"\[Phi]", "\[Rule]", " ", "0"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
       RowBox[{
        RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"k", "\[Rule]", " ", 
           RowBox[{"r", " ", 
            FractionBox["TBloch", "4"]}]}], ",", " ", 
          RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
           RowBox[{"\[Kappa]", " ", 
            FractionBox[
             RowBox[{"(", 
              RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
          RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
          RowBox[{
          "\[CapitalDelta]w", " ", "\[Rule]", " ", 
           "\[CapitalDelta]\[Omega]"}], ",", " ", 
          RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
           RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
          RowBox[{"\[Phi]", "\[Rule]", 
           FractionBox[
            RowBox[{"r", " ", 
             SuperscriptBox["TBloch", "2"]}], "2"]}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MatrixForm", "[", 
       RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
       RowBox[{
        RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"k", "\[Rule]", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "r"}], " ", 
             FractionBox["TBloch", "4"]}], " ", "+", " ", 
            RowBox[{"r", " ", 
             FractionBox["tt", "4"]}]}]}], ",", " ", 
          RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
          RowBox[{"rr", "\[Rule]", "r"}], ",", " ", 
          RowBox[{
          "\[CapitalDelta]w", " ", "\[Rule]", " ", 
           "\[CapitalDelta]\[Omega]"}], ",", " ", 
          RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
          RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MatrixForm", "[", 
       RowBox[{"Ham1", "[", "t", "]"}], "]"}]}], "\[IndentingNewLine]", 
     "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Clear", "[", 
      RowBox[{
      "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
       ",", " ", "cs", ",", " ", "\[Psi]cf", ",", "tt"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
      RowBox[{"Table", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"nn", ",", 
          RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"cs", " ", "=", " ", 
      RowBox[{"Table", "[", " ", 
       RowBox[{
        RowBox[{"ci", "[", "nn", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"nn", ",", 
          RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
      RowBox[{
       RowBox[{
        RowBox[{"loadLattice", "[", 
         RowBox[{
         "lmax", ",", " ", "k0", ",", " ", "tLoad", ",", " ", "HamLoad"}], 
         "]"}], "\[IndentingNewLine]", 
        SuperscriptBox[
         RowBox[{"Abs", "[", "\[Psi]iBloch", "]"}], "2"], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"i1", " ", "=", "  ", 
           SuperscriptBox[
            RowBox[{"Norm", "[", 
             RowBox[{"\[Psi]iBloch", ".", 
              RowBox[{
               RowBox[{
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"Ham1", "[", "0", "]"}], "]"}], 
                "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "\[LeftDoubleBracket]", "dim", " ", 
               "\[RightDoubleBracket]"}]}], "]"}], "2"]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"i2", " ", "=", "  ", 
           SuperscriptBox[
            RowBox[{"Norm", "[", 
             RowBox[{"\[Psi]iBloch", ".", 
              RowBox[{
               RowBox[{
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"Ham1", "[", "0", "]"}], "]"}], 
                "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], 
             "]"}], "2"]}], ";", "\[IndentingNewLine]", 
          RowBox[{"i3", " ", "=", "  ", 
           SuperscriptBox[
            RowBox[{"Norm", "[", 
             RowBox[{"\[Psi]iBloch", ".", 
              RowBox[{
               RowBox[{
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"Ham1", "[", "0", "]"}], "]"}], 
                "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], 
             "]"}], "2"]}], ";"}], "\[IndentingNewLine]", "*)"}], 
        "\[IndentingNewLine]", "ics"}], " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"equation", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], " ", 
        RowBox[{
         RowBox[{"Ham1", "[", "tt", "]"}], ".", 
         RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sol", " ", "=", " ", 
      RowBox[{"NDSolve", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
        RowBox[{"{", 
         RowBox[{"tt", ",", "0", ",", 
          RowBox[{"2", " ", "TBloch"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
       RowBox[{
       "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"\[Psi]ci", "[", 
      RowBox[{"2", " ", "TBloch"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SuperscriptBox[
        RowBox[{"Abs", "[", 
         RowBox[{"\[Psi]ci", "[", 
          RowBox[{"2", " ", "TBloch"}], "]"}], "]"}], "2"], 
       "\[IndentingNewLine]", 
       SuperscriptBox[
        RowBox[{"Abs", "[", 
         RowBox[{"\[Psi]ci", "[", 
          RowBox[{
           RowBox[{"2", " ", "TBloch"}], " ", "-", " ", "BlochPeriod"}], 
          "]"}], "]"}], "2"], "\[IndentingNewLine]", 
       SuperscriptBox[
        RowBox[{"Abs", "[", 
         RowBox[{"\[Psi]ci", "[", 
          RowBox[{
           RowBox[{"2", " ", "TBloch"}], " ", "-", " ", 
           RowBox[{"2", " ", "BlochPeriod"}]}], "]"}], "]"}], "2"], 
       "\[IndentingNewLine]", 
       RowBox[{"Clear", "[", "t", "]"}], "\[IndentingNewLine]", "\[Psi]cf"}], 
      " ", "=", " ", 
      RowBox[{"unLoadLattice", "[", 
       RowBox[{"lmax", ",", " ", "tLoad", ",", " ", "HamUnLoad", ",", 
        RowBox[{"\[Psi]ci", "[", 
         RowBox[{"2", " ", "TBloch"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        SuperscriptBox[
         RowBox[{"Norm", "[", 
          RowBox[{
           RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
           RowBox[{
            RowBox[{
             RowBox[{"Eigensystem", "[", 
              RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], 
             "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{"dim", " ", "-", "4"}], "\[RightDoubleBracket]"}]}], 
          "]"}], "2"], "\[IndentingNewLine]", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"p1", "[", "t_", "]"}], " ", ":=", "  ", 
           SuperscriptBox[
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
              RowBox[{
               RowBox[{
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"Ham1", "[", "t", "]"}], "]"}], 
                "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "\[LeftDoubleBracket]", "dim", " ", 
               "\[RightDoubleBracket]"}]}], "]"}], "2"]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"p2", "[", "t_", "]"}], " ", ":=", "  ", 
           SuperscriptBox[
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
              RowBox[{
               RowBox[{
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"Ham1", "[", "t", "]"}], "]"}], 
                "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], 
             "]"}], "2"]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"p3", "[", "t_", "]"}], " ", ":=", "  ", 
           SuperscriptBox[
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
              RowBox[{
               RowBox[{
                RowBox[{"Eigensystem", "[", 
                 RowBox[{"Ham1", "[", "t", "]"}], "]"}], 
                "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], 
             "]"}], "2"]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"Re", "[", 
               RowBox[{"p1", "[", "t", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], 
             "]"}], "\[IndentingNewLine]", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"Re", "[", 
               RowBox[{"p2", "[", "t", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], 
             "]"}], "\[IndentingNewLine]", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"Re", "[", 
               RowBox[{"p3", "[", "t", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], 
             "]"}], "\[IndentingNewLine]", "p1"}], "+", "p2", "+", "p3"}], 
          ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
        SuperscriptBox[
         RowBox[{"Abs", "[", "\[Psi]cf", "]"}], "2"], "\[IndentingNewLine]", 
        RowBox[{"ArcTan", "[", 
         RowBox[{
          RowBox[{"Re", "[", 
           RowBox[{
           "\[Psi]cf", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}],
            "]"}], ",", " ", 
          RowBox[{"Im", "[", 
           RowBox[{
           "\[Psi]cf", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}],
            "]"}]}], "]"}]}], "-", 
       RowBox[{
        RowBox[{"ArcTan", "[", 
         RowBox[{
          RowBox[{"Re", "[", 
           RowBox[{
           "\[Psi]cf", "\[LeftDoubleBracket]", "17", 
            "\[RightDoubleBracket]"}], "]"}], ",", " ", 
          RowBox[{"Im", "[", 
           RowBox[{
           "\[Psi]cf", "\[LeftDoubleBracket]", "17", 
            "\[RightDoubleBracket]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
        RowBox[{"Plot", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"Abs", "[", 
            RowBox[{"\[Psi]ci", "[", "t", "]"}], "]"}], "2"], ",", " ", 
          RowBox[{"{", 
           RowBox[{"t", ",", "0", ",", 
            RowBox[{"2", " ", "TBloch"}]}], "}"}], ",", " ", 
          RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Plot", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
             RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], 
           "2"], ",", " ", 
          RowBox[{"{", 
           RowBox[{"t", ",", "0", ",", 
            RowBox[{"2", " ", "TBloch"}]}], "}"}], ",", " ", 
          RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Plot", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
             RowBox[{"lmax", "+", "2"}], "\[RightDoubleBracket]"}], "]"}], 
           "2"], ",", " ", 
          RowBox[{"{", 
           RowBox[{"t", ",", "0", ",", 
            RowBox[{"2", " ", "TBloch"}]}], "}"}], ",", " ", 
          RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "try", " ", "plotting", " ", "projetion", " ", "onto", " ", 
          "eigenstates", " ", 
          RowBox[{"vs", ".", " ", 
           RowBox[{"time", "?"}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"evect1", "[", 
         RowBox[{"k_", ",", "t_"}], "]"}]}]}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"Ham1", "[", 
            RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", 
         "\[RightDoubleBracket]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evect2", "[", 
       RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"Ham0", "[", 
            RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
         RowBox[{"dim", "-", "1"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evect3", "[", 
       RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"Ham0", "[", 
            RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
         RowBox[{"dim", "-", "2"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}],
      ";"}]}]}]}]], "Input",
 CellChangeTimes->{
  3.74789198402812*^9, {3.747971297627748*^9, 3.747971349972892*^9}, {
   3.747971442870778*^9, 3.747971449777811*^9}, 3.7479721027919865`*^9, {
   3.748269934486339*^9, 3.7482699413944597`*^9}, {3.748270006189145*^9, 
   3.7482700094393167`*^9}, {3.748270072128196*^9, 3.7482700843298874`*^9}, {
   3.7482702898904357`*^9, 3.748270327445113*^9}, {3.748270456693988*^9, 
   3.7482704610223303`*^9}, {3.7482704910259314`*^9, 
   3.7482704951751776`*^9}, {3.7482705347880335`*^9, 
   3.7482705381694374`*^9}, {3.7482705746384535`*^9, 
   3.7482705782940454`*^9}, {3.7482706630746307`*^9, 
   3.7482706664246674`*^9}, {3.748270838509296*^9, 3.7482709067868767`*^9}, {
   3.7482709418674803`*^9, 3.7482709422848616`*^9}, {3.748270975392987*^9, 
   3.748271038482089*^9}, {3.748271072021905*^9, 3.748271074875886*^9}, {
   3.7483598954801702`*^9, 3.7483599844003744`*^9}, {3.7483600355254803`*^9, 
   3.7483600919355016`*^9}, {3.748360133260284*^9, 3.7483601436601667`*^9}, {
   3.748360185588765*^9, 3.7483602339325175`*^9}, {3.748360266226734*^9, 
   3.7483603326845055`*^9}, {3.7483603975724096`*^9, 3.748360407733678*^9}, {
   3.748360444367799*^9, 3.748360445432107*^9}, {3.753023920247596*^9, 
   3.7530240360266504`*^9}, {3.753024076307972*^9, 3.753024104187107*^9}, {
   3.753024283786497*^9, 3.7530243021766605`*^9}, {3.7530243891850214`*^9, 
   3.753024428201868*^9}},
 EmphasizeSyntaxErrors->
  True,ExpressionUUID->"44429642-975b-4e4b-8899-eb484e9924e3"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Calculating and plotting efficiency of a Bloch Beamsplitter", "Section",
 CellChangeTimes->{{3.7418815452281647`*^9, 3.741881618858805*^9}, {
   3.741881671086541*^9, 3.741881716696693*^9}, {3.741881752160838*^9, 
   3.74188178489005*^9}, {3.741881967325671*^9, 3.741882082986882*^9}, {
   3.741882161091339*^9, 3.741882180164667*^9}, {3.741882212985139*^9, 
   3.7418822136081486`*^9}, {3.741882244025753*^9, 3.741882278689544*^9}, {
   3.7418823623896413`*^9, 3.741882500932417*^9}, {3.74188253597342*^9, 
   3.741882679259897*^9}, {3.741882734993167*^9, 3.741882741513494*^9}, {
   3.7418828209548473`*^9, 3.7418828782243166`*^9}, {3.7418831296626005`*^9, 
   3.7418832134396043`*^9}, {3.741883261697014*^9, 3.7418833212463512`*^9}, {
   3.741883478696267*^9, 3.7418835580660353`*^9}, {3.741883614782113*^9, 
   3.7418837192258167`*^9}, {3.741883821715001*^9, 3.7418838465074773`*^9}, {
   3.7418839626694655`*^9, 3.741883983629427*^9}, 3.741942077031226*^9, 
   3.741944279823856*^9, {3.741944389229206*^9, 3.741944420986409*^9}, {
   3.741944485325745*^9, 3.74194451582856*^9}, {3.741944563749442*^9, 
   3.7419446721348047`*^9}, 3.741944717715289*^9, {3.7419448268427944`*^9, 
   3.7419448288784733`*^9}, {3.7419449303595333`*^9, 
   3.7419449428278074`*^9}, {3.741945034647667*^9, 3.7419452213739862`*^9}, {
   3.7419453411898766`*^9, 3.741945341602253*^9}, {3.7419453943490353`*^9, 
   3.7419453958519993`*^9}, {3.7419457073146434`*^9, 3.741945720312786*^9}, {
   3.741945852665106*^9, 3.7419458769688263`*^9}, 3.741946052648031*^9, 
   3.7419495172284713`*^9, 3.741949568896909*^9, {3.741949614068632*^9, 
   3.741949666251521*^9}, {3.741949807911152*^9, 3.7419498108296385`*^9}, {
   3.741950020868823*^9, 3.7419501598801928`*^9}, {3.7419502913932886`*^9, 
   3.741950291932275*^9}, {3.741950412847595*^9, 3.7419504132882233`*^9}, {
   3.7419505057793026`*^9, 3.7419505072622027`*^9}, {3.7419505498129086`*^9, 
   3.7419505585715637`*^9}, {3.741950595164336*^9, 3.7419505956455297`*^9}, {
   3.741951053274946*^9, 3.741951056141962*^9}, 3.7419511105095186`*^9, {
   3.7419512101203613`*^9, 3.7419512214109974`*^9}, {3.741951291824642*^9, 
   3.741951297716751*^9}, {3.7419514230491004`*^9, 3.741951450141926*^9}, {
   3.74195151454677*^9, 3.741951655892046*^9}, {3.741951736341807*^9, 
   3.741951775960843*^9}, {3.741951812375228*^9, 3.741951825119231*^9}, {
   3.7419521447240973`*^9, 3.7419521744375725`*^9}, {3.741953326652159*^9, 
   3.7419533425413456`*^9}, {3.7419539366029634`*^9, 
   3.7419539680390882`*^9}, {3.741954063747334*^9, 3.7419540640494647`*^9}, {
   3.7419541562459*^9, 3.741954160011956*^9}, {3.741976161093671*^9, 
   3.741976161123312*^9}, {3.74216749840306*^9, 3.742167521377059*^9}, {
   3.7423933645593634`*^9, 3.7423933870665436`*^9}, {3.7423934287866497`*^9, 
   3.742393432508827*^9}, {3.7423940643688583`*^9, 3.7423940772546754`*^9}, {
   3.742394113456526*^9, 3.742394149018551*^9}, {3.7423942003607388`*^9, 
   3.742394200530285*^9}, {3.742394282951422*^9, 3.742394284340479*^9}, {
   3.7423943215944185`*^9, 3.742394352962783*^9}, {3.7423945355406947`*^9, 
   3.7423945524187174`*^9}, {3.7426496502506533`*^9, 
   3.7426496505630794`*^9}, {3.7426496981691236`*^9, 3.742649698325339*^9}, {
   3.7428194894313602`*^9, 3.742819522014397*^9}, {3.7428195532949286`*^9, 
   3.7428196407976966`*^9}, {3.7428196782302194`*^9, 
   3.7428197996623173`*^9}, {3.742864849868371*^9, 3.742865065719782*^9}, {
   3.7428651016222315`*^9, 3.7428651025145893`*^9}, {3.7428654320804405`*^9, 
   3.7428654392453537`*^9}, {3.7428655619177084`*^9, 3.742865565319542*^9}, {
   3.7428656160065393`*^9, 3.7428656166527395`*^9}, {3.742865803509218*^9, 
   3.7428658166497602`*^9}, {3.742865933993359*^9, 3.742865940101988*^9}, {
   3.7428660933656483`*^9, 3.74286613611241*^9}, {3.742867264078724*^9, 
   3.742867271718955*^9}, {3.7428673352507*^9, 3.7428673906408987`*^9}, {
   3.7428674244532795`*^9, 3.742867428922534*^9}, {3.7428674962732964`*^9, 
   3.7428675172818427`*^9}, {3.7428675624916525`*^9, 3.742867573875573*^9}, {
   3.7428681769055634`*^9, 3.7428681883743134`*^9}, {3.7428682350224886`*^9, 
   3.7428685325490403`*^9}, {3.74286869913986*^9, 3.742868823733999*^9}, {
   3.7428691213274403`*^9, 3.7428691411243153`*^9}, {3.7428701131872406`*^9, 
   3.742870122514867*^9}, {3.742871314501204*^9, 3.7428713183909197`*^9}, 
   3.7428742569649887`*^9, {3.742874318595728*^9, 3.742874385923684*^9}, {
   3.7428744651783695`*^9, 3.742874472604374*^9}, {3.742874648565053*^9, 
   3.742874664392881*^9}, {3.743804365694183*^9, 3.743804426449497*^9}, {
   3.743804501969309*^9, 3.743804504783072*^9}, {3.7479712883212028`*^9, 
   3.747971292891555*^9}},ExpressionUUID->"f6e04396-86d1-4f9c-8433-\
4453dad80800"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Test", " ", "the", " ", "efficiency", " ", "of", " ", "a", " ", "Bloch", 
    " ", "beamsplitter", " ", "as", " ", "a", " ", "function", " ", "of", " ",
     "ramp", " ", "rate"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]12", ",", "NBloch", ",", "k0", 
      ",", " ", "tLoad", ",", " ", "NLat", ",", " ", "\[CapitalDelta]", ",", 
      " ", "r"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rGrav", " ", "=", " ", "0.8576"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"BlochBeamsplitterEfficiency", "[", 
      RowBox[{
      "NLatDep_", ",", "NRampRate_", ",", "NBloch_", ",", "kk0_", ",", " ", 
       "loadTime_", ",", " ", "\[CapitalDelta]\[Omega]_"}], "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"NLat", "=", " ", "NLatDep"}], ",", " ", 
         RowBox[{"NBO", "=", " ", "NBloch"}], ",", "  ", 
         RowBox[{"NRam", "=", " ", "NRampRate"}], ",", 
         RowBox[{"k0", " ", "=", " ", "kk0"}], ",", " ", 
         RowBox[{"tLoad", " ", "=", " ", "loadTime"}], ",", " ", 
         RowBox[{"\[CapitalDelta]", "=", "\[CapitalDelta]\[Omega]"}]}], "}"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Clear", "[", 
         RowBox[{
         "pl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", 
          "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", "Ham0", ",", 
          "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", " ", 
          "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",", 
          " ", "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", 
          " ", "\[Psi]cf", ",", " ", "\[CapitalDelta]w"}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"\[Kappa]", " ", "=", " ", 
         FractionBox["NLat", "8"]}], ";", "\[IndentingNewLine]", 
        RowBox[{"r", " ", "=", " ", 
         RowBox[{"NRam", "*", "rGrav"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"BlochPeriod", " ", "=", " ", 
         FractionBox["8", "r"]}], ";", "\[IndentingNewLine]", 
        RowBox[{"TBloch", " ", "=", " ", 
         RowBox[{"BlochPeriod", " ", "*", " ", "NBO"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"lmax", " ", "=", " ", 
         RowBox[{"Max", "[", 
          RowBox[{"10", ",", 
           RowBox[{"Round", "[", 
            RowBox[{"5.", "*", 
             SuperscriptBox["NLat", 
              RowBox[{"1", "/", "4"}]]}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"dim", " ", "=", " ", 
         RowBox[{
          RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Clear", "[", 
         RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"kl", "[", "l_", "]"}], ":=", 
         RowBox[{"k0", "+", 
          RowBox[{"2", " ", "l"}]}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"+", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"4", " ", "\[Kappa]\[Kappa]"}], " ", "+", " ", 
            RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"Cos", "[", 
              FractionBox[
               RowBox[{"rr", " ", 
                SuperscriptBox["tt", "2"]}], "2"], "]"}]}]}], ")"}]}], "*)"}],
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
         RowBox[{"Normal", "[", 
          RowBox[{"SparseArray", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
               SuperscriptBox[
                RowBox[{"kl", "[", 
                 RowBox[{"l", " ", "-", " ", 
                  RowBox[{"(", 
                   RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"]}], " ", 
              ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
               RowBox[{
                RowBox[{"4", "  ", "\[Kappa]\[Kappa]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", " ", "\[ImaginaryI]"}], " ", 
                    "\[CapitalDelta]w", " ", "tt"}], "]"}], " ", 
                   RowBox[{"Cos", "[", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"rr", " ", 
                    SuperscriptBox["tt", "2"]}], "2"], "+", 
                    RowBox[{"\[CapitalDelta]wm", " ", "tt"}], "+", " ", 
                    "\[Phi]"}], "]"}]}], ")"}]}], " ", "/;", " ", 
                RowBox[{
                 RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
               RowBox[{
                RowBox[{"4", " ", "\[Kappa]\[Kappa]", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Exp", "[", 
                    RowBox[{
                    "\[ImaginaryI]", " ", "\[CapitalDelta]w", " ", "tt"}], 
                    "]"}], " ", 
                   RowBox[{"Cos", "[", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"rr", " ", 
                    SuperscriptBox["tt", "2"]}], "2"], "+", 
                    RowBox[{"\[CapitalDelta]wm", " ", "tt"}], " ", "+", " ", 
                    "\[Phi]"}], "]"}]}], ")"}]}], "/;", 
                RowBox[{
                 RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
         RowBox[{
          RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
             RowBox[{"\[Kappa]", " ", 
              FractionBox["tt", "tLoad"]}]}], ",", " ", 
            RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
            RowBox[{
            "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]"}], ",",
             " ", 
            RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", 
            RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
         RowBox[{
          RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
             RowBox[{"\[Kappa]", " ", 
              FractionBox[
               RowBox[{"(", 
                RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
            RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
            RowBox[{
            "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]"}], ",",
             " ", 
            RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
             RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
            RowBox[{"\[Phi]", "\[Rule]", 
             FractionBox[
              RowBox[{"r", " ", 
               SuperscriptBox["TBloch", "2"]}], "2"]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"MatrixForm", "[", 
         RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
         RowBox[{
          RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
            RowBox[{"rr", "\[Rule]", "r"}], ",", " ", 
            RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", 
            RowBox[{
            "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]"}], ",", 
            RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"MatrixForm", "[", 
         RowBox[{"Ham1", "[", "t", "]"}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Clear", "[", 
         RowBox[{
         "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics",
           ",", " ", "cs"}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Psi]i", " ", "=", " ", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", "dim"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"rem", " ", "=", " ", 
         RowBox[{"Mod", "[", 
          RowBox[{"k0", ",", " ", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"low", " ", "=", " ", 
         RowBox[{"Floor", "[", 
          FractionBox["k0", "2"], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"high", " ", "=", " ", 
         RowBox[{"Ceiling", "[", 
          FractionBox["k0", "2"], "]"}]}], " ", ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
          RowBox[{"low", " ", "+", " ", 
           RowBox[{"(", 
            RowBox[{"lmax", " ", "+", "1"}], ")"}]}], 
          "\[RightDoubleBracket]"}], " ", "=", " ", 
         RowBox[{"Sqrt", "[", "rem", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
          RowBox[{"high", " ", "+", " ", 
           RowBox[{"(", 
            RowBox[{"lmax", " ", "+", "1"}], ")"}]}], 
          "\[RightDoubleBracket]"}], "=", " ", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "-", "rem"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
         RowBox[{"Table", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"nn", ",", 
             RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"cs", " ", "=", " ", 
         RowBox[{"Table", "[", " ", 
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"nn", ",", 
             RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"ics", " ", "=", " ", 
         RowBox[{"Table", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
            RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
             RowBox[{"nn", "+", 
              RowBox[{"(", 
               RowBox[{"lmax", "+", "1"}], ")"}]}], 
             "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"nn", ",", 
             RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"equation", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
          RowBox[{
           RowBox[{"-", "\[ImaginaryI]"}], " ", 
           RowBox[{
            RowBox[{"HamLoad", "[", "tt", "]"}], ".", 
            RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sol", " ", "=", " ", 
         RowBox[{"NDSolve", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
           RowBox[{"{", 
            RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "tt_", "]"}], ":=", 
         RowBox[{
          RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
          RowBox[{
          "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"\[Psi]iBloch", " ", "=", 
         RowBox[{"\[Psi]ci", "[", "tLoad", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Clear", "[", 
         RowBox[{
         "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics",
           ",", " ", "cs"}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
         RowBox[{"Table", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"nn", ",", 
             RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"cs", " ", "=", " ", 
         RowBox[{"Table", "[", " ", 
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"nn", ",", 
             RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        SuperscriptBox[
         RowBox[{"Abs", "[", "\[Psi]iBloch", "]"}], "2"], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"i1", " ", "=", "  ", 
         SuperscriptBox[
          RowBox[{"Norm", "[", 
           RowBox[{"\[Psi]iBloch", ".", 
            RowBox[{
             RowBox[{
              RowBox[{"Eigensystem", "[", 
               RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]",
               "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", 
             " ", "\[RightDoubleBracket]"}]}], "]"}], "2"]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"i2", " ", "=", "  ", 
         SuperscriptBox[
          RowBox[{"Norm", "[", 
           RowBox[{"\[Psi]iBloch", ".", 
            RowBox[{
             RowBox[{
              RowBox[{"Eigensystem", "[", 
               RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]",
               "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
             RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], 
           "]"}], "2"]}], ";", "\[IndentingNewLine]", 
        RowBox[{"i3", " ", "=", "  ", 
         SuperscriptBox[
          RowBox[{"Norm", "[", 
           RowBox[{"\[Psi]iBloch", ".", 
            RowBox[{
             RowBox[{
              RowBox[{"Eigensystem", "[", 
               RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]",
               "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
             RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], 
           "]"}], "2"]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ics", " ", "=", " ", 
         RowBox[{"Table", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
            RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
             RowBox[{"nn", "+", 
              RowBox[{"(", 
               RowBox[{"lmax", "+", "1"}], ")"}]}], 
             "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"nn", ",", 
             RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"equation", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
          RowBox[{
           RowBox[{"-", "\[ImaginaryI]"}], " ", 
           RowBox[{
            RowBox[{"Ham1", "[", "tt", "]"}], ".", 
            RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sol", " ", "=", " ", 
         RowBox[{"NDSolve", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
           RowBox[{"{", 
            RowBox[{"tt", ",", "0", ",", "TBloch"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
         RowBox[{
          RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
          RowBox[{
          "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ";", "\[IndentingNewLine]", 
        SuperscriptBox[
         RowBox[{"Abs", "[", 
          RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], "]"}], "2"], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Clear", "[", 
         RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
         RowBox[{"Table", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"nn", ",", 
             RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"cs", " ", "=", " ", 
         RowBox[{"Table", "[", " ", 
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"nn", ",", 
             RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"ics", " ", "=", " ", 
         RowBox[{"Table", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
            RowBox[{
             RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], "\[LeftDoubleBracket]", 
             RowBox[{"nn", "+", 
              RowBox[{"(", 
               RowBox[{"lmax", "+", "1"}], ")"}]}], 
             "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"nn", ",", 
             RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"equation", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
          RowBox[{
           RowBox[{"-", "\[ImaginaryI]"}], " ", 
           RowBox[{
            RowBox[{"HamUnLoad", "[", "tt", "]"}], ".", 
            RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sol", " ", "=", " ", 
         RowBox[{"NDSolve", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
           RowBox[{"{", 
            RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Psi]cff", "[", "tt_", "]"}], ":=", 
         RowBox[{
          RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
          RowBox[{
          "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"\[Psi]cf", " ", "=", " ", 
         RowBox[{"\[Psi]cff", "[", "tLoad", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"p1", " ", "=", "  ", 
         SuperscriptBox[
          RowBox[{"Norm", "[", 
           RowBox[{
            RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
            RowBox[{
             RowBox[{
              RowBox[{"Eigensystem", "[", 
               RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "\[LeftDoubleBracket]", "dim", " ", "\[RightDoubleBracket]"}]}], 
           "]"}], "2"]}], ";", "\[IndentingNewLine]", 
        RowBox[{"p2", " ", "=", "  ", 
         SuperscriptBox[
          RowBox[{"Norm", "[", 
           RowBox[{
            RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
            RowBox[{
             RowBox[{
              RowBox[{"Eigensystem", "[", 
               RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], 
           "]"}], "2"]}], ";", "\[IndentingNewLine]", 
        RowBox[{"p3", " ", "=", "  ", 
         SuperscriptBox[
          RowBox[{"Norm", "[", 
           RowBox[{
            RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
            RowBox[{
             RowBox[{
              RowBox[{"Eigensystem", "[", 
               RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], 
           "]"}], "2"]}], ";", "\[IndentingNewLine]", 
        RowBox[{"p1", "+", "p2", "+", "p3"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Return", " ", "population", " ", "in", " ", "correct", " ", 
          "states"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"Abs", "[", 
           RowBox[{"\[Psi]cf", "\[LeftDoubleBracket]", 
            RowBox[{"NBO", " ", "+", " ", 
             RowBox[{"(", 
              RowBox[{"lmax", " ", "+", " ", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}], "]"}], "2"], " ", "+", " ", 
         SuperscriptBox[
          RowBox[{"Abs", "[", 
           RowBox[{"\[Psi]cf", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"-", "NBO"}], " ", "+", " ", 
             RowBox[{"(", 
              RowBox[{"lmax", " ", "+", " ", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}], "]"}], "2"]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "The", " ", "module", " ", "above", " ", "now", " ", "needs", " ", "to", 
     " ", "be", " ", 
     RowBox[{"implemented", ".", " ", "We"}], " ", "can", " ", "sweep", " ", 
     "out", " ", "the", " ", "ramp", " ", "rate", " ", "and", " ", "the", " ",
      "lattice", " ", "depth", " ", "to", " ", "test", " ", "the", " ", 
     "efficiency"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]12", ",", "NBloch", ",", "k0", 
      ",", " ", "tLoad", ",", " ", "NRamps", ",", " ", "NLatDep"}], "]"}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NBloch", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NRamps", " ", "=", " ", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Exp", "[", "n", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", 
         RowBox[{"-", "3.5"}], ",", "4", ",", ".5"}], "}"}]}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NLatDep", " ", "=", " ", 
     RowBox[{"Table", "[", " ", 
      RowBox[{"n", " ", ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "1", ",", "16", ",", " ", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[CapitalDelta]\[Omega]", "0"], " ", "=", " ", "0"}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BlochEffFn", "[", "LatDep_", "]"}], ":=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"BlochBeamsplitterEfficiency", "[", 
        RowBox[{"LatDep", ",", "#", ",", "NBloch", ",", "k0", ",", " ", 
         RowBox[{"6", " ", "Pi"}], ",", " ", "0"}], "]"}], "&"}], ",", " ", 
      "NRamps"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"BlochEff", " ", "=", " ", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"BlochEffFn", "[", "#", "]"}], "&"}], ",", " ", "NLatDep"}], 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "pList", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Old", " ", "plotting", " ", "code", " ", "from", " ", 
       RowBox[{
       "matt", ":", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        "colors"}]}], " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
       "Blue", ",", "Red", ",", "Purple", ",", "Purple", ",", "Purple", ",", 
        "Purple"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pOpts", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Frame", "\[Rule]", "True"}], ",", 
        RowBox[{"FrameTicks", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Automatic", ",", "None"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Automatic", ",", "None"}], "}"}]}], "}"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "800"}], ",", 
        RowBox[{"FrameTicksStyle", "\[Rule]", 
         RowBox[{"Directive", "[", 
          RowBox[{"Black", ",", "16"}], "]"}]}], ",", 
        RowBox[{"FrameLabel", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Text", "[", 
            RowBox[{"Style", "[", 
             RowBox[{
             "\"\<\!\(\*SubscriptBox[\(U\), \
\(0\)]\)(\!\(\*SubscriptBox[\(E\), \(rec\)]\))\>\"", ",", "Black", ",", 
              "Bold", ",", "28"}], "]"}], "]"}], ",", 
           RowBox[{"Text", "[", 
            RowBox[{"Style", "[", 
             RowBox[{
             "\"\<Probability \[Eta]\>\"", ",", "Black", ",", "Bold", ",", 
              "28"}], "]"}], "]"}]}], "}"}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pInterp", "[", "j_", "]"}], ":=", " ", 
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Interpolation", "[", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"8", "*", "\[Kappa]s"}], ",", 
             RowBox[{
             "\[Eta]ijs", "\[LeftDoubleBracket]", "j", 
              "\[RightDoubleBracket]"}]}], "}"}], "]"}], "]"}], "[", 
         "\[Kappa]\[Kappa]", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Kappa]\[Kappa]", ",", "0", ",", 
          RowBox[{"8", "\[Kappa]F2Max"}]}], "}"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}]}], ",", 
        RowBox[{"PlotStyle", "\[Rule]", 
         RowBox[{"Directive", "[", 
          RowBox[{
           RowBox[{
           "colors", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
           ",", " ", 
           RowBox[{"Opacity", "[", "0.5", "]"}], ",", " ", "Dashed"}], 
          "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ptsProduct", " ", "=", " ", 
      RowBox[{"ListPlot", "[", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"8", "\[Kappa]s"}], ",", 
           RowBox[{
            RowBox[{
            "\[Eta]ijs", "\[LeftDoubleBracket]", "1", 
             "\[RightDoubleBracket]"}], "*", 
            RowBox[{
            "\[Eta]ijs", "\[LeftDoubleBracket]", "3", 
             "\[RightDoubleBracket]"}]}]}], "}"}], "]"}], ",", 
        RowBox[{"PlotStyle", "\[Rule]", 
         RowBox[{"Directive", "[", 
          RowBox[{"Black", ",", 
           RowBox[{"Opacity", "[", "1", "]"}]}], "]"}]}], ",", 
        RowBox[{"PlotMarkers", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"\[Wolf]", ",", "12"}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pList", "=", 
      RowBox[{"ListPlot", "[", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"NRamps", ",", "BlochEff"}], "}"}], "]"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.7418815452281647`*^9, 3.741881618858805*^9}, {
   3.741881671086541*^9, 3.741881716696693*^9}, {3.741881752160838*^9, 
   3.74188178489005*^9}, {3.741881967325671*^9, 3.741882082986882*^9}, {
   3.741882161091339*^9, 3.741882180164667*^9}, {3.741882212985139*^9, 
   3.7418822136081486`*^9}, {3.741882244025753*^9, 3.741882278689544*^9}, {
   3.7418823623896413`*^9, 3.741882500932417*^9}, {3.74188253597342*^9, 
   3.741882679259897*^9}, {3.741882734993167*^9, 3.741882741513494*^9}, {
   3.7418828209548473`*^9, 3.7418828782243166`*^9}, {3.7418831296626005`*^9, 
   3.7418832134396043`*^9}, {3.741883261697014*^9, 3.7418833212463512`*^9}, {
   3.741883478696267*^9, 3.7418835580660353`*^9}, {3.741883614782113*^9, 
   3.7418837192258167`*^9}, {3.741883821715001*^9, 3.7418838465074773`*^9}, {
   3.7418839626694655`*^9, 3.741883983629427*^9}, 3.741942077031226*^9, 
   3.741944279823856*^9, {3.741944389229206*^9, 3.741944420986409*^9}, {
   3.741944485325745*^9, 3.74194451582856*^9}, {3.741944563749442*^9, 
   3.7419446721348047`*^9}, 3.741944717715289*^9, {3.7419448268427944`*^9, 
   3.7419448288784733`*^9}, {3.7419449303595333`*^9, 
   3.7419449428278074`*^9}, {3.741945034647667*^9, 3.7419452213739862`*^9}, {
   3.7419453411898766`*^9, 3.741945341602253*^9}, {3.7419453943490353`*^9, 
   3.7419453958519993`*^9}, {3.7419457073146434`*^9, 3.741945720312786*^9}, {
   3.741945852665106*^9, 3.7419458769688263`*^9}, 3.741946052648031*^9, 
   3.7419495172284713`*^9, 3.741949568896909*^9, {3.741949614068632*^9, 
   3.741949666251521*^9}, {3.741949807911152*^9, 3.7419498108296385`*^9}, {
   3.741950020868823*^9, 3.7419501598801928`*^9}, {3.7419502913932886`*^9, 
   3.741950291932275*^9}, {3.741950412847595*^9, 3.7419504132882233`*^9}, {
   3.7419505057793026`*^9, 3.7419505072622027`*^9}, {3.7419505498129086`*^9, 
   3.7419505585715637`*^9}, {3.741950595164336*^9, 3.7419505956455297`*^9}, {
   3.741951053274946*^9, 3.741951056141962*^9}, 3.7419511105095186`*^9, {
   3.7419512101203613`*^9, 3.7419512214109974`*^9}, {3.741951291824642*^9, 
   3.741951297716751*^9}, {3.7419514230491004`*^9, 3.741951450141926*^9}, {
   3.74195151454677*^9, 3.741951655892046*^9}, {3.741951736341807*^9, 
   3.741951775960843*^9}, {3.741951812375228*^9, 3.741951825119231*^9}, {
   3.7419521447240973`*^9, 3.7419521744375725`*^9}, {3.741953326652159*^9, 
   3.7419533425413456`*^9}, {3.7419539366029634`*^9, 
   3.7419539680390882`*^9}, {3.741954063747334*^9, 3.7419540640494647`*^9}, {
   3.7419541562459*^9, 3.741954160011956*^9}, {3.741976161093671*^9, 
   3.741976161123312*^9}, {3.74216749840306*^9, 3.742167521377059*^9}, {
   3.7423933645593634`*^9, 3.7423933870665436`*^9}, {3.7423934287866497`*^9, 
   3.742393432508827*^9}, {3.7423940643688583`*^9, 3.7423940772546754`*^9}, {
   3.742394113456526*^9, 3.742394149018551*^9}, {3.7423942003607388`*^9, 
   3.742394200530285*^9}, {3.742394282951422*^9, 3.742394284340479*^9}, {
   3.7423943215944185`*^9, 3.742394352962783*^9}, {3.7423945355406947`*^9, 
   3.7423945524187174`*^9}, {3.7426496502506533`*^9, 
   3.7426496505630794`*^9}, {3.7426496981691236`*^9, 3.742649698325339*^9}, {
   3.7428194894313602`*^9, 3.742819522014397*^9}, {3.7428195532949286`*^9, 
   3.7428196407976966`*^9}, {3.7428196782302194`*^9, 
   3.7428197996623173`*^9}, {3.742864849868371*^9, 3.742865065719782*^9}, {
   3.7428651016222315`*^9, 3.7428651025145893`*^9}, {3.7428654320804405`*^9, 
   3.7428654392453537`*^9}, {3.7428655619177084`*^9, 3.742865565319542*^9}, {
   3.7428656160065393`*^9, 3.7428656166527395`*^9}, {3.742865803509218*^9, 
   3.7428658166497602`*^9}, {3.742865933993359*^9, 3.742865940101988*^9}, {
   3.7428660933656483`*^9, 3.74286613611241*^9}, {3.742867264078724*^9, 
   3.742867271718955*^9}, {3.7428673352507*^9, 3.7428673906408987`*^9}, {
   3.7428674244532795`*^9, 3.742867428922534*^9}, {3.7428674962732964`*^9, 
   3.7428675172818427`*^9}, {3.7428675624916525`*^9, 3.742867573875573*^9}, {
   3.7428681769055634`*^9, 3.7428681883743134`*^9}, {3.7428682350224886`*^9, 
   3.7428685325490403`*^9}, {3.74286869913986*^9, 3.742868823733999*^9}, {
   3.7428691213274403`*^9, 3.7428691411243153`*^9}, {3.7428701131872406`*^9, 
   3.742870122514867*^9}, {3.742871314501204*^9, 3.7428713183909197`*^9}, 
   3.7428742569649887`*^9, {3.742874318595728*^9, 3.742874385923684*^9}, {
   3.7428744651783695`*^9, 3.742874472604374*^9}, {3.742874648565053*^9, 
   3.742874664392881*^9}, {3.743804365694183*^9, 3.74380437126894*^9}, {
   3.743804532244052*^9, 3.7438045836860313`*^9}, {3.7438046775025544`*^9, 
   3.743804683529937*^9}, {3.743804742279564*^9, 3.7438048337979546`*^9}, {
   3.7467586385255218`*^9, 3.746758651775528*^9}, 3.7467586993173304`*^9, {
   3.746758752878418*^9, 3.7467587620102177`*^9}, {3.746758832460474*^9, 
   3.7467588353797297`*^9}, 3.7467588691489096`*^9, {3.746758904142888*^9, 
   3.746758994103366*^9}, {3.7467591245254936`*^9, 3.7467591582928143`*^9}, 
   3.746759202419325*^9, {3.746759337148718*^9, 3.7467593539180512`*^9}, {
   3.746759397248374*^9, 3.7467594213580694`*^9}, {3.7467595315305796`*^9, 
   3.7467595316175137`*^9}, {3.746760266380872*^9, 3.746760270431086*^9}, {
   3.7467607609301863`*^9, 3.746760772377617*^9}, {3.7467616189569817`*^9, 
   3.7467616193697643`*^9}, {3.7467618502670784`*^9, 3.74676185448419*^9}, {
   3.7467643948630905`*^9, 3.746764397920916*^9}, {3.747507455606583*^9, 
   3.7475075120895433`*^9}, 3.747507604985359*^9, {3.7475093497176275`*^9, 
   3.747509384260271*^9}, {3.747509415852151*^9, 3.7475094160675764`*^9}, {
   3.7475117278295555`*^9, 3.7475117279213104`*^9}, {3.7475381385838633`*^9, 
   3.747538156929618*^9}, {3.747610554497363*^9, 3.7476105745027266`*^9}, {
   3.7476124235843244`*^9, 3.7476124237450647`*^9}, {3.7476162190574694`*^9, 
   3.747616220081843*^9}, {3.7530324077115364`*^9, 3.753032425551486*^9}, 
   3.7530324690239325`*^9, 3.7530325228974166`*^9, {3.7530325531604776`*^9, 
   3.753032556865065*^9}, {3.753033390770291*^9, 3.7530334274609747`*^9}, {
   3.753033537225483*^9, 3.7530335718817453`*^9}, {3.753033629759987*^9, 
   3.75303364032329*^9}, {3.7530336938631973`*^9, 3.753033700378834*^9}, 
   3.7530534819529696`*^9},ExpressionUUID->"b1ce8f62-9769-4d88-87e5-\
96b26006a05e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Now", " ", "plot", " ", "the", " ", "results", " ", "of", " ", "the", " ",
     "previous", " ", "block", " ", "of", " ", "code"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"NumEl", " ", "=", " ", 
     RowBox[{"Length", "[", "BlochEff", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NRampsList", " ", "=", " ", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"NRamps", ",", " ", "NumEl"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"temp", " ", "=", " ", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"NRampsList", ",", " ", "BlochEff"}], "}"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Pairs", " ", "=", " ", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", " ", "NumEl"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"i", "=", "1"}], ",", 
     RowBox[{"i", "\[LessEqual]", "NumEl"}], ",", 
     RowBox[{"i", "++"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{
       "Pairs", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], " ", 
       "=", " ", 
       RowBox[{"Transpose", "[", 
        RowBox[{
        "temp", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
        "]"}]}], ";"}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"Pairs", ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"a", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"b", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"c", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "3", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"d", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"e", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "5", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"f", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "6", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"g", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "7", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"h", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "8", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"aa", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "9", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bb", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "10", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cc", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "11", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dd", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "12", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ee", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "13", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ff", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "14", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gg", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "15", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"hh", " ", "=", " ", 
     RowBox[{"Pairs", "[", 
      RowBox[{"[", "16", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"k", " ", "=", " ", 
      RowBox[{"Pairs", "[", 
       RowBox[{"[", "9", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"l", " ", "=", " ", 
      RowBox[{"Pairs", "[", 
       RowBox[{"[", "10", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"m", " ", "=", " ", 
      RowBox[{"Pairs", "[", 
       RowBox[{"[", "11", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n", " ", "=", " ", 
      RowBox[{"Pairs", "[", 
       RowBox[{"[", "12", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Black", ",", " ", "Purple", ",", " ", "Blue", ","}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"colors", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "Black", ",", " ", "Purple", ",", " ", "Blue", ",", "Green", ",", 
       "Yellow", ",", "Orange", ",", "Red", ",", " ", "Pink", ",", "Black", 
       ",", " ", "Purple", ",", " ", "Blue", ",", "Green", ",", "Yellow", ",",
        "Orange", ",", "Red", ",", " ", "Pink"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"colors", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
       "Black", ",", " ", "Purple", ",", " ", "Blue", ",", "Green", ",", 
        "Yellow", ",", "Orange", ",", "Red", ",", " ", "Pink"}], "}"}]}], 
     ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"legend", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "\"\<N=1\>\"", ",", "\"\<N=2\>\"", ",", "\"\<N=3\>\"", ",", 
       "\"\<N=4\>\"", ",", "\"\<N=5\>\"", ",", "\"\<N=6\>\"", ",", 
       "\"\<N=7\>\"", ",", "\"\<N=8\>\"", ",", "\"\<N=9\>\"", ",", 
       "\"\<N=10\>\"", ",", "\"\<N=11\>\"", ",", "\"\<N=12\>\"", ",", 
       "\"\<N=13\>\"", ",", " ", "\"\<N=14\>\"", ",", " ", "\"\<N=15\>\"", 
       ",", " ", "\"\<N=16\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"label", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{"\"\<Efficiency\>\"", ",", " ", "Larger"}], "]"}], ",", 
         "\"\<\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
          "\"\<Ramp rate r' (dimensionless)\>\"", ",", " ", "Larger"}], "]"}],
          ",", " ", "\"\<\>\""}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pInterp", "=", " ", 
      RowBox[{"LogLinearPlot", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Interpolation", "[", "Pairs", "]"}], "[", 
         "\[Kappa]\[Kappa]", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Kappa]\[Kappa]", ",", 
          RowBox[{"Min", "[", "NRamps", "]"}], ",", 
          RowBox[{"Max", "[", "NRamps", "]"}]}], "}"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}]}], ",", 
        RowBox[{"PlotStyle", "\[Rule]", 
         RowBox[{"Directive", "[", 
          RowBox[{"colors", ",", " ", 
           RowBox[{"Opacity", "[", "0.5", "]"}], ",", " ", "Dashed"}], 
          "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pList", "=", 
      RowBox[{"ListLogLinearPlot", "[", 
       RowBox[{"Pairs", ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}]}], ",", "  ", 
        RowBox[{"PlotStyle", "\[Rule]", 
         RowBox[{"Directive", "[", 
          RowBox[{"colors", ",", " ", 
           RowBox[{"Opacity", "[", "0.8", "]"}]}], "]"}]}]}], "]"}]}], ";"}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{",", " ", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"aa", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}], ",", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"bb", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}], ",", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"cc", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}], ",", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"dd", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}], " ", ",", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"ee", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}], ",", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"ff", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}], ",", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"gg", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]",
      "\[IndentingNewLine]", ",", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"d", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}], " ", ",", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"e", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}], ",", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"f", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}], ",", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"g", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}], ",", 
     RowBox[{
      RowBox[{"Interpolation", "[", 
       RowBox[{"h", ",", " ", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
      "\[Kappa]\[Kappa]", "]"}]}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pInterp", "=", " ", 
     RowBox[{"LogLinearPlot", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"a", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"b", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"c", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"d", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], " ", ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"e", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"f", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"g", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"h", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", " ", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"aa", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"bb", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"cc", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"dd", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], " ", ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"ee", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"ff", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"gg", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{"hh", ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}], "[", 
          "\[Kappa]\[Kappa]", "]"}], ",", " ", ".7"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\[Kappa]\[Kappa]", ",", 
         RowBox[{"Min", "[", "NRamps", "]"}], ",", 
         RowBox[{"Max", "[", "NRamps", "]"}]}], "}"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], ",", 
       RowBox[{"PlotStyle", "\[Rule]", "colors"}], ",", " ", 
       RowBox[{"Frame", "\[Rule]", "True"}], ",", " ", 
       RowBox[{"FrameLabel", "\[Rule]", "label"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    ",", " ", "aa", ",", "bb", ",", "cc", ",", "dd", ",", "ee", ",", "ff", 
     ",", 
     RowBox[{"gg", "\[IndentingNewLine]", "d"}], ",", "e", ",", "f", ",", "g",
      ",", "h"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pList", "=", 
     RowBox[{"ListLogLinearPlot", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "d", ",", "e", ",", "f", ",", "g", ",", 
         "h", ",", " ", "aa", ",", "bb", ",", "cc", ",", "dd", ",", "ee", ",",
          "ff", ",", "gg", ",", " ", "hh"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], ",", "  ", 
       RowBox[{"PlotStyle", "\[Rule]", "colors"}], ",", " ", 
       RowBox[{"PlotLegends", "\[Rule]", "legend"}], ",", "  ", 
       RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", "  ", 
       RowBox[{"PlotLabel", "\[Rule]", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Bloch Beamsplitter Efficiency\>\"", ",", "Large"}], 
         "]"}]}], ",", " ", 
       RowBox[{"Frame", "\[Rule]", "True"}], ",", " ", 
       RowBox[{"FrameLabel", "\[Rule]", "label"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"{", 
     RowBox[{"Directive", "[", 
      RowBox[{"colors", ",", " ", 
       RowBox[{"Opacity", "[", "0.8", "]"}]}], "]"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"total", " ", "=", " ", 
    RowBox[{"Show", "[", 
     RowBox[{"pList", ",", " ", "pInterp"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
    "\"\<BlochBeamsplitterEfficienyGraph_12-5-18.png\>\"", ",", "total"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7419499188533235`*^9, 3.741949946046254*^9}, {
   3.74195196135802*^9, 3.7419519716489573`*^9}, {3.7419520406523247`*^9, 
   3.741952119125368*^9}, {3.7423965052518034`*^9, 3.742396507671402*^9}, 
   3.7428691477021637`*^9, {3.7428691850464787`*^9, 3.742869214483733*^9}, {
   3.742869291108431*^9, 3.7428694019840984`*^9}, {3.742869484281019*^9, 
   3.7428696332960997`*^9}, {3.7428696947808843`*^9, 3.742869810905887*^9}, {
   3.7428698682649326`*^9, 3.742870017593807*^9}, {3.7428700625310106`*^9, 
   3.7428700633433123`*^9}, {3.7428702581552715`*^9, 
   3.7428703456864567`*^9}, {3.742870375880578*^9, 3.7428703781769123`*^9}, {
   3.7428704361398735`*^9, 3.742870438358139*^9}, {3.742870545534895*^9, 
   3.7428705922197933`*^9}, {3.7428706223945436`*^9, 
   3.7428706587004366`*^9}, {3.742870730457132*^9, 3.7428708822473335`*^9}, 
   3.742871287541559*^9, 3.7428745318080225`*^9, {3.7428745803494186`*^9, 
   3.742874612015614*^9}, {3.7438048427177672`*^9, 3.7438048587731266`*^9}, {
   3.7438092511095314`*^9, 3.7438092548555727`*^9}, {3.746760481590665*^9, 
   3.7467604876167917`*^9}, {3.746760530553733*^9, 3.7467605742721567`*^9}, {
   3.7467606637951117`*^9, 3.7467606857620597`*^9}, {3.7467610597935743`*^9, 
   3.7467612371141605`*^9}, {3.74676128696996*^9, 3.7467613576680927`*^9}, {
   3.7467614095093193`*^9, 3.7467614320383368`*^9}, {3.7467614842784214`*^9, 
   3.746761502633269*^9}, {3.74676162731378*^9, 3.7467616899502883`*^9}, {
   3.746762018610392*^9, 3.7467620983143444`*^9}, {3.74676441478782*^9, 
   3.746764486316583*^9}, {3.746764777379855*^9, 3.7467649975123324`*^9}, {
   3.746765031755756*^9, 3.746765125393401*^9}, {3.74676521740646*^9, 
   3.746765260637868*^9}, {3.7467664113864145`*^9, 3.7467664176736045`*^9}, {
   3.7467665117708244`*^9, 3.746766629599078*^9}, {3.7467667050693336`*^9, 
   3.7467667404377823`*^9}, {3.746766778271619*^9, 3.746766791398572*^9}, {
   3.746766829046668*^9, 3.746766862647835*^9}, {3.7467668959787254`*^9, 
   3.7467672100694046`*^9}, {3.7475075504719253`*^9, 3.7475075650569296`*^9}, 
   3.7475083677734985`*^9, {3.7475085021460886`*^9, 3.747508542722927*^9}, {
   3.7475093382592583`*^9, 3.747509344105628*^9}, {3.7475114563563676`*^9, 
   3.747511692393298*^9}, {3.747525608534305*^9, 3.747525613900936*^9}, {
   3.747525653693757*^9, 3.7475256693433356`*^9}, {3.747526078627536*^9, 
   3.7475260828305335`*^9}, {3.747539022031183*^9, 3.747539057688203*^9}, {
   3.7475390950429306`*^9, 3.7475391091695695`*^9}, {3.7476123402850046`*^9, 
   3.7476124188302917`*^9}, {3.747616231650568*^9, 3.7476162323431864`*^9}, {
   3.7530530261868615`*^9, 3.753053281689206*^9}, {3.7530534458975163`*^9, 
   3.7530534527186604`*^9}},ExpressionUUID->"0f4e6e91-762d-49df-a3a8-\
9b7b9d69ac4e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Deriving Bloch Beamsplitter Hamiltonian", "Section",
 CellChangeTimes->{{3.7438093518481555`*^9, 
  3.743809379927377*^9}},ExpressionUUID->"d4c95dc4-4b31-45cc-909e-\
eff124e5a21e"],

Cell["\<\
First, we need to expand potential terms for multiple laser beams in vacuum. \
Let\[CloseCurlyQuote]s do 2 laser beams first. For the upgoing beams, we have \
sin(k1 x - w1 t) + sin(k2 x - w2 t), and for the downgoing we have sin(k1 x + \
w1 t) + sin(k2 x + w2 t). We should get two moving lattices with velocities \
+/-v:\
\>", "Text",
 CellChangeTimes->{{3.7427847542049274`*^9, 3.74278477062567*^9}, {
   3.7433391290737166`*^9, 3.7433391851346292`*^9}, {3.7433392470769176`*^9, 
   3.7433393283793507`*^9}, {3.7433400401922784`*^9, 3.74334006723228*^9}, {
   3.743341350959959*^9, 3.7433414596455483`*^9}, 
   3.743809384992441*^9},ExpressionUUID->"565693e2-08ad-43ef-8a2d-\
eb5bd2314c8c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ExpToTrig", "[", 
  RowBox[{"Expand", "[", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox["E", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k1", " ", "x"}], " ", "+", " ", 
          RowBox[{"w1", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k2", " ", "x"}], " ", "-", " ", 
          RowBox[{"w2", " ", "t"}]}], ")"}]}]], "  ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k1", " ", "x"}], " ", "+", " ", 
          RowBox[{"w1", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k2", " ", "x"}], " ", "-", " ", 
          RowBox[{"w2", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k1", " ", "x"}], " ", "-", " ", 
          RowBox[{"w1", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k2", " ", "x"}], " ", "+", " ", 
          RowBox[{"w2", " ", "t"}]}], ")"}]}]], "  ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k1", " ", "x"}], " ", "-", " ", 
          RowBox[{"w1", " ", "t"}]}], ")"}]}]], "+", " ", 
      SuperscriptBox["E", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k2", " ", "x"}], " ", "+", " ", 
          RowBox[{"w2", " ", "t"}]}], ")"}]}]]}], ")"}], "2"], "]"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.7427847861256356`*^9, 3.7427849507505836`*^9}, {
  3.743339409947753*^9, 3.743339423701331*^9}, {3.743339556793105*^9, 
  3.743339595044503*^9}, {3.7433397410102634`*^9, 3.7433397411131363`*^9}, {
  3.7433398674396515`*^9, 3.7433399002670727`*^9}, {3.7433399405496416`*^9, 
  3.743340000340043*^9}, {3.743341299112197*^9, 3.743341321709239*^9}, {
  3.7433414202667875`*^9, 3.7433415020157976`*^9}, {3.7433453621905146`*^9, 
  3.743345370230032*^9}},ExpressionUUID->"c242f5b9-b83b-4a72-a5a5-\
a21ca8cee72c"],

Cell[TextData[{
 "Any high frequency terms drop out, so any 2 w1, 2 w2, w1+w2 terms. Also, \
any terms with (k1 - k2) will drop out because the length scale of the \
variation is much larger than any relevant length scale in the problem. We \
will then be left with:\n\n8+4 Cos[2 k1 x]+4 Cos[2 k2 x]+4 Cos[t w1-t w2-k1 \
x-k2 x]+4 Cos[t w1-t w2+k1 x+k2 x]\n\nSo we have the constant AC Stark shift \
term, two standing waves in the lab frame, cos(2 k1 x) and cos(2 k2 x), and \
the two traveling waves of speed ",
 Cell[BoxData[
  FormBox[
   FractionBox["\[CapitalDelta]\[Omega]", 
    RowBox[{"k1", "+", "k2"}]], TraditionalForm]],ExpressionUUID->
  "a68a8afe-9c9e-40a6-a4b1-384251dd68be"],
 "\n\nFor a Bloch beam-splitter, we need to use three frequencies. This will \
give us four moving lattices, two at +/-v1, and two at +/-v2."
}], "Text",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQB2IQbcrqsuj0o9eOJ1hubAPR/4Ltim49fu3oV/itGETL
Jc5sAdGTchI7QbRIyILZIPrCvMVgeoFg3moQfae7Yz2IXjVt4hYQradRuh9E
yxRtOwKiOawYroDVS75Lvg2kr0/XSgHRFmuPVoFoqSfna0D0jY8zO0H0NZ6P
fSD6k5bWVBB979OO6SB6i4frAhDtkhq8EERP+PttM4hOsQ7bB6Jfbbx2EUSb
mm25DqLX1P+/D5b/wPIQLJ+k8xJET0/IfQ0Wj/gfdxdIP1zZHw+ifxUxttwH
0joW6zpA9P7+utZHQPrR0iftIPpdSkgPiE5kVJwIoo99bJsNov999V4Eopls
tq0G0W8MMtaC6GeZAVtAdGiE7n4QDQDqKetj
  "],ExpressionUUID->"29f2d9bb-d28e-4e97-98aa-7bd41fcafe9c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ExpToTrig", "[", 
  RowBox[{"Expand", "[", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox["E", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k1", " ", "x"}], " ", "+", " ", 
          RowBox[{"w1", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k2", " ", "x"}], " ", "-", " ", 
          RowBox[{"w2", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k3", " ", "x"}], " ", "+", " ", 
          RowBox[{"w3", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k1", " ", "x"}], " ", "+", " ", 
          RowBox[{"w1", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k2", " ", "x"}], " ", "-", " ", 
          RowBox[{"w2", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k3", " ", "x"}], " ", "+", " ", 
          RowBox[{"w3", " ", "t"}]}], ")"}]}]], "+", 
      SuperscriptBox["E", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k1", " ", "x"}], " ", "-", " ", 
          RowBox[{"w1", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k2", " ", "x"}], " ", "+", " ", 
          RowBox[{"w2", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k3", " ", "x"}], " ", "-", " ", 
          RowBox[{"w3", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k1", " ", "x"}], " ", "-", " ", 
          RowBox[{"w1", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k2", " ", "x"}], " ", "+", " ", 
          RowBox[{"w2", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
      SuperscriptBox["E", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"k3", " ", "x"}], " ", "-", " ", 
          RowBox[{"w3", " ", "t"}]}], ")"}]}]]}], ")"}], "2"], "]"}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7427847861256356`*^9, 3.7427849507505836`*^9}, {
  3.743339409947753*^9, 3.743339423701331*^9}, {3.743339556793105*^9, 
  3.743339595044503*^9}, {3.7433397410102634`*^9, 3.7433397411131363`*^9}, {
  3.7433398674396515`*^9, 3.7433399002670727`*^9}, {3.7433399405496416`*^9, 
  3.7433400227637157`*^9}, {3.7433494704306746`*^9, 3.7433495064494324`*^9}, {
  3.7433565095161934`*^9, 
  3.743356522870982*^9}},ExpressionUUID->"ad685179-430c-43ae-a553-\
e8dfc73c741d"],

Cell["\<\
Again, we drop any high frequency terms and any ki-kj terms. We are left with:

12+4 Cos[2 k1 x]+4 Cos[2 k2 x]+4 Cos[2 k3 x]+4 Cos[t w1-t w2-k1 x-k2 x]+4 \
Cos[t w1-t w2+k1 x+k2 x]+4 Cos[t w1-t w3-k1 x-k3 x]++4 Cos[t w2-t w3-k2 x-k3 \
x]+4 Cos[t w1-t w3+k1 x+k3 x]+4 Cos[t w2-t w3+k2 x+k3 x]

Notice that we have w1 - w3 terms. If we start with a degenerate lattice of \
w1=w2=w3, then ramp w1 -> w2-wm, w3 -> w2+wm, then we will have w2-w1 = wm, \
w3-w2=wm, w3-w1 = 2wm. But we don\[CloseCurlyQuote]t want a lattice moving at \
2wm! That would kill our beamsplitter for sure. 

Suppose instead we have two polarizations in order to eliminate the w1 - w3 \
term. We put w1 and w2 on one polarization, and w2 and w3 on another. Then we \
get:\
\>", "Text",
 CellChangeTimes->{{3.7433565294869967`*^9, 3.743356595337192*^9}, {
  3.7433566282447505`*^9, 3.7433566300171337`*^9}, {3.743356666434765*^9, 
  3.7433566823134685`*^9}, {3.7433567178345985`*^9, 3.743356740591581*^9}, {
  3.7433830605754166`*^9, 3.7433831789534984`*^9}, {3.743385172838829*^9, 
  3.7433852173759804`*^9}},ExpressionUUID->"bf72c9e4-9367-4645-8dec-\
cb0244cc6dfd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ExpToTrig", "[", 
  RowBox[{"Expand", "[", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["E", 
        RowBox[{"\[ImaginaryI]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k1", " ", "x"}], " ", "+", " ", 
           RowBox[{"w1", " ", "t"}]}], ")"}]}]], " ", "+", "  ", 
       SuperscriptBox["E", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k1", " ", "x"}], " ", "+", " ", 
           RowBox[{"w1", " ", "t"}]}], ")"}]}]], " ", "+", "  ", 
       SuperscriptBox["E", 
        RowBox[{"\[ImaginaryI]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k2", " ", "x"}], " ", "-", " ", 
           RowBox[{"w2", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
       SuperscriptBox["E", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k2", " ", "x"}], " ", "-", " ", 
           RowBox[{"w2", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
       SuperscriptBox["E", 
        RowBox[{"\[ImaginaryI]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k1", " ", "x"}], " ", "-", "  ", 
           RowBox[{"w1", " ", "t"}]}], ")"}]}]], " ", "+", "  ", 
       SuperscriptBox["E", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k1", " ", "x"}], " ", "-", "  ", 
           RowBox[{"w1", " ", "t"}]}], ")"}]}]], " ", "+", "  ", 
       SuperscriptBox["E", 
        RowBox[{"\[ImaginaryI]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k2", " ", "x"}], " ", "+", " ", 
           RowBox[{"w2", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
       SuperscriptBox["E", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k2", " ", "x"}], " ", "+", " ", 
           RowBox[{"w2", " ", "t"}]}], ")"}]}]]}], ")"}], "2"], "+", 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["E", 
        RowBox[{"\[ImaginaryI]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k2", " ", "x"}], " ", "+", " ", 
           RowBox[{"w2", " ", "t"}]}], ")"}]}]], " ", "+", "  ", 
       SuperscriptBox["E", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k2", " ", "x"}], " ", "+", " ", 
           RowBox[{"w2", " ", "t"}]}], ")"}]}]], "+", " ", 
       SuperscriptBox["E", 
        RowBox[{"\[ImaginaryI]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k3", " ", "x"}], " ", "+", " ", 
           RowBox[{"w3", " ", "t"}]}], ")"}]}]], "   ", "+", " ", 
       SuperscriptBox["E", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k3", " ", "x"}], " ", "+", " ", 
           RowBox[{"w3", " ", "t"}]}], ")"}]}]], "+", 
       SuperscriptBox["E", 
        RowBox[{"\[ImaginaryI]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k2", " ", "x"}], " ", "-", " ", 
           RowBox[{"w2", " ", "t"}]}], ")"}]}]], "  ", "+", " ", 
       SuperscriptBox["E", 
        RowBox[{"\[ImaginaryI]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k3", " ", "x"}], " ", "-", " ", 
           RowBox[{"w3", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
       SuperscriptBox["E", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k2", " ", "x"}], " ", "-", " ", 
           RowBox[{"w2", " ", "t"}]}], ")"}]}]], " ", "+", " ", 
       SuperscriptBox["E", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"k3", " ", "x"}], " ", "-", " ", 
           RowBox[{"w3", " ", "t"}]}], ")"}]}]]}], ")"}], "2"]}], "]"}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.743381906828988*^9, 3.7433819344552803`*^9}, {
  3.7433819708542805`*^9, 3.7433820340480595`*^9}, {3.743382069935672*^9, 
  3.743382176167006*^9}, {3.7433822088717737`*^9, 3.743382250850351*^9}, {
  3.7433822978782253`*^9, 3.743382334838945*^9}, {3.7433825079427843`*^9, 
  3.743382532723714*^9}, {3.743382650274331*^9, 
  3.7433826729209785`*^9}},ExpressionUUID->"d3b6cb5c-7ba3-4db2-9972-\
836ae3d06a07"],

Cell[BoxData[
 RowBox[{"16", "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{"2", " ", "t", " ", "w1"}], "]"}]}], "+", 
  RowBox[{"8", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{"2", " ", "t", " ", "w2"}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{"2", " ", "t", " ", "w3"}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{"2", " ", "k1", " ", "x"}], "]"}]}], "+", 
  RowBox[{"8", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{"2", " ", "k2", " ", "x"}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{"2", " ", "k3", " ", "x"}], "]"}]}], "+", 
  RowBox[{"2", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"2", " ", "t", " ", "w1"}], "-", 
     RowBox[{"2", " ", "k1", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"2", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"2", " ", "t", " ", "w1"}], "+", 
     RowBox[{"2", " ", "k1", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"2", " ", "t", " ", "w2"}], "-", 
     RowBox[{"2", " ", "k2", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w1"}], "-", 
     RowBox[{"t", " ", "w2"}], "-", 
     RowBox[{"k1", " ", "x"}], "-", 
     RowBox[{"k2", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w1"}], "+", 
     RowBox[{"t", " ", "w2"}], "-", 
     RowBox[{"k1", " ", "x"}], "-", 
     RowBox[{"k2", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w1"}], "-", 
     RowBox[{"t", " ", "w2"}], "+", 
     RowBox[{"k1", " ", "x"}], "-", 
     RowBox[{"k2", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w1"}], "+", 
     RowBox[{"t", " ", "w2"}], "+", 
     RowBox[{"k1", " ", "x"}], "-", 
     RowBox[{"k2", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w1"}], "-", 
     RowBox[{"t", " ", "w2"}], "-", 
     RowBox[{"k1", " ", "x"}], "+", 
     RowBox[{"k2", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w1"}], "+", 
     RowBox[{"t", " ", "w2"}], "-", 
     RowBox[{"k1", " ", "x"}], "+", 
     RowBox[{"k2", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w1"}], "-", 
     RowBox[{"t", " ", "w2"}], "+", 
     RowBox[{"k1", " ", "x"}], "+", 
     RowBox[{"k2", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w1"}], "+", 
     RowBox[{"t", " ", "w2"}], "+", 
     RowBox[{"k1", " ", "x"}], "+", 
     RowBox[{"k2", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"2", " ", "t", " ", "w2"}], "+", 
     RowBox[{"2", " ", "k2", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"2", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"2", " ", "t", " ", "w3"}], "-", 
     RowBox[{"2", " ", "k3", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w2"}], "-", 
     RowBox[{"t", " ", "w3"}], "-", 
     RowBox[{"k2", " ", "x"}], "-", 
     RowBox[{"k3", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w2"}], "+", 
     RowBox[{"t", " ", "w3"}], "-", 
     RowBox[{"k2", " ", "x"}], "-", 
     RowBox[{"k3", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w2"}], "-", 
     RowBox[{"t", " ", "w3"}], "+", 
     RowBox[{"k2", " ", "x"}], "-", 
     RowBox[{"k3", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w2"}], "+", 
     RowBox[{"t", " ", "w3"}], "+", 
     RowBox[{"k2", " ", "x"}], "-", 
     RowBox[{"k3", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w2"}], "-", 
     RowBox[{"t", " ", "w3"}], "-", 
     RowBox[{"k2", " ", "x"}], "+", 
     RowBox[{"k3", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w2"}], "+", 
     RowBox[{"t", " ", "w3"}], "-", 
     RowBox[{"k2", " ", "x"}], "+", 
     RowBox[{"k3", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w2"}], "-", 
     RowBox[{"t", " ", "w3"}], "+", 
     RowBox[{"k2", " ", "x"}], "+", 
     RowBox[{"k3", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"t", " ", "w2"}], "+", 
     RowBox[{"t", " ", "w3"}], "+", 
     RowBox[{"k2", " ", "x"}], "+", 
     RowBox[{"k3", " ", "x"}]}], "]"}]}], "+", 
  RowBox[{"2", " ", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"2", " ", "t", " ", "w3"}], "+", 
     RowBox[{"2", " ", "k3", " ", "x"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7433830514990835`*^9, 
  3.743383052950398*^9}},ExpressionUUID->"ed0471a5-3e15-4f80-9f53-\
7d966099b217"],

Cell["\<\
Now we keep:

16+4 Cos[2 k1 x]+8 Cos[2 k2 x]+4 Cos[2 k3 x]+4 Cos[t w1-t w2-k1 x-k2 x]+4 \
Cos[t w1-t w2+k1 x+k2 x]+4 Cos[t w2-t w3-k2 x-k3 x]+4 Cos[t w2-t w3+k2 x+k3 x]

and this is the Hamiltonian that we want! Cool! Can I get the real and \
imaginary parts for Matlab? (Not finished)\
\>", "Text",
 CellChangeTimes->{{3.743382396747295*^9, 3.7433824861525483`*^9}, {
   3.7433825430847483`*^9, 3.743382559151355*^9}, {3.7433825942258344`*^9, 
   3.7433826194044347`*^9}, {3.7433826854269953`*^9, 3.743382701288081*^9}, 
   3.743382737749117*^9, {3.743382779542899*^9, 3.7433827957311096`*^9}, 
   3.7433828543434258`*^9, {3.743383216813569*^9, 3.7433832329081125`*^9}, {
   3.743428932985321*^9, 3.7434289440458565`*^9}, {3.7438095098382397`*^9, 
   3.7438095130524387`*^9}},ExpressionUUID->"a27a57cb-7b07-463d-8ad2-\
4d2589334955"],

Cell[BoxData[
 RowBox[{"Re", "[", 
  RowBox[{"TrigToExp", "[", 
   RowBox[{"16", "+", 
    RowBox[{"4", " ", 
     RowBox[{"Cos", "[", 
      RowBox[{"2", " ", "k1", " ", "x"}], "]"}]}], "+", 
    RowBox[{"8", " ", 
     RowBox[{"Cos", "[", 
      RowBox[{"2", " ", "k2", " ", "x"}], "]"}]}], "+", 
    RowBox[{"4", " ", 
     RowBox[{"Cos", "[", 
      RowBox[{"2", " ", "k3", " ", "x"}], "]"}]}], "+", 
    RowBox[{"4", " ", 
     RowBox[{"Cos", "[", 
      RowBox[{
       RowBox[{"t", " ", "w1"}], "-", 
       RowBox[{"t", " ", "w2"}], "-", 
       RowBox[{"k1", " ", "x"}], "-", 
       RowBox[{"k2", " ", "x"}]}], "]"}]}], "+", 
    RowBox[{"4", " ", 
     RowBox[{"Cos", "[", 
      RowBox[{
       RowBox[{"t", " ", "w1"}], "-", 
       RowBox[{"t", " ", "w2"}], "+", 
       RowBox[{"k1", " ", "x"}], "+", 
       RowBox[{"k2", " ", "x"}]}], "]"}]}], "+", 
    RowBox[{"4", " ", 
     RowBox[{"Cos", "[", 
      RowBox[{
       RowBox[{"t", " ", "w2"}], "-", 
       RowBox[{"t", " ", "w3"}], "-", 
       RowBox[{"k2", " ", "x"}], "-", 
       RowBox[{"k3", " ", "x"}]}], "]"}]}], "+", 
    RowBox[{"4", " ", 
     RowBox[{"Cos", "[", 
      RowBox[{
       RowBox[{"t", " ", "w2"}], "-", 
       RowBox[{"t", " ", "w3"}], "+", 
       RowBox[{"k2", " ", "x"}], "+", 
       RowBox[{"k3", " ", "x"}]}], "]"}]}]}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7434289596370587`*^9, 3.7434289862953825`*^9}, {
  3.743429069985957*^9, 3.743429093832347*^9}, {3.7434293990328693`*^9, 
  3.7434294019451447`*^9}},ExpressionUUID->"05ecaeb9-0aaa-4e31-8f56-\
b489fb460e5c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Real", " ", "part"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"16", " ", "+", " ", 
   RowBox[{"4", "cos", 
    RowBox[{"(", 
     RowBox[{"k1", " ", "x"}], ")"}]}], " ", "+", " ", 
   RowBox[{"8", "cos", 
    RowBox[{"(", 
     RowBox[{"k2", " ", "x"}], ")"}]}], " ", "+", " ", 
   RowBox[{"4", "cos", 
    RowBox[{"(", 
     RowBox[{"k3", " ", "x"}], ")"}], " "}]}]}]], "Input",
 CellChangeTimes->{{3.7434294084496756`*^9, 3.743429494795151*^9}, {
  3.743809524417184*^9, 
  3.743809525977334*^9}},ExpressionUUID->"bca8c146-823a-4881-aaad-\
3df526d3245a"],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{{3.745617108225157*^9, 3.74561713110808*^9}, {
   3.745617235180022*^9, 3.745617354532934*^9}, {3.7456174012153845`*^9, 
   3.745617423993513*^9}, {3.7456174995783186`*^9, 3.745617546087549*^9}, {
   3.7456176133574066`*^9, 3.7456176151852903`*^9}, {3.745618840788312*^9, 
   3.7456188410207167`*^9}, 
   3.7458735135233345`*^9},ExpressionUUID->"f91bacbb-96d1-4778-a3a2-\
e16fdc7bc613"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7458735158386087`*^9, 
  3.745873515854829*^9}},ExpressionUUID->"b560eb49-e4bc-44b6-86d1-\
50b6a219dd4a"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7456174297688646`*^9, 3.745617473090497*^9}, {
   3.745617651116115*^9, 3.745617652747794*^9}, {3.7456176871269536`*^9, 
   3.745617710247054*^9}, {3.7456177452901936`*^9, 3.7456177557787876`*^9}, 
   3.7458735193372755`*^9},ExpressionUUID->"e8f59a99-5b2d-433b-ba6c-\
be02c1b1ed3e"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.745873522360489*^9, 
  3.7458735223660393`*^9}},ExpressionUUID->"fb4565f4-f948-43c4-9591-\
70d7bd839a45"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7458735213716545`*^9, 
  3.745873525601345*^9}},ExpressionUUID->"44e91a39-e865-40d5-8996-\
d86b6139d174"]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "Trying something crazy... double dimension of Hamiltonian, treat ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Psi]", "L"], TraditionalForm]],ExpressionUUID->
  "7205b9e3-e769-4d6d-aa82-96aa039d5e85"],
 " and ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Psi]", "R"], TraditionalForm]],ExpressionUUID->
  "23e936ff-8d00-41b4-b338-d42f9c410b4f"],
 " separately"
}], "Section",
 CellChangeTimes->{{3.7458735352330327`*^9, 3.7458735514335012`*^9}, {
  3.7480607699942155`*^9, 3.7480607755767374`*^9}, {3.7481903199792223`*^9, 
  3.7481903605580816`*^9}},ExpressionUUID->"f6ae40a7-c774-4579-ab40-\
8ebb998d2234"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rGrav", " ", "=", " ", "0.8576"}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
     "This", " ", "is", " ", "the", " ", "dimensionless", " ", "value", " ", 
      "for", " ", "r"}], " ", "=", " ", 
     RowBox[{"23", " ", 
      RowBox[{"kHz", "/", "ms"}], " ", "converted", " ", "with", " ", "a", 
      " ", "factor", " ", "of", " ", "2", " ", "\[Pi]", " ", "x", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"2.066", " ", "kHz"}], ")"}], "^", "2."}], " ", "We", " ", 
      "need", " ", "to", " ", "convert", " ", "both", " ", 
      RowBox[{"1", "/", "s"}], " ", "units"}]}], ",", " ", 
    RowBox[{
    "but", " ", "the", " ", "23", " ", "KHz", " ", "number", " ", "is", " ", 
     "in", " ", "Hz"}], ",", " ", 
    RowBox[{"not", " ", 
     RowBox[{"radians", "/", "s"}]}], ",", " ", 
    RowBox[{
    "so", " ", "we", " ", "only", " ", "need", " ", "one", " ", "factor", " ",
      "of", " ", 
     RowBox[{"pi", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "NLatDep", " ", "is", " ", "the", " ", "lattice", " ", "depth", " ", "in",
      " ", "units", " ", "of", " ", 
     SubscriptBox["E", "r"]}], ",", " ", 
    RowBox[{"as", " ", "defined", " ", 
     RowBox[{"above", ".", " ", "NRamp"}], " ", "is", " ", "the", " ", "ramp",
      " ", "rate", " ", "in", " ", "units", " ", "of", " ", "gravity", " ", 
     "ramp", " ", "rate"}], ",", " ", 
    RowBox[{
    "NBloch", " ", "is", " ", "the", " ", "number", " ", "of", " ", "Bloch", 
     " ", "oscillations", " ", "to", " ", "do"}], ",", " ", 
    RowBox[{
    "and", " ", "therefore", " ", "gives", " ", "the", " ", "duration", " ", 
     "of", " ", "the", " ", "ramp"}], ",", " ", 
    RowBox[{
    "k0", " ", "is", " ", "the", " ", "initial", " ", "quasimomentum", " ", 
     "when", " ", "atoms", " ", "are", " ", "loaded", " ", "into", " ", "the",
      " ", "lattice"}], ",", " ", 
    RowBox[{
    "and", " ", "tLoad", " ", "is", " ", "the", " ", "time", " ", "taken", 
     " ", "to", " ", "load", " ", "atoms", " ", "into", " ", "the", " ", 
     "lattice", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"assumed", " ", "linear", " ", "intensity", " ", "ramp"}], 
       ")"}], "."}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NLatDep", " ", "=", " ", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NBloch", " ", "=", " ", "6"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NRamp", " ", "=", " ", ".3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"v0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tLoad", " ", "=", " ", 
    RowBox[{"2", " ", "Pi"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Variables", " ", "for", " ", "simulation"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"k0", " ", "=", " ", "0"}], ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n0", " ", "=", " ", 
   FractionBox[
    RowBox[{"v0", " ", "-", " ", "k0"}], "2"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalDelta]\[Omega]", " ", "=", " ", 
   RowBox[{"8", " ", "n0"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Kappa]", " ", "=", " ", 
   FractionBox["NLatDep", "8"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"r", " ", "=", " ", 
   RowBox[{"NRamp", "*", "rGrav"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlochPeriod", " ", "=", " ", 
   FractionBox["8", "r"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TBloch", " ", "=", " ", 
    RowBox[{"BlochPeriod", " ", "*", " ", "NBloch"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lmax", " ", "=", " ", 
    RowBox[{"Max", "[", 
     RowBox[{"10", ",", 
      RowBox[{"Round", "[", 
       RowBox[{"5.", "*", 
        SuperscriptBox["NLatDep", 
         RowBox[{"1", "/", "4"}]]}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dim", " ", "=", " ", 
    RowBox[{"2", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"lmax", "*", "2"}], "+", "1"}], ")"}]}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "This", " ", "loadLattice", " ", "module", " ", "creates", " ", "the", 
     " ", "initial", " ", "state", " ", "and", " ", "loads", " ", "it", " ", 
     "into", " ", "the", " ", 
     RowBox[{"lattice", ".", " ", "It"}], " ", "takes", " ", "in", " ", "an", 
     " ", "initial", " ", "free", " ", "space", " ", "momentum", " ", "state",
      " ", "n0", " ", "for", " ", "a", " ", "wavefunction"}], ",", " ", 
    RowBox[{
    "size", " ", "of", " ", "the", " ", "hamiltonian", " ", "being", " ", 
     "simulated"}], ",", " ", 
    RowBox[{"time", " ", "to", " ", "load", " ", "lattice"}], ",", " ", 
    RowBox[{
    "and", " ", "a", " ", "load", " ", "hamiltonian", " ", "which", " ", "is",
      " ", "a", " ", "function", " ", "of", " ", 
     RowBox[{"time", ".", " ", "It"}], " ", "solves", " ", "the", " ", 
     "Schrodinger", " ", "equation", " ", "for", " ", "\[IndentingNewLine]", 
     "the", " ", "wave", " ", "function", " ", "while", " ", "loading", " ", 
     "the", " ", "atom", " ", "into", " ", "the", " ", "lattice", "  ", "and",
      " ", "returns", " ", "this", " ", "wave", " ", 
     RowBox[{"function", "."}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"loadLattice", "[", 
    RowBox[{
    "lMax_", ",", " ", "nn0_", ",", " ", "tLoad_", ",", " ", "loadHam_"}], 
    "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
       RowBox[{"n0", " ", "=", " ", "nn0"}], ",", " ", 
       RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
       RowBox[{"HamLoad", " ", "=", " ", "loadHam"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{
       "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
        ",", " ", "cs"}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"dimState", " ", "=", " ", 
       RowBox[{"2", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", "*", "maxL"}], " ", "+", " ", "1"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Psi]i", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", "dimState"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
        RowBox[{"n0", " ", "+", " ", "maxL", "+", "1"}], 
        "\[RightDoubleBracket]"}], " ", "=", " ", 
       FractionBox["1", 
        RowBox[{"Sqrt", "[", "2", "]"}]]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
        RowBox[{"n0", " ", "+", " ", 
         RowBox[{"3", 
          RowBox[{"(", 
           RowBox[{"maxL", "+", "1"}], ")"}]}], "-", "1"}], 
        "\[RightDoubleBracket]"}], " ", "=", " ", 
       FractionBox["1", 
        RowBox[{"Sqrt", "[", "2", "]"}]]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", "1", ",", 
           RowBox[{"2", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", " ", "maxL"}], " ", "+", " ", "1"}], ")"}]}], ",", 
           "1"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", "1", ",", 
           RowBox[{"2", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", " ", "maxL"}], " ", "+", " ", "1"}], ")"}]}], ",", 
           "1"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{
          "\[Psi]i", "\[LeftDoubleBracket]", "nn", 
           "\[RightDoubleBracket]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", "1", ",", 
           RowBox[{"2", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", " ", "maxL"}], " ", "+", " ", "1"}], ")"}]}], ",", 
           "1"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"equation", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{"HamLoad", "[", "tt", "]"}], ".", 
          RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
         RowBox[{"{", 
          RowBox[{"tt", ",", "0", ",", "loadTime"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]cii", "[", "tt_", "]"}], "=", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
        RowBox[{
        "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[Psi]cii"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "unloadLattice", " ", "is", " ", "a", " ", "module", " ", "that", " ", 
     "takes", " ", "in", " ", "the", " ", "size", " ", "of", " ", "the", " ", 
     "hamiltonian", " ", "being", " ", "simulated"}], ",", " ", 
    RowBox[{
    "the", " ", "time", " ", "taken", " ", "to", " ", "unload", " ", "the", 
     " ", "atoms", " ", 
     RowBox[{"(", 
      RowBox[{
      "assumed", " ", "to", " ", "be", " ", "the", " ", "same", " ", "as", 
       " ", "the", " ", "load", " ", "time"}], ")"}]}], ",", " ", 
    RowBox[{
    "the", " ", "unload", " ", "hamiltonian", " ", "as", " ", "a", " ", 
     "function", " ", "of", " ", "time"}], ",", " ", 
    RowBox[{"and", " ", "the", " ", "state", " ", "to", " ", "be", " ", 
     RowBox[{"unloaded", ".", " ", "It"}], " ", "returns", " ", "the", " ", 
     "state", " ", "evolution", " ", "during", " ", "unload"}], ",", " ", 
    RowBox[{"so", " ", 
     RowBox[{"\[Psi]ci", "[", "tLoad", "]"}], " ", "is", " ", "the", " ", 
     "final", " ", "free", " ", "space", " ", 
     RowBox[{"wavefunction", "."}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"unLoadLattice", "[", 
    RowBox[{
    "lMax_", ",", " ", "tLoad_", ",", " ", "unLoadHam_", ",", " ", 
     "\[Psi]ci_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
       RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
       RowBox[{"HamUnLoad", " ", "=", " ", "unLoadHam"}], ",", " ", 
       RowBox[{"\[Psi]i", "=", " ", "\[Psi]ci"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", "1", ",", " ", 
           RowBox[{"2", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", " ", "maxL"}], " ", "+", " ", "1"}], ")"}]}], ",", 
           "1"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", "1", ",", " ", 
           RowBox[{"2", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", " ", "maxL"}], " ", "+", " ", "1"}], ")"}]}], ",", 
           "1"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{
          "\[Psi]i", "\[LeftDoubleBracket]", "nn", 
           "\[RightDoubleBracket]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", "1", ",", 
           RowBox[{"2", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", " ", "maxL"}], " ", "+", " ", "1"}], ")"}]}], ",", 
           "1"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"equation", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{"HamUnLoad", "[", "tt", "]"}], ".", 
          RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
         RowBox[{"{", 
          RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]cff", "[", "tt_", "]"}], "=", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
        RowBox[{
        "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[Psi]cff"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Define", " ", 
     RowBox[{"Hamiltonian", ".", " ", "The"}], " ", "base", " ", 
     "hamiltonian", " ", "is", " ", 
     RowBox[{"Ham0", ".", " ", "I"}], " ", "then", " ", "specialize", " ", 
     "this", " ", "to", " ", "the", " ", "load", " ", "and", " ", "unload", 
     " ", "hamiltonians"}], ",", " ", 
    RowBox[{
    "and", " ", "the", " ", "main", " ", "hamiltonian", " ", "for", " ", "BO",
      " ", "is", " ", 
     RowBox[{"Ham1", "."}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"kl", "[", 
     RowBox[{"l_", ",", "v_"}], "]"}], ":=", 
    RowBox[{"v", "+", 
     RowBox[{"2", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"+", "4"}], " ", "\[Kappa]\[Kappa]"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ham0", " ", "[", 
    RowBox[{"t_", ",", "k_"}], "]"}], "=", " ", 
   RowBox[{"Normal", "[", 
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"kl", "[", 
            RowBox[{
             RowBox[{"l", " ", "-", " ", 
              RowBox[{"(", 
               RowBox[{"lmax", " ", "+", " ", "1"}], ")"}]}], ",", "k"}], 
            "]"}], "2"], " ", "/;", 
          RowBox[{"l", "<=", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", " ", "lmax"}], " ", "+", " ", "1"}], " ", 
            ")"}]}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"f_", ",", "f_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"kl", "[", 
            RowBox[{
             RowBox[{"f", " ", "-", " ", 
              RowBox[{"3", " ", 
               RowBox[{"(", 
                RowBox[{"lmax", " ", "+", " ", "1"}], ")"}]}], "+", "1"}], 
             ",", 
             RowBox[{"-", "k"}]}], "]"}], "2"], " ", "/;", 
          RowBox[{"f", ">", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", " ", "lmax"}], " ", "+", " ", "1"}], " ", 
            ")"}]}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", "\[Kappa]\[Kappa]"}], "/;", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"i", "-", "j"}], "]"}], "\[Equal]", "1"}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", "\[Kappa]\[Kappa]", " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"\[ImaginaryI]", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"rr", " ", 
                SuperscriptBox["t", "2"]}], " ", "+", " ", 
               RowBox[{"2", " ", "wm", " ", "t"}], " ", "+", " ", 
               RowBox[{"2", " ", "\[Phi]"}]}], ")"}]}], "]"}]}], "/;", 
          RowBox[{
           RowBox[{"a", "-", "b"}], "\[Equal]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", " ", "lmax"}], " ", "+", " ", "2"}], ")"}]}]}]}], 
        ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"v_", ",", "w_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", "\[Kappa]\[Kappa]", " ", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", "\[ImaginaryI]"}], " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"rr", " ", 
                SuperscriptBox["t", "2"]}], " ", "+", " ", 
               RowBox[{"2", " ", "wm", " ", "t"}], "+", " ", 
               RowBox[{"2", " ", "\[Phi]"}]}], ")"}]}], "]"}]}], "/;", 
          RowBox[{
           RowBox[{"w", "-", "v"}], "\[Equal]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", " ", "lmax"}], " ", "+", " ", "2"}], ")"}]}]}]}], 
        ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n_", ",", "m_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", "\[Kappa]\[Kappa]", " ", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", "\[ImaginaryI]"}], " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"rr", " ", 
                SuperscriptBox["t", "2"]}], " ", "+", " ", 
               RowBox[{"2", " ", "wm", " ", "t"}], "+", " ", 
               RowBox[{"2", " ", "\[Phi]"}]}], ")"}]}], "]"}]}], "/;", 
          RowBox[{
           RowBox[{"n", "-", "m"}], "\[Equal]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", " ", "lmax"}], " ", "+", " ", "0"}], ")"}]}]}]}], 
        ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x_", ",", "y_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", "\[Kappa]\[Kappa]", " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"\[ImaginaryI]", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"rr", " ", 
                SuperscriptBox["t", "2"]}], "+", 
               RowBox[{"2", " ", "wm", " ", "t"}], "+", " ", 
               RowBox[{"2", " ", "\[Phi]"}]}], ")"}]}], "]"}]}], "/;", 
          RowBox[{
           RowBox[{"y", "-", "x"}], "\[Equal]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", " ", "lmax"}], " ", "+", " ", "0"}], ")"}]}]}]}]}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HamLoad", "[", "t_", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"Ham0", "[", 
     RowBox[{"t", ",", "k0"}], "]"}], "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
       RowBox[{"\[Kappa]", " ", 
        FractionBox["t", "tLoad"]}]}], ",", " ", 
      RowBox[{"\[CapitalDelta]w", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
       ",", " ", 
      RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
      RowBox[{"wm", "\[Rule]", "0"}], ",", " ", 
      RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HamUnLoad", "[", "tt_", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"Ham0", "[", 
     RowBox[{"tt", ",", 
      RowBox[{"k0", "-", 
       FractionBox[
        RowBox[{"r", " ", "TBloch"}], "4"]}]}], "]"}], "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
       RowBox[{"\[Kappa]", " ", 
        RowBox[{"(", 
         FractionBox[
          RowBox[{"tLoad", " ", "-", " ", "tt"}], "tLoad"], ")"}]}]}], ",", 
      "  ", 
      RowBox[{"\[CapitalDelta]w", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
       ",", " ", 
      RowBox[{"rr", "\[Rule]", " ", "0"}], ",", " ", 
      RowBox[{"wm", " ", "\[Rule]", " ", 
       RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
      RowBox[{"\[Phi]", "\[Rule]", " ", 
       RowBox[{"r", " ", 
        FractionBox[
         SuperscriptBox["TBloch", "2"], "2"]}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Ham1", "[", "tt_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Ham0", "[", 
      RowBox[{"tt", ",", 
       RowBox[{"k0", "-", 
        FractionBox[
         RowBox[{"r", " ", "tt"}], "4"]}]}], "]"}], "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", "  ", 
       RowBox[{
       "\[CapitalDelta]w", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], ",", 
       " ", 
       RowBox[{"rr", "\[Rule]", "r"}], ",", " ", 
       RowBox[{"wm", "\[Rule]", "0"}], ",", " ", 
       RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Returns", " ", "the", " ", "main", " ", "Hamiltonian", " ", "in", " ", 
    "matrix", " ", "form"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MatrixForm", "[", 
   RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"load", " ", "lattice"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
    RowBox[{"loadLattice", "[", 
     RowBox[{"lmax", ",", " ", "n0", ",", " ", "tLoad", ",", " ", "HamLoad"}],
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Return", " ", "the", " ", "amplitude", " ", "squared", " ", "after", " ", 
    "loading"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  SuperscriptBox[
   RowBox[{"Abs", "[", 
    RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], "]"}], "2"], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Now", ",", " ", 
    RowBox[{
    "set", " ", "up", " ", "NDSolve", " ", "to", " ", "solve", " ", "the", 
     " ", "Schrodinger", " ", "equation", " ", "for", " ", "Bloch", " ", 
     "oscillations"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", "1", ",", 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", " ", "lmax"}], " ", "+", " ", "1"}], ")"}]}], ",", 
       "1"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cs", " ", "=", " ", 
    RowBox[{"Table", "[", " ", 
     RowBox[{
      RowBox[{"ci", "[", "nn", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"nn", ",", "1", ",", 
        RowBox[{"2", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", "lmax"}], " ", "+", " ", "1"}], ")"}]}], ",", 
        "1"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "See", " ", "projection", " ", "of", " ", "loaded", " ", "wave", " ", 
    "function", " ", "onto", " ", "the", " ", "first", " ", "three", " ", 
    "Bloch", " ", "bands"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"i1", " ", "=", "  ", 
  SuperscriptBox[
   RowBox[{"Norm", "[", 
    RowBox[{
     RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], ".", 
     RowBox[{
      RowBox[{
       RowBox[{"Eigensystem", "[", 
        RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
       "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ", 
      "\[RightDoubleBracket]"}]}], "]"}], "2"]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"i2", " ", "=", "  ", 
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], ".", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
        "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
    "2"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i3", " ", "=", "  ", 
    SuperscriptBox[
     RowBox[{"Norm", "[", 
      RowBox[{
       RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], ".", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", "2",
          "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
        RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
     "2"]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Solve", " ", "the", " ", "main", " ", "Schrodinger", " ", "equation", " ",
     "for", " ", "BOs"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ics", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
      RowBox[{
       RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], "\[LeftDoubleBracket]", 
       "nn", "\[RightDoubleBracket]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", "1", ",", 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", " ", "lmax"}], " ", "+", " ", "1"}], ")"}]}], ",", 
       "1"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"equation", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
    RowBox[{
     RowBox[{"-", "\[ImaginaryI]"}], " ", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt", "]"}], ".", 
      RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sol", " ", "=", " ", 
   RowBox[{"NDSolve", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
     RowBox[{"{", 
      RowBox[{"tt", ",", "0", ",", "TBloch"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
    RowBox[{
     RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
     RowBox[{
     "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], ";"}],
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Return", " ", "the", " ", "amplitude", " ", "squared", " ", "after", " ", 
    "bloch", " ", "oscillations"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  SuperscriptBox[
   RowBox[{"Abs", "[", 
    RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], "]"}], "2"], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Look", " ", "at", " ", "projection", " ", "onto", " ", "different", " ", 
    "bloch", " ", "bands", " ", "after", " ", "BOs", " ", "are", " ", 
    "done"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"p1", " ", "=", "  ", 
  SuperscriptBox[
   RowBox[{"Norm", "[", 
    RowBox[{
     RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
     RowBox[{
      RowBox[{
       RowBox[{"Eigensystem", "[", 
        RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], "\[LeftDoubleBracket]", 
       "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ", 
      "\[RightDoubleBracket]"}]}], "]"}], "2"]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"p2", " ", "=", "  ", 
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], "\[LeftDoubleBracket]", 
        "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
    "2"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"p3", " ", "=", "  ", 
    SuperscriptBox[
     RowBox[{"Norm", "[", 
      RowBox[{
       RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], "\[LeftDoubleBracket]",
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
        RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
     "2"]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Unload", " ", "lattice"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]fBloch", " ", "=", " ", 
    RowBox[{"unLoadLattice", "[", 
     RowBox[{"lmax", ",", " ", "tLoad", ",", " ", "HamUnLoad", ",", " ", 
      RowBox[{"\[Psi]ci", "[", "TBloch", "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Return", " ", "magnitude", " ", "squared", " ", "of", " ", "final", " ", 
    "free", " ", "space", " ", "wave", " ", "function"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  SuperscriptBox[
   RowBox[{"Abs", "[", 
    RowBox[{"\[Psi]fBloch", "[", "tLoad", "]"}], "]"}], "2"], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Plot", " ", "time", " ", "domain", " ", "BO", " ", "solution", " ", 
    "during", " ", "main", " ", "Hamiltonian"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"load", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]iBloch", "[", "t", "]"}], "]"}], "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "tLoad"}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"ColorData", "[", "\"\<Rainbow\>\"", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BO", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]ci", "[", 
        RowBox[{"t", "-", "tLoad"}], "]"}], "]"}], "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "tLoad", ",", 
       RowBox[{"tLoad", " ", "+", " ", "TBloch"}]}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"ColorData", "[", "\"\<Rainbow\>\"", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"unload", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]fBloch", "[", 
        RowBox[{"t", "-", "tLoad", " ", "-", " ", "TBloch"}], "]"}], "]"}], 
      "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{"tLoad", " ", "+", " ", "TBloch"}], ",", 
       RowBox[{
        RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}], ",", 
     " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"ColorData", "[", "\"\<Rainbow\>\"", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"load", ",", " ", "BO", ",", " ", "unload"}], "}"}], ",", " ", 
   RowBox[{"AxesLabel", "\[Rule]", " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<Time (dimensionless)\>\"", ",", " ", 
      "\"\<Probability Amplitude\>\""}], "}"}]}], ",", " ", 
   RowBox[{"ImageSize", "\[Rule]", " ", 
    RowBox[{"{", 
     RowBox[{"700", ",", "400"}], "}"}]}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"(*", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"kList", " ", "=", " ", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{"i", ",", " ", 
       RowBox[{"{", 
        RowBox[{"i", ",", " ", 
         RowBox[{"-", "lmax"}], ",", " ", "lmax", ",", " ", "1"}], "}"}]}], 
      "]"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evect1", "[", "t_", "]"}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", 
         "\[RightDoubleBracket]"}], "]"}], "]"}]}]}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"evect2", "[", "t_", "]"}], " ", ":=", " ", 
    RowBox[{"Normalize", "[", 
     RowBox[{"N", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
        "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "1"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}], 
   ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"evect3", "[", "t_", "]"}], " ", ":=", " ", 
    RowBox[{"Normalize", "[", 
     RowBox[{"N", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
        "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "2"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}], 
   ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"evect4", "[", "t_", "]"}], " ", ":=", " ", 
    RowBox[{"Normalize", "[", 
     RowBox[{"N", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
        "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "3"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}], 
   ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"evect5", "[", "t_", "]"}], " ", ":=", " ", 
    RowBox[{"Normalize", "[", 
     RowBox[{"N", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", "2", 
        "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "4"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}], 
   ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"e1", "[", "t_", "]"}], " ", ":=", " ", 
    SuperscriptBox[
     RowBox[{"Abs", "[", 
      RowBox[{
       RowBox[{"evect1", "[", "t", "]"}], ".", 
       RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"e2", "[", "t_", "]"}], " ", ":=", " ", 
    SuperscriptBox[
     RowBox[{"Abs", "[", 
      RowBox[{
       RowBox[{"evect2", "[", "t", "]"}], ".", 
       RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"e3", "[", "t_", "]"}], " ", ":=", " ", 
    SuperscriptBox[
     RowBox[{"Abs", "[", 
      RowBox[{
       RowBox[{"evect3", "[", "t", "]"}], ".", 
       RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"e4", "[", "t_", "]"}], " ", ":=", " ", 
    SuperscriptBox[
     RowBox[{"Abs", "[", 
      RowBox[{
       RowBox[{"evect4", "[", "t", "]"}], ".", 
       RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"e5", "[", "t_", "]"}], " ", ":=", " ", 
    SuperscriptBox[
     RowBox[{"Abs", "[", 
      RowBox[{
       RowBox[{"evect5", "[", "t", "]"}], ".", 
       RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"ttt", " ", "=", " ", 
    RowBox[{
     FractionBox["8", "8"], "TBloch"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"kkkk", " ", "=", " ", 
    RowBox[{"r", " ", 
     FractionBox["ttt", "4"]}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Re", "[", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"Ham1", "[", "ttt", "]"}], "]"}], "\[LeftDoubleBracket]", 
         "1", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", 
        "\[RightDoubleBracket]"}], "]"}], "]"}], "\[IndentingNewLine]", 
     RowBox[{"ListPlot", "[", 
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"kList", ",", " ", 
          RowBox[{"Re", "[", 
           RowBox[{"evect1", "[", "ttt", "]"}], "]"}]}], "}"}], "]"}], ",", 
       " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
       RowBox[{"PlotStyle", "\[Rule]", "Red"}]}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Re", "[", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"Ham1", "[", "ttt", "]"}], "]"}], "\[LeftDoubleBracket]", 
         "1", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
        RowBox[{"dim", "-", "1"}], "\[RightDoubleBracket]"}], "]"}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ListPlot", "[", 
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"kList", ",", " ", 
          RowBox[{"Re", "[", 
           RowBox[{"evect2", "[", "ttt", "]"}], "]"}]}], "}"}], "]"}], ",", 
       " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
       RowBox[{"PlotStyle", "\[Rule]", "Orange"}]}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Re", "[", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"Ham1", "[", "ttt", "]"}], "]"}], "\[LeftDoubleBracket]", 
         "1", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
        RowBox[{"dim", "-", "2"}], "\[RightDoubleBracket]"}], "]"}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ListPlot", "[", 
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"kList", ",", " ", 
          RowBox[{"Re", "[", 
           RowBox[{"evect3", "[", "ttt", "]"}], "]"}]}], "}"}], "]"}], ",", 
       " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
       RowBox[{"PlotStyle", "\[Rule]", "Purple"}]}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Re", "[", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"Ham1", "[", "ttt", "]"}], "]"}], "\[LeftDoubleBracket]", 
         "1", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
        RowBox[{"dim", "-", "3"}], "\[RightDoubleBracket]"}], "]"}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ListPlot", "[", 
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"kList", ",", " ", 
          RowBox[{"Re", "[", 
           RowBox[{"evect4", "[", "ttt", "]"}], "]"}]}], "}"}], "]"}], ",", 
       " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
       RowBox[{"PlotStyle", "\[Rule]", "Green"}]}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Re", "[", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"Ham1", "[", "ttt", "]"}], "]"}], "\[LeftDoubleBracket]", 
         "1", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
        RowBox[{"dim", "-", "4"}], "\[RightDoubleBracket]"}], "]"}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ListPlot", "[", 
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"kList", ",", " ", 
          RowBox[{"Re", "[", 
           RowBox[{"evect5", "[", "ttt", "]"}], "]"}]}], "}"}], "]"}], ",", 
       " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
       RowBox[{"PlotStyle", "\[Rule]", "Blue"}]}], "]"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Plot", "[", 
     RowBox[{
      RowBox[{"e1", "[", "t", "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"Plot", "[", 
     RowBox[{
      RowBox[{"e2", "[", "t", "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"Plot", "[", 
     RowBox[{
      RowBox[{"e3", "[", "t", "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"Plot", "[", 
     RowBox[{
      RowBox[{"e4", "[", "t", "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"Plot", "[", 
     RowBox[{
      RowBox[{"e5", "[", "t", "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"(*", "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"BlochBands", "[", "k", "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"k", ",", " ", 
         RowBox[{"-", "2"}], ",", " ", "2"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "4"}], ",", " ", "15"}], "}"}]}], ",", " ", 
       RowBox[{"AxesLabel", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Quasimomentum", " ", 
           SubscriptBox["k", "q"]}], ",", 
          RowBox[{"Energy", "  ", "[", 
           SubscriptBox["E", "r"], "]"}]}], "}"}]}]}], " ", "]"}], 
     "\[IndentingNewLine]", "*)"}]}]}]}]}], "Input",
 CellChangeTimes->{{3.748060786225119*^9, 3.748060845694586*^9}, {
   3.7480609237131405`*^9, 3.7480609269798107`*^9}, {3.7480609625906644`*^9, 
   3.748061057901035*^9}, {3.7480611240417905`*^9, 3.748061266889057*^9}, {
   3.748061328229722*^9, 3.7480613868952785`*^9}, {3.7480614169766674`*^9, 
   3.74806147782347*^9}, {3.748061530551072*^9, 3.7480615338877816`*^9}, {
   3.748061770884599*^9, 3.74806177094711*^9}, {3.7480618132788258`*^9, 
   3.7480619570453854`*^9}, {3.7480620707878036`*^9, 
   3.7480621101960077`*^9}, {3.7480621550657587`*^9, 3.748062158143897*^9}, {
   3.7480622818495913`*^9, 3.7480622916993856`*^9}, {3.7480624640405216`*^9, 
   3.748062464632967*^9}, {3.748062609531991*^9, 3.7480626298939543`*^9}, {
   3.7480627254853506`*^9, 3.748062731733879*^9}, {3.7480628487867575`*^9, 
   3.748062872294058*^9}, 3.748062978361493*^9, {3.748063036880129*^9, 
   3.7480630528286896`*^9}, 3.748063155981061*^9, {3.7480633955214386`*^9, 
   3.7480634677878065`*^9}, {3.7480639060928383`*^9, 
   3.7480641004973445`*^9}, {3.7480641917197924`*^9, 3.748064193246647*^9}, {
   3.7480643753750763`*^9, 3.748064382823268*^9}, {3.7480644414312754`*^9, 
   3.7480644464925876`*^9}, {3.7480645140957212`*^9, 3.748064740219556*^9}, {
   3.7480648716851254`*^9, 3.748064879810797*^9}, {3.748065089383791*^9, 
   3.748065089461892*^9}, {3.7481865334899435`*^9, 3.74818653500805*^9}, {
   3.748186566896552*^9, 3.7481865692833366`*^9}, {3.748186601447831*^9, 
   3.7481866021543818`*^9}, {3.7481867093383436`*^9, 3.748186717648305*^9}, {
   3.748187000961274*^9, 3.748187003663514*^9}},
 EmphasizeSyntaxErrors->
  True,ExpressionUUID->"cda46331-ed51-4624-8ac4-dc7e748ce890"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Trying", " ", "BBS", " ", "hamiltonian", " ", "in", " ", "lattice", " ", 
    "frame", " ", "with", " ", "an", " ", "initial", " ", 
    RowBox[{"k0", ":", " ", 
     RowBox[{
     "how", " ", "big", " ", "does", " ", "k0", " ", "have", " ", "to", " ", 
      "be", " ", "for", " ", "it", " ", "to", " ", "be", " ", "an", " ", 
      RowBox[{"eigenstate", "?"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ClearAll", "[", "\"\<Global'*\>\"", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "pl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", 
      "NBloch", ",", "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", 
      "Ham0", ",", "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", 
      " ", "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",",
       " ", "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", 
      " ", "\[Psi]cf"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rGrav", " ", "=", " ", "0.8576"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NBloch", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NLatDep", " ", "=", "4"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NRamp", " ", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k0", " ", "=", " ", "2"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tLoad", " ", "=", " ", 
     RowBox[{"2", " ", "Pi"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CapitalDelta]\[Omega]", " ", "=", " ", "0"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Kappa]", " ", "=", " ", 
     FractionBox["NLatDep", "8"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"r", " ", "=", " ", 
     RowBox[{"NRamp", "*", "rGrav"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BlochPeriod", " ", "=", " ", 
     FractionBox["8", "r"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TBloch", " ", "=", " ", 
     RowBox[{"BlochPeriod", " ", "*", " ", "NBloch"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"time", " ", "=", " ", 
     RowBox[{
      FractionBox["10000", "125"], "*", "2", " ", 
      FractionBox[
       RowBox[{"NBloch", " ", "*", " ", "11"}], "NRamp"]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lmax", " ", "=", " ", 
     RowBox[{"Max", "[", 
      RowBox[{"10", ",", 
       RowBox[{"Round", "[", 
        RowBox[{"5.", "*", 
         SuperscriptBox["NLatDep", 
          RowBox[{"1", "/", "4"}]]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dim", " ", "=", " ", 
     RowBox[{
      RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"loadLattice", "[", 
     RowBox[{
     "lMax_", ",", " ", "kk0_", ",", " ", "tLoad_", ",", " ", "loadHam_"}], 
     "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
        RowBox[{"k0", " ", "=", " ", "kk0"}], ",", " ", 
        RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
        RowBox[{"HamLoad", " ", "=", " ", "loadHam"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{
        "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
         ",", " ", "cs"}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"dimState", " ", "=", " ", 
        RowBox[{
         RowBox[{"2", "*", "maxL"}], " ", "+", " ", "1"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Psi]i", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "dimState"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"rem", " ", "=", " ", 
        RowBox[{"Mod", "[", 
         RowBox[{"k0", ",", " ", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"low", " ", "=", " ", 
        RowBox[{"Floor", "[", 
         FractionBox["k0", "2"], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"high", " ", "=", " ", 
        RowBox[{"low", " ", "+", " ", "1"}]}], " ", ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]i", "[", 
         RowBox[{"[", 
          RowBox[{"low", "+", " ", 
           RowBox[{"(", 
            RowBox[{"lmax", " ", "+", "1"}], ")"}]}], "]"}], "]"}], " ", "=", 
        RowBox[{"Sqrt", "[", 
         RowBox[{"(", 
          RowBox[{"1", " ", "-", "rem"}], ")"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]i", "[", 
         RowBox[{"[", 
          RowBox[{"high", "+", " ", 
           RowBox[{"(", 
            RowBox[{"lmax", " ", "+", "1"}], ")"}]}], "]"}], "]"}], " ", "=", 
        " ", 
        RowBox[{"Sqrt", "[", 
         RowBox[{"(", "rem", ")"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"cs", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ics", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
           RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
            RowBox[{"nn", "+", 
             RowBox[{"(", 
              RowBox[{"lmax", "+", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"equation", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{
           RowBox[{"HamLoad", "[", "tt", "]"}], ".", 
           RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sol", " ", "=", " ", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
          RowBox[{"{", 
           RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", "tt_", "]"}], ":=", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
         RowBox[{
         "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[Psi]ci", "[", "tLoad", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"unLoadLattice", "[", 
     RowBox[{
     "lMax_", ",", " ", "tLoad_", ",", " ", "unLoadHam_", ",", " ", 
      "\[Psi]ci_"}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
        RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
        RowBox[{"HamUnLoad", " ", "=", " ", "unLoadHam"}], ",", " ", 
        RowBox[{"\[Psi]i", "=", " ", "\[Psi]ci"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"cs", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ics", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
           RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
            RowBox[{"nn", "+", 
             RowBox[{"(", 
              RowBox[{"lmax", "+", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"equation", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{
           RowBox[{"HamUnLoad", "[", "tt", "]"}], ".", 
           RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sol", " ", "=", " ", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
          RowBox[{"{", 
           RowBox[{"tt", ",", "0", ",", "loadTime"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]cff", "[", "tt_", "]"}], ":=", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
         RowBox[{
         "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[Psi]cff", "[", "loadTime", "]"}]}]}], "\[IndentingNewLine]",
      "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Clear", "[", "k", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kl", "[", "l_", "]"}], ":=", 
      RowBox[{"k0", "+", 
       RowBox[{"2", " ", "l"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
      RowBox[{"Normal", "[", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
            SuperscriptBox[
             RowBox[{"kl", "[", 
              RowBox[{"l", " ", "-", " ", 
               RowBox[{"(", 
                RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", " ", 
            RowBox[{
             RowBox[{"2", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", " ", "\[ImaginaryI]"}], " ", 
                  "\[CapitalDelta]w", " ", 
                  RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
                RowBox[{"Cos", "[", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"rr", " "}], "2"], "+", 
                  RowBox[{"\[CapitalDelta]wm", " ", 
                   RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                 "]"}]}], ")"}]}], " ", "/;", " ", 
             RowBox[{
              RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", " ", 
            RowBox[{
             RowBox[{"2", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{"\[ImaginaryI]", " ", "\[CapitalDelta]w", " ", 
                  RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
                RowBox[{"Cos", "[", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"rr", " "}], "2"], "+", 
                  RowBox[{"\[CapitalDelta]wm", " ", 
                   RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                 "]"}]}], ")"}]}], "/;", 
             RowBox[{
              RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox["tt", "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "  ", "0"}]}], " ", "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox[
            RowBox[{"(", 
             RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
          RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", " ", 
          RowBox[{"r", " ", 
           FractionBox[
            SuperscriptBox["TBloch", "2"], "2"]}]}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", 
          RowBox[{"r", 
           SuperscriptBox[
            RowBox[{"(", "tt", ")"}], "2"]}]}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamTest", "[", 
       RowBox[{"kk_", ",", "tt_"}], "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", 
          RowBox[{"r", " ", 
           SuperscriptBox["tt", "2"]}]}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"Ham1", "[", "t", "]"}], "]"}]}], "\[IndentingNewLine]", "*)"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "k", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"kl", "[", "l_", "]"}], ":=", 
     RowBox[{"k0", "+", 
      RowBox[{"2", " ", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
           SuperscriptBox[
            RowBox[{"kl", "[", 
             RowBox[{"l", " ", "-", " ", 
              RowBox[{"(", 
               RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", " ", 
           RowBox[{
            RowBox[{"2", " ", 
             RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", " ", "\[ImaginaryI]"}], " ", "\[CapitalDelta]w",
                  " ", 
                 RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
               RowBox[{"Cos", "[", 
                RowBox[{
                 FractionBox[
                  RowBox[{"rr", " "}], "2"], "+", 
                 RowBox[{"\[CapitalDelta]wm", " ", 
                  RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                "]"}]}], ")"}]}], " ", "/;", " ", 
            RowBox[{
             RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", " ", 
           RowBox[{
            RowBox[{"2", " ", 
             RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{"\[ImaginaryI]", " ", "\[CapitalDelta]w", " ", 
                 RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
               RowBox[{"Cos", "[", 
                RowBox[{
                 FractionBox[
                  RowBox[{"rr", " "}], "2"], "+", 
                 RowBox[{"\[CapitalDelta]wm", " ", 
                  RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                "]"}]}], ")"}]}], "/;", 
            RowBox[{
             RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox["tt", "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
         RowBox[{"4", " ", "k0"}]}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", "  ", "0"}]}], " ", "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox[
           RowBox[{"(", 
            RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
         RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", " ", 
         RowBox[{
          RowBox[{"r", " ", 
           FractionBox[
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"TBloch", " ", "-", " ", 
               RowBox[{"4", " ", 
                FractionBox["k0", "r"]}]}], ")"}], "2"], "2"]}], " ", "+", 
          " ", 
          RowBox[{"4", " ", "k0", " ", 
           RowBox[{"(", 
            RowBox[{"TBloch", " ", "-", " ", 
             RowBox[{"4", " ", 
              FractionBox["k0", "r"]}], " ", "+", " ", "tLoad"}], 
            ")"}]}]}]}]}], "}"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MatrixForm", "[", 
     RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
        RowBox[{"rr", "\[Rule]", 
         RowBox[{"r", 
          SuperscriptBox[
           RowBox[{"(", "tt", ")"}], "2"]}]}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
         RowBox[{"4", " ", "k0"}]}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", 
         RowBox[{
          RowBox[{"4", " ", "k0", " ", "tLoad"}], " ", "-", " ", 
          RowBox[{"r", " ", 
           FractionBox[
            SuperscriptBox["tLoad", "2"], "2"]}]}]}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamTest", "[", 
      RowBox[{"kk_", ",", "tt_"}], "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
        RowBox[{"rr", "\[Rule]", 
         RowBox[{"r", " ", 
          SuperscriptBox["tt", "2"]}]}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"MatrixForm", "[", 
    RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
      ",", " ", "cs", ",", " ", "\[Psi]cf", ",", "tt"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
     RowBox[{"Table", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cs", " ", "=", " ", 
     RowBox[{"Table", "[", " ", 
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
    RowBox[{"loadLattice", "[", 
     RowBox[{"lmax", ",", " ", "k0", ",", " ", "tLoad", ",", " ", "HamLoad"}],
      "]"}]}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", "\[Psi]iBloch", "]"}], "2"], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"i1", " ", "=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{"\[Psi]iBloch", ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ",
           "\[RightDoubleBracket]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"i2", " ", "=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{"\[Psi]iBloch", ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"i3", " ", "=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{"\[Psi]iBloch", ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ics", " ", "=", " ", 
     RowBox[{"Table", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
        RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
         RowBox[{"nn", "+", 
          RowBox[{"(", 
           RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"equation", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", 
       RowBox[{
        RowBox[{"Ham1", "[", "tt", "]"}], ".", 
        RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sol", " ", "=", " ", 
     RowBox[{"NDSolve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
       RowBox[{"{", 
        RowBox[{"tt", ",", "0", ",", 
         RowBox[{"TBloch", " ", "-", " ", 
          RowBox[{"4", " ", 
           FractionBox["k0", "r"]}]}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
      RowBox[{
      "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]ci", "[", 
     RowBox[{"TBloch", " ", "-", " ", 
      RowBox[{"4", " ", 
       FractionBox["k0", "r"]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", 
     RowBox[{"\[Psi]ci", "[", " ", 
      RowBox[{"TBloch", " ", "-", " ", 
       RowBox[{"4", " ", 
        FractionBox["k0", "r"]}]}], "]"}], "]"}], "2"], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "t", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]cf", " ", "=", " ", 
     RowBox[{"unLoadLattice", "[", 
      RowBox[{"lmax", ",", " ", "tLoad", ",", " ", "HamUnLoad", ",", 
       RowBox[{"\[Psi]ci", "[", 
        RowBox[{"TBloch", " ", "-", " ", 
         RowBox[{"4", " ", 
          FractionBox["k0", "r"]}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
      RowBox[{
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"Ham1", "[", 
          RowBox[{"TBloch", " ", "-", " ", 
           RowBox[{"4", " ", 
            FractionBox["k0", "r"]}]}], "]"}], "]"}], "\[LeftDoubleBracket]", 
        "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", " ", "-", "4"}], "\[RightDoubleBracket]"}]}], "]"}], 
    "2"], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"p1", "[", "t_", "]"}], " ", ":=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ",
           "\[RightDoubleBracket]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p2", "[", "t_", "]"}], " ", ":=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p3", "[", "t_", "]"}], " ", ":=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{"p1", "[", "t", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{"p2", "[", "t", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{"p3", "[", "t", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", "p1"}], "+", "p2", "+", "p3"}], ";"}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", "\[Psi]cf", "]"}], "2"], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ArcTan", "[", 
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{
       "\[Psi]cf", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
       "]"}], ",", " ", 
      RowBox[{"Im", "[", 
       RowBox[{
       "\[Psi]cf", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
       "]"}]}], "]"}], "-", 
    RowBox[{"ArcTan", "[", 
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{
       "\[Psi]cf", "\[LeftDoubleBracket]", "17", "\[RightDoubleBracket]"}], 
       "]"}], ",", " ", 
      RowBox[{"Im", "[", 
       RowBox[{
       "\[Psi]cf", "\[LeftDoubleBracket]", "17", "\[RightDoubleBracket]"}], 
       "]"}]}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]ci", "[", "t", "]"}], "]"}], "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", 
       RowBox[{"TBloch", " ", "-", " ", 
        RowBox[{"4", " ", 
         FractionBox["k0", "r"]}]}]}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], "2"], 
     ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", 
       RowBox[{"TBloch", "-", " ", 
        RowBox[{"4", " ", 
         FractionBox["k0", "r"]}]}]}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"lmax", "+", "2"}], "\[RightDoubleBracket]"}], "]"}], "2"], 
     ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", 
       RowBox[{"TBloch", "-", " ", 
        RowBox[{"4", " ", 
         FractionBox["k0", "r"]}]}]}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "try", " ", "plotting", " ", "projetion", " ", "onto", " ", 
      "eigenstates", " ", 
      RowBox[{"vs", ".", " ", "time"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"evect1", "[", 
       RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"HamTest", "[", 
            RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", 
         "\[RightDoubleBracket]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evect2", "[", 
       RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"HamTest", "[", 
            RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
         RowBox[{"dim", "-", "1"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evect3", "[", 
       RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"HamTest", "[", 
            RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
         RowBox[{"dim", "-", "2"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evect4", "[", 
       RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
      RowBox[{"Normalize", "[", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"HamTest", "[", 
            RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
         RowBox[{"dim", "-", "3"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e1p", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect1", "[", 
           RowBox[{
            RowBox[{"r", " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"test", "[", "t_", "]"}], " ", ":=", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect1", "[", 
           RowBox[{
            RowBox[{"r", " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"N", "[", 
          RowBox[{"evect1", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "r"}], " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}]}], "]"}], 
       "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e1m", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect1", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "r"}], " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e2p", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect2", "[", 
           RowBox[{
            RowBox[{"r", " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e2m", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect2", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "r"}], " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e3p", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect3", "[", 
           RowBox[{
            RowBox[{"r", " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e3m", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect3", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "r"}], " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e4p", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect4", "[", 
           RowBox[{
            RowBox[{"r", " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e4m", "[", "t_", "]"}], " ", ":=", " ", 
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"evect4", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "r"}], " ", 
             FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
         RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"NIntegrate", "[", 
       RowBox[{
        RowBox[{"test", "[", "t", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          FractionBox["BlochPeriod", "2"], ",", "TBloch"}], "}"}]}], "]"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"test", "[", "t", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"e1p", "[", "t", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"e1m", "[", "t", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"e2p", "[", "t", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"e2m", "[", "t", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"e3p", "[", "t", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"e3m", "[", "t", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"e4p", "[", "t", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"e4m", "[", "t", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
      "\[IndentingNewLine]", "*)"}]}]}]}]}]], "Input",
 CellChangeTimes->{{3.7480985798730526`*^9, 3.7480986430463395`*^9}, {
   3.7480987525934095`*^9, 3.7480987657138915`*^9}, {3.748098846114633*^9, 
   3.7480988469374285`*^9}, {3.748098901524184*^9, 3.7480989760281425`*^9}, 
   3.748099048490223*^9, {3.7480991272273893`*^9, 3.748099136505351*^9}, {
   3.7480991745297465`*^9, 3.748099174997018*^9}, 3.748099222565362*^9, {
   3.7480993539888234`*^9, 3.7480993623900003`*^9}, {3.748099406678591*^9, 
   3.7480994398932962`*^9}, {3.7480995388879004`*^9, 3.74809953917819*^9}, {
   3.748099575060418*^9, 3.748099577355873*^9}, {3.7480996793039384`*^9, 
   3.7480996796066127`*^9}, {3.7480997359886827`*^9, 3.748099736332168*^9}, {
   3.748099775966153*^9, 3.7480997762574663`*^9}, {3.748099826191821*^9, 
   3.748099851843484*^9}, {3.7480998821974545`*^9, 3.7480999446586037`*^9}, {
   3.7481000709661407`*^9, 3.7481000716110363`*^9}, {3.748100104391264*^9, 
   3.748100104570777*^9}, {3.74810042130493*^9, 3.7481004234242544`*^9}, {
   3.7481004559905167`*^9, 3.748100468638184*^9}, {3.7481048788227043`*^9, 
   3.7481049205170746`*^9}, {3.748104991603896*^9, 3.7481050729538608`*^9}, {
   3.7481051463388443`*^9, 3.74810514992013*^9}, {3.748105258241677*^9, 
   3.7481053986775503`*^9}, {3.7481054634473085`*^9, 
   3.7481054944288983`*^9}, {3.748105561625722*^9, 3.7481055617506638`*^9}},
 EmphasizeSyntaxErrors->
  True,ExpressionUUID->"d8bddd09-8f4a-4527-92d3-ef285f2c73bf"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Four port Bloch beamsplitter", "Section",
 CellChangeTimes->{{3.748190223162379*^9, 3.7481902267349377`*^9}, {
  3.7481903020042105`*^9, 
  3.7481903027703066`*^9}},ExpressionUUID->"75edfa4d-7ccb-4b60-a720-\
8d9fe0c45e46"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ClearAll", "[", "\"\<Global'*\>\"", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "pl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", 
      "NBloch", ",", "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", 
      "Ham0", ",", "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", 
      " ", "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",",
       " ", "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", 
      " ", "\[Psi]cf"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rGrav", " ", "=", " ", "0.8576"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NBloch", " ", "=", " ", "3"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NLatDep", " ", "=", "3.85"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NRamp", " ", "=", ".501"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tLoad", " ", "=", " ", 
     RowBox[{"2", " ", "Pi"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CapitalDelta]\[Omega]", " ", "=", " ", "0"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Kappa]", " ", "=", " ", 
     FractionBox["NLatDep", "8"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"r", " ", "=", " ", 
     RowBox[{"NRamp", "*", "rGrav"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BlochPeriod", " ", "=", " ", 
     FractionBox["8", "r"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TBloch", " ", "=", " ", 
     RowBox[{"BlochPeriod", " ", "*", " ", "NBloch"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"time", " ", "=", " ", 
     RowBox[{
      FractionBox["10000", "125"], "*", "2", " ", 
      FractionBox[
       RowBox[{"NBloch", " ", "*", " ", "11"}], "NRamp"]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lmax", " ", "=", " ", 
     RowBox[{"Max", "[", 
      RowBox[{"10", ",", 
       RowBox[{"Round", "[", 
        RowBox[{"5.", "*", 
         SuperscriptBox["NLatDep", 
          RowBox[{"1", "/", "4"}]]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dim", " ", "=", " ", 
     RowBox[{
      RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"loadLattice", "[", 
     RowBox[{
     "lMax_", ",", " ", "kk0_", ",", " ", "tLoad_", ",", " ", "loadHam_"}], 
     "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
        RowBox[{"k0", " ", "=", " ", "kk0"}], ",", " ", 
        RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
        RowBox[{"HamLoad", " ", "=", " ", "loadHam"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{
        "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
         ",", " ", "cs"}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"dimState", " ", "=", " ", 
        RowBox[{
         RowBox[{"2", "*", "maxL"}], " ", "+", " ", "1"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Psi]i", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "dimState"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"rem", " ", "=", " ", 
        RowBox[{"Mod", "[", 
         RowBox[{"k0", ",", " ", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"low", " ", "=", " ", 
           RowBox[{"Floor", "[", 
            FractionBox["k0", "2"], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"high", " ", "=", " ", 
           RowBox[{"Ceiling", "[", 
            FractionBox["k0", "2"], "]"}]}], " ", ";"}], "="}], 
        "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]i", "[", 
         RowBox[{"[", 
          RowBox[{"0", "+", " ", 
           RowBox[{"(", 
            RowBox[{"lmax", " ", "+", "1"}], ")"}]}], "]"}], "]"}], " ", "=", 
        " ", "1"}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"cs", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ics", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
           RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
            RowBox[{"nn", "+", 
             RowBox[{"(", 
              RowBox[{"lmax", "+", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"equation", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{
           RowBox[{"HamLoad", "[", "tt", "]"}], ".", 
           RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sol", " ", "=", " ", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
          RowBox[{"{", 
           RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", "tt_", "]"}], ":=", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
         RowBox[{
         "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[Psi]ci", "[", "tLoad", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"unLoadLattice", "[", 
     RowBox[{
     "lMax_", ",", " ", "tLoad_", ",", " ", "unLoadHam_", ",", " ", 
      "\[Psi]ci_"}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
        RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
        RowBox[{"HamUnLoad", " ", "=", " ", "unLoadHam"}], ",", " ", 
        RowBox[{"\[Psi]i", "=", " ", "\[Psi]ci"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Clear", "[", 
        RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"cs", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ics", " ", "=", " ", 
        RowBox[{"Table", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
           RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
            RowBox[{"nn", "+", 
             RowBox[{"(", 
              RowBox[{"lmax", "+", "1"}], ")"}]}], 
            "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"nn", ",", 
            RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"equation", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{
           RowBox[{"HamUnLoad", "[", "tt", "]"}], ".", 
           RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sol", " ", "=", " ", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
          RowBox[{"{", 
           RowBox[{"tt", ",", "0", ",", "loadTime"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Psi]cff", "[", "tt_", "]"}], ":=", 
        RowBox[{
         RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
         RowBox[{
         "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[Psi]cff", "[", "loadTime", "]"}]}]}], "\[IndentingNewLine]",
      "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Clear", "[", "k", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kl", "[", "l_", "]"}], ":=", 
      RowBox[{"k0", "+", 
       RowBox[{"2", " ", "l"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
      RowBox[{"Normal", "[", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
            SuperscriptBox[
             RowBox[{"kl", "[", 
              RowBox[{"l", " ", "-", " ", 
               RowBox[{"(", 
                RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", " ", 
            RowBox[{
             RowBox[{"2", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", " ", "\[ImaginaryI]"}], " ", 
                  "\[CapitalDelta]w", " ", 
                  RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
                RowBox[{"Cos", "[", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"rr", " "}], "2"], "+", 
                  RowBox[{"\[CapitalDelta]wm", " ", 
                   RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                 "]"}]}], ")"}]}], " ", "/;", " ", 
             RowBox[{
              RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", " ", 
            RowBox[{
             RowBox[{"2", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{"\[ImaginaryI]", " ", "\[CapitalDelta]w", " ", 
                  RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
                RowBox[{"Cos", "[", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"rr", " "}], "2"], "+", 
                  RowBox[{"\[CapitalDelta]wm", " ", 
                   RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                 "]"}]}], ")"}]}], "/;", 
             RowBox[{
              RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox["tt", "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "  ", "0"}]}], " ", "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox[
            RowBox[{"(", 
             RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
          RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", " ", 
          RowBox[{"r", " ", 
           FractionBox[
            SuperscriptBox["TBloch", "2"], "2"]}]}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", 
          RowBox[{"r", 
           SuperscriptBox[
            RowBox[{"(", "tt", ")"}], "2"]}]}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamTest", "[", 
       RowBox[{"kk_", ",", "tt_"}], "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", 
          RowBox[{"r", " ", 
           SuperscriptBox["tt", "2"]}]}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"Ham1", "[", "t", "]"}], "]"}]}], "\[IndentingNewLine]", "*)"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Clear", "[", "k", "]"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Ham0", "[", 
        RowBox[{"k_", ",", "tt_"}], "]"}], " ", "=", " ", 
       RowBox[{"Normal", "[", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"k", "+", 
                RowBox[{"2", 
                 RowBox[{"(", 
                  RowBox[{"l", " ", "-", " ", 
                   RowBox[{"(", 
                    RowBox[{"lmax", "+", "1"}], ")"}]}], ")"}]}]}], ")"}], 
              "2"]}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", " ", 
             RowBox[{
              RowBox[{"2", " ", 
               RowBox[{"Sqrt", "[", "2", "]"}], " ", "\[Kappa]\[Kappa]", 
               RowBox[{"(", " ", 
                RowBox[{"1", " ", "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"\[ImaginaryI]", " ", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{"rr", " ", 
                    SuperscriptBox["tt", "2"]}], "+", 
                    RowBox[{"2", " ", "\[CapitalDelta]wm", " ", "tt"}], "+", 
                    " ", 
                    RowBox[{"2", " ", "\[Phi]"}]}], ")"}]}], "]"}]}], ")"}]}],
               " ", "/;", " ", 
              RowBox[{
               RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", " ", 
             RowBox[{
              RowBox[{"2", " ", 
               RowBox[{"Sqrt", "[", "2", "]"}], "\[Kappa]\[Kappa]", " ", 
               RowBox[{"(", " ", 
                RowBox[{"1", "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "\[ImaginaryI]"}], " ", 
                   RowBox[{"(", "  ", 
                    RowBox[{
                    RowBox[{"rr", " ", 
                    SuperscriptBox["tt", "2"]}], "+", 
                    RowBox[{"2", "\[CapitalDelta]wm", " ", "tt"}], "+", " ", 
                    RowBox[{"2", " ", "\[Phi]"}]}], ")"}]}], "]"}]}], ")"}]}],
               "/;", 
              RowBox[{
               RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"Ham0", "[", 
        RowBox[{"0", ",", "tt"}], "]"}], "/.", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox["tt", "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", " ", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", " ", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "r"}], " ", 
          FractionBox["TBloch", "4"]}], ",", "tt"}], "]"}], "/.", 
       RowBox[{"{", "  ", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
          RowBox[{"\[Kappa]", " ", 
           FractionBox[
            RowBox[{"(", 
             RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
         RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
          RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", 
          FractionBox[
           RowBox[{"r", " ", 
            SuperscriptBox["TBloch", "2"]}], "2"]}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "r"}], " ", 
          FractionBox["tt", "4"]}], ",", "tt"}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", "r"}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HamTest", "[", 
       RowBox[{"k_", ",", "tt_"}], "]"}], "=", 
      RowBox[{
       RowBox[{"Ham0", "[", 
        RowBox[{"k", ",", "tt"}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
         RowBox[{"rr", "\[Rule]", "r"}], ",", " ", 
         RowBox[{
         "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}],
          ",", " ", 
         RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
         RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"Ham1", "[", "t", "]"}], "]"}]}], "\[IndentingNewLine]", "*)"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "k", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"kl", "[", "l_", "]"}], ":=", 
     RowBox[{"k0", "+", 
      RowBox[{"2", " ", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham0", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
           SuperscriptBox[
            RowBox[{"kl", "[", 
             RowBox[{"l", " ", "-", " ", 
              RowBox[{"(", 
               RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", " ", 
           RowBox[{
            RowBox[{"4", " ", "\[Kappa]\[Kappa]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", " ", "\[ImaginaryI]"}], " ", "\[CapitalDelta]w",
                  " ", 
                 RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
               RowBox[{"Cos", "[", 
                RowBox[{
                 FractionBox[
                  RowBox[{"rr", " "}], "2"], "+", 
                 RowBox[{"\[CapitalDelta]wm", " ", 
                  RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                "]"}]}], ")"}]}], " ", "/;", " ", 
            RowBox[{
             RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", " ", 
           RowBox[{
            RowBox[{"4", " ", "\[Kappa]\[Kappa]", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{"\[ImaginaryI]", " ", "\[CapitalDelta]w", " ", 
                 RowBox[{"(", "tt", ")"}]}], "]"}], " ", 
               RowBox[{"Cos", "[", 
                RowBox[{
                 FractionBox[
                  RowBox[{"rr", " "}], "2"], "+", 
                 RowBox[{"\[CapitalDelta]wm", " ", 
                  RowBox[{"(", "tt", ")"}]}], "+", " ", "\[Phi]"}], "  ", 
                "]"}]}], ")"}]}], "/;", 
            RowBox[{
             RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox["tt", "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", "  ", "0"}]}], " ", "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
         RowBox[{"\[Kappa]", " ", 
          FractionBox[
           RowBox[{"(", 
            RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
        RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", 
         RowBox[{"r", " ", "TBloch"}]}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", " ", 
         RowBox[{"r", " ", 
          FractionBox[
           SuperscriptBox["TBloch", "2"], "2"]}]}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MatrixForm", "[", 
     RowBox[{"HamUnLoad", "[", "t", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
        RowBox[{"rr", "\[Rule]", 
         RowBox[{"r", 
          SuperscriptBox[
           RowBox[{"(", "tt", ")"}], "2"]}]}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HamTest", "[", 
      RowBox[{"kk_", ",", "tt_"}], "]"}], "=", 
     RowBox[{
      RowBox[{"Ham0", "[", "tt", "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
        RowBox[{"rr", "\[Rule]", 
         RowBox[{"r", " ", 
          SuperscriptBox["tt", "2"]}]}], ",", " ", 
        RowBox[{
        "\[CapitalDelta]w", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
        ",", " ", 
        RowBox[{"\[CapitalDelta]wm", "\[Rule]", "0"}], ",", " ", 
        RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MatrixForm", "[", 
     RowBox[{"Ham1", "[", "t", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
      ",", " ", "cs", ",", " ", "\[Psi]cf", ",", "tt"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
     RowBox[{"Table", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cs", " ", "=", " ", 
     RowBox[{"Table", "[", " ", 
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"nn", ",", 
         RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
    RowBox[{"loadLattice", "[", 
     RowBox[{"lmax", ",", " ", "k0", ",", " ", "tLoad", ",", " ", "HamLoad"}],
      "]"}]}], "\[IndentingNewLine]", 
   SuperscriptBox[
    RowBox[{"Abs", "[", "\[Psi]iBloch", "]"}], "2"], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"i1", " ", "=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{"\[Psi]iBloch", ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ",
           "\[RightDoubleBracket]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"i2", " ", "=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{"\[Psi]iBloch", ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"i3", " ", "=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{"\[Psi]iBloch", ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "0", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ics", " ", "=", " ", 
      RowBox[{"Table", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
         RowBox[{"\[Psi]iBloch", "\[LeftDoubleBracket]", 
          RowBox[{"nn", "+", 
           RowBox[{"(", 
            RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"nn", ",", 
          RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"equation", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], " ", 
        RowBox[{
         RowBox[{"Ham1", "[", "tt", "]"}], ".", 
         RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sol", " ", "=", " ", 
      RowBox[{"NDSolve", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
        RowBox[{"{", 
         RowBox[{"tt", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"AccuracyGoal", "\[Rule]", "14"}], ",", " ", 
        RowBox[{"PrecisionGoal", "\[Rule]", "14"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
       RowBox[{
       "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"Abs", "[", 
        RowBox[{"\[Psi]ci", "[", " ", "TBloch", "]"}], "]"}], "2"], 
      "\[IndentingNewLine]", 
      RowBox[{"Clear", "[", "t", "]"}], "\[IndentingNewLine]", 
      RowBox[{"\[Psi]cf", " ", "=", " ", 
       RowBox[{"unLoadLattice", "[", 
        RowBox[{"lmax", ",", " ", "tLoad", ",", " ", "HamUnLoad", ",", 
         RowBox[{"\[Psi]ci", "[", "TBloch", "]"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     SuperscriptBox[
      RowBox[{"Norm", "[", 
       RowBox[{
        RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ".", 
        RowBox[{
         RowBox[{
          RowBox[{"Eigensystem", "[", 
           RowBox[{"Ham1", "[", "TBloch", "]"}], "]"}], 
          "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"dim", " ", "-", "4"}], "\[RightDoubleBracket]"}]}], "]"}], 
      "2"]}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"p1", "[", "t_", "]"}], " ", ":=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", " ",
           "\[RightDoubleBracket]"}]}], "]"}], "2"]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p2", "[", "t_", "]"}], " ", ":=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", "-", "1"}], " ", "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p3", "[", "t_", "]"}], " ", ":=", "  ", 
      SuperscriptBox[
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"\[Psi]ci", "[", "t", "]"}], ".", 
         RowBox[{
          RowBox[{
           RowBox[{"Eigensystem", "[", 
            RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
          RowBox[{"dim", " ", "-", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
       "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{"p1", "[", "t", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{"p2", "[", "t", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{"p3", "[", "t", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", "p1"}], "+", "p2", "+", "p3"}], ";"}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      SuperscriptBox[
       RowBox[{"Abs", "[", "\[Psi]cf", "]"}], "2"], "\[IndentingNewLine]", 
      RowBox[{"ArcTan", "[", 
       RowBox[{
        RowBox[{"Re", "[", 
         RowBox[{
         "\[Psi]cf", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
         "]"}], ",", " ", 
        RowBox[{"Im", "[", 
         RowBox[{
         "\[Psi]cf", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
         "]"}]}], "]"}]}], "-", 
     RowBox[{
      RowBox[{"ArcTan", "[", 
       RowBox[{
        RowBox[{"Re", "[", 
         RowBox[{
         "\[Psi]cf", "\[LeftDoubleBracket]", "17", "\[RightDoubleBracket]"}], 
         "]"}], ",", " ", 
        RowBox[{"Im", "[", 
         RowBox[{
         "\[Psi]cf", "\[LeftDoubleBracket]", "17", "\[RightDoubleBracket]"}], 
         "]"}]}], "]"}], "\[IndentingNewLine]", 
      RowBox[{"Plot", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"Abs", "[", 
          RowBox[{"\[Psi]ci", "[", "t", "]"}], "]"}], "2"], ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Plot", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"Abs", "[", 
          RowBox[{
           RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"lmax", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], "2"],
         ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Plot", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"Abs", "[", 
          RowBox[{
           RowBox[{"\[Psi]ci", "[", "t", "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"lmax", "+", "2"}], "\[RightDoubleBracket]"}], "]"}], "2"],
         ",", " ", 
        RowBox[{"{", 
         RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "try", " ", "plotting", " ", "projetion", " ", "onto", " ", "eigenstates",
      " ", 
     RowBox[{"vs", ".", " ", "time"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"evect1", "[", 
      RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Normalize", "[", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"HamTest", "[", 
           RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", "2",
          "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "dim", 
        "\[RightDoubleBracket]"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"evect2", "[", 
      RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Normalize", "[", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"HamTest", "[", 
           RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", "2",
          "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
        RowBox[{"dim", "-", "1"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"evect3", "[", 
      RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Normalize", "[", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"HamTest", "[", 
           RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", "2",
          "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
        RowBox[{"dim", "-", "2"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"evect4", "[", 
      RowBox[{"k_", ",", "t_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Normalize", "[", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Eigensystem", "[", 
          RowBox[{"HamTest", "[", 
           RowBox[{"k", ",", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", "2",
          "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
        RowBox[{"dim", "-", "3"}], "\[RightDoubleBracket]"}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"e1p", "[", "t_", "]"}], " ", ":=", " ", 
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"evect1", "[", 
          RowBox[{
           RowBox[{"r", " ", 
            FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
        RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"e1m", "[", "t_", "]"}], " ", ":=", " ", 
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"evect1", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "r"}], " ", 
            FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
        RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"e2p", "[", "t_", "]"}], " ", ":=", " ", 
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"evect2", "[", 
          RowBox[{
           RowBox[{"r", " ", 
            FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
        RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"e2m", "[", "t_", "]"}], " ", ":=", " ", 
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"evect2", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "r"}], " ", 
            FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
        RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"e3p", "[", "t_", "]"}], " ", ":=", " ", 
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"evect3", "[", 
          RowBox[{
           RowBox[{"r", " ", 
            FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
        RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"e3m", "[", "t_", "]"}], " ", ":=", " ", 
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"evect3", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "r"}], " ", 
            FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
        RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"e4p", "[", "t_", "]"}], " ", ":=", " ", 
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"evect4", "[", 
          RowBox[{
           RowBox[{"r", " ", 
            FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
        RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"e4m", "[", "t_", "]"}], " ", ":=", " ", 
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"evect4", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "r"}], " ", 
            FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
        RowBox[{"\[Psi]ci", "[", "t", "]"}]}], "]"}], "2"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      RowBox[{"test", "[", "t", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"t", ",", 
        FractionBox["BlochPeriod", "2"], ",", "TBloch"}], "}"}]}], "]"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"test", "[", "t_", "]"}], " ", ":=", 
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"evect1", "[", 
          RowBox[{
           RowBox[{"r", " ", 
            FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}], ".", 
        RowBox[{"N", "[", 
         RowBox[{"evect1", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "r"}], " ", 
            FractionBox["t", "4"]}], ",", " ", "t"}], "]"}], "]"}]}], "]"}], 
      "2"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"Plot", "[", 
     RowBox[{
      RowBox[{"test", "[", "t", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"e1p", "[", "t", "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"e1m", "[", "t", "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"e2p", "[", "t", "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"e2m", "[", "t", "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"e3p", "[", "t", "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"e3m", "[", "t", "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"e4p", "[", "t", "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"e4m", "[", "t", "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", "0", ",", " ", "TBloch"}], "}"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
    "\[IndentingNewLine]", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.748229523874381*^9, 3.7482295276262217`*^9}, {
   3.7482295805845785`*^9, 3.748229580746335*^9}, {3.7482296163159294`*^9, 
   3.7482296173028893`*^9}, {3.7482296697424164`*^9, 
   3.7482296708746357`*^9}, {3.7482297063373547`*^9, 3.748229707415966*^9}, {
   3.748489399347474*^9, 3.748489400562641*^9}, {3.7484894426862497`*^9, 
   3.748489443178503*^9}, {3.7484894780398636`*^9, 3.7484894803600693`*^9}, {
   3.7484895506069317`*^9, 3.748489555749954*^9}, {3.748489592729184*^9, 
   3.7484896151885157`*^9}, {3.748489688012571*^9, 3.7484896885902376`*^9}, {
   3.7484897683877463`*^9, 3.7484897877480516`*^9}, {3.748490172040448*^9, 
   3.7484901722992864`*^9}, {3.7484902176184874`*^9, 
   3.7484902228454657`*^9}, {3.7484902656257267`*^9, 
   3.7484902660668945`*^9}, {3.7484903295877967`*^9, 
   3.7484903297605267`*^9}, {3.7484903607555885`*^9, 3.748490364810358*^9}, {
   3.748490398210458*^9, 3.748490398601418*^9}, {3.7484904414421263`*^9, 
   3.748490441742448*^9}, {3.748490472973031*^9, 3.748490473603448*^9}, {
   3.748490510603317*^9, 3.7484905108755417`*^9}, {3.748490555296429*^9, 
   3.7484905591414533`*^9}, {3.748490712503153*^9, 3.7484907150345716`*^9}, {
   3.748490754730813*^9, 3.7484907556961117`*^9}, {3.748521924342457*^9, 
   3.7485219244693794`*^9}, {3.7485220663221264`*^9, 
   3.7485220686018515`*^9}, {3.7485221027052617`*^9, 
   3.7485221030662355`*^9}, {3.748522139474576*^9, 3.7485221399881463`*^9}, {
   3.748522173277643*^9, 3.748522173729622*^9}, 3.7485222785840387`*^9, {
   3.7530564244521513`*^9, 3.7530564309680696`*^9}, {3.753056478514967*^9, 
   3.7530564859704924`*^9}, {3.753056597356326*^9, 
   3.7530566294050927`*^9}},ExpressionUUID->"875f4847-e40e-4697-a22e-\
918a103740c9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lmax", " ", "=", " ", "8"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dim", " ", "=", " ", 
   RowBox[{
    RowBox[{"2", " ", "lmax"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ham0", "[", 
    RowBox[{"k_", ",", "NN_"}], "]"}], " ", "=", " ", 
   RowBox[{"Normal", "[", 
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"k", "+", 
            RowBox[{"2", 
             RowBox[{"(", 
              RowBox[{"l", " ", "-", " ", 
               RowBox[{"(", 
                RowBox[{"lmax", "+", "1"}], ")"}]}], ")"}]}]}], ")"}], "2"]}],
         "  ", ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          FractionBox["NN", "2"], "/;", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"i", "-", "j"}], "]"}], "\[Equal]", "1"}]}]}]}], "}"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BlochBands", "[", 
     RowBox[{"kk_", ",", "NN_"}], "]"}], " ", ":=", 
    RowBox[{
     RowBox[{"Eigensystem", "[", 
      RowBox[{"Ham0", "[", 
       RowBox[{"kk", ",", "NN"}], "]"}], "]"}], "\[LeftDoubleBracket]", "1", 
     "\[RightDoubleBracket]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"N", "[", 
     RowBox[{"BlochBands", "[", 
      RowBox[{"1", ",", "12"}], "]"}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"N", "[", 
     RowBox[{"BlochBands", "[", 
      RowBox[{"1", ",", "15"}], "]"}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"N", "[", 
     RowBox[{"BlochBands", "[", 
      RowBox[{"0", ",", "12"}], "]"}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"N", "[", 
     RowBox[{"BlochBands", "[", 
      RowBox[{"0", ",", "15"}], "]"}], "]"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"Plot", "[", 
     RowBox[{
      RowBox[{"BlochBands", "[", 
       RowBox[{"k", ",", "15"}], "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"k", ",", " ", 
        RowBox[{"-", "2"}], ",", " ", "2"}], "}"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "15"}], ",", " ", "25"}], "}"}]}], ",", " ", 
      RowBox[{"AxesLabel", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Quasimomentum", " ", 
          SubscriptBox["k", "q"]}], ",", 
         RowBox[{"Energy", "  ", "[", 
          SubscriptBox["E", "r"], "]"}]}], "}"}]}]}], " ", "]"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Plot", "[", 
     RowBox[{
      RowBox[{"BlochBands", "[", 
       RowBox[{"k", ",", "20"}], "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"k", ",", " ", 
        RowBox[{"-", "2"}], ",", " ", "2"}], "}"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "15"}], ",", " ", "25"}], "}"}]}], ",", " ", 
      RowBox[{"AxesLabel", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Quasimomentum", " ", 
          SubscriptBox["k", "q"]}], ",", 
         RowBox[{"Energy", "  ", "[", 
          SubscriptBox["E", "r"], "]"}]}], "}"}]}]}], " ", "]"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Plot", "[", 
     RowBox[{
      RowBox[{"BlochBands", "[", 
       RowBox[{"k", ",", "25"}], "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"k", ",", " ", 
        RowBox[{"-", "2"}], ",", " ", "2"}], "}"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "15"}], ",", " ", "25"}], "}"}]}], ",", " ", 
      RowBox[{"AxesLabel", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Quasimomentum", " ", 
          SubscriptBox["k", "q"]}], ",", 
         RowBox[{"Energy", "  ", "[", 
          SubscriptBox["E", "r"], "]"}]}], "}"}]}]}], " ", "]"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Plot", "[", 
     RowBox[{
      RowBox[{"BlochBands", "[", 
       RowBox[{"k", ",", "30"}], "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"k", ",", " ", 
        RowBox[{"-", "2"}], ",", " ", "2"}], "}"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "15"}], ",", " ", "25"}], "}"}]}], ",", " ", 
      RowBox[{"AxesLabel", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Quasimomentum", " ", 
          SubscriptBox["k", "q"]}], ",", 
         RowBox[{"Energy", "  ", "[", 
          SubscriptBox["E", "r"], "]"}]}], "}"}]}]}], " ", "]"}]}], 
   "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Nmin", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Nmax", " ", "=", " ", "16"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dN", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Bands", "[", "NNN_", "]"}], " ", ":=", " ", 
   RowBox[{"Sort", "[", 
    RowBox[{
     RowBox[{"N", "[", 
      RowBox[{"BlochBands", "[", 
       RowBox[{"1", ",", "NNN"}], "]"}], "]"}], ",", " ", "Greater"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BandsMiddle", "[", "NNN_", "]"}], ":=", 
    RowBox[{"Sort", "[", 
     RowBox[{
      RowBox[{"N", "[", 
       RowBox[{"BlochBands", "[", 
        RowBox[{"0", ",", "NNN"}], "]"}], "]"}], ",", " ", "Greater"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Bands", "[", "4", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Gap1", " ", "=", " ", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Bands", "[", "NNN", "]"}], "\[LeftDoubleBracket]", 
      RowBox[{"dim", "-", "1"}], "\[RightDoubleBracket]"}], " ", "-", " ", 
     RowBox[{
      RowBox[{"Bands", "[", "NNN", "]"}], "\[LeftDoubleBracket]", "dim", 
      "\[RightDoubleBracket]"}]}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"NNN", ",", " ", "Nmin", ",", " ", "Nmax", ",", " ", "dN"}], 
     "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Gap2", " ", "=", " ", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"BandsMiddle", "[", "NNN", "]"}], "\[LeftDoubleBracket]", 
      RowBox[{"dim", "-", "2"}], "\[RightDoubleBracket]"}], " ", "-", " ", 
     RowBox[{
      RowBox[{"BandsMiddle", "[", "NNN", "]"}], "\[LeftDoubleBracket]", 
      RowBox[{"dim", "-", "1"}], "\[RightDoubleBracket]"}]}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"NNN", ",", " ", "Nmin", ",", " ", "Nmax", ",", " ", "dN"}], 
     "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Gap3", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Bands", "[", "NNN", "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "3"}], "\[RightDoubleBracket]"}], " ", "-", " ", 
      RowBox[{
       RowBox[{"Bands", "[", "NNN", "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"dim", "-", "2"}], "\[RightDoubleBracket]"}]}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"NNN", ",", " ", "Nmin", ",", " ", "Nmax", ",", " ", "dN"}], 
      "}"}]}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"TheList12", " ", "=", " ", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{"Gap1", ",", "Gap2"}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TheList23", " ", "=", " ", 
    RowBox[{"Transpose", "[", 
     RowBox[{"{", 
      RowBox[{"Gap1", ",", "Gap3"}], "}"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Ns", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{"w", ",", 
     RowBox[{"{", 
      RowBox[{"w", ",", "Nmin", ",", " ", "Nmax", ",", " ", "dN"}], "}"}]}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"ListLogLogPlot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"TheList12", ",", " ", "TheList23"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ListLogLogPlot", "[", 
  RowBox[{
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{"Ns", ",", " ", "Gap1"}], "}"}], "]"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ListLogLogPlot", "[", 
  RowBox[{
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{"Ns", ",", " ", "Gap2"}], "}"}], "]"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ListLogLogPlot", "[", 
  RowBox[{
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{"Ns", ",", " ", "Gap3"}], "}"}], "]"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7523562116074963`*^9, 3.752356257940153*^9}, {
   3.75235632383138*^9, 3.752356581900564*^9}, {3.7523566410052347`*^9, 
   3.752356671994624*^9}, {3.752356721323798*^9, 3.7523567469010196`*^9}, {
   3.752356816168661*^9, 3.7523568616802316`*^9}, {3.752356937301201*^9, 
   3.7523569698040166`*^9}, {3.752357006859883*^9, 3.7523570165101633`*^9}, {
   3.7523571500585146`*^9, 3.752357166293332*^9}, {3.752357285286745*^9, 
   3.752357325749173*^9}, {3.7523583672312794`*^9, 3.752358376314396*^9}, {
   3.7523584744521513`*^9, 3.752358494134145*^9}, {3.7523585334029408`*^9, 
   3.7523585465289354`*^9}, {3.752358797827998*^9, 3.752358874830658*^9}, {
   3.752358953398587*^9, 3.7523589661462584`*^9}, {3.7523721038081894`*^9, 
   3.752372135801633*^9}, {3.752372388299224*^9, 3.7523725307044935`*^9}, {
   3.75237256553636*^9, 3.752372716208522*^9}, {3.752372856799641*^9, 
   3.752372864048257*^9}, {3.752373042481227*^9, 3.75237309014579*^9}, {
   3.7523731792573266`*^9, 3.752373256348777*^9}, {3.7523733966924562`*^9, 
   3.7523734038012285`*^9}, {3.7524562306667895`*^9, 3.752456272713713*^9}, {
   3.7530288488823943`*^9, 3.7530288518200426`*^9}, 3.753054629920905*^9, {
   3.7530546992226286`*^9, 3.753054759908487*^9}, {3.75305485921138*^9, 
   3.753054868687332*^9}, {3.7530549587366247`*^9, 3.753054975094528*^9}, {
   3.7530551048643646`*^9, 3.7530551121722903`*^9}, {3.7530552028114967`*^9, 
   3.7530553173287716`*^9}},ExpressionUUID->"eb1a9636-6e05-4054-b038-\
d74ba4e5bdbd"],

Cell[BoxData[
 RowBox[{"Transpose", "[", 
  RowBox[{"{", 
   RowBox[{"Gap1", ",", "Gap2"}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.752357245819319*^9, 
  3.7523572719989133`*^9}},ExpressionUUID->"15be4c19-950a-4386-b610-\
c9ace1f7610d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{
   "pl", ",", " ", "\[Eta]", ",", "\[Eta]11", ",", "\[Eta]33", ",", "NBloch", 
    ",", "p0", ",", " ", "\[Kappa]\[Kappa]", ",", "pl", ",", "Ham0", ",", 
    "Ham1", ",", "q", ",", "k", ",", "m", ",", " ", "r", ",", " ", 
    "\[Psi]iBloch", ",", " ", "rr", ",", " ", "tt", ",", " ", "t", ",", " ", 
    "HamLoad", ",", " ", "HamUnLoad", ",", " ", "HamUnLoad0", ",", " ", 
    "\[Psi]cf"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rGrav", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NBloch", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NLatDep", " ", "=", " ", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NRamp", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"v0", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"k0", " ", "=", " ", 
   RowBox[{
    RowBox[{"Mod", "[", 
     RowBox[{
      RowBox[{"v0", "+", "1"}], ",", "2"}], "]"}], "-", "1"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tLoad", " ", "=", " ", 
   RowBox[{"2", " ", "Pi", " ", "6"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[CapitalDelta]\[Omega]", " ", "=", 
    RowBox[{
     RowBox[{"-", "4"}], "*", 
     RowBox[{"(", 
      RowBox[{"v0", "-", "k0"}], ")"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Kappa]", " ", "=", " ", 
   FractionBox["NLatDep", "8"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"r", " ", "=", " ", 
   RowBox[{"NRamp", "*", "rGrav"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlochPeriod", " ", "=", 
   RowBox[{"Abs", "[", 
    FractionBox["8", "r"], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"TBloch", " ", "=", " ", 
   RowBox[{"BlochPeriod", " ", "*", " ", "NBloch"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lmax", " ", "=", " ", 
    RowBox[{"Max", "[", 
     RowBox[{"10", ",", 
      RowBox[{"Round", "[", 
       RowBox[{"5.", "*", 
        SuperscriptBox["NLatDep", 
         RowBox[{"1", "/", "4"}]]}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dim", " ", "=", " ", 
    RowBox[{
     RowBox[{"lmax", "*", "2"}], "+", "1"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"loadLattice", "[", 
    RowBox[{
    "lMax_", ",", " ", "vv0_", ",", " ", "tLoad_", ",", " ", "loadHam_"}], 
    "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
       RowBox[{"v0", " ", "=", " ", "vv0"}], ",", " ", 
       RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
       RowBox[{"HamLoad", " ", "=", " ", "loadHam"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{
       "\[Psi]", ",", " ", "\[Psi]i", ",", " ", "\[Psi]ci", ",", " ", "ics", 
        ",", " ", "cs"}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"dimState", " ", "=", " ", 
       RowBox[{
        RowBox[{"2", "*", "maxL"}], " ", "+", " ", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Psi]i", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", "dimState"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"rem", " ", "=", " ", 
       RowBox[{"Mod", "[", 
        RowBox[{"v0", ",", " ", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"Floor", "[", 
        FractionBox[
         RowBox[{"v0", "+", "1"}], "2"], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m0", " ", "=", " ", 
       RowBox[{
        RowBox[{"Mod", "[", 
         RowBox[{
          RowBox[{"v0", "+", "1"}], ",", " ", "2"}], "]"}], " ", "-", " ", 
        "1"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]i", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"-", "state"}], " ", "+", "maxL", "+", "1"}], "]"}], "]"}], 
       " ", "=", " ", "1"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "maxL"}], ",", "maxL", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "maxL"}], ",", "maxL", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"maxL", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "maxL"}], ",", "maxL", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"equation", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{"HamLoad", "[", "tt", "]"}], ".", 
          RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
         RowBox[{"{", 
          RowBox[{"tt", ",", "0", ",", "tLoad"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
        RowBox[{
        "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[Psi]ci"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"unLoadLattice", "[", 
    RowBox[{
    "lMax_", ",", " ", "tLoad_", ",", " ", "unLoadHam_", ",", " ", 
     "\[Psi]ci_", ",", "vv0_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxL", "=", " ", "lMax"}], ",", " ", 
       RowBox[{"loadTime", " ", "=", " ", "tLoad"}], ",", " ", 
       RowBox[{"HamUnLoad", " ", "=", " ", "unLoadHam"}], ",", " ", 
       RowBox[{"\[Psi]i", "=", " ", "\[Psi]ci"}], ",", 
       RowBox[{"v0", "=", "vv0"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{"\[Psi]", ",", " ", "ics", ",", " ", "cs"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{"ci", "[", "nn", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ics", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
          RowBox[{"\[Psi]i", "\[LeftDoubleBracket]", 
           RowBox[{"nn", "+", 
            RowBox[{"(", 
             RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}],
          ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", 
           RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"equation", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{"HamUnLoad", "[", "tt", "]"}], ".", 
          RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
         RowBox[{"{", 
          RowBox[{"tt", ",", "0", ",", "loadTime"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Psi]cff", "[", "tt_", "]"}], "=", 
       RowBox[{
        RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
        RowBox[{
        "sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[Psi]cff"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "\[Psi]", ",", " ", "ics", ",", " ", "cs", ",", " ", "\[CapitalDelta]"}], 
    "]"}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kl", "[", 
    RowBox[{"l_", ",", "v_"}], "]"}], ":=", 
   RowBox[{"v", "+", 
    RowBox[{"2", " ", "l"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ham0", "[", 
    RowBox[{"tt_", ",", "v_"}], "]"}], " ", "=", " ", 
   RowBox[{"Normal", "[", 
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"kl", "[", 
            RowBox[{
             RowBox[{"l", " ", "-", " ", 
              RowBox[{"(", 
               RowBox[{"lmax", "+", "1"}], ")"}]}], ",", "v"}], "]"}], "2"], 
          " ", "+", 
          RowBox[{"4", " ", "\[Kappa]\[Kappa]"}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", " ", "\[Kappa]\[Kappa]", 
           RowBox[{"(", 
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"-", "\[ImaginaryI]"}], " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"tt", " ", 
                 RowBox[{"(", " ", 
                  RowBox[{"\[CapitalDelta]", "+", 
                   FractionBox[
                    RowBox[{"rr", " ", "tt"}], "2"]}], ")"}]}], " ", "+", " ",
                 "\[Phi]"}], ")"}]}], "]"}], ")"}]}], " ", "/;", " ", 
          RowBox[{
           RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
           RowBox[{"(", 
            RowBox[{"Exp", "[", 
             RowBox[{"\[ImaginaryI]", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"tt", " ", 
                 RowBox[{"(", " ", 
                  RowBox[{"\[CapitalDelta]", "+", 
                   FractionBox[
                    RowBox[{"rr", " ", "tt"}], "2"]}], ")"}]}], " ", "+", " ",
                 "\[Phi]"}], ")"}]}], "]"}], ")"}]}], "/;", 
          RowBox[{
           RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HamLoad", "[", "tt_", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"Ham0", "[", 
     RowBox[{"tt", ",", "k0"}], "]"}], "/.", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
       RowBox[{"\[Kappa]", " ", 
        FractionBox["tt", "tLoad"]}]}], ",", " ", 
      RowBox[{"rr", "\[Rule]", "0"}], ",", " ", 
      RowBox[{
      "\[CapitalDelta]", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
      ",", " ", 
      RowBox[{"\[Phi]", "\[Rule]", "0"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HamUnLoad0", "[", 
    RowBox[{"tt_", ",", "v_"}], "]"}], " ", "=", " ", 
   RowBox[{"Normal", "[", 
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"kl", "[", 
            RowBox[{
             RowBox[{"l", " ", "-", " ", 
              RowBox[{"(", 
               RowBox[{"lmax", "+", "1"}], ")"}]}], ",", "v"}], "]"}], "2"], 
          " ", "+", 
          RowBox[{"4", " ", "\[Kappa]\[Kappa]"}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
           RowBox[{"(", 
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"-", "\[ImaginaryI]"}], " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"tt", " ", 
                 RowBox[{"(", " ", 
                  RowBox[{"\[CapitalDelta]", " ", "+", 
                   FractionBox["rr", "2"]}], ")"}]}], " ", "+", " ", 
                "\[Phi]"}], ")"}]}], "]"}], ")"}]}], " ", "/;", " ", 
          RowBox[{
           RowBox[{"a", "-", "b"}], "\[Equal]", "1"}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"m_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"2", " ", "\[Kappa]\[Kappa]", " ", 
           RowBox[{"(", 
            RowBox[{"Exp", "[", 
             RowBox[{"\[ImaginaryI]", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"tt", " ", 
                 RowBox[{"(", " ", 
                  RowBox[{"\[CapitalDelta]", " ", "+", 
                   FractionBox["rr", "2"]}], ")"}]}], " ", "+", " ", 
                "\[Phi]"}], ")"}]}], "]"}], ")"}]}], "/;", 
          RowBox[{
           RowBox[{"n", "-", "m"}], "\[Equal]", "1"}]}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HamUnLoad", "[", "tt_", "]"}], "=", 
   RowBox[{
    RowBox[{"HamUnLoad0", "[", 
     RowBox[{"tt", ",", "k0"}], "]"}], "/.", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", 
       RowBox[{"\[Kappa]", " ", 
        FractionBox[
         RowBox[{"(", 
          RowBox[{"tLoad", "-", "tt"}], ")"}], "tLoad"]}]}], ",", " ", 
      RowBox[{"rr", "\[Rule]", " ", "0"}], " ", ",", " ", 
      RowBox[{"\[CapitalDelta]", " ", "\[Rule]", " ", 
       RowBox[{"\[CapitalDelta]\[Omega]", " ", "+", 
        RowBox[{"r", " ", "TBloch"}]}]}], ",", " ", 
      RowBox[{"\[Phi]", "\[Rule]", 
       RowBox[{
        FractionBox[
         RowBox[{"r", " ", 
          SuperscriptBox["TBloch", "2"]}], "2"], " ", "+", " ", 
        RowBox[{"\[CapitalDelta]\[Omega]", " ", 
         RowBox[{"(", 
          RowBox[{"TBloch", " ", "+", " ", "tLoad"}], ")"}]}]}]}]}], 
     "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ham1", "[", "tt_", "]"}], "=", 
   RowBox[{
    RowBox[{"Ham0", "[", 
     RowBox[{"tt", ",", "k0"}], "]"}], "/.", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\[Kappa]\[Kappa]", "\[Rule]", "\[Kappa]"}], ",", " ", 
      RowBox[{"rr", "\[Rule]", 
       RowBox[{"2", " ", "r", " ", 
        SuperscriptBox[
         RowBox[{"Cos", "[", 
          RowBox[{"r", " ", "tt", " ", 
           FractionBox["\[Pi]", "2"]}], "]"}], "2"]}]}], ",", " ", 
      RowBox[{
      "\[CapitalDelta]", " ", "\[Rule]", " ", "\[CapitalDelta]\[Omega]"}], 
      ",", " ", 
      RowBox[{"\[Phi]", "\[Rule]", " ", 
       RowBox[{"\[CapitalDelta]\[Omega]", " ", "tLoad"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"MatrixForm", "[", 
  RowBox[{"Ham1", "[", "t", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HamTrans", "[", "t_", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"Ham1", "[", 
     RowBox[{"t", ",", "k0"}], "]"}], ".", 
    RowBox[{"Normal", "[", 
     RowBox[{"SparseArray", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"l_", ",", "l_"}], "}"}], "\[RuleDelayed]", 
         SuperscriptBox["E", 
          RowBox[{
           RowBox[{"-", "\[ImaginaryI]"}], " ", "t", 
           RowBox[{"(", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"kl", "[", 
               RowBox[{"l", " ", "-", " ", 
                RowBox[{"(", 
                 RowBox[{"lmax", "+", "1"}], ")"}]}], "]"}], "2"], " ", "+", 
             RowBox[{"4", " ", "\[Kappa]\[Kappa]"}]}], ")"}]}]]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"dim", ",", "dim"}], "}"}]}], "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MatrixForm", "[", 
    RowBox[{"HamTrans", "[", "t", "]"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]", "[", "tt_", "]"}], "=", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ci", "[", "nn", "]"}], "[", "tt", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cs", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{"ci", "[", "nn", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"\[Psi]iBloch", " ", "=", "  ", 
  RowBox[{"loadLattice", "[", 
   RowBox[{"lmax", ",", " ", "v0", ",", " ", "tLoad", ",", " ", "HamLoad"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  SuperscriptBox[
   RowBox[{"Abs", "[", 
    RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], "]"}], "2"], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ics", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ci", "[", "nn", "]"}], "[", "0", "]"}], "\[Equal]", 
      RowBox[{
       RowBox[{"\[Psi]iBloch", "[", "tLoad", "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"nn", "+", 
        RowBox[{"(", 
         RowBox[{"lmax", "+", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"nn", ",", 
       RowBox[{"-", "lmax"}], ",", "lmax", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"equation", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "'"}], "[", "tt", "]"}], "\[Equal]", " ", 
    RowBox[{
     RowBox[{"-", "\[ImaginaryI]"}], " ", 
     RowBox[{
      RowBox[{"Ham1", "[", "tt", "]"}], ".", 
      RowBox[{"\[Psi]", "[", "tt", "]"}]}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sol", " ", "=", " ", 
   RowBox[{"NDSolve", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
     RowBox[{"{", 
      RowBox[{"tt", ",", "0", ",", "TBloch"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]ci", "[", "tt_", "]"}], "=", 
   RowBox[{
    RowBox[{"\[Psi]", "[", "tt", "]"}], "/.", 
    RowBox[{"sol", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], "\[IndentingNewLine]", 
 SuperscriptBox[
  RowBox[{"Abs", "[", 
   RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], "]"}], 
  "2"], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]cf", " ", "=", " ", 
   RowBox[{"unLoadLattice", "[", 
    RowBox[{"lmax", ",", " ", "tLoad", ",", " ", "HamUnLoad", ",", 
     RowBox[{"\[Psi]ci", "[", "TBloch", "]"}], ",", "v0"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  SuperscriptBox[
   RowBox[{"Abs", "[", 
    RowBox[{"\[Psi]cf", "[", "tLoad", "]"}], "]"}], "2"], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"load", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]iBloch", "[", "t", "]"}], "]"}], "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "tLoad"}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BO", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]ci", "[", 
        RowBox[{"t", "-", "tLoad"}], "]"}], "]"}], "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "tLoad", ",", 
       RowBox[{"tLoad", " ", "+", " ", "TBloch"}]}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"unload", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", 
       RowBox[{"\[Psi]cf", "[", 
        RowBox[{"t", "-", "tLoad", " ", "-", " ", "TBloch"}], "]"}], "]"}], 
      "2"], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{"tLoad", " ", "+", " ", "TBloch"}], ",", 
       RowBox[{
        RowBox[{"2", " ", "tLoad"}], " ", "+", " ", "TBloch"}]}], "}"}], ",", 
     " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", "BO", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"load", ",", " ", "BO", ",", " ", "unload"}], "}"}], ",", " ", 
   RowBox[{"AxesLabel", "\[Rule]", " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<Time (dimensionless)\>\"", ",", " ", 
      "\"\<Probability Amplitude\>\""}], "}"}]}], ",", " ", 
   RowBox[{"ImageSize", "\[Rule]", " ", 
    RowBox[{"{", 
     RowBox[{"700", ",", "400"}], "}"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7826176042612925`*^9, 3.782617610397622*^9}, {
  3.78261764804418*^9, 3.7826176746787624`*^9}, {3.7826177064801273`*^9, 
  3.7826177113381386`*^9}, {3.78261783057139*^9, 3.7826178848465137`*^9}, {
  3.78261795133352*^9, 3.782618079204628*^9}, {3.782618121525638*^9, 
  3.7826181301646338`*^9}, {3.782618251306883*^9, 
  3.782618257205654*^9}},ExpressionUUID->"c90069d0-3cb7-4245-b516-\
a8d3ac01bf05"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1904, 997},
WindowMargins->{{-8, Automatic}, {Automatic, 0}},
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1281, 29, 49, "Input",ExpressionUUID->"9683201a-c063-4b23-a797-40f561c4b66a"],
Cell[CellGroupData[{
Cell[1864, 53, 383, 6, 96, "Title",ExpressionUUID->"72126f28-df3c-41af-85d8-de8d4133e54c"],
Cell[CellGroupData[{
Cell[2272, 63, 326, 5, 67, "Section",ExpressionUUID->"c743ae9a-090d-420d-a144-a92cae18c743"],
Cell[2601, 70, 7539, 111, 386, "Text",ExpressionUUID->"a2fc3284-537e-4ca5-88a3-fb7727496c0a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10177, 186, 3793, 52, 67, "Section",ExpressionUUID->"5efdd70c-920e-4e13-9f16-d6fc8501a871"],
Cell[13973, 240, 13677, 315, 740, "Text",ExpressionUUID->"1394e92c-7b7e-480a-85f9-8aa05541efc5"],
Cell[27653, 557, 7923, 167, 223, "Input",ExpressionUUID->"c98c5c60-5783-4461-bd22-f159f7448a7c"],
Cell[35579, 726, 18361, 466, 917, "Text",ExpressionUUID->"34590aa0-c1f5-406f-9d28-3fc4ad0276d6"],
Cell[53943, 1194, 4205, 87, 162, "Input",ExpressionUUID->"d9bef651-16da-400c-80bc-20606eb9e0be"],
Cell[58151, 1283, 2172, 37, 254, "Text",ExpressionUUID->"438c889f-41a3-41a1-9d69-e6a8e7ea0f6e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[60360, 1325, 247, 5, 67, "Section",ExpressionUUID->"46845895-8a47-46c5-a608-ee752aa0b69d"],
Cell[60610, 1332, 331, 8, 56, "Text",ExpressionUUID->"b9941298-489a-4a4d-808e-7f1abc56eda9"],
Cell[60944, 1342, 40930, 1045, 3067, "Input",ExpressionUUID->"45dcede9-ed50-43b8-89b3-a7bdd7ec6920"]
}, Open  ]],
Cell[CellGroupData[{
Cell[101911, 2392, 224, 4, 67, "Section",ExpressionUUID->"932035d5-e66c-4a0a-8c25-dde2f622f089"],
Cell[102138, 2398, 636, 11, 56, "Text",ExpressionUUID->"21695f31-11f8-4806-8ddf-3a873d227879"],
Cell[102777, 2411, 20480, 535, 2296, "Input",ExpressionUUID->"0884d85a-59f1-4efa-91f2-e68604750c6e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[123294, 2951, 769, 11, 67, "Section",ExpressionUUID->"1bef48a0-4b57-41b1-9c57-5a7b066a2aac"],
Cell[124066, 2964, 11604, 306, 871, "Text",ExpressionUUID->"da525ee8-8bd4-4ec1-ac15-526ab0e60a55"]
}, Open  ]],
Cell[CellGroupData[{
Cell[135707, 3275, 319, 5, 67, "Section",ExpressionUUID->"b19c1240-713f-4bc9-8667-5799149691e2"],
Cell[136029, 3282, 472, 7, 34, "Text",ExpressionUUID->"8d2c47fc-adb8-48b0-a475-02685e7fc021"],
Cell[136504, 3291, 7427, 101, 28, "Input",ExpressionUUID->"7afd8b0f-e4f5-444d-aedd-b5b6e6aa067c"],
Cell[143934, 3394, 156, 3, 28, "Input",ExpressionUUID->"687e0dc3-d1dd-4dd6-954b-9f909d62572d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[144127, 3402, 346, 6, 67, "Section",ExpressionUUID->"7f81da71-d436-40cf-ab3d-2be4d96db746"],
Cell[144476, 3410, 5297, 72, 48, "Input",ExpressionUUID->"2172d681-5467-479e-8a91-76f5508d5177"]
}, Open  ]],
Cell[CellGroupData[{
Cell[149810, 3487, 401, 9, 105, "Section",ExpressionUUID->"39360da8-6692-4df3-8c26-6e6fb5e9761e"],
Cell[150214, 3498, 39785, 889, 1919, "Input",ExpressionUUID->"6f9e9a3e-c9c3-49b4-8b4c-3157797561d6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[190036, 4392, 173, 3, 67, "Section",ExpressionUUID->"059bb7e4-f7cb-4c59-9dc8-170d58fe24f9"],
Cell[190212, 4397, 32579, 794, 1864, "Input",ExpressionUUID->"eb24d7ce-b747-4be9-850e-ce05a408fad2"],
Cell[222794, 5193, 129, 3, 28, "Input",ExpressionUUID->"6f6f4103-a770-41b0-9b7a-d06e0581e29e"],
Cell[222926, 5198, 156, 3, 28, "Input",ExpressionUUID->"0ca48f2f-7f5f-4475-968e-6ef9dc995c62"],
Cell[223085, 5203, 154, 3, 28, "Input",ExpressionUUID->"bea0fdac-30c5-4c83-a307-28e6f2a8a03d"],
Cell[223242, 5208, 154, 3, 28, "Input",ExpressionUUID->"5251a683-0efc-43f6-abca-477bac8cbc87"],
Cell[223399, 5213, 154, 3, 28, "Input",ExpressionUUID->"168397dc-6ec9-4a7d-b73f-7ee2bf3c3c64"],
Cell[CellGroupData[{
Cell[223578, 5220, 156, 3, 28, "Input",ExpressionUUID->"a0735ba1-f040-4706-9508-bbae90fe453c"],
Cell[223737, 5225, 2037, 33, 21, "Message",ExpressionUUID->"9e9d0383-74ee-44f7-a459-8b860cfef59c"]
}, Open  ]],
Cell[225789, 5261, 156, 3, 28, "Input",ExpressionUUID->"443cdfdc-7369-40e5-8630-1e9d5a764e44"]
}, Open  ]],
Cell[CellGroupData[{
Cell[225982, 5269, 176, 3, 67, "Section",ExpressionUUID->"0c4874c1-72a4-4a82-83e9-c1fbcb9b2011"],
Cell[226161, 5274, 22870, 608, 1825, "Input",ExpressionUUID->"9b93bacd-1aa2-4b07-9c43-c106d6c61d40"]
}, Open  ]],
Cell[CellGroupData[{
Cell[249068, 5887, 290, 7, 67, "Section",ExpressionUUID->"ab790ed3-42c3-4e35-a1e5-9005bc2c55b6"],
Cell[249361, 5896, 50789, 1314, 3646, "Input",ExpressionUUID->"fe4bf2f2-79ab-4602-91f4-fe4eb2a8c4b6"],
Cell[300153, 7212, 334, 8, 67, "Input",ExpressionUUID->"0f1abc11-73b4-4b89-8d28-238cc505f6b4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[300524, 7225, 281, 4, 67, "Section",ExpressionUUID->"db509298-9d5b-4b7a-97d1-ffc43a9b66f8"],
Cell[300808, 7231, 79290, 1772, 4106, "Input",ExpressionUUID->"914f5001-5385-481e-ab04-ca96dd50c059"],
Cell[380101, 9005, 156, 3, 28, "Input",ExpressionUUID->"d89c1af4-6e5c-440d-9ddc-0e928aec0161"],
Cell[380260, 9010, 152, 3, 28, "Input",ExpressionUUID->"f69c087e-56c7-48c3-88cf-acdc5eb221af"],
Cell[380415, 9015, 222, 4, 48, "Input",ExpressionUUID->"62b82f68-00b7-4834-8ded-5dced9a5a254"],
Cell[380640, 9021, 154, 3, 28, "Input",ExpressionUUID->"9b028130-dae9-4c4a-8a84-85b4ce2f7358"],
Cell[380797, 9026, 175, 3, 28, "Input",ExpressionUUID->"511631ba-d020-4e44-bc48-c021c48ea897"],
Cell[380975, 9031, 154, 3, 28, "Input",ExpressionUUID->"669322ba-1fbf-4fd7-8f96-61ccfb6ef55c"],
Cell[381132, 9036, 154, 3, 28, "Input",ExpressionUUID->"738544a3-1518-4e03-b137-833a05dde45d"],
Cell[381289, 9041, 227, 4, 28, "Input",ExpressionUUID->"4ecae579-fc28-4289-8f47-8c0abba9f138"],
Cell[381519, 9047, 156, 3, 28, "Input",ExpressionUUID->"15cf8d18-b159-4bbc-a260-00e55e73249e"],
Cell[381678, 9052, 156, 3, 28, "Input",ExpressionUUID->"8256aa35-a3ba-479d-8eb9-166a7f0a7b89"],
Cell[381837, 9057, 147, 3, 48, "Input",ExpressionUUID->"a07eeed0-a5ec-4e97-a6bf-4febdc96d66d"],
Cell[381987, 9062, 1564, 32, 466, "Input",ExpressionUUID->"2d2bbb78-4853-447e-9ae5-2c229f2a6e58"],
Cell[383554, 9096, 129, 3, 28, "Input",ExpressionUUID->"037ef508-7124-4dbe-b4fd-c412c98af8b7"],
Cell[383686, 9101, 154, 3, 28, "Input",ExpressionUUID->"6317b6cb-2b87-4023-9864-d54bd89e460f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[383877, 9109, 214, 4, 67, "Section",ExpressionUUID->"fe425fa6-55e9-4275-a5e7-3f6e797171e5"],
Cell[384094, 9115, 41509, 1025, 3043, "Input",ExpressionUUID->"44429642-975b-4e4b-8899-eb484e9924e3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[425640, 10145, 4740, 64, 67, "Section",ExpressionUUID->"f6e04396-86d1-4f9c-8433-4453dad80800"],
Cell[430383, 10211, 34983, 767, 2279, "Input",ExpressionUUID->"b1ce8f62-9769-4d88-87e5-96b26006a05e"],
Cell[465369, 10980, 18672, 436, 1112, "Input",ExpressionUUID->"0f4e6e91-762d-49df-a3a8-9b7b9d69ac4e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[484078, 11421, 186, 3, 67, "Section",ExpressionUUID->"d4c95dc4-4b31-45cc-909e-eff124e5a21e"],
Cell[484267, 11426, 703, 12, 34, "Text",ExpressionUUID->"565693e2-08ad-43ef-8a2d-eb5bd2314c8c"],
Cell[484973, 11440, 2594, 69, 53, "Input",ExpressionUUID->"c242f5b9-b83b-4a72-a5a5-a21ca8cee72c"],
Cell[487570, 11511, 1347, 24, 171, "Text",ExpressionUUID->"29f2d9bb-d28e-4e97-98aa-7bd41fcafe9c"],
Cell[488920, 11537, 3478, 95, 73, "Input",ExpressionUUID->"ad685179-430c-43ae-a553-e8dfc73c741d"],
Cell[492401, 11634, 1146, 21, 166, "Text",ExpressionUUID->"bf72c9e4-9367-4645-8dec-cb0244cc6dfd"],
Cell[493550, 11657, 4518, 124, 73, "Input",ExpressionUUID->"d3b6cb5c-7ba3-4db2-9972-836ae3d06a07"],
Cell[498071, 11783, 5218, 164, 86, "Input",ExpressionUUID->"ed0471a5-3e15-4f80-9f53-7d966099b217"],
Cell[503292, 11949, 844, 16, 122, "Text",ExpressionUUID->"a27a57cb-7b07-463d-8ad2-4d2589334955"],
Cell[504139, 11967, 1577, 44, 28, "Input",ExpressionUUID->"05ecaeb9-0aaa-4e31-8f56-b489fb460e5c"],
Cell[505719, 12013, 612, 17, 48, "Input",ExpressionUUID->"bca8c146-823a-4881-aaad-3df526d3245a"],
Cell[506334, 12032, 451, 7, 48, "Input",ExpressionUUID->"f91bacbb-96d1-4778-a3a2-e16fdc7bc613"],
Cell[506788, 12041, 154, 3, 28, "Input",ExpressionUUID->"b560eb49-e4bc-44b6-86d1-50b6a219dd4a"],
Cell[506945, 12046, 331, 5, 28, "Input",ExpressionUUID->"e8f59a99-5b2d-433b-ba6c-be02c1b1ed3e"],
Cell[507279, 12053, 154, 3, 28, "Input",ExpressionUUID->"fb4565f4-f948-43c4-9591-70d7bd839a45"],
Cell[507436, 12058, 154, 3, 28, "Input",ExpressionUUID->"44e91a39-e865-40d5-8996-d86b6139d174"]
}, Open  ]],
Cell[CellGroupData[{
Cell[507627, 12066, 630, 16, 67, "Section",ExpressionUUID->"f6ae40a7-c774-4579-ab40-8ebb998d2234"],
Cell[508260, 12084, 44821, 1156, 3152, "Input",ExpressionUUID->"cda46331-ed51-4624-8ac4-dc7e748ce890"],
Cell[553084, 13242, 44492, 1132, 3292, "Input",ExpressionUUID->"d8bddd09-8f4a-4527-92d3-ef285f2c73bf"]
}, Open  ]],
Cell[CellGroupData[{
Cell[597613, 14379, 228, 4, 67, "Section",ExpressionUUID->"75edfa4d-7ccb-4b60-a720-8d9fe0c45e46"],
Cell[597844, 14385, 48986, 1246, 3568, "Input",ExpressionUUID->"875f4847-e40e-4697-a22e-918a103740c9"],
Cell[646833, 15633, 10781, 277, 816, "Input",ExpressionUUID->"eb1a9636-6e05-4054-b038-d74ba4e5bdbd"],
Cell[657617, 15912, 243, 6, 28, "Input",ExpressionUUID->"15be4c19-950a-4386-b610-c9ace1f7610d"],
Cell[657863, 15920, 23107, 633, 1746, "Input",ExpressionUUID->"c90069d0-3cb7-4245-b516-a8d3ac01bf05"]
}, Open  ]]
}, Open  ]]
}
]
*)

