(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     95784,       2269]
NotebookOptionsPosition[     93577,       2229]
NotebookOutlinePosition[     93954,       2245]
CellTagsIndexPosition[     93911,       2242]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Calculating shtuff for Kagome lattice", "Title",
 CellChangeTimes->{{3.7964181127988725`*^9, 3.7964182377909393`*^9}, {
   3.7964212323825445`*^9, 3.796421397850155*^9}, {3.7964214619505916`*^9, 
   3.796421620187564*^9}, {3.796421823289322*^9, 3.796421876591899*^9}, {
   3.796421932910861*^9, 3.796422354549322*^9}, {3.796422441267102*^9, 
   3.796422516019143*^9}, {3.796423264762141*^9, 3.7964233523864384`*^9}, {
   3.7964234683459487`*^9, 3.7964237140592318`*^9}, {3.7964237444599476`*^9, 
   3.7964238375616384`*^9}, {3.796493613872202*^9, 3.796493622900425*^9}, 
   3.796494015924507*^9, {3.796494057138955*^9, 3.79649406462798*^9}, {
   3.796495498062047*^9, 3.796495537173437*^9}, {3.796501230550069*^9, 
   3.7965012588027267`*^9}, {3.79650130533492*^9, 3.7965013077870245`*^9}, {
   3.796501409325836*^9, 3.7965014125053687`*^9}, {3.7965014586542625`*^9, 
   3.7965015851119947`*^9}, {3.796501617130787*^9, 3.7965016252455893`*^9}, {
   3.7965016951026764`*^9, 
   3.796501710321185*^9}},ExpressionUUID->"ce6a7457-966c-4055-8c1e-\
327ce4c030af"],

Cell["First look at 3-site tight-binding model", "Section",
 CellChangeTimes->{{3.7964181127988725`*^9, 3.7964182377909393`*^9}, {
   3.7964212323825445`*^9, 3.796421397850155*^9}, {3.7964214619505916`*^9, 
   3.796421620187564*^9}, {3.796421823289322*^9, 3.796421876591899*^9}, {
   3.796421932910861*^9, 3.796422354549322*^9}, {3.796422441267102*^9, 
   3.796422516019143*^9}, {3.796423264762141*^9, 3.7964233523864384`*^9}, {
   3.7964234683459487`*^9, 3.7964237140592318`*^9}, {3.7964237444599476`*^9, 
   3.7964238375616384`*^9}, {3.796493613872202*^9, 3.796493622900425*^9}, 
   3.796494015924507*^9, {3.796494057138955*^9, 3.79649406462798*^9}, {
   3.796495498062047*^9, 3.796495537173437*^9}, {3.796501230550069*^9, 
   3.7965012588027267`*^9}, {3.79650130533492*^9, 3.7965013077870245`*^9}, {
   3.796501409325836*^9, 3.7965014125053687`*^9}, {3.7965014586542625`*^9, 
   3.7965015851119947`*^9}, {3.796501617130787*^9, 3.7965016252455893`*^9}, {
   3.7965016951026764`*^9, 
   3.7965017568621264`*^9}},ExpressionUUID->"38b5bb29-6262-45c1-9498-\
d468e3abe42e"],

Cell[TextData[{
 "This has exact solution, see Appendix A of the paper \
\[OpenCurlyDoubleQuote]",
 ButtonBox["Fermionization of bosons in a flat band",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://journals.aps.org/prb/pdf/10.1103/PhysRevB.99.174418"], None},
  ButtonNote->"https://journals.aps.org/prb/pdf/10.1103/PhysRevB.99.174418"],
 "\[CloseCurlyDoubleQuote] by Saurabh Maiti and Tigran Sedrakyan.\n\nWe want \
to find eigenvalues of the Hamiltonian \n\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"  ", 
    RowBox[{
     SubscriptBox["H", "k"], "  ", "=", "  ", 
     SubscriptBox["J", "1"]}]}], $Failed]],ExpressionUUID->
  "c6efebb3-b9b9-40da-8f33-ad5d612edfb2"],
 " ",
 Cell[BoxData[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0", 
      SubscriptBox["H", "2"], 
      SubscriptBox["H", "1"]},
     {
      SubscriptBox["H", "2"], "0", 
      SubscriptBox["H", "3"]},
     {
      SubscriptBox["H", "1"], 
      SubscriptBox["H", "3"], "0"}
    }], "\[NoBreak]", ")"}]],ExpressionUUID->
  "88de1de9-e98d-489d-a175-a20029255eae"],
 " \n\nwhere ",
 Cell[BoxData[
  FormBox[
   RowBox[{"  ", 
    SubscriptBox["J", "1"], "  "}], $Failed]],ExpressionUUID->
  "e42a0c7d-89fd-4f66-aa1e-345f2a4a2c0f"],
 " is the nearest-neighbor hopping matrix element, and ",
 Cell[BoxData[
  FormBox[
   RowBox[{"  ", 
    RowBox[{
     SubscriptBox["H", "i"], "  ", "=", "  ", 
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["e", 
        RowBox[{"\[ImaginaryI]", " ", 
         RowBox[{
          RowBox[{
           StyleBox["k",
            FontWeight->"Bold"], ".", 
           SubscriptBox[
            StyleBox["a",
             FontWeight->"Bold"], "i"]}], " ", "/", "2"}]}]], " ", "+", " ", 
       SuperscriptBox["e", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{
          RowBox[{
           StyleBox["k",
            FontWeight->"Bold"], ".", 
           SubscriptBox[
            StyleBox["a",
             FontWeight->"Bold"], "i"]}], " ", "/", "2"}]}]]}], 
      ")"}]}]}], $Failed]],ExpressionUUID->
  "2da557f9-4cef-4c93-a122-9590c262e632"],
 " ,   and the vectors ",
 Cell[BoxData[
  FormBox[
   RowBox[{"  ", 
    SubscriptBox["a", 
     RowBox[{"i", "  "}]]}], $Failed]],ExpressionUUID->
  "ced3ee7c-3a4b-46ce-875c-2f74d4e1c1ce"],
 " are given by   \n\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["a", "1"], " ", "=", " ", "a"}], $Failed]],ExpressionUUID->
  "5161ad97-28e8-46eb-9ed4-f4ccb8d179eb"],
 Cell[BoxData[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"1"},
     {"0"}
    }], "\[NoBreak]", ")"}]],ExpressionUUID->
  "84b2313b-737a-4a77-b65d-f113dd1e912c"],
 "\n\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["a", "2"], " ", "=", " ", "a"}], $Failed]],ExpressionUUID->
  "2a60b5a9-3fa0-4737-bf35-afcac5b8283d"],
 Cell[BoxData[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"1", "/", "2"}]},
     {
      RowBox[{
       SqrtBox["3"], "/", "2"}]}
    }], "\[NoBreak]", ")"}]],ExpressionUUID->
  "2d15dbb9-5633-4feb-871d-6007609b31af"],
 "\n\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["a", "3"], " ", "=", " ", "a"}], $Failed]],ExpressionUUID->
  "b920bbbf-77cf-4709-acd0-2cbc67e46ac2"],
 Cell[BoxData[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"1", "/", "2"}]},
     {
      RowBox[{
       RowBox[{"-", 
        SqrtBox["3"]}], "/", "2"}]}
    }], "\[NoBreak]", ")"}]],ExpressionUUID->
  "04e54c9c-26a4-4c18-b08a-0d9727218db9"],
 "\n\n\n"
}], "Text",
 CellChangeTimes->{{3.7964181127988725`*^9, 3.7964182377909393`*^9}, {
   3.7964212323825445`*^9, 3.796421397850155*^9}, {3.7964214619505916`*^9, 
   3.796421620187564*^9}, {3.796421823289322*^9, 3.796421876591899*^9}, {
   3.796421932910861*^9, 3.796422354549322*^9}, {3.796422441267102*^9, 
   3.796422516019143*^9}, {3.796423264762141*^9, 3.7964233523864384`*^9}, {
   3.7964234683459487`*^9, 3.7964237140592318`*^9}, {3.7964237444599476`*^9, 
   3.7964238375616384`*^9}, {3.796493613872202*^9, 3.796493622900425*^9}, 
   3.796494015924507*^9, {3.796494057138955*^9, 3.79649406462798*^9}, {
   3.796495498062047*^9, 3.796495537173437*^9}, {3.796501230550069*^9, 
   3.7965012588027267`*^9}, {3.79650130533492*^9, 3.7965013077870245`*^9}, {
   3.796501409325836*^9, 3.7965014125053687`*^9}, {3.7965014586542625`*^9, 
   3.7965015851119947`*^9}, {3.796501617130787*^9, 3.7965016252455893`*^9}, {
   3.7965016951026764`*^9, 3.796501768780915*^9}, {3.796501813763722*^9, 
   3.796501854654502*^9}, {3.7965018848286734`*^9, 3.796501957632211*^9}, {
   3.7965020174962683`*^9, 3.796502362078551*^9}, {3.796502399221465*^9, 
   3.7965024333393407`*^9}, {3.7965024897788706`*^9, 
   3.7965026807099075`*^9}, {3.7965029314074917`*^9, 3.796502931407988*^9}, {
   3.7966124986917343`*^9, 
   3.7966125010613985`*^9}},ExpressionUUID->"ae1c271f-16fb-44ee-ab18-\
5b46d1f74a8d"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "\"\<Global'*\>\"", "]"}], "\n", 
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{
   "a1", ",", "a2", ",", "a3", ",", "a", ",", "H", ",", "Ham", ",", "kx", ",",
     "ky", ",", " ", "G1", ",", " ", "G2"}], "]"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"a1", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"1", ",", "0"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"a2", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "/", "2"}], ",", " ", 
     RowBox[{
      SqrtBox["3"], "/", "2"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"a3", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "/", "2"}], ",", " ", 
     RowBox[{
      RowBox[{"-", 
       SqrtBox["3"]}], "/", "2"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"a", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"a1", ",", "a2", ",", "a3"}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"H", "[", 
     RowBox[{"ind_", ",", " ", "kx_", ",", " ", "ky_"}], "]"}], " ", ":=", 
    " ", 
    RowBox[{
     RowBox[{"Exp", "[", 
      RowBox[{"\[ImaginaryI]", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"kx", ",", "ky"}], "}"}], ".", 
         RowBox[{
         "a", "\[LeftDoubleBracket]", "ind", "\[RightDoubleBracket]"}]}], "/",
         "2"}]}], "]"}], " ", "+", " ", 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"kx", ",", "ky"}], "}"}], ".", 
         RowBox[{
         "a", "\[LeftDoubleBracket]", "ind", "\[RightDoubleBracket]"}]}], "/",
         "2"}]}], "]"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Ham", "[", 
     RowBox[{"kx_", ",", "ky_"}], "]"}], " ", "=", " ", 
    RowBox[{"-", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", " ", 
         RowBox[{"H", "[", 
          RowBox[{"2", ",", "kx", ",", "ky"}], "]"}], ",", " ", 
         RowBox[{"H", "[", 
          RowBox[{"1", ",", "kx", ",", "ky"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"H", "[", 
          RowBox[{"2", ",", "kx", ",", "ky"}], "]"}], ",", "0", ",", 
         RowBox[{"H", "[", 
          RowBox[{"3", ",", "kx", ",", "ky"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"H", "[", 
          RowBox[{"1", ",", "kx", ",", "ky"}], "]"}], ",", 
         RowBox[{"H", "[", 
          RowBox[{"3", ",", "kx", ",", "ky"}], "]"}], ",", "0"}], "}"}]}], 
      "}"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{"Plot3D", "[", 
  RowBox[{
   RowBox[{"Sort", "@", 
    RowBox[{"Eigenvalues", "[", 
     RowBox[{"Ham", "[", 
      RowBox[{"kx", ",", "ky"}], "]"}], "]"}]}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"kx", ",", 
     RowBox[{"-", "8"}], ",", "8"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"ky", ",", 
     RowBox[{"-", "8"}], ",", "8"}], "}"}], ",", " ", 
   RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", " ", 
   RowBox[{"PlotPoints", "\[Rule]", "50"}]}], "]"}], "\n"}], "Input",
 CellChangeTimes->{{3.7964181127988725`*^9, 3.7964182377909393`*^9}, {
   3.7964212323825445`*^9, 3.796421397850155*^9}, {3.7964214619505916`*^9, 
   3.796421620187564*^9}, {3.796421823289322*^9, 3.796421876591899*^9}, {
   3.796421932910861*^9, 3.796422354549322*^9}, {3.796422441267102*^9, 
   3.796422516019143*^9}, {3.796423264762141*^9, 3.7964233523864384`*^9}, {
   3.7964234683459487`*^9, 3.7964237140592318`*^9}, {3.7964237444599476`*^9, 
   3.7964238375616384`*^9}, {3.796493613872202*^9, 3.796493622900425*^9}, 
   3.796494015924507*^9, {3.796494057138955*^9, 3.79649406462798*^9}, {
   3.796495498062047*^9, 3.796495537173437*^9}, {3.796501230550069*^9, 
   3.7965012588027267`*^9}, {3.79650130533492*^9, 3.7965013077870245`*^9}, {
   3.796501409325836*^9, 3.7965014125053687`*^9}, {3.7965014586542625`*^9, 
   3.7965015851119947`*^9}, {3.796501617130787*^9, 3.7965016252455893`*^9}, {
   3.7965016951026764`*^9, 3.7965017473379526`*^9}, {3.796502741202318*^9, 
   3.796502791453068*^9}, {3.79650283204531*^9, 3.7965029712814646`*^9}, {
   3.796503054754509*^9, 3.7965031511816473`*^9}, {3.7965032208073573`*^9, 
   3.796503223108886*^9}, {3.7965032562541327`*^9, 3.7965033689632893`*^9}, {
   3.796503401179711*^9, 3.796503406964327*^9}, {3.796503578300166*^9, 
   3.7965036098424797`*^9}, {3.796503714087799*^9, 3.79650377228571*^9}, {
   3.79650397973533*^9, 3.796504294138934*^9}, {3.7965043862741365`*^9, 
   3.796504387847864*^9}, {3.796504638872969*^9, 3.7965046730201902`*^9}, {
   3.796504809495535*^9, 3.796504811498623*^9}, {3.7965048440965023`*^9, 
   3.7965048696920786`*^9}, {3.796504980717086*^9, 3.796505108813137*^9}, {
   3.7965051718398724`*^9, 3.796505174697405*^9}, {3.796505306841651*^9, 
   3.796505315257543*^9}, {3.796505408885763*^9, 3.7965054147839713`*^9}, 
   3.796505446768525*^9, {3.7965054792026677`*^9, 3.796505481901967*^9}, {
   3.796505518072443*^9, 3.7965055757811766`*^9}, {3.796505949361744*^9, 
   3.796505976744384*^9}, {3.7965856869654055`*^9, 3.796585687599059*^9}, {
   3.7965860200550175`*^9, 3.7965860797564573`*^9}, {3.7965861493584576`*^9, 
   3.796586169084922*^9}, {3.7965862377526956`*^9, 3.7965862400822754`*^9}, {
   3.796600923633456*^9, 3.7966009274196653`*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"a456c568-889c-4150-a70d-10be18d420d2"],

Cell["Real space and k-space potentials", "Section",
 CellChangeTimes->{{3.7964181127988725`*^9, 3.7964182377909393`*^9}, {
   3.7964212323825445`*^9, 3.796421397850155*^9}, {3.7964214619505916`*^9, 
   3.796421620187564*^9}, {3.796421823289322*^9, 3.796421876591899*^9}, {
   3.796421932910861*^9, 3.796422354549322*^9}, {3.796422441267102*^9, 
   3.796422516019143*^9}, {3.796423264762141*^9, 3.7964233523864384`*^9}, {
   3.7964234683459487`*^9, 3.7964237140592318`*^9}, {3.7964237444599476`*^9, 
   3.7964238375616384`*^9}, {3.796493613872202*^9, 3.796493622900425*^9}, 
   3.796494015924507*^9, {3.796494057138955*^9, 3.79649406462798*^9}, {
   3.796495498062047*^9, 3.796495537173437*^9}, {3.796501230550069*^9, 
   3.7965012588027267`*^9}, {3.79650130533492*^9, 3.7965013077870245`*^9}, {
   3.796501409325836*^9, 3.7965014125053687`*^9}, {3.7965014586542625`*^9, 
   3.7965015851119947`*^9}, {3.796501617130787*^9, 3.7965016252455893`*^9}, {
   3.7965016951026764`*^9, 3.796501696986478*^9}, {3.796506635482395*^9, 
   3.796506641161956*^9}, {3.7965254327007966`*^9, 3.7965256055806084`*^9}, {
   3.7965256851665154`*^9, 3.796525690924758*^9}, {3.796525784898925*^9, 
   3.7965258363887267`*^9}, {3.7965264157615595`*^9, 3.796526451442286*^9}, {
   3.7965280922283173`*^9, 3.7965281890970345`*^9}, {3.7965282306113005`*^9, 
   3.7965282402306547`*^9}, {3.7965286736002493`*^9, 3.796528678724367*^9}, {
   3.7965877532973633`*^9, 3.796587760007573*^9}, {3.796599241103588*^9, 
   3.7965992754832816`*^9}, 3.7965994298340783`*^9, {3.7966002466755114`*^9, 
   3.796600270156573*^9}, {3.796600315936099*^9, 3.7966003558215704`*^9}, {
   3.796600454765662*^9, 3.7966005406428795`*^9}, {3.796600663197361*^9, 
   3.7966007375333056`*^9}, {3.796613341041902*^9, 3.7966133449015837`*^9}, {
   3.7966256209142046`*^9, 
   3.7966256691603675`*^9}},ExpressionUUID->"7189b5c7-0906-484a-92cf-\
bccdb1760a41"]
}, Open  ]],

Cell[TextData[{
 "I plot the kagome lattice in real space, then plot the fourier transform of \
the lattice potential. Since the fourier transform is a bunch of delta \
functions, I replace this with ",
 Cell[BoxData[
  FormBox[
   RowBox[{"exp", "(", 
    RowBox[{"-", 
     SuperscriptBox["r", "2"]}], ")"}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "81a36661-9eb6-48f7-b12f-07e31596f7f4"],
 " for plotting purposes.\n\nThe fourier transform is just what you get from \
transforming the 6 cosine terms in the potential, each term creates a +/-k \
coupling in k-space. For kagome this means +1 weight on 1064 terms, -0.5 on \
the 532 terms. \n\nI add the scaleK variable as a hack to get around a dumb \
property of the FourierTransform function. If you run the following:\n\n\
FourierTransform[Cos[4x],x,k]\nFourierTransform[Cos[2x],x,k]\n\
FourierTransform[Cos[1x],x,k]\nFourierTransform[Cos[1/2x],x,k]\n\
FourierTransform[Cos[1/4x],x,k]\n\nYou would see that the coefficient in \
front of the DiracDeltas is independent of k for k>1, but depends on k for \
k<1.... Doesn\[CloseCurlyQuote]t make any sense."
}], "Text",
 CellChangeTimes->{{3.7964181127988725`*^9, 3.7964182377909393`*^9}, {
   3.7964212323825445`*^9, 3.796421397850155*^9}, {3.7964214619505916`*^9, 
   3.796421620187564*^9}, {3.796421823289322*^9, 3.796421876591899*^9}, {
   3.796421932910861*^9, 3.796422354549322*^9}, {3.796422441267102*^9, 
   3.796422516019143*^9}, {3.796423264762141*^9, 3.7964233523864384`*^9}, {
   3.7964234683459487`*^9, 3.7964237140592318`*^9}, {3.7964237444599476`*^9, 
   3.7964238375616384`*^9}, {3.796493613872202*^9, 3.796493622900425*^9}, 
   3.796494015924507*^9, {3.796494057138955*^9, 3.79649406462798*^9}, {
   3.796495498062047*^9, 3.796495537173437*^9}, {3.796501230550069*^9, 
   3.7965012588027267`*^9}, {3.79650130533492*^9, 3.7965013077870245`*^9}, {
   3.796501409325836*^9, 3.7965014125053687`*^9}, {3.7965014586542625`*^9, 
   3.7965015851119947`*^9}, {3.796501617130787*^9, 3.7965016252455893`*^9}, {
   3.7965016951026764`*^9, 3.796501696986478*^9}, {3.796506635482395*^9, 
   3.796506641161956*^9}, {3.7965254327007966`*^9, 3.7965256055806084`*^9}, {
   3.7965256851665154`*^9, 3.796525690924758*^9}, {3.796525784898925*^9, 
   3.7965258363887267`*^9}, {3.7965264157615595`*^9, 3.796526451442286*^9}, {
   3.7965280922283173`*^9, 3.7965281890970345`*^9}, {3.7965282306113005`*^9, 
   3.7965282402306547`*^9}, {3.7965286736002493`*^9, 3.796528678724367*^9}, {
   3.7965877532973633`*^9, 3.796587760007573*^9}, {3.796599241103588*^9, 
   3.7965992754832816`*^9}, 3.7965994298340783`*^9, {3.7966002466755114`*^9, 
   3.796600270156573*^9}, {3.796600315936099*^9, 3.7966003558215704`*^9}, {
   3.796600454765662*^9, 3.7966005406428795`*^9}, {3.796600663197361*^9, 
   3.7966007375333056`*^9}, {3.796613341041902*^9, 3.7966133449015837`*^9}, {
   3.7966256209142046`*^9, 3.7966257188518734`*^9}, {3.7966259120819116`*^9, 
   3.7966259328745823`*^9}, {3.7966261185343122`*^9, 3.796626154437033*^9}, {
   3.7966262490285797`*^9, 3.79662630469005*^9}, {3.7966266363140936`*^9, 
   3.7966267059206614`*^9}},ExpressionUUID->"d1650bb4-a6ec-47f8-8d1e-\
9dcc5baaf02f"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"eval", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"AF", "\[Rule]", "2"}], ",", " ", 
     RowBox[{"AH", " ", "\[Rule]", " ", 
      RowBox[{"-", "1"}]}], ",", " ", 
     RowBox[{"\[Phi]1", "\[Rule]", " ", "0"}], ",", " ", 
     RowBox[{"\[Phi]2", "\[Rule]", "0"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"scaleK", " ", "=", " ", "10"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"G1", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Sin", "[", 
      FractionBox["\[Pi]", "6"], "]"}], ",", 
     RowBox[{"Cos", "[", 
      FractionBox["\[Pi]", "6"], "]"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"G2", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Sin", "[", 
       RowBox[{"-", 
        FractionBox["\[Pi]", "2"]}], "]"}], ",", " ", 
      RowBox[{"Cos", "[", 
       RowBox[{"-", 
        FractionBox["\[Pi]", "2"]}], "]"}]}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"V", "[", 
     RowBox[{"x_", ",", "y_"}], "]"}], " ", "=", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"AF", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{"scaleK", " ", 
            RowBox[{"G1", ".", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y"}], "}"}]}]}], "]"}], " ", "+", " ", 
          RowBox[{"Cos", "[", 
           RowBox[{"scaleK", " ", 
            RowBox[{"G2", ".", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y"}], "}"}]}]}], "]"}], " ", "+", " ", 
          RowBox[{"Cos", "[", 
           RowBox[{
            RowBox[{"-", "scaleK"}], " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"G1", "+", "G2"}], ")"}], ".", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y"}], "}"}]}]}], "]"}]}], ")"}]}], " ", "+", 
       " ", 
       RowBox[{"AH", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{
            RowBox[{"2", " ", "scaleK", " ", 
             RowBox[{"G1", ".", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y"}], "}"}]}]}], "+", "\[Phi]1"}], "]"}], 
          " ", "+", " ", 
          RowBox[{"Cos", "[", 
           RowBox[{
            RowBox[{"2", " ", "scaleK", " ", 
             RowBox[{"G2", ".", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y"}], "}"}]}]}], "+", "\[Phi]2"}], "]"}], 
          " ", "+", " ", 
          RowBox[{"Cos", "[", 
           RowBox[{
            RowBox[{"-", "2"}], "scaleK", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"G1", "+", "G2"}], ")"}], ".", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y"}], "}"}]}]}], "]"}]}], ")"}]}]}], ")"}], "/.",
      "eval"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fourierKagome", "[", 
     RowBox[{"kX_", ",", "kY_"}], "]"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{"FourierTransform", "[", 
       RowBox[{
        RowBox[{"V", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"kX", ",", " ", "kY"}], "}"}]}], "]"}], "/.", 
      RowBox[{
       RowBox[{"DiracDelta", "[", "a_", "]"}], "\[RuleDelayed]", " ", 
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", 
          SuperscriptBox[
           RowBox[{"Abs", "[", "a", "]"}], "2"]}], "/", 
         SuperscriptBox["1", "2"]}], "]"}]}]}], "/.", 
     RowBox[{
      RowBox[{"DiracDelta", "[", 
       RowBox[{"c_", ",", "d_"}], "]"}], "\[RuleDelayed]", " ", 
      RowBox[{"Exp", "[", 
       RowBox[{
        RowBox[{"-", 
         SuperscriptBox[
          RowBox[{"Abs", "[", 
           RowBox[{"c", "-", "d"}], "]"}], "2"]}], "/", 
        SuperscriptBox["1", "2"]}], "]"}]}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"DensityPlot", "[", 
   RowBox[{
    RowBox[{"V", "[", 
     RowBox[{"x", ",", "y"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", 
      FractionBox[
       RowBox[{"-", "10"}], "scaleK"], ",", 
      FractionBox["10", "scaleK"]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"y", ",", 
      FractionBox[
       RowBox[{"-", "10"}], "scaleK"], ",", 
      FractionBox["10", "scaleK"]}], "}"}], ",", " ", 
    RowBox[{"ColorFunction", "\[Rule]", "\"\<IslandColors\>\""}], ",", " ", 
    RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
    RowBox[{"PlotPoints", "\[Rule]", "100"}], ",", " ", 
    RowBox[{"PlotLabel", "\[Rule]", 
     RowBox[{"Style", "[", 
      RowBox[{"\"\<Real space kagome potential\>\"", ",", 
       RowBox[{"FontSize", "\[Rule]", "20"}]}], "]"}]}]}], "]"}], 
  "\n"}], "\n", 
 RowBox[{"Quiet", "@", 
  RowBox[{"DensityPlot", "[", 
   RowBox[{
    RowBox[{"fourierKagome", "[", 
     RowBox[{"kX", ",", "kY"}], "]"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"kX", ",", " ", 
      RowBox[{
       RowBox[{"-", "3"}], "scaleK"}], ",", " ", 
      RowBox[{"3", "scaleK"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"kY", ",", 
      RowBox[{
       RowBox[{"-", "3"}], "scaleK"}], ",", 
      RowBox[{"3", "scaleK"}]}], "}"}], ",", " ", 
    RowBox[{"PlotPoints", "\[Rule]", "200"}], ",", " ", 
    RowBox[{"ColorFunction", "\[Rule]", "\"\<SunsetColors\>\""}], ",", " ", 
    RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
    RowBox[{"PlotLegends", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"BarLegend", "[", "\"\<SunsetColors\>\"", "]"}], "}"}]}], ",", 
    " ", 
    RowBox[{"PlotLabel", "\[Rule]", 
     RowBox[{"Style", "[", 
      RowBox[{"\"\<k-space kagome potential\>\"", ",", 
       RowBox[{"FontSize", "\[Rule]", "20"}]}], "]"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.7964181127988725`*^9, 3.7964182377909393`*^9}, {
   3.7964212323825445`*^9, 3.796421397850155*^9}, {3.7964214619505916`*^9, 
   3.796421620187564*^9}, {3.796421823289322*^9, 3.796421876591899*^9}, {
   3.796421932910861*^9, 3.796422354549322*^9}, {3.796422441267102*^9, 
   3.796422516019143*^9}, {3.796423264762141*^9, 3.7964233523864384`*^9}, {
   3.7964234683459487`*^9, 3.7964237140592318`*^9}, {3.7964237444599476`*^9, 
   3.7964238375616384`*^9}, {3.796493613872202*^9, 3.796493622900425*^9}, 
   3.796494015924507*^9, {3.796494057138955*^9, 3.79649406462798*^9}, {
   3.796495498062047*^9, 3.796495537173437*^9}, {3.796501230550069*^9, 
   3.7965012588027267`*^9}, {3.79650130533492*^9, 3.7965013077870245`*^9}, {
   3.796501409325836*^9, 3.7965014125053687`*^9}, {3.7965014586542625`*^9, 
   3.7965015851119947`*^9}, {3.796501617130787*^9, 3.7965016252455893`*^9}, {
   3.7965016951026764`*^9, 3.796501696986478*^9}, {3.796506635482395*^9, 
   3.796506641161956*^9}, {3.7965254327007966`*^9, 3.7965256055806084`*^9}, {
   3.7965256851665154`*^9, 3.796525690924758*^9}, {3.796525784898925*^9, 
   3.7965258363887267`*^9}, {3.7965264157615595`*^9, 3.796526451442286*^9}, {
   3.7965280922283173`*^9, 3.7965281890970345`*^9}, {3.7965282306113005`*^9, 
   3.7965282402306547`*^9}, {3.7965286736002493`*^9, 3.796528678724367*^9}, {
   3.7965877532973633`*^9, 3.796587760007573*^9}, {3.796599241103588*^9, 
   3.7965992754832816`*^9}, 3.7965994298340783`*^9, {3.7966002466755114`*^9, 
   3.796600270156573*^9}, {3.796600315936099*^9, 3.7966003558215704`*^9}, {
   3.796600454765662*^9, 3.7966005406428795`*^9}, {3.796600663197361*^9, 
   3.7966007375333056`*^9}, {3.796613341041902*^9, 3.7966133449015837`*^9}, {
   3.7966256209142046`*^9, 3.7966256486495667`*^9}, {3.796625943763624*^9, 
   3.796626106552822*^9}, {3.796626351620021*^9, 3.7966266182615433`*^9}},
 CellLabel->"In[86]:=",ExpressionUUID->"814ccb6e-f8b5-4389-8b25-8a7a9e3511f9"],

Cell["Including more momentum states", "Section",
 CellChangeTimes->{{3.7965071242280836`*^9, 3.796507137835515*^9}, {
  3.7966134730509863`*^9, 
  3.7966134977140512`*^9}},ExpressionUUID->"ea5dbacf-ec14-4ba1-814d-\
0681af11b536"]
}, Open  ]],

Cell[TextData[{
 "Below I create a triangular lattice in momentum space and solve for the \
eigenvalues. By including more basis vectors you can solve for more energy \
levels.\n\nThe FFT of the Kagome potential is just a honeycomb in momentum \
space, with +1 weight on the nearest neighbor couplings and -0.5 on the next \
nearest neighbors. \n\nThe square lattice below is indexed such that rows \
correspond to constant ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["k", "y"], TraditionalForm]],ExpressionUUID->
  "a87313b0-65fd-4897-9ea3-485853cdb997"],
 " (horizontal in ",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    RowBox[{
     SubscriptBox["k", "x"], ",", 
     SubscriptBox["k", "y"]}], ")"}], TraditionalForm]],ExpressionUUID->
  "f0c7c570-7dc8-42c1-a05f-2dbcb2ec1c71"],
 " ). Every other row is shifted by ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["k", "x"], "\[Rule]", " ", 
    RowBox[{
     SubscriptBox["k", "x"], " ", "+", " ", "0.5"}]}], TraditionalForm]],
  ExpressionUUID->"5079a07f-0695-41ae-a840-71ca15c8eb87"],
 "  to account for the triangular lattice shifts between planes. Please don\
\[CloseCurlyQuote]t read the KagomeCoupling code... I don\[CloseCurlyQuote]t \
know what else to do besides brute force it... But you can trust it\
\[CloseCurlyQuote]s right because you get the flat bands \
you\[CloseCurlyQuote]d expect ;P"
}], "Text",
 CellChangeTimes->{{3.7965071242280836`*^9, 3.796507137835515*^9}, {
  3.7966134730509863`*^9, 3.796613794069767*^9}, {3.7966138363602247`*^9, 
  3.7966138913734837`*^9}, {3.7966139420131035`*^9, 3.796614187910575*^9}, {
  3.79662672317054*^9, 
  3.796626784760458*^9}},ExpressionUUID->"261711cc-c999-4128-ad4d-\
bb5dc46a1ae1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "matDim", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"KagomeCoupling", "[", "dim_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"matDim", " ", "=", " ", "dim"}], "}"}], ",", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{"Initialize", " ", "matrix"}], "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"matTemp", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{
            SuperscriptBox["matDim", "2"], ",", 
            SuperscriptBox["matDim", "2"]}], "}"}]}], "]"}]}], ";", "\n", 
       "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{"Loop", " ", "over", " ", "rows"}], "*)"}], "\n", "\t", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"k", "=", "1"}], ",", 
         RowBox[{"k", "\[LessEqual]", " ", 
          SuperscriptBox["matDim", "2"]}], ",", 
         RowBox[{"k", "++"}], ",", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "set", " ", "the", " ", "stagger", " ", "variable", " ", "to", " ", 
           "account", " ", "for", " ", "hexagonal", " ", "NN", " ", 
           RowBox[{"shifts", "."}]}], "*)"}], "\n", "\t\t", 
         RowBox[{
          RowBox[{"stag", " ", "=", " ", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"Floor", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"k", "-", "1"}], ")"}], "/", "matDim"}], "]"}], 
                ",", "2"}], "]"}], " ", "+", " ", 
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"Floor", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"matDim", "-", "1"}], ")"}], "/", "2"}], "]"}], 
                ",", "2"}], "]"}]}], ",", "2"}], "]"}]}], ";", "\n", "\t\t", 
          "\n", "\t\t", 
          RowBox[{"(*", 
           RowBox[{"Left", " ", "boundary"}], "*)"}], "\n", "\t\t", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Mod", "[", 
              RowBox[{"k", ",", "matDim"}], "]"}], "\[Equal]", "1"}], ",", 
            " ", "\n", "\t\t\t", 
            RowBox[{"(*", 
             RowBox[{"Neighbors", " ", "to", " ", "the", " ", "right"}], 
             "*)"}], "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"matTemp", "\[LeftDoubleBracket]", 
               RowBox[{"k", ",", 
                RowBox[{"k", "+", "1"}]}], "\[RightDoubleBracket]"}], " ", 
              "=", " ", "1"}], ";", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"matTemp", "\[LeftDoubleBracket]", 
               RowBox[{"k", ",", 
                RowBox[{"k", "+", "2"}]}], "\[RightDoubleBracket]"}], " ", 
              "=", " ", 
              RowBox[{"-", "0.5"}]}], ";", "\n", "\n", "\t\t\t", 
             RowBox[{"(*", 
              RowBox[{"Neighbor", 
               RowBox[{"(", "s", ")"}], " ", "below"}], "*)"}], "\n", 
             "\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"k", "+", "matDim"}], "\[LessEqual]", 
                SuperscriptBox["matDim", "2"]}], ",", "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                  RowBox[{"k", ",", 
                   RowBox[{"k", "+", "matDim"}]}], "\[RightDoubleBracket]"}], 
                 " ", "=", " ", "1"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"stag", ">", " ", "0"}], ",", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "+", "matDim", "+", "1"}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", "1"}], ";"}]}], 
                 "\n", "\t\t\t\t", "]"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"k", "+", 
                    RowBox[{"2", "matDim"}]}], " ", "\[LessEqual]", " ", 
                   SuperscriptBox["matDim", "2"]}], ",", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "+", 
                    RowBox[{"2", "matDim"}], "+", "1"}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", 
                    RowBox[{"-", "0.5"}]}], ";"}]}], "\n", "\t\t\t\t", "]"}], 
                ";"}]}], "\n", "\t\t\t", "]"}], ";", "\n", "\n", "\t\t\t", 
             RowBox[{"(*", 
              RowBox[{"Neighbor", 
               RowBox[{"(", "s", ")"}], " ", "above"}], "*)"}], "\n", 
             "\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"k", "-", "matDim"}], ">", "0"}], ",", "\n", 
               "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                  RowBox[{"k", ",", 
                   RowBox[{"k", "-", "matDim"}]}], "\[RightDoubleBracket]"}], 
                 " ", "=", " ", "1"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"stag", ">", " ", "0"}], ",", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "-", 
                    RowBox[{"(", 
                    RowBox[{"matDim", "-", "1"}], ")"}]}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", "1"}], ";"}]}], 
                 "\n", "\t\t\t\t", "]"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"k", "-", 
                    RowBox[{"2", "matDim"}]}], ">", "0"}], ",", "\n", 
                  "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", "matDim"}], "-", "1"}], ")"}]}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", 
                    RowBox[{"-", "0.5"}]}], ";"}]}], "\n", "\t\t\t\t", "]"}], 
                ";"}]}], "\n", "\t\t\t", "]"}], ";"}]}], "\n", "\t\t", "]"}], 
          ";", "\n", "\n", "\n", "\t\t", 
          RowBox[{"(*", 
           RowBox[{"Right", " ", "boundary"}], "*)"}], "\n", "\t\t", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Mod", "[", 
              RowBox[{"k", ",", "matDim"}], "]"}], "\[Equal]", "0"}], ",", 
            " ", "\n", "\t\t\t", 
            RowBox[{"(*", 
             RowBox[{"Neighbor", " ", "to", " ", "the", " ", "left"}], "*)"}],
             "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"matTemp", "\[LeftDoubleBracket]", 
               RowBox[{"k", ",", 
                RowBox[{"k", "-", "1"}]}], "\[RightDoubleBracket]"}], " ", 
              "=", " ", "1"}], ";", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"matTemp", "\[LeftDoubleBracket]", 
               RowBox[{"k", ",", 
                RowBox[{"k", "-", "2"}]}], "\[RightDoubleBracket]"}], " ", 
              "=", " ", 
              RowBox[{"-", "0.5"}]}], ";", "\n", "\n", "\t\t\t", 
             RowBox[{"(*", 
              RowBox[{"Neighbor", 
               RowBox[{"(", "s", ")"}], " ", "below"}], "*)"}], "\n", 
             "\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"k", "+", "matDim"}], "\[LessEqual]", 
                SuperscriptBox["matDim", "2"]}], ",", "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                  RowBox[{"k", ",", 
                   RowBox[{"k", "+", "matDim"}]}], "\[RightDoubleBracket]"}], 
                 " ", "=", " ", "1"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"stag", "\[Equal]", " ", "0"}], ",", "\n", 
                  "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "+", "matDim", "-", "1"}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", "1"}], ";"}]}], 
                 "\n", "\t\t\t\t", "]"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"k", "+", 
                    RowBox[{"2", "matDim"}]}], " ", "\[LessEqual]", " ", 
                   SuperscriptBox["matDim", "2"]}], ",", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "+", 
                    RowBox[{"2", "matDim"}], "-", "1"}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", 
                    RowBox[{"-", "0.5"}]}], ";"}]}], "\n", "\t\t\t\t", "]"}], 
                ";"}]}], "\n", "\t\t\t", "]"}], ";", "\n", "\t\t\t", "\n", 
             "\t\t\t", 
             RowBox[{"(*", 
              RowBox[{"Neighbor", 
               RowBox[{"(", "s", ")"}], " ", "above"}], "*)"}], "\n", 
             "\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"k", "-", "matDim"}], ">", "0"}], ",", "\n", 
               "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                  RowBox[{"k", ",", 
                   RowBox[{"k", "-", "matDim"}]}], "\[RightDoubleBracket]"}], 
                 " ", "=", " ", "1"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"stag", "\[Equal]", "0"}], ",", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "-", 
                    RowBox[{"(", 
                    RowBox[{"matDim", "+", "1"}], ")"}]}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", "1"}], ";"}]}], 
                 "\n", "\t\t\t\t", "]"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"k", "-", 
                    RowBox[{"2", "matDim"}]}], ">", "0"}], ",", "\n", 
                  "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", "matDim"}], "+", "1"}], ")"}]}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", 
                    RowBox[{"-", "0.5"}]}], ";"}]}], "\n", "\t\t\t\t", "]"}], 
                ";"}]}], "\n", "\t\t\t", "]"}], ";"}]}], "\n", "\t\t", "]"}], 
          ";", "\n", "\n", "\t\t", 
          RowBox[{"(*", 
           RowBox[{"Do", " ", "the", " ", "center", " ", "columns"}], "*)"}], 
          "\n", "\t\t", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{"k", ",", "matDim"}], "]"}], ">", "1"}], " ", "&&", 
             " ", 
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{"k", ",", "matDim"}], "]"}], "<", "matDim"}]}], ",", 
            "\n", "\t\t\t", 
            RowBox[{"(*", 
             RowBox[{"Left", " ", "and", " ", "right", " ", "neighbors"}], 
             "*)"}], "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"matTemp", "\[LeftDoubleBracket]", 
               RowBox[{"k", ",", 
                RowBox[{"k", "-", "1"}]}], "\[RightDoubleBracket]"}], " ", 
              "=", " ", "1"}], ";", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"matTemp", "\[LeftDoubleBracket]", 
               RowBox[{"k", ",", 
                RowBox[{"k", "+", "1"}]}], "\[RightDoubleBracket]"}], " ", 
              "=", " ", "1"}], ";", "\n", "\n", "\t\t\t", 
             RowBox[{"(*", 
              RowBox[{
              "Left", " ", "and", " ", "right", " ", "next", " ", "nearest", 
               " ", "neighbor"}], "*)"}], "\n", "\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Mod", "[", 
                 RowBox[{"k", ",", "matDim"}], "]"}], ">", "2"}], ",", "\n", 
               "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                  RowBox[{"k", ",", 
                   RowBox[{"k", "-", "2"}]}], "\[RightDoubleBracket]"}], " ", 
                 "=", " ", 
                 RowBox[{"-", "0.5"}]}], ";"}]}], "\n", "\t\t\t", "]"}], ";", 
             "\n", "\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Mod", "[", 
                 RowBox[{"k", ",", "matDim"}], "]"}], "<", 
                RowBox[{"matDim", "-", "1"}]}], ",", "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                  RowBox[{"k", ",", 
                   RowBox[{"k", "+", "2"}]}], "\[RightDoubleBracket]"}], " ", 
                 "=", " ", 
                 RowBox[{"-", "0.5"}]}], ";"}]}], "\n", "\t\t\t", "]"}], ";", 
             "\n", "\n", "\t\t\t", 
             RowBox[{"(*", 
              RowBox[{"Neighbors", " ", "above"}], "*)"}], "\n", "\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"k", "-", "matDim"}], ">", "0"}], ",", "\n", 
               "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                  RowBox[{"k", ",", 
                   RowBox[{"k", "-", "matDim"}]}], "\[RightDoubleBracket]"}], 
                 " ", "=", " ", "1"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"stag", "\[Equal]", "0"}], ",", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "-", 
                    RowBox[{"(", 
                    RowBox[{"matDim", "+", "1"}], ")"}]}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", "1"}], ";"}], 
                  "\n", "\t\t\t\t", ",", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "-", 
                    RowBox[{"(", 
                    RowBox[{"matDim", "-", "1"}], ")"}]}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", "1"}], ";"}]}], 
                 "\n", "\t\t\t\t", "]"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"k", "-", 
                    RowBox[{"2", "matDim"}]}], ">", "0"}], ",", "\n", 
                  "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", "matDim"}], "+", "1"}], ")"}]}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", 
                    RowBox[{"-", "0.5"}]}], ";", "\n", "\t\t\t\t\t", 
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", "matDim"}], "-", "1"}], ")"}]}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", 
                    RowBox[{"-", "0.5"}]}], ";"}]}], "\n", "\t\t\t\t", "]"}], 
                ";"}]}], "\n", "\t\t\t", "]"}], ";", "\n", "\n", "\t\t\t", 
             RowBox[{"(*", 
              RowBox[{"Neighbors", " ", "below"}], "*)"}], "\n", "\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"k", "+", "matDim"}], "<", 
                SuperscriptBox["matDim", "2"]}], ",", "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                  RowBox[{"k", ",", 
                   RowBox[{"k", "+", "matDim"}]}], "\[RightDoubleBracket]"}], 
                 " ", "=", " ", "1"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"stag", "\[Equal]", "0"}], ",", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "+", 
                    RowBox[{"(", 
                    RowBox[{"matDim", "-", "1"}], ")"}]}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", "1"}], ";"}], 
                  "\n", "\t\t\t\t", ",", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "+", 
                    RowBox[{"(", 
                    RowBox[{"matDim", "+", "1"}], ")"}]}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", "1"}], ";"}]}], 
                 "\n", "\t\t\t\t", "]"}], ";", "\n", "\t\t\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"k", "+", 
                    RowBox[{"2", "matDim"}]}], " ", "\[LessEqual]", " ", 
                   SuperscriptBox["matDim", "2"]}], ",", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "+", 
                    RowBox[{"2", "matDim"}], "-", "1"}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", 
                    RowBox[{"-", "0.5"}]}], ";", "\n", "\t\t\t\t\t", 
                   RowBox[{
                    RowBox[{"matTemp", "\[LeftDoubleBracket]", 
                    RowBox[{"k", ",", 
                    RowBox[{"k", "+", 
                    RowBox[{"2", "matDim"}], "+", "1"}]}], 
                    "\[RightDoubleBracket]"}], " ", "=", " ", 
                    RowBox[{"-", "0.5"}]}], ";"}]}], "\n", "\t\t\t\t", "]"}], 
                ";"}]}], "\n", "\t\t\t", "]"}], ";"}]}], "\t\t", "\n", "\t\t",
            "]"}], ";"}]}], "\n", "\t", "]"}], ";", "\n", "\t", "matTemp"}]}],
      "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"KagomeKE", "[", 
    RowBox[{"dimension_", ",", "kX_", ",", "kY_", ",", " ", 
     RowBox[{"F_:", "0"}], ",", 
     RowBox[{"\[Theta]_:", "0"}], ",", 
     RowBox[{"time_:", "t"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"matDim", " ", "=", " ", "dimension"}], "}"}], ",", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{"Initialize", " ", "matrix"}], "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"matTemp", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{
           SuperscriptBox["matDim", "2"], ",", 
           SuperscriptBox["matDim", "2"]}], "}"}]}], "]"}]}], ";", "\n", "\t",
       "\n", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Loop", " ", "over", " ", "the", " ", "diagonal", " ", "of", " ", 
        "the", " ", "matrix"}], " ", "*)"}], "\n", "\t", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"k", "=", "1"}], ",", 
        RowBox[{"k", "\[LessEqual]", " ", 
         SuperscriptBox["matDim", "2"]}], ",", 
        RowBox[{"k", "++"}], ",", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{
         "Check", " ", "the", " ", "stagger", " ", "of", " ", "the", " ", 
          "row"}], "*)"}], "\n", "\t\t", 
        RowBox[{
         RowBox[{"stag", " ", "=", " ", 
          RowBox[{"Mod", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"k", "-", "1"}], ")"}], "/", "matDim"}], "]"}], ",",
                "2"}], "]"}], " ", "+", " ", 
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"matDim", "-", "1"}], ")"}], "/", "2"}], "]"}], ",",
                "2"}], "]"}]}], ",", "2"}], "]"}]}], ";", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"Update", " ", "ky", " ", "which", " ", 
           RowBox[{"doesn", "'"}], "t", " ", "depend", " ", "on", " ", 
           "stagger"}], "*)"}], "\n", "\t\t", 
         RowBox[{"ky", " ", "=", " ", 
          RowBox[{
           RowBox[{
            FractionBox[
             SqrtBox["3"], "2"], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"matDim", "-", "1"}], ")"}], "/", "2"}], "-", 
              RowBox[{"Floor", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"k", "-", "1"}], ")"}], "/", "matDim"}], "]"}]}], 
             ")"}]}], " ", "+", " ", 
           RowBox[{"F", " ", "t", " ", 
            RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}]}], ";", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"Update", " ", "kx"}], "*)"}], "\n", "\t\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"stag", "\[Equal]", "0"}], ",", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"kx", " ", "=", " ", 
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"k", "-", "1"}], ",", "matDim"}], "]"}], "-", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"matDim", "-", "1"}], ")"}], "/", "2"}], " ", "+", 
              " ", 
              RowBox[{"F", " ", "t", " ", 
               RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}]}], ";"}], "\n", 
           "\t\t", ",", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"kx", " ", "=", " ", 
             RowBox[{"0.5", "+", 
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"k", "-", "1"}], ",", "matDim"}], "]"}], "-", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"matDim", "-", "1"}], ")"}], "/", "2"}]}]}], ";"}]}], 
          "\n", "\t\t", "]"}], ";", "\n", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"Put", " ", 
           SuperscriptBox["k", "2"], " ", "in", " ", "the", " ", "diagonal"}],
           "*)"}], "\n", "\t\t", 
         RowBox[{
          RowBox[{"matTemp", "\[LeftDoubleBracket]", 
           RowBox[{"k", ",", "k"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"kx", "+", "kX"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"ky", "+", "kY"}], ")"}], "2"]}], ")"}]}], ";"}]}], 
       "\n", "\t", "]"}], ";", "\n", "\t", "matTemp"}]}], "\n", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{
  3.545825155715281*^9, {3.7965071438468437`*^9, 3.796507384513954*^9}, {
   3.796507435012138*^9, 3.796507470014183*^9}, {3.7965077100997353`*^9, 
   3.7965079517886405`*^9}, {3.7965083189507575`*^9, 3.796508440906542*^9}, {
   3.796508474435363*^9, 3.796508507123046*^9}, {3.7965085460024223`*^9, 
   3.796508557117283*^9}, {3.7965086383358316`*^9, 3.7965087457555175`*^9}, {
   3.796508780530397*^9, 3.7965087909882336`*^9}, {3.7965088328916945`*^9, 
   3.7965089029632845`*^9}, {3.7965090805407567`*^9, 
   3.7965092456524754`*^9}, {3.7965092770272636`*^9, 
   3.7965094236321955`*^9}, {3.796509486158317*^9, 3.7965094869673223`*^9}, {
   3.796509990004008*^9, 3.796509990856571*^9}, {3.7965109459664173`*^9, 
   3.796511057772003*^9}, {3.79651124585242*^9, 3.796511291907541*^9}, {
   3.796511413791391*^9, 3.7965114147352133`*^9}, 3.7965114575722513`*^9, {
   3.7965116316060557`*^9, 3.796511754182906*^9}, {3.7965118618551226`*^9, 
   3.796511889915879*^9}, {3.7965119773675194`*^9, 3.7965120150233808`*^9}, {
   3.796512057187007*^9, 3.7965120807611656`*^9}, {3.7965121128230195`*^9, 
   3.7965121484849806`*^9}, {3.7965121901169205`*^9, 
   3.7965125117932596`*^9}, {3.7965125715629935`*^9, 
   3.7965128924752607`*^9}, {3.7965129761752214`*^9, 3.796513026872172*^9}, {
   3.7965130742492404`*^9, 3.7965130998234224`*^9}, {3.796513158565951*^9, 
   3.7965131790464897`*^9}, {3.79651322485448*^9, 3.79651329568962*^9}, {
   3.796513347419195*^9, 3.796513552842799*^9}, {3.7965136071457553`*^9, 
   3.7965137605307755`*^9}, {3.796513815394614*^9, 3.796513837889599*^9}, {
   3.7965138959736223`*^9, 3.796513933647298*^9}, 3.7965140351105146`*^9, {
   3.7965141238089805`*^9, 3.796514155760667*^9}, 3.796514299039095*^9, {
   3.796514362110289*^9, 3.7965143844491253`*^9}, {3.7965145169834547`*^9, 
   3.796514517720133*^9}, {3.7965146142964153`*^9, 3.7965146670187974`*^9}, {
   3.7965148264343877`*^9, 3.7965149797683363`*^9}, {3.796515163291215*^9, 
   3.7965155406031823`*^9}, {3.796515573963813*^9, 3.7965155790539074`*^9}, {
   3.7965156160189*^9, 3.796515748599045*^9}, {3.796515790858245*^9, 
   3.796515863437951*^9}, {3.796515936970372*^9, 3.7965159985367126`*^9}, {
   3.7965160458355103`*^9, 3.796516075663493*^9}, {3.796516149266309*^9, 
   3.7965162889290094`*^9}, {3.7965165119309654`*^9, 3.796516513859769*^9}, {
   3.7965166342922816`*^9, 3.7965167057574377`*^9}, 3.7965168000434713`*^9, {
   3.7965168847944126`*^9, 3.7965170251214795`*^9}, {3.796517263123353*^9, 
   3.7965172918278446`*^9}, {3.796517368526289*^9, 3.79651737430809*^9}, {
   3.7965174576072454`*^9, 3.7965174595051928`*^9}, {3.7965175117072787`*^9, 
   3.7965175375115905`*^9}, {3.7965175729538345`*^9, 3.7965175785540133`*^9}, 
   3.7965176369646387`*^9, {3.7965176713660755`*^9, 3.796517701034727*^9}, {
   3.796517811485445*^9, 3.7965179212323484`*^9}, {3.796518058972271*^9, 
   3.796518065564502*^9}, 3.7965192296554375`*^9, {3.7965192791194115`*^9, 
   3.7965192793117523`*^9}, 3.796519563689822*^9, {3.7965206073038535`*^9, 
   3.7965207368501945`*^9}, {3.7965216155219927`*^9, 
   3.7965216176569448`*^9}, {3.796523891106874*^9, 3.796523894619743*^9}, {
   3.7965242088729477`*^9, 3.796524224033353*^9}, {3.796524375203697*^9, 
   3.796524421892717*^9}, {3.7965245463374767`*^9, 3.796524569337077*^9}, {
   3.7965247979836907`*^9, 3.796524802293765*^9}, {3.7965250276620536`*^9, 
   3.7965250277473874`*^9}, {3.796525063984205*^9, 3.7965251105953054`*^9}, {
   3.796529496856542*^9, 3.7965295316501913`*^9}, {3.7965296693290176`*^9, 
   3.796529690024184*^9}, 3.7965298214012194`*^9, 3.796529945076598*^9, {
   3.796601356395252*^9, 3.7966014188928103`*^9}, {3.7966016292667103`*^9, 
   3.7966018029394608`*^9}, {3.7966022859723425`*^9, 
   3.7966022884334745`*^9}, {3.79660233633276*^9, 3.7966023364641914`*^9}, 
   3.79660237455932*^9, {3.7966033253641744`*^9, 3.796603337275949*^9}, {
   3.7966033757471094`*^9, 3.7966033962323656`*^9}, {3.796603573275853*^9, 
   3.7966038593440466`*^9}, {3.796603958858354*^9, 3.796603983996825*^9}, {
   3.796604033548893*^9, 3.796604074147284*^9}, {3.796604122641526*^9, 
   3.7966041659919357`*^9}, {3.7966042445368023`*^9, 
   3.7966043655717793`*^9}, {3.796604419618924*^9, 3.7966044277656097`*^9}, {
   3.7966045016601777`*^9, 3.7966045248653173`*^9}, {3.7966045786878853`*^9, 
   3.7966045819023485`*^9}, {3.7966046150849476`*^9, 3.796604700698489*^9}, {
   3.7966049202079287`*^9, 3.7966049382622824`*^9}, {3.796604968613591*^9, 
   3.7966049927421265`*^9}, {3.7966052012096434`*^9, 
   3.7966052014008102`*^9}, {3.7966054587664175`*^9, 
   3.7966055089096684`*^9}, {3.7966055684602547`*^9, 3.79660557965353*^9}, {
   3.796605611501511*^9, 3.7966056490874243`*^9}, {3.796605699690815*^9, 
   3.79660571113032*^9}, {3.79660574484781*^9, 3.7966058311107616`*^9}, {
   3.7966060169292355`*^9, 3.79660604833503*^9}, 3.7966061630678587`*^9, 
   3.796606214248787*^9, {3.796606882690015*^9, 3.79660691653098*^9}, {
   3.7966127612429504`*^9, 3.796612763380237*^9}, {3.796612864030157*^9, 
   3.7966128650873313`*^9}, 3.7966139774054813`*^9, {3.7966141922818537`*^9, 
   3.796614216883752*^9}, {3.7966142640338306`*^9, 3.7966143286264863`*^9}, {
   3.7966144671984396`*^9, 3.796614491070057*^9}, {3.7966150996083984`*^9, 
   3.796615239424898*^9}, {3.796615469332388*^9, 3.7966154715604324`*^9}, {
   3.7966169241779957`*^9, 3.7966169540032635`*^9}, 3.796617056599308*^9, {
   3.79661710777002*^9, 3.7966171260185165`*^9}, {3.7966171619519672`*^9, 
   3.796617235967134*^9}, {3.7966172690217657`*^9, 3.79661731379208*^9}, {
   3.796626805937189*^9, 3.7966268177576313`*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"bdf6ae7e-6580-4850-b308-73c94844a7da"],

Cell["\<\
Create the Hamiltonian and solve for the eigenvalues at some k-point. \
\>", "Text",
 CellChangeTimes->{
  3.545825155715281*^9, {3.7966154848179903`*^9, 3.796615507013654*^9}, {
   3.7966155614137373`*^9, 
   3.7966155918144655`*^9}},ExpressionUUID->"54482a2d-de6b-4732-a459-\
c18164ef0b28"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{"HamKagome", ",", " ", "Diags", ",", " ", "OffDiags"}], "]"}], 
  "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"create", " ", "matrix", " ", "that", " ", "is", " ", 
    RowBox[{"(", 
     SuperscriptBox["dimKagome", "2"], ")"}], " ", "x", " ", 
    RowBox[{"(", 
     SuperscriptBox["dimKagome", "2"], ")"}]}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dimKagome", " ", "=", " ", "13"}], ";"}], "  ", "\n"}], "\n", 
 RowBox[{
  RowBox[{"OffDiags", " ", "=", " ", 
   RowBox[{"KagomeCoupling", "[", "dimKagome", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Diags", "[", 
    RowBox[{"kX_", ",", "kY_"}], "]"}], " ", "=", " ", 
   RowBox[{"KagomeKE", "[", 
    RowBox[{"dimKagome", ",", "kX", ",", "kY"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"HamKagome", "[", 
     RowBox[{"kX_", ",", "kY_", ",", "U_"}], "]"}], " ", "=", " ", 
    RowBox[{
     RowBox[{"Diags", "[", 
      RowBox[{"kX", ",", "kY"}], "]"}], " ", "+", " ", 
     RowBox[{"U", " ", "*", "OffDiags"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MatrixForm", "@", "OffDiags"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MatrixForm", "@", 
   RowBox[{"Diags", "[", 
    RowBox[{"kX", ",", "kY"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MatrixForm", "@", 
    RowBox[{"HamKagome", "[", 
     RowBox[{"kX", ",", "kY", ",", "U"}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{"Print", "[", 
  "\"\<The output below is in the format {time to solve, sorted \
eigenvalues}\>\"", "]"}], "\n", 
 RowBox[{"Timing", "@", 
  RowBox[{"Sort", "[", 
   RowBox[{
    RowBox[{"N", "@", 
     RowBox[{"Eigenvalues", "@", 
      RowBox[{"HamKagome", "[", 
       RowBox[{"1", ",", "1", ",", "1"}], "]"}]}]}], ",", " ", "Less"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{
  3.545825155715281*^9, {3.7966154848179903`*^9, 3.7966155516348777`*^9}, {
   3.7966156242796764`*^9, 3.7966157791710844`*^9}, 3.796626847807327*^9},
 CellLabel->"In[98]:=",ExpressionUUID->"95d63d15-0366-4f2d-b789-fb31fa4afa19"],

Cell["\<\
Below plots the band structure, and it takes a while to run (~a few minutes \
for dimKagome = 13). Currently I solve for all eigenvalues when we only plot \
the lowest. So if we could solve for the six lowest energy states directly \
that would be speed this up, but when I used Eigenvalues[Ham,6] it didn\
\[CloseCurlyQuote]t return the lowest 6 as sorted by eigenvalue, so that didn\
\[CloseCurlyQuote]t seem to work. \
\>", "Text",
 CellChangeTimes->{
  3.545825155715281*^9, {3.7966148014700346`*^9, 
   3.796615084052983*^9}},ExpressionUUID->"31880a06-d092-4fd0-9574-\
46d857b8d139"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"kXmax", " ", "=", " ", "1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"kYmax", " ", "=", " ", 
   FractionBox[
    SqrtBox["3"], "2"]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dk", " ", "=", " ", "0.02"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"kPts", " ", "=", " ", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"k1", ",", "k2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"k1", ",", 
        RowBox[{"-", "kXmax"}], ",", "kXmax", ",", "dk"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"k2", ",", 
        RowBox[{"-", "kYmax"}], ",", "kYmax", ",", "dk"}], "}"}]}], "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"eigs", " ", "=", " ", 
    RowBox[{"Transpose", "@", 
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Sort", "[", 
         RowBox[{
          RowBox[{"N", "@", 
           RowBox[{"Eigenvalues", "[", 
            RowBox[{"HamKagome", "[", 
             RowBox[{"#1", ",", "#2", ",", "2"}], "]"}], "]"}]}], ",", 
          "Less"}], "]"}], " ", "&"}], ",", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Flatten", "[", 
         RowBox[{"kPts", ",", "1"}], "]"}]}]}], "]"}]}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"bands", " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"kPts", ",", "1"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "1", "\[RightDoubleBracket]"}], ",", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"kPts", ",", "1"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}], ",", 
         RowBox[{
         "eigs", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}]}], 
        "}"}], "]"}], "&"}], "/@", 
     RowBox[{"Range", "[", "6", "]"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{"gndPlot", " ", "=", " ", 
  RowBox[{"ListPlot3D", "[", 
   RowBox[{
    RowBox[{"bands", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
    ",", " ", 
    RowBox[{"PlotLabel", "\[Rule]", 
     RowBox[{"Style", "[", 
      RowBox[{"\"\<Ground band\>\"", ",", " ", "Large"}], "]"}]}]}], 
   "]"}]}], "\n", 
 RowBox[{"sndPlot", " ", "=", " ", 
  RowBox[{"ListPlot3D", "[", 
   RowBox[{
    RowBox[{"bands", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
    ",", " ", 
    RowBox[{"PlotLabel", "\[Rule]", 
     RowBox[{"Style", "[", 
      RowBox[{
      "\"\<\!\(\*SuperscriptBox[\(2\), \(nd\)]\) band\>\"", ",", " ", 
       "Large"}], "]"}]}]}], "]"}]}], "\n", 
 RowBox[{"trdPlot", " ", "=", " ", 
  RowBox[{"ListPlot3D", "[", 
   RowBox[{
    RowBox[{"bands", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
    ",", " ", 
    RowBox[{"PlotLabel", "\[Rule]", 
     RowBox[{"Style", "[", 
      RowBox[{
      "\"\<\!\(\*SuperscriptBox[\(3\), \(rd\)]\) band\>\"", ",", " ", 
       "Large"}], "]"}]}]}], "]"}]}], "\n", 
 RowBox[{"frtPlot", " ", "=", " ", 
  RowBox[{"ListPlot3D", "[", 
   RowBox[{
    RowBox[{"bands", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
    ",", " ", 
    RowBox[{"PlotLabel", "\[Rule]", 
     RowBox[{"Style", "[", 
      RowBox[{
      "\"\<\!\(\*SuperscriptBox[\(4\), \(th\)]\) band\>\"", ",", " ", 
       "Large"}], "]"}]}]}], "]"}]}], "\n", 
 RowBox[{"fftPlot", " ", "=", " ", 
  RowBox[{"ListPlot3D", "[", 
   RowBox[{
    RowBox[{"bands", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
    ",", " ", 
    RowBox[{"PlotLabel", "\[Rule]", 
     RowBox[{"Style", "[", 
      RowBox[{
      "\"\<\!\(\*SuperscriptBox[\(5\), \(th\)]\) band\>\"", ",", " ", 
       "Large"}], "]"}]}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"sxtPlot", " ", "=", " ", 
   RowBox[{"ListPlot3D", "[", 
    RowBox[{
     RowBox[{"bands", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], 
     ",", " ", 
     RowBox[{"PlotLabel", "\[Rule]", 
      RowBox[{"Style", "[", 
       RowBox[{
       "\"\<\!\(\*SuperscriptBox[\(6\), \(th\)]\) band\>\"", ",", " ", 
        "Large"}], "]"}]}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gndPlot", ",", "sndPlot", ",", " ", "trdPlot"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
   RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", " ", 
   RowBox[{"PlotLabel", "\[Rule]", " ", 
    RowBox[{"Style", "[", 
     RowBox[{"\"\<Bands 1-3\>\"", ",", " ", "Large"}], "]"}]}]}], "]"}], "\n", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"frtPlot", ",", "fftPlot", ",", " ", "sxtPlot"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
   RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", " ", 
   RowBox[{"PlotLabel", "\[Rule]", " ", 
    RowBox[{"Style", "[", 
     RowBox[{"\"\<Bands 4-6\>\"", ",", " ", "Large"}], "]"}]}]}], 
  "]"}], "\n"}], "Input",
 CellChangeTimes->{
  3.545825155715281*^9, {3.7965161841773834`*^9, 3.796516186642957*^9}, {
   3.7965180915001197`*^9, 3.796518111559732*^9}, {3.7965181614554896`*^9, 
   3.79651826093198*^9}, {3.796518723926763*^9, 3.796518731973299*^9}, {
   3.796519553384182*^9, 3.796519554785971*^9}, {3.7965197204972134`*^9, 
   3.7965197241376357`*^9}, {3.796519764329892*^9, 3.7965198412149353`*^9}, {
   3.796519884288101*^9, 3.7965199027048564`*^9}, {3.796520053549085*^9, 
   3.7965200550364404`*^9}, {3.7965202444147563`*^9, 3.796520387758025*^9}, {
   3.7965205426390443`*^9, 3.79652059238792*^9}, {3.7965207501118307`*^9, 
   3.7965207778179617`*^9}, {3.796521041138641*^9, 3.796521197439152*^9}, {
   3.7965212732314987`*^9, 3.796521356577551*^9}, {3.796521423171636*^9, 
   3.796521436744231*^9}, {3.796521486299862*^9, 3.796521511726843*^9}, {
   3.796521589091385*^9, 3.796521590184372*^9}, {3.7965221778893585`*^9, 
   3.7965223830399756`*^9}, {3.796522548714138*^9, 3.7965225949136515`*^9}, 
   3.796522668346761*^9, {3.7965228272416573`*^9, 3.7965228769176054`*^9}, {
   3.7965229096946783`*^9, 3.7965229127469344`*^9}, {3.796522964682776*^9, 
   3.7965229701126943`*^9}, {3.7965230171731367`*^9, 3.79652306991988*^9}, {
   3.7965231128646345`*^9, 3.79652315269781*^9}, {3.7965232000517063`*^9, 
   3.7965232004293785`*^9}, {3.7965232558381643`*^9, 
   3.7965232672209806`*^9}, {3.7965233370470195`*^9, 
   3.7965235067333555`*^9}, {3.7965235599997716`*^9, 3.796523562801627*^9}, {
   3.796523648095123*^9, 3.796523673270813*^9}, 3.796523987143593*^9, {
   3.7965241793379183`*^9, 3.796524185643194*^9}, 3.796524449678235*^9, {
   3.79652448319697*^9, 3.796524486199645*^9}, 3.7965245333249483`*^9, {
   3.796524761482095*^9, 3.7965247627319484`*^9}, {3.796524818951475*^9, 
   3.7965249435545125`*^9}, {3.7965251201274576`*^9, 3.796525151059478*^9}, {
   3.7965296508164463`*^9, 3.7965296562986507`*^9}, {3.7965297685978174`*^9, 
   3.7965297714840775`*^9}, {3.7966018999582043`*^9, 3.796601901909348*^9}, {
   3.796602405886264*^9, 3.7966024074689193`*^9}, {3.796602547908345*^9, 
   3.7966025881416335`*^9}, {3.796605134095336*^9, 3.796605134186598*^9}, {
   3.79660517873319*^9, 3.7966051799596767`*^9}, {3.7966052152853265`*^9, 
   3.79660521938605*^9}, {3.7966059250430927`*^9, 3.7966059258489466`*^9}, 
   3.796606112748884*^9, 3.7966063048944035`*^9, {3.7966063773462486`*^9, 
   3.796606398625181*^9}, 3.796606504026225*^9, {3.7966065989495916`*^9, 
   3.7966066033939743`*^9}, {3.79660696117387*^9, 3.7966069827866516`*^9}, {
   3.7966071052603855`*^9, 3.7966071073639097`*^9}, {3.7966071478450127`*^9, 
   3.7966071579812155`*^9}, {3.796607279234705*^9, 3.7966073252275763`*^9}, {
   3.7966125915939674`*^9, 3.7966126005171127`*^9}, {3.7966152734420495`*^9, 
   3.7966153446511993`*^9}, {3.7966154768632555`*^9, 
   3.7966154770836663`*^9}, {3.7966155289186077`*^9, 
   3.7966155315116744`*^9}, {3.796615610126515*^9, 3.7966156105673323`*^9}, {
   3.7966158314622936`*^9, 3.7966159170395203`*^9}, {3.7966163744044447`*^9, 
   3.796616426506161*^9}, {3.7966268927925143`*^9, 3.7966268929644213`*^9}},
 CellLabel->
  "In[108]:=",ExpressionUUID->"30c1e600-2b6b-4ec6-afc2-c02b3afe9692"],

Cell["\<\
Now that we have the Hamiltonian working correctly, we can numerically \
integrate to solve for Bloch oscillations :D\
\>", "Text",
 CellChangeTimes->{
  3.545825155715281*^9, {3.796616843829893*^9, 
   3.796616890047727*^9}},ExpressionUUID->"09f1ef94-c2f6-4945-a0be-\
2f78606126fd"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{"HamKagome", ",", " ", "Diags", ",", " ", "OffDiags"}], "]"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"dimKagome", " ", "=", " ", "17"}], ";", "   ", 
  RowBox[{"(*", 
   RowBox[{"create", " ", "matrix", " ", "that", " ", "is", " ", 
    RowBox[{"(", 
     SuperscriptBox["dimKagome", "2"], ")"}], " ", "x", " ", 
    RowBox[{"(", 
     SuperscriptBox["dimKagome", "2"], ")"}]}], " ", "*)"}], "\n", 
  RowBox[{"force", " ", "=", " ", "1"}], ";", "    ", 
  RowBox[{"(*", 
   RowBox[{"Force", " ", "during", " ", "BO"}], "*)"}], "\n", 
  RowBox[{"\[Phi]F", " ", "=", " ", "0"}], ";", "      ", 
  RowBox[{"(*", 
   RowBox[{"Angle", " ", "of", " ", "force", " ", "for", " ", "BO"}], "*)"}], 
  "\n", 
  RowBox[{"n0", " ", "=", " ", 
   FractionBox[
    RowBox[{
     SuperscriptBox["dimKagome", "2"], "+", "1"}], "2"]}], ";", "    ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"inial", " ", "state", " ", "at", " ", 
     RowBox[{"(", 
      RowBox[{"0", ",", "0"}], ")"}], " ", "in", " ", "k"}], "-", "space"}], 
   "*)"}], "\n", 
  RowBox[{"kX0", " ", "=", " ", "0"}], ";", "      ", 
  RowBox[{"(*", 
   RowBox[{"Initial", " ", "x", " ", "momentum", " ", "for", " ", "atom"}], 
   "*)"}], "\n", 
  RowBox[{"kY0", " ", "=", " ", "0"}], ";", "     ", 
  RowBox[{"(*", 
   RowBox[{"initial", " ", "y", " ", "momentum", " ", "for", " ", "atom"}], 
   "*)"}], "\n", 
  RowBox[{"LatDep", " ", "=", " ", "1"}], ";", "   ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Lattice", " ", 
     RowBox[{"depth", ".", " ", "Currently"}], " ", "set", " ", "up", " ", 
     "for", " ", 
     SubscriptBox["V", "tot"]}], " ", "=", " ", 
    RowBox[{
     RowBox[{"LatDep", " ", 
      SubscriptBox["V", "1064"]}], " ", "-", " ", 
     RowBox[{
      FractionBox["1", "2"], "LatDep", " ", 
      SubscriptBox["V", "532"]}]}]}], "  ", "*)"}], "\n", 
  RowBox[{"TLoad", " ", "=", " ", "4"}], ";", "    ", 
  RowBox[{"(*", 
   RowBox[{
   "Time", " ", "to", " ", "adiabatically", " ", "load", " ", "the", " ", 
    "lattice"}], "*)"}], "\n", 
  RowBox[{"NBloch", " ", "=", " ", "1"}], ";", "   ", 
  RowBox[{"(*", 
   RowBox[{"Number", " ", "of", " ", "Bloch", " ", "oscillations"}], "*)"}], 
  "\n", 
  RowBox[{"TBloch", " ", "=", " ", 
   FractionBox[
    RowBox[{"4", " ", "NBloch"}], "force"]}], ";", "   ", 
  RowBox[{"(*", 
   RowBox[{"Time", " ", "to", " ", "Bloch", " ", "oscillate"}], "*)"}], "\n", 
  "\n", 
  RowBox[{"OffDiags", " ", "=", " ", 
   RowBox[{"KagomeCoupling", "[", "dimKagome", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Diags", "[", 
    RowBox[{"kX_", ",", "kY_", ",", " ", "t_"}], "]"}], " ", "=", " ", 
   RowBox[{"KagomeKE", "[", 
    RowBox[{
    "dimKagome", ",", "kX", ",", "kY", ",", "force", ",", " ", "\[Phi]F", ",",
      "t"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"HamKagome", "[", 
    RowBox[{"kX_", ",", "kY_", ",", "U_", ",", " ", "t_"}], "]"}], " ", "=", 
   " ", 
   RowBox[{
    RowBox[{"Diags", "[", 
     RowBox[{"kX", ",", "kY", ",", "t"}], "]"}], " ", "+", " ", 
    RowBox[{"U", " ", "*", "OffDiags"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"HamKagomeLoad", "[", 
    RowBox[{"kX_", ",", "kY_", ",", "U_", ",", " ", "t_"}], "]"}], " ", "=", 
   " ", 
   RowBox[{
    RowBox[{"Diags", "[", 
     RowBox[{"kX", ",", "kY", ",", "0"}], "]"}], " ", "+", " ", 
    RowBox[{"U", " ", 
     RowBox[{"(", 
      RowBox[{"t", "/", "TLoad"}], ")"}], "*", "OffDiags"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"HamKagomeUnload", "[", 
     RowBox[{"kX_", ",", "kY_", ",", "U_", ",", " ", "t_"}], "]"}], " ", "=", 
    " ", 
    RowBox[{
     RowBox[{"Diags", "[", 
      RowBox[{"kX", ",", "kY", ",", "0"}], "]"}], " ", "+", " ", 
     RowBox[{"U", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"TLoad", "-", "t"}], ")"}], "/", "TLoad"}], ")"}], " ", "*", 
      "OffDiags"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MatrixForm", "@", "OffDiags"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MatrixForm", "@", 
   RowBox[{"Diags", "[", 
    RowBox[{"kX", ",", "kY", ",", "t"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MatrixForm", "@", 
    RowBox[{"HamKagome", "[", 
     RowBox[{"kX", ",", "kY", ",", "U", ",", "t"}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{"Print", "[", 
  "\"\<The output below is in the format {time to solve, sorted \
eigenvalues}\>\"", "]"}], "\n", 
 RowBox[{"Timing", "@", 
  RowBox[{"Sort", "[", 
   RowBox[{
    RowBox[{"N", "@", 
     RowBox[{"Eigenvalues", "@", 
      RowBox[{"HamKagome", "[", 
       RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "]"}]}]}], ",", " ", 
    "Less"}], "]"}]}]}], "Input",
 CellChangeTimes->{
  3.545825155715281*^9, {3.7966174270224843`*^9, 3.7966175338130503`*^9}, {
   3.7966176264954414`*^9, 3.7966176716597023`*^9}, {3.796618952549952*^9, 
   3.79661901370278*^9}, {3.796619102795657*^9, 3.7966192609389124`*^9}, {
   3.796619583746258*^9, 3.796619651965397*^9}, {3.79661968750343*^9, 
   3.796619687978181*^9}, {3.7966197635670877`*^9, 3.7966197689616685`*^9}, {
   3.796620201692438*^9, 3.796620202047489*^9}, {3.7966269043887315`*^9, 
   3.7966269048054843`*^9}, {3.7966270431388254`*^9, 
   3.7966270580689135`*^9}, {3.796628625439274*^9, 3.7966286255362306`*^9}, {
   3.796629038609815*^9, 3.796629059489088*^9}, {3.796632724042592*^9, 
   3.7966327255737534`*^9}, {3.796633842600733*^9, 3.796633851950009*^9}, {
   3.7966959397931557`*^9, 3.796695989675632*^9}, {3.796697834050276*^9, 
   3.7966978364548454`*^9}},
 CellLabel->
  "In[517]:=",ExpressionUUID->"2264dbc4-d00c-49a5-99f1-63aeea4c526d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Psi]i", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", 
     SuperscriptBox["dimKagome", "2"]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
    "\[Psi]i", "\[LeftDoubleBracket]", "n0", "\[RightDoubleBracket]"}], " ", 
    "=", " ", "1"}], ";"}], "\[IndentingNewLine]", "\n", 
  RowBox[{"(*", "    ", 
   RowBox[{
    RowBox[{"--", 
     RowBox[{"--", " ", "Load"}]}], " ", 
    RowBox[{
     RowBox[{"lattice", "--"}], "--"}]}], "    ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]", "[", "t_", "]"}], "=", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ci", "[", "n", "]"}], "[", "t", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "1", ",", 
       SuperscriptBox["dimKagome", "2"]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cs", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{"ci", "[", "n", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "1", ",", 
       SuperscriptBox["dimKagome", "2"]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ics", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ci", "[", "n", "]"}], "[", "0", "]"}], "\[Equal]", 
      RowBox[{
      "\[Psi]i", "\[LeftDoubleBracket]", "n", "\[RightDoubleBracket]"}]}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "1", ",", 
       SuperscriptBox["dimKagome", "2"]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"equation", " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Psi]", "'"}], "[", "t", "]"}], "\[Equal]", " ", 
     RowBox[{
      RowBox[{"-", "\[ImaginaryI]"}], " ", 
      RowBox[{
       RowBox[{"HamKagomeLoad", "[", 
        RowBox[{"kX0", ",", "kY0", ",", "LatDep", ",", "t"}], "]"}], ".", 
       RowBox[{"\[Psi]", "[", "t", "]"}]}]}]}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Solve", " ", "the", " ", "main", " ", "Schrodinger", " ", "equation"}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"soln", " ", "=", " ", 
   RowBox[{"NDSolve", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "TLoad"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Psi]Load", "[", "t_", "]"}], "=", 
    RowBox[{
     RowBox[{"\[Psi]", "[", "t", "]"}], "/.", 
     RowBox[{
     "soln", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
   ";"}], "\n", "\n", "\n", 
  RowBox[{"(*", "    ", 
   RowBox[{
    RowBox[{"--", 
     RowBox[{"--", " ", "Bloch"}]}], " ", 
    RowBox[{
     RowBox[{"oscillate", " ", "--"}], "--"}]}], "    ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"ci", ",", " ", "\[Psi]"}], "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]", "[", "t_", "]"}], "=", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ci", "[", "n", "]"}], "[", "t", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "1", ",", 
       SuperscriptBox["dimKagome", "2"]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cs", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{"ci", "[", "n", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "1", ",", 
       SuperscriptBox["dimKagome", "2"]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ics", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ci", "[", "n", "]"}], "[", "0", "]"}], "\[Equal]", 
      RowBox[{
       RowBox[{"\[Psi]Load", "[", "TLoad", "]"}], "\[LeftDoubleBracket]", "n",
        "\[RightDoubleBracket]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "1", ",", 
       SuperscriptBox["dimKagome", "2"]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"equation", " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Psi]", "'"}], "[", "t", "]"}], "\[Equal]", " ", 
     RowBox[{
      RowBox[{"-", "\[ImaginaryI]"}], " ", 
      RowBox[{
       RowBox[{"HamKagome", "[", 
        RowBox[{"kX0", ",", "kY0", ",", "LatDep", ",", "t"}], "]"}], ".", 
       RowBox[{"\[Psi]", "[", "t", "]"}]}]}]}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Solve", " ", "the", " ", "main", " ", "Schrodinger", " ", "equation"}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"soln", " ", "=", " ", 
   RowBox[{"NDSolve", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "TBloch"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Psi]Bloch", "[", "t_", "]"}], "=", 
    RowBox[{
     RowBox[{"\[Psi]", "[", "t", "]"}], "/.", 
     RowBox[{
     "soln", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
   ";"}], "\n", "\n", "\n", 
  RowBox[{"(*", "    ", 
   RowBox[{
    RowBox[{"--", 
     RowBox[{"--", " ", "Unload"}]}], " ", 
    RowBox[{
     RowBox[{"lattice", "--"}], "--"}]}], "    ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"ci", ",", " ", "\[Psi]"}], "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]", "[", "t_", "]"}], "=", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ci", "[", "n", "]"}], "[", "t", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "1", ",", 
       SuperscriptBox["dimKagome", "2"]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cs", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{"ci", "[", "n", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "1", ",", 
       SuperscriptBox["dimKagome", "2"]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ics", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ci", "[", "n", "]"}], "[", "0", "]"}], "\[Equal]", 
      RowBox[{
       RowBox[{"\[Psi]Bloch", "[", "TBloch", "]"}], "\[LeftDoubleBracket]", 
       "n", "\[RightDoubleBracket]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "1", ",", 
       SuperscriptBox["dimKagome", "2"]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"equation", " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Psi]", "'"}], "[", "t", "]"}], "\[Equal]", " ", 
     RowBox[{
      RowBox[{"-", "\[ImaginaryI]"}], " ", 
      RowBox[{
       RowBox[{"HamKagomeUnload", "[", 
        RowBox[{"kX0", ",", "kY0", ",", "LatDep", ",", "t"}], "]"}], ".", 
       RowBox[{"\[Psi]", "[", "t", "]"}]}]}]}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Solve", " ", "the", " ", "main", " ", "Schrodinger", " ", "equation", " ",
     "for", " ", "Bragg"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"soln", " ", "=", " ", 
   RowBox[{"NDSolve", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"equation", ",", "ics"}], "}"}], ",", "cs", ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "TLoad"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Psi]Unload", "[", "t_", "]"}], "=", 
    RowBox[{
     RowBox[{"\[Psi]", "[", "t", "]"}], "/.", 
     RowBox[{
     "soln", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
   ";"}], "\n", "\n", "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"Plot", " ", "all", " ", "outputs"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"loadPt", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"Evaluate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Hold", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"Abs", "[", 
            RowBox[{"\[Psi]Load", "[", "t", "]"}], "]"}], "2"], 
          "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Range", "@", 
        SuperscriptBox["dimKagome", "2"]}]}], "]"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "TLoad"}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"boPt", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"Evaluate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Hold", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"Abs", "[", 
            RowBox[{"\[Psi]Bloch", "[", 
             RowBox[{"t", "-", "TLoad"}], "]"}], "]"}], "2"], 
          "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Range", "@", 
        SuperscriptBox["dimKagome", "2"]}]}], "]"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "TLoad", ",", 
       RowBox[{"TLoad", "+", "TBloch"}]}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"unloadPt", " ", "=", " ", 
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"Evaluate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Hold", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"Abs", "[", 
            RowBox[{"\[Psi]Unload", "[", 
             RowBox[{"t", "-", "TLoad", "-", "TBloch"}], "]"}], "]"}], "2"], 
          "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], "]"}], 
        "&"}], "/@", 
       RowBox[{"Range", "@", 
        SuperscriptBox["dimKagome", "2"]}]}], "]"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{"TLoad", "+", "TBloch"}], ",", 
       RowBox[{
        RowBox[{"2", " ", "TLoad"}], "+", "TBloch"}]}], "}"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"loadPt", ",", "boPt", ",", "unloadPt"}], "}"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "Input",
 CellChangeTimes->{
  3.545825155715281*^9, {3.796617986341169*^9, 3.7966181503972893`*^9}, {
   3.796618240709859*^9, 3.7966182442404175`*^9}, {3.7966183556595592`*^9, 
   3.79661852625169*^9}, {3.7966185649542255`*^9, 3.7966187682782993`*^9}, {
   3.7966189361993628`*^9, 3.796618948258814*^9}, {3.796619298388797*^9, 
   3.796619375784101*^9}, {3.7966194129327908`*^9, 3.7966194158031178`*^9}, {
   3.7966194663838987`*^9, 3.796619538716049*^9}, {3.7966197052011185`*^9, 
   3.7966197482719765`*^9}, {3.7966198198536177`*^9, 
   3.7966198875167546`*^9}, {3.796619923266387*^9, 3.796620012029601*^9}, {
   3.79662005856021*^9, 3.796620059390989*^9}, {3.7966201044455805`*^9, 
   3.796620137946534*^9}, {3.7966202162909255`*^9, 3.7966202906805706`*^9}, {
   3.7966269247239075`*^9, 3.7966269511575837`*^9}, {3.7966270108084526`*^9, 
   3.796627028261245*^9}, {3.796627089778681*^9, 3.7966271142008133`*^9}, {
   3.796627485152667*^9, 3.7966275163327827`*^9}},
 CellLabel->
  "In[554]:=",ExpressionUUID->"4f395d15-4fb3-4d7c-8c8b-9d95401a9008"]
}, Open  ]],

Cell["Now I\[CloseCurlyQuote]ll make a function to plot any state", "Text",
 CellChangeTimes->{{3.796627749117401*^9, 
  3.7966277621599703`*^9}},ExpressionUUID->"87c7a58b-968f-42be-91ee-\
46235eec0ed7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PlotState", "[", 
    RowBox[{"some\[Psi]_", ",", 
     RowBox[{"plotLabel_:", "\"\<Momentum space wavefunction\>\""}]}], "]"}], 
   ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Psi]", " ", "=", " ", "some\[Psi]"}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"State", " ", "=", " ", "0"}], ";", "\n", "\n", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "Loop", " ", "over", " ", "the", " ", "elements", " ", "of", " ", 
         "the", " ", "state", " ", "vector"}], ",", " ", 
        RowBox[{
        "add", " ", "an", " ", "exponential", " ", "to", " ", "the", " ", 
         "output"}]}], " ", "*)"}], "\n", "\t", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"k", "=", "1"}], ",", 
        RowBox[{"k", "\[LessEqual]", " ", 
         SuperscriptBox["dimKagome", "2"]}], ",", 
        RowBox[{"k", "++"}], ",", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{
         "Check", " ", "the", " ", "stagger", " ", "of", " ", "the", " ", 
          "row"}], "*)"}], "\n", "\t\t", 
        RowBox[{
         RowBox[{"stag", " ", "=", " ", 
          RowBox[{"Mod", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"k", "-", "1"}], ")"}], "/", "dimKagome"}], "]"}], 
               ",", "2"}], "]"}], " ", "+", " ", 
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"dimKagome", "-", "1"}], ")"}], "/", "2"}], "]"}], 
               ",", "2"}], "]"}]}], ",", "2"}], "]"}]}], ";", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"Update", " ", "ky", " ", "which", " ", 
           RowBox[{"doesn", "'"}], "t", " ", "depend", " ", "on", " ", 
           "stagger"}], "*)"}], "\n", "\t\t", 
         RowBox[{"ky", " ", "=", " ", 
          RowBox[{
           FractionBox[
            SqrtBox["3"], "2"], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"dimKagome", "-", "1"}], ")"}], "/", "2"}], "-", 
             RowBox[{"Floor", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"k", "-", "1"}], ")"}], "/", "dimKagome"}], "]"}]}], 
            ")"}]}]}], ";", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"Update", " ", "kx"}], "*)"}], "\n", "\t\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"stag", "\[Equal]", "0"}], ",", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"kx", " ", "=", " ", 
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"k", "-", "1"}], ",", "dimKagome"}], "]"}], "-", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dimKagome", "-", "1"}], ")"}], "/", "2"}]}]}], 
            ";"}]}], "\n", "\t\t", "]"}], ";", "\n", "\t\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"stag", ">", "0"}], ",", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"kx", " ", "=", " ", 
             RowBox[{"0.5", "+", 
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"k", "-", "1"}], ",", "dimKagome"}], "]"}], "-", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dimKagome", "-", "1"}], ")"}], "/", "2"}]}]}], 
            ";"}]}], "\n", "\t\t", "]"}], ";", "\n", "\n", "\t\t", 
         RowBox[{"State", " ", "=", " ", 
          RowBox[{"State", " ", "+", " ", 
           RowBox[{
            RowBox[{
            "\[Psi]", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}], 
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"kX", "-", "kx"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"kY", "-", "ky"}], ")"}], "2"]}], ")"}]}], "/", 
              SuperscriptBox["0.2", "2"]}], "]"}]}]}]}], ";"}]}], "\n", "\t", 
       "]"}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{"Quiet", "@", 
       RowBox[{"DensityPlot", "[", 
        RowBox[{
         RowBox[{"Abs", "[", "State", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"kX", ",", 
           RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"kY", ",", 
           RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", " ", 
         RowBox[{"ColorFunction", "\[Rule]", "\"\<SunsetColors\>\""}], ",", 
         " ", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"Style", "[", 
           RowBox[{"plotLabel", ",", 
            RowBox[{"FontSize", "\[Rule]", " ", "20"}]}], "]"}]}], ",", " ", 
         RowBox[{"PlotPoints", "\[Rule]", "100"}]}], "]"}]}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{"PlotState", "[", 
  RowBox[{"\[Psi]Unload", "[", "0", "]"}], "]"}]}], "Input",
 CellChangeTimes->{
  3.545825155715281*^9, {3.796627768331952*^9, 3.7966278799773164`*^9}, {
   3.796627934612235*^9, 3.7966279644408154`*^9}, {3.79662801533729*^9, 
   3.7966280217892847`*^9}, {3.796628101534006*^9, 3.7966282167158656`*^9}, {
   3.7966282675934157`*^9, 3.7966285517902956`*^9}, {3.7966286046060843`*^9, 
   3.7966286086737695`*^9}, {3.796628649979334*^9, 3.7966286930897694`*^9}, {
   3.796628887429346*^9, 3.796629001317545*^9}, 3.796629087662287*^9, {
   3.796631649594755*^9, 3.796631702885392*^9}, {3.7966317681281366`*^9, 
   3.7966319160242724`*^9}, {3.796632012102419*^9, 3.79663201330235*^9}, {
   3.796633642063418*^9, 3.796633661331416*^9}, {3.7966347857939415`*^9, 
   3.7966348430446267`*^9}, {3.796697080403133*^9, 3.7966971415217934`*^9}, {
   3.7967329833181114`*^9, 3.7967329836951065`*^9}},
 CellLabel->
  "In[582]:=",ExpressionUUID->"a1180329-fdf1-44b4-ad35-493aeac11d00"]
}, Open  ]]
},
WindowSize->{1280, 717},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
Magnification:>1.25 Inherited,
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"DarkColors.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 1063, 15, 103, "Title",ExpressionUUID->"ce6a7457-966c-4055-8c1e-327ce4c030af"],
Cell[1646, 39, 1070, 15, 84, "Section",ExpressionUUID->"38b5bb29-6262-45c1-9498-d468e3abe42e"],
Cell[2719, 56, 4870, 137, 582, "Text",ExpressionUUID->"ae1c271f-16fb-44ee-ab18-5b46d1f74a8d"],
Cell[CellGroupData[{
Cell[7614, 197, 5430, 128, 495, "Input",ExpressionUUID->"a456c568-889c-4150-a70d-10be18d420d2"],
Cell[13047, 327, 1903, 26, 84, "Section",ExpressionUUID->"7189b5c7-0906-484a-92cf-bccdb1760a41"]
}, Open  ]],
Cell[14965, 356, 3205, 49, 404, "Text",ExpressionUUID->"d1650bb4-a6ec-47f8-8d1e-9dcc5baaf02f"],
Cell[CellGroupData[{
Cell[18195, 409, 7726, 195, 716, "Input",ExpressionUUID->"814ccb6e-f8b5-4389-8b25-8a7a9e3511f9"],
Cell[25924, 606, 230, 4, 84, "Section",ExpressionUUID->"ea5dbacf-ec14-4ba1-814d-0681af11b536"]
}, Open  ]],
Cell[26169, 613, 1711, 38, 248, "Text",ExpressionUUID->"261711cc-c999-4128-ad4d-bb5dc46a1ae1"],
Cell[27883, 653, 30693, 653, 4428, "Input",ExpressionUUID->"bdf6ae7e-6580-4850-b308-73c94844a7da"],
Cell[58579, 1308, 302, 7, 40, "Text",ExpressionUUID->"54482a2d-de6b-4732-a459-c18164ef0b28"],
Cell[58884, 1317, 2069, 57, 473, "Input",ExpressionUUID->"95d63d15-0366-4f2d-b789-fb31fa4afa19"],
Cell[60956, 1376, 598, 11, 92, "Text",ExpressionUUID->"31880a06-d092-4fd0-9574-46d857b8d139"],
Cell[61557, 1389, 8241, 187, 692, "Input",ExpressionUUID->"30c1e600-2b6b-4ec6-afc2-c02b3afe9692"],
Cell[69801, 1578, 293, 7, 40, "Text",ExpressionUUID->"09f1ef94-c2f6-4945-a0be-2f78606126fd"],
Cell[CellGroupData[{
Cell[70119, 1589, 5658, 148, 857, "Input",ExpressionUUID->"2264dbc4-d00c-49a5-99f1-63aeea4c526d"],
Cell[75780, 1739, 11350, 331, 1527, "Input",ExpressionUUID->"4f395d15-4fb3-4d7c-8c8b-9d95401a9008"]
}, Open  ]],
Cell[87145, 2073, 203, 3, 40, "Text",ExpressionUUID->"87c7a58b-968f-42be-91ee-46235eec0ed7"],
Cell[87351, 2078, 6210, 148, 921, "Input",ExpressionUUID->"a1180329-fdf1-44b4-ad35-493aeac11d00"]
}, Open  ]]
}
]
*)

